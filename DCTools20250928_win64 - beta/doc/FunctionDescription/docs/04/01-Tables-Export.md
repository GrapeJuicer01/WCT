# 配置数据导出

标签（空格分隔）： 未分类

Last Update : 20200623

## 主界面
![配置数据导出](doc/FunctionDescription/img/04/01-数据导出主界面.png)

## 基本功能说明
把配置好的业务数据，导出形成文件，给CMO/其他环境进行导入

## 输入
- Control File： 数据导出的配置文件
> 默认路径：config->DataExtract
- 数据库中的具体的数据
    
## 输出 
一个数据文件
## 功能详细说明：
- Control File 
> 数据导出的配置文件
- Package File
> 导出数据包的目录与文件名
- DB Structure: 
> 如果需要将表的表结构同时导出，则需要勾选此项。此选项可用于将源库中表结构同步到目标库中
- Released By Increment
> 如果希望导入时先进行数据的比对，只导入有差异的数据，则需要勾选此项。如果勾选了此项需保证所有需要导出的表都有主键，如果表本身没有主键需要在导出的配置文件中添加表的主键，以便导入时做数据的比对
- Is Multi-user?
> 如果希望一次导出多个数据库用户的数据，则需要勾选此项。勾选此项后在导出时会先连接数据库

#### 配置文件介绍
配置文件的文件名后缀必需为’yaml’，单用户导出时的配置文件样例如图所示：
-
![导出配置文件样例1](doc/FunctionDescription/img/04/02-导出配置文件样例1.png)

![导出配置文件样例2](doc/FunctionDescription/img/04/02-导出配置文件样例2.png)
- TableList
> 配置需要导出的表名，不区分大小写，如果表名拼写错误或配置的表名不存界面的debug日志会有提示。
- TableSql
> 配置导出表数据时的查询语句，如果某张表只需要导出部分数据则需要在该标签下配置相应的查询语句。该标签也可以控制只导出表的部分字段，当源库中表的字段数多于目标库中表的字段数时需要配置该表的查询语句控制导出的字段。
- DeleteSql
> 配置导入目标库时删除目标表数据的删除语句，支持配置多条，如果配置了删除语句，则会使用配置的删除语句覆盖自动生成的删除目标表数据的语句。如果为UDAL数据库，则会先使用自动生成的带_rowid的删除语句，删除目标表的数据，如果该表不存在_rowid字段，则使用配置的删除语句，否则使用自动生成的不带_rowid的删除语句删除目标表的数据。即优先级为_rowid>DeleteSql>自动生成的删除语句。
- BeforeImportSql
> 配置数据导入前需要执行的sql语句。数据导出时不会做任何处理，当将导出的数据导入到目标库前会执行该标签下配置的sql。
- AfterImportSql
> 配置数据导入后需要执行的sql语句。数据导出时不会做任何处理，当将导出的数据导入到目标库后会执行该标签下配置的sql。
- ThreadNumber
> 配置导出时并行数量，最好不要超过8，在导入时也会用该数值控制并行导入的并行数，并且每个并行会再开多个线程。
- TablePrimaryKey
> 配置表的主键。当界面勾选增量导出时，如果表不存在主键则需要在该标签下配置表的主键。
- PageLimit
> 翻页数， 如果udal数据库限制了每次查询返回的记录数，则需要配置这个参数，参数的值需要***严格***与udal库每次能查询的最大记录数一致，比如1000(e.g某张表在数据库的总记录数超过1000，如果参数设置值为10000，这个时候因为数据库限制一次只能查询1000条，然而翻页数是10000，导致不能翻页只能导出1000条)，如果数据库没有查询限制，则不需要配置。默认为100000000000

多用户数据导出的配置文件样例如下：
-
![多用户的配置文件样例](doc/FunctionDescription/img/04/03-多用户配置文件样例.png)
- UserNameList
> 该标签下配置每个用户对应的导出的配置文件名，这些配置文件必需在相同的目录下

