create:
  DC_TEMPLATE_OFFER:
    - |
        CREATE TABLE DC_TEMPLATE_OFFER
        (
          TEMPLATE_NAME   VARCHAR2(200)  NOT NULL,
          OFFER_NAME VARCHAR2(250),
          OBJECT_TYPE VARCHAR2(10),
          OLD_OFFER_ID    VARCHAR2(20)
        )
    - comment on table DC_TEMPLATE_OFFER is  'TEMPLATE RELATIONSHIP WITH OFFER'
    - comment on column DC_TEMPLATE_OFFER.TEMPLATE_NAME is  'Advice template name and is the only one'
    - comment on column DC_TEMPLATE_OFFER.OFFER_NAME is  'Object name. Leave null if there are no objects.'
    - comment on column DC_TEMPLATE_OFFER.OFFER_NAME is  'Object type, offer or product'
    - comment on column DC_TEMPLATE_OFFER.OLD_OFFER_ID is  'OFFER_ID of old system which is not the necessary'
  DC_MSG_TEMPLATE:
    - |
        create table DC_MSG_TEMPLATE
        (
          TEMPLATE_NAME   VARCHAR2(200)  not null,
          LANGUAGE_NAME             VARCHAR2(30)  not null ,
          TEXT            VARCHAR2(4000) not null,
          SUBJECT         VARCHAR2(1024)
        )
    - comment on table DC_MSG_TEMPLATE is  'Advince Template'
    - comment on column DC_MSG_TEMPLATE.TEMPLATE_NAME is  'Template Name'
    - comment on column DC_MSG_TEMPLATE.LANGUAGE_NAME is  'Language Name.Domain:attr_value where attr_id = (select attr_id from attr_spec where attr_nbr = INT_SUBS_LANGUAGE)'
    - comment on column DC_MSG_TEMPLATE.TEXT is  'Advice content.Paramer format:${MSISDN}'
    - comment on column DC_MSG_TEMPLATE.SUBJECT is  'If email, it must be configed'

  DC_CIC_TEMPLATE_REL:
    - |
      create table DC_CIC_TEMPLATE_REL
      (
        TEMPLATE_NAME   VARCHAR2(200)  not null,
        TEMPLATE_LABEL_NAME VARCHAR2(64) ,
        EVENT_CODE	VARCHAR2(120) not null,
        CATALOG_NAME    VARCHAR2(32) not null,
        SRC_NBR      VARCHAR2(128) ,
        REG_DELIVERY    CHAR(1),
        FLASH_SMS       CHAR(1),
        TIME_WINDOW     VARCHAR2(32) ,
        ACTION_NAME	  VARCHAR2(64) not null,
        ACTION_PARAM_CODE VARCHAR2(32),
        ATTR_CODE_PATH  VARCHAR2(128),
        ENRICH_SERVICE_NAME  VARCHAR2(32),
        FIELD_CODE_PATH VARCHAR2(128),
        FEEDBACK_STATE   CHAR(1),
        CONTENT_FORMAT  VARCHAR2(8),
        MAIL_CC   VARCHAR2(128),
        MAIL_CC_INPUT_TYPE VARCHAR2(8),
        ATTACH_FILE_URL VARCHAR2(128),
        ATTACH_FILE_URL_INPUT_TYPE VARCHAR2(8)
      )
    - comment on table DC_CIC_TEMPLATE_REL is  'MSG Template Relatived Detail Infomation'
    - comment on column DC_CIC_TEMPLATE_REL.TEMPLATE_NAME is  'Template Name'
    - comment on column DC_CIC_TEMPLATE_REL.TEMPLATE_LABEL_NAME is  'Template label Name. Domain:cic.cic_lable'
    - comment on column DC_CIC_TEMPLATE_REL.EVENT_CODE is  'Event Code.Domain:cic.cic_event'
    - comment on column DC_CIC_TEMPLATE_REL.CATALOG_NAME is  'just support SMS Catalog'
    - comment on column DC_CIC_TEMPLATE_REL.SRC_NBR is  'just support sms channel'
    - comment on column DC_CIC_TEMPLATE_REL.REG_DELIVERY is  'SMS Receipt:Y N,EMAIL:null'
    - comment on column DC_CIC_TEMPLATE_REL.FLASH_SMS is  ''
    - comment on column DC_CIC_TEMPLATE_REL.TIME_WINDOW is  'Msg time window like 9:00-18:00. Domain:cic.cic_contact_time_window'
    - comment on column DC_CIC_TEMPLATE_REL.ACTION_NAME is  'Just support Send SMS'
    - comment on column DC_CIC_TEMPLATE_REL.ACTION_PARAM_CODE is  'According to SELECT ce.service_id,cp.param_code FROM cic.cic_reg_service ce,cic.Cic_Input_Param cp where ce.reg_service_id = cp.reg_service_id'
    - comment on column DC_CIC_TEMPLATE_REL.ATTR_CODE_PATH is  ''
    - comment on column DC_MSG_TEMPLATE_JUDGE.ENRICH_SERVICE_NAME is  'ENRICH SERVICE NAME.Domain:cic.cic_enrich_service'
    - comment on column DC_MSG_TEMPLATE_JUDGE.FIELD_CODE_PATH is  'FIELD CODE PATH.Domain:cic.cic_serv_rtn'
    - comment on column DC_CIC_TEMPLATE_REL.FEEDBACK_STATE is  'Default is N'
    - comment on column DC_CIC_TEMPLATE_REL.CONTENT_FORMAT is  'It must be configed when EMail'
    - comment on column DC_CIC_TEMPLATE_REL.MAIL_CC is  'When Email,it maybe config'
    - comment on column DC_CIC_TEMPLATE_REL.MAIL_CC_INPUT_TYPE is  'When Email,it maybe config'
    - comment on column DC_CIC_TEMPLATE_REL.ATTACH_FILE_URL is  'When Email,it maybe config'
    - comment on column DC_CIC_TEMPLATE_REL.ATTACH_FILE_URL_INPUT_TYPE is  'When Email,it maybe config'

  DC_MSG_TEMPLATE_PARAM:
    - |
      create table DC_MSG_TEMPLATE_PARAM
      (
        TEMPLATE_NAME   VARCHAR2(200)  ,
        EVENT_CODE	VARCHAR2(120) ,
        ATTR_CODE_PATH    VARCHAR2(128),
        DIM_NAME VARCHAR2(200)  ,
        DIM_FIELD_CODE_PATH VARCHAR2(128),
        ENRICH_SERVICE_NAME  VARCHAR2(32),
        FIELD_CODE_PATH VARCHAR2(128),
        OLD_PARAM_NAME			VARCHAR2(100),
        CONFIG_CODE VARCHAR2(60) ,
        IS_SUBJECT CHAR(1)
      )
    - comment on table DC_MSG_TEMPLATE_PARAM is  'MSG Parameter Detail Info'
    - comment on column DC_MSG_TEMPLATE_PARAM.TEMPLATE_NAME is  'TEMPLATE_NAME'
    - comment on column DC_MSG_TEMPLATE_PARAM.EVENT_CODE is  'Event Code'
    - comment on column DC_MSG_TEMPLATE_PARAM.ATTR_CODE_PATH is  'Event Attribute Code Path'
    - comment on column DC_MSG_TEMPLATE_PARAM.DIM_NAME is  'DIM_NAME'
    - comment on column DC_MSG_TEMPLATE_PARAM.DIM_FIELD_CODE_PATH is  'Service Field Code Path like ${resp.otcSumDtoList.charge}'
    - comment on column DC_MSG_TEMPLATE_PARAM.ENRICH_SERVICE_NAME is  'Service Name'
    - comment on column DC_MSG_TEMPLATE_PARAM.FIELD_CODE_PATH is  'Service Field Code Path like ${resp.otcSumDtoList.charge}'
    - comment on column DC_MSG_TEMPLATE_PARAM.OLD_PARAM_NAME is  'Old System Parameter must be like ${***}'
    - comment on column DC_MSG_TEMPLATE_PARAM.CONFIG_CODE is  'CONFIG_CODE must be like ${CD@***}'
    - comment on column DC_MSG_TEMPLATE_PARAM.IS_SUBJECT is  'IS_SUBJECT is EMAIL subject'

  DC_MSG_TEMPLATE_JUDGE:
    - |
       create table DC_MSG_TEMPLATE_JUDGE
       (
         TEMPLATE_NAME   VARCHAR2(200)  ,
         TEMPLATE_LABEL_NAME VARCHAR2(64) ,
         EVENT_CODE	VARCHAR2(120) ,
         ATTR_CODE_PATH    VARCHAR2(128),
         DIM_NAME VARCHAR2(200)  ,
         DIM_FIELD_CODE_PATH VARCHAR2(128),
         ENRICH_SERVICE_NAME  VARCHAR2(32),
         FIELD_CODE_PATH VARCHAR2(128),
         BLOCK_ID			NUMBER(3),
         OPERATOR_NAME		VARCHAR2(32),
         INPUT_VALUE 		VARCHAR2(120)
       )
    - comment on table DC_MSG_TEMPLATE_JUDGE is  'MSG Judge Condition just for used event code,not support template'
    - comment on column DC_MSG_TEMPLATE_JUDGE.TEMPLATE_NAME is 'Template Name'
    - comment on column DC_MSG_TEMPLATE_JUDGE.TEMPLATE_LABEL_NAME is  'Template LABEL Name.Domain:cic.cic_lable'
    - comment on column DC_MSG_TEMPLATE_JUDGE.EVENT_CODE is  'Event Code.Domain:cic.cic_event'
    - comment on column DC_MSG_TEMPLATE_JUDGE.ATTR_CODE_PATH is  'ATTR CODE PATH.Domain:cic.cic_inter_event_attr'
    - comment on column DC_MSG_TEMPLATE_JUDGE.ENRICH_SERVICE_NAME is  'ENRICH SERVICE NAME.Domain:cic.cic_enrich_service'
    - comment on column DC_MSG_TEMPLATE_JUDGE.FIELD_CODE_PATH is  'FIELD CODE PATH.Domain:cic.cic_serv_rtn'
    - comment on column DC_MSG_TEMPLATE_JUDGE.BLOCK_ID is  'BLOCK ID used for sorting'
    - comment on column DC_MSG_TEMPLATE_JUDGE.OPERATOR_NAME is  '1:>=,2:<=,3:<,4:>,5:In,6:Not In,7:=,8:!=,9:Is Empty,15:Is Not Empty,10:Contain,11:Begin with,12:End with'
    - comment on column DC_MSG_TEMPLATE_JUDGE.INPUT_VALUE is  'Judge condition value.If offer keep null'

  DC_CIC_PROCESS:
    - |
      CREATE TABLE DC_CIC_PROCESS
      (
        FLOW_NAME   VARCHAR2(200)  NOT NULL,
        PROCESS_NAME VARCHAR2(200) NOT NULL,
        PROCESS_TYPE_NAME VARCHAR2(200) NOT NULL,
        ACTION_NAME   VARCHAR2(64) ,
        PROCESS_IMAGE VARCHAR2(120) NOT NULL,
        FROM_PROCESS_NAME   VARCHAR2(200)  ,
        FIX_OUTPUT_PARAM_NAME VARCHAR2(32),
        CONDITION_OPER      VARCHAR2(8),
        INPUT_VALUE         VARCHAR2(256),
        PROCESS_ID    NUMBER(6),
        PARENT_PROCESS_ID    NUMBER(6),
        PROCESS_NODE VARCHAR2(120),
        R_PROCESS_ID NUMBER(6),
        FLOW_LABEL_NAME VARCHAR2(64)
      )
    - comment on table DC_CIC_PROCESS is  'PROCESS ON THE FLOW'
    - comment on column DC_CIC_PROCESS.FLOW_NAME is  'FLOW NAME and is the only one'
    - comment on column DC_CIC_PROCESS.PROCESS_NAME is  'When it is the start node, it must be the same with event code'
    - comment on column DC_CIC_PROCESS.PROCESS_TYPE_NAME is  'PROCESS TYPE NAME'
    - comment on column DC_CIC_PROCESS.ACTION_NAME is  'IF PROCESS_TYPE_NAME IS ACTION, it must be configed.'
    - comment on column DC_CIC_PROCESS.PROCESS_IMAGE is  'PROCESS ICON'
    - comment on column DC_CIC_PROCESS.FROM_PROCESS_NAME is 'CONNECT TO PROCESS NAME'
    - comment on column DC_CIC_PROCESS.FIX_OUTPUT_PARAM_NAME is 'If judgement the default value is Result, else is null'
    - comment on column DC_CIC_PROCESS.CONDITION_OPER is 'CONDITION OPER'
    - comment on column DC_CIC_PROCESS.INPUT_VALUE is 'INPUT_VALUE'
    - comment on column DC_CIC_PROCESS.PROCESS_ID is  'Which is child process id. And action should be high priority at the same parent_id'
    - comment on column DC_CIC_PROCESS.PARENT_PROCESS_ID is  'Which is parent id'
    - comment on column DC_CIC_PROCESS.PROCESS_NODE is  'Which is not configed'
    - comment on column DC_CIC_PROCESS.R_PROCESS_ID is  'Which is not configed'

  DC_CIC_ACTION_PARAM_VALUE:
    - |
      CREATE TABLE DC_CIC_ACTION_PARAM_VALUE
      (
        PROCESS_NAME      VARCHAR2(200) NOT NULL,
        ACTION_PARAM_NAME    VARCHAR2(128) not null,
        INPUT_VALUE_TYPE     VARCHAR2(8),
        ATTR_CODE_PATH    VARCHAR2(128),
        ENRICH_SERVICE_NAME  VARCHAR2(32),
        FIELD_CODE_PATH VARCHAR2(128),
        INPUT_VALUE          VARCHAR2(128),
        CAL_EXPRESSION_NAME  VARCHAR2(32),
        SPLIT_PARAM_NAME     VARCHAR2(32),
        ACTION_FIELD_NAME    VARCHAR2(32),
        FIX_OUTPUT_NAME      VARCHAR2(32),
        ACM_NAME             VARCHAR2(32),
        OBJ_DIM_RTN_FIELD_NAME VARCHAR2(32)
      )
    - comment on table DC_CIC_ACTION_PARAM_VALUE is  'PARAM OF ACTION'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.PROCESS_NAME is  'PROCESS NAME'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.INPUT_VALUE_TYPE is  'AS：Action返回属性，EV：EVENT，ES：enrich Service，CA：计算表达式，IP：用户输入参数，ARS：数组对象，IV：输入值'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.ATTR_CODE_PATH is  'Event Attribute Code Path'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.ENRICH_SERVICE_NAME is  'Service Name'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.FIELD_CODE_PATH is  'Service Field Code Path'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.INPUT_VALUE is  'INPUT PARAM VALUE'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.CAL_EXPRESSION_NAME is  'Which is not configed'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.SPLIT_PARAM_NAME is  'Which is not configed'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.ACTION_FIELD_NAME is  'Which is not configed'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.FIX_OUTPUT_NAME is  'Which is not configed'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.ACM_NAME is  'Which is not configed'
    - comment on column DC_CIC_ACTION_PARAM_VALUE.OBJ_DIM_RTN_FIELD_NAME is  'Which is not configed'

  DC_EncodeBASE64:
    - |
      CREATE OR REPLACE FUNCTION DC_EncodeBASE64(InClearChar IN OUT NOCOPY CLOB)

       RETURN CLOB IS
        dest_lob     BLOB;
        lang_context INTEGER := DBMS_LOB.DEFAULT_LANG_CTX;
        dest_offset  INTEGER := 1;
        src_offset   INTEGER := 1;
        read_offset  INTEGER := 1;
        warning      INTEGER;
        ClobLen      INTEGER := DBMS_LOB.GETLENGTH(InClearChar);

        amount INTEGER := 1440; -- must be a whole multiple of 3
        -- size of a whole multiple of 48 is beneficial to get NEW_LINE after each 64 characters
        buffer RAW(1440);
        res    CLOB := EMPTY_CLOB();

      BEGIN

        IF InClearChar IS NULL OR NVL(ClobLen, 0) = 0 THEN
          RETURN NULL;
        ELSIF ClobLen <= 24000 THEN
          RETURN UTL_RAW.CAST_TO_VARCHAR2(UTL_ENCODE.BASE64_ENCODE(UTL_RAW.CAST_TO_RAW(InClearChar)));
        END IF;
        -- UTL_ENCODE.BASE64_ENCODE is limited to 32k/(3/4), process in chunks if bigger

        DBMS_LOB.CREATETEMPORARY(dest_lob, TRUE);
        DBMS_LOB.CONVERTTOBLOB(dest_lob,
                               InClearChar,
                               DBMS_LOB.LOBMAXSIZE,
                               dest_offset,
                               src_offset,
                               DBMS_LOB.DEFAULT_CSID,
                               lang_context,
                               warning);
        LOOP
          EXIT WHEN read_offset >= dest_offset;
          DBMS_LOB.READ(dest_lob, amount, read_offset, buffer);
          res         := res ||
                         UTL_RAW.CAST_TO_VARCHAR2(UTL_ENCODE.BASE64_ENCODE(buffer));
          read_offset := read_offset + amount;
        END LOOP;
        DBMS_LOB.FREETEMPORARY(dest_lob);
        RETURN res;

      END DC_EncodeBASE64;

  DC_PROC_MSG_JUDGE:
    - |
      create or replace procedure DC_PROC_MSG_JUDGE(v_mul_flag in number,V_TEMPLATE_NAME in VARCHAR2,V_ATTR_CODE_PATH in VARCHAR2,V_DIM_NAME in VARCHAR2,V_dim_field_code_path in VARCHAR2,V_ENRICH_SERVICE_NAME in VARCHAR2,V_FIELD_CODE_PATH in VARCHAR2,V_BLOCK_ID in NUMBER,V_OPERATOR_NAME in VARCHAR2,V_EVENT_ID in NUMBER,V_MED_PROCESS_ID in NUMBER,V_INPUT_VALUE in VARCHAR)as
        -- Local variables here
        V_threshold           NUMBER;
        V_FILTER_ID           NUMBER;
        V_LEFT_OPERAND_ID     NUMBER;
        V_RIGHT_OPERAND_ID    NUMBER;
        V_OPERATOR            NUMBER(3);
        V_EVENT_ATTR_ID       NUMBER;
        V_EVENT_ATTR_ID3      NUMBER;
        C_SPLIT_ID1       NUMBER;
        C_SPLIT_ID2       NUMBER;
      begin
        C_SPLIT_ID1       := 20000;
        C_SPLIT_ID2       := 10000;
        -- Test statements here
        select case when max(filter_id) > C_SPLIT_ID1 then max(filter_id) + 1 else C_SPLIT_ID1 end
                  into V_FILTER_ID
                  from cic.CIC_RULE_FILTER;
                if V_OPERATOR_NAME is null then
                  select distinct threshold
                    into V_threshold
                    from dc_cic_trigger
                   where template_name = V_TEMPLATE_NAME;
                  SELECT operator
                    into V_OPERATOR
                    FROM cic.cic_operator
                   where operator_name = decode(V_threshold, 0, '=', '!=');
                else
                  SELECT operator
                    into V_OPERATOR
                    FROM cic.cic_operator
                   where operator_name = V_OPERATOR_NAME;
                end if;
                insert into cic.CIC_RULE_FILTER
                  (FILTER_ID, PROCESS_ID, OPERATOR, BLOCK_ID, RULE_EXP_ID)
                values
                  (V_FILTER_ID,
                   V_MED_PROCESS_ID,
                   V_OPERATOR,
                   V_block_id,
                   null);
                /*Get attribute on judgement*/
                if V_ATTR_CODE_PATH is not null and V_dim_field_code_path is null then
                  SELECT EVENT_ATTR_ID
                    into V_EVENT_ATTR_ID
                    FROM cic.cic_inter_event_attr
                   where attr_code_path = V_attr_code_path
                     and inter_event_id = V_EVENT_ID;
                elsif V_field_code_path is not null then
                  SELECT rtn_field_id
                    into V_EVENT_ATTR_ID
                    FROM cic.cic_serv_rtn csr, cic.cic_enrich_service ces
                   where csr.reg_service_id = ces.reg_service_id
                     and FIELD_CODE_PATH = V_field_code_path
                     and ENRICH_SERVICE_NAME = V_enrich_service_name;
                elsif V_dim_field_code_path is not null then
                    SELECT EVENT_ATTR_ID  into V_EVENT_ATTR_ID FROM cic.CIC_INTER_EVENT_ATTR where inter_event_id = V_EVENT_ID and attr_code_path = substr(V_attr_code_path, 3, length(V_attr_code_path) - 3);
                    SELECT rtn_field_id
                      into V_EVENT_ATTR_ID3
                      FROM cic.cic_serv_rtn csr
                     where field_code_path = substr(trim(V_dim_field_code_path), 3,length(trim(V_dim_field_code_path)) - 3)
                       and reg_service_id in (select reg_service_id
                      from cic.cic_dim_service
                     where attr_dim_id in (select ATTR_DIM_ID from cic.cic_dim where attr_dim_name = V_dim_name));
                end if;
                select case when max(LEFT_OPERAND_ID) > C_SPLIT_ID2 then max(LEFT_OPERAND_ID) + 1 else C_SPLIT_ID2 end
                  into V_LEFT_OPERAND_ID
                  from cic.CIC_LEFT_OPERAND;
                insert into cic.CIC_LEFT_OPERAND
                  (LEFT_OPERAND_ID,
                   FILTER_ID,
                   OPERAND_TYPE,
                   FUN_ID,
                   EVENT_ATTR_ID,
                   ENRICH_SERV_FIELD,
                   MEMBER_ATTR_ID,
                   CAL_EXPRESSION_ID,
                   SPLIT_PARAM_ID,
                   FIX_OUTPUT_ID,
                   ACTION_FIELD_ID,
                   ACM_ID,
                   OBJ_DIM_RTN_FIELD_ID)
                values
                  (V_LEFT_OPERAND_ID,
                   V_FILTER_ID,
                   case when V_ATTR_CODE_PATH is not null then 'EV' when
                   V_FIELD_CODE_PATH is not null then 'ES' end,
                   null,
                   decode(V_attr_code_path, null, null, V_EVENT_ATTR_ID),
                   decode(V_field_code_path, null, null, V_EVENT_ATTR_ID),
                   null,
                   null,
                   null,
                   null,
                   null,
                   null,
                   decode（V_dim_field_code_path, null, null, V_EVENT_ATTR_ID3));
              if V_INPUT_VALUE is not null then
                select case when max(RIGHT_OPERAND_ID) > C_SPLIT_ID1 then max(RIGHT_OPERAND_ID)+ 1 else C_SPLIT_ID1 end
                  into V_RIGHT_OPERAND_ID
                  from cic.CIC_RIGHT_OPERAND;
                insert into cic.CIC_RIGHT_OPERAND
                  (RIGHT_OPERAND_ID,
                   OPERAND_TYPE,
                   FUN_ID,
                   FILTER_ID,
                   EVENT_ATTR_ID,
                   ENRICH_SERV_FIELD,
                   CAL_EXPRESSION_ID,
                   MEMBER_ATTR_ID,
                   SPLIT_PARAM_ID,
                   FIX_OUTPUT_ID,
                   ACTION_FIELD_ID,
                   INPUT_VALUE,
                   OFFSET,
                   ACM_ID,
                   OBJ_DIM_RTN_FIELD_ID)
                values
                  (V_RIGHT_OPERAND_ID,
                   'IV',
                   null,
                   V_FILTER_ID,
                   null,
                   null,
                   null,
                   null,
                   null,
                   null,
                   null,
                   V_INPUT_VALUE,
                   null,
                   null,
                   null);
                  end if;
         if v_mul_flag = 1 then
          update cic.CIC_RULE
             set RULE_EXPRESSION = replace(RULE_EXPRESSION,'block'||V_BLOCK_ID,' $' || V_FILTER_ID || '$ ')
           where PROCESS_ID = V_MED_PROCESS_ID;
         else
           update cic.CIC_RULE
                   set RULE_EXPRESSION = decode(RULE_EXPRESSION,
                        null,
                        '$' || V_FILTER_ID || '$',
                        RULE_EXPRESSION || ' and ' || '$' ||
                        V_FILTER_ID || '$') where PROCESS_ID = V_MED_PROCESS_ID;
         end if;
      end;

  DC_PROC_MSG_FlowLayout:
    - |
      create or replace procedure DC_PROC_MSG_FlowLayout Authid Current_User is
              count_p               integer;
              v_flag                NUMBER;
              V_EVENT_ID            NUMBER;
              V_OPERATOR            NUMBER(3);
              v_lang_id             VARCHAR2(10);
              V_threshold           NUMBER;
              V_TIME_WIN_ID         NUMBER;
              V_EVENT_ATTR_ID       NUMBER;
              V_EVENT_ATTR_ID2      NUMBER;
              V_EVENT_ATTR_ID3      NUMBER;
              V_EVENT_FLOW_ID       NUMBER;
              V_FLOW_LABEL_ID       NUMBER;
              V_FLOW_VERSION_ID     NUMBER;
              V_TEMPLATE_ID         NUMBER;
              V_TEMPLATE_ATTR_ID    NUMBER;
              V_CONTACT_CHANNEL     NUMBER;
              V_REG_DELIVERY        CHAR(1);
              V_FLASH_SMS           CHAR(1);
              V_ACTION_ID           NUMBER(9);
              V_INPUT_VALUE_TYPE    VARCHAR2(8);
              V_input_param_id      NUMBER(9);
              V_reg_service_id      NUMBER(9);
              V_T_CATALOG_ID        NUMBER;
              V_SRC_NBR_ID          NUMBER;
              V_RTN_FIELD_ID        NUMBER;
              V_CONTENT_ID          NUMBER;
              V_LABEL_ID            NUMBER;
              V_PARAM_FIELD         VARCHAR2(128);
              V_TEMPLATE_LABEL_ID   NUMBER;
              V_FROM_PROCESS_ID     NUMBER;
              V_MED_PROCESS_ID      NUMBER;
              V_TO_PROCESS_ID       NUMBER;
              V_PROCESS_CONNECT_ID  NUMBER;
              V_PROCESS_CONNECT_ID1 NUMBER;
              V_FLOW_LAYOUT         clob;
              V_EVENT_CODE          VARCHAR2(120);
              V_START_NODE          VARCHAR2(120);
              V_END_NODE            VARCHAR2(120);
              V_MED_NODE            VARCHAR2(120);
              V_FILTER_ID           NUMBER;
              V_LEFT_OPERAND_ID     NUMBER;
              V_RIGHT_OPERAND_ID    NUMBER;
              V_INPUT_VALUE         VARCHAR2(4000);
              V_START_POINT_X       FLOAT;
              V_START_POINT_Y       FLOAT;
              V_RULE_POINT_X        FLOAT;
              V_RULE_POINT_Y        FLOAT;
              V_SMS_POINT_X         FLOAT;
              V_SMS_POINT_Y         FLOAT;
              V_IMAGE_RULE          VARCHAR2(120);
              V_IMAGE_SMS           VARCHAR2(120);
              V_TEMPLATE_LENGTH     FLOAT;
              V_SHAPE_FPOINTS_X     FLOAT;
              V_SHAPE_FPOINTS_Y     FLOAT;
              V_SHAPE_TPOINTS_X     FLOAT;
              V_SHAPE_TPOINTS_Y     FLOAT;
              V_SHAPE_EPOINTS_X     FLOAT;
              V_SHAPE_EPOINTS_Y     FLOAT;
            begin
              V_START_POINT_X   := 32;
              V_START_POINT_Y   := 75;
              V_RULE_POINT_X    := 129;
              V_RULE_POINT_Y    := 63;
              V_SMS_POINT_X     := 312;
              V_SMS_POINT_Y     := 61;
              V_SHAPE_FPOINTS_X := V_START_POINT_X + 35;
              V_SHAPE_FPOINTS_Y := V_RULE_POINT_Y + 29;
              V_SHAPE_TPOINTS_X := V_RULE_POINT_X;
              V_SHAPE_TPOINTS_Y := V_RULE_POINT_Y + 30;
              V_SHAPE_EPOINTS_X := V_RULE_POINT_X + 100;
              V_SHAPE_EPOINTS_Y := V_SHAPE_TPOINTS_Y;

              V_IMAGE_RULE := 'cic/modules/cic-event-mgr/styles/icons/icon-judgment-rule.svg';
              V_IMAGE_SMS  := 'cic/modules/cic-event-mgr/styles/icons/icon-send-sms.svg';
              FOR CUR IN (SELECT template_name,
                                 listagg(new_offer_id, ',') within group(order by o.new_offer_id) input_value
                            FROM dc_template_offer dt
                            left join dc_config_offer_basic_info o
                              on o.offer_name = dt.offer_name where dt.object_type = 'OFFER'
                           group by template_name
                          union all
                             SELECT template_name,
                                listagg(new_prod_id, ',') within group(order by o.new_prod_id) input_value
                                FROM dc_template_offer dt
                                left join dc_config_prod_basic_info o
                                     on o.prod_name = dt.offer_name where dt.object_type = 'PRODUCT'
                                 group by template_name
                          union all
                          SELECT template_name,
                                               listagg(acct_res_id, ',') within group(order by acct_res_id) input_value
                                          FROM DC_CIC_TRIGGER dt
                                          left join cbec_acct_res cr
                                            on cr.acct_res_name = dt.acct_res_name
                           group by template_name) LOOP
                select distinct length(template_name)
                  into V_TEMPLATE_LENGTH
                  from (SELECT template_name
                           FROM DC_TEMPLATE_OFFER
                         union all
                         SELECT template_name
                           FROM dc_cic_trigger)
                  where template_name = cur.template_name;
                select distinct event_code
                  into V_EVENT_CODE
                  from dc_cic_template_rel
                 where template_name = cur.template_name;
                select label_id
                  into V_LABEL_ID
                  from cic.cic_label
                 where label_name =
                       (select template_label_name
                          from dc_cic_template_rel
                         where template_name = cur.template_name);
                SELECT count(1)
                  into v_flag
                  FROM cic.cic_event_flow
                 where flow_name = cur.template_name;
                SELECT event_id
                  into v_event_id
                  FROM cic.cic_event
                 where event_code = V_EVENT_CODE;

                if v_flag = 0 then
                  /*flow configure*/
                  SELECT case when MAX(EVENT_FLOW_ID) > 4999 then MAX(EVENT_FLOW_ID)+1 else 5000 end
                    into V_EVENT_FLOW_ID
                    FROM cic.cic_event_flow;
                  insert into cic.cic_event_flow
                    (EVENT_FLOW_ID,
                     INTER_EVENT_ID,
                     FLOW_NAME,
                     STATE,
                     STATE_DATE,
                     CREATED_BY,
                     CREATED_DATE,
                     UPDATE_BY,
                     UPDATE_DATE,
                     INTER_TIME_LIMIT,
                     SP_ID)
                  values
                    (V_EVENT_FLOW_ID,
                     v_event_id,
                     cur.template_name,
                     'A',
                     to_date('01-01-2000 00:00:00', 'dd-mm-yyyy hh24:mi:ss'),
                     3044336,
                     to_date('01-01-2000 00:00:00', 'dd-mm-yyyy hh24:mi:ss'),
                     3044336,
                     to_date('01-01-2000 00:00:00', 'dd-mm-yyyy hh24:mi:ss'),
                     5,
                     null);
                  SELECT case when max(flow_label_id) > 4999 then MAX(FLOW_LABEL_ID) + 1 else 5000 end
                    into V_FLOW_LABEL_ID
                    FROM cic.CIC_FLOW_LABEL;
                  insert into cic.cic_flow_label
                    (FLOW_LABEL_ID, EVENT_FLOW_ID, LABEL_ID)
                  values
                    (V_FLOW_LABEL_ID, V_EVENT_FLOW_ID, 20);
                  /*FLOWOUT coloumn initial*/
                  SELECT case when MAX(FLOW_VERSION_ID) >4999 then MAX(FLOW_VERSION_ID)+1 else 5000 end
                    into V_FLOW_VERSION_ID
                    from cic.CIC_FLOW_VERSION;
                  insert into cic.CIC_FLOW_VERSION
                    (FLOW_VERSION_ID,
                     EVENT_FLOW_ID,
                     STATE,
                     STATE_DATE,
                     VER_NO,
                     EFF_DATE,
                     EXP_DATE,
                     CREATED_BY,
                     CREATED_DATE,
                     UPDATE_BY,
                     UPDATE_DATE,
                     FLOW_LAYOUT)
                  values
                    (V_FLOW_VERSION_ID,
                     V_EVENT_FLOW_ID,
                     'D',
                     null,
                     1,
                     null,
                     null,
                     3044336,
                     to_date('01-01-2000 00:00:00', 'dd-mm-yyyy hh24:mi:ss'),
                     3044336,
                     null,
                     null);
                  /*Start node*/
                  SELECT case when MAX(PROCESS_ID) > 19999 then MAX(PROCESS_ID)+1 else 20000 end
                    into V_FROM_PROCESS_ID
                    FROM cic.CIC_PROCESS;
                  insert into cic.CIC_PROCESS
                    (PROCESS_ID, PROCESS_TYPE, FLOW_VERSION_ID, PROCESS_NAME, COMMENTS)
                  values
                    (V_FROM_PROCESS_ID, 1, V_FLOW_VERSION_ID, cur.template_name, null);
                  insert into cic.CIC_INPUT_EVENT
                    (PROCESS_ID, INTER_EVENT_ID)
                  values
                    (V_FROM_PROCESS_ID, V_EVENT_ID);
                  ---Judge node configure
                  SELECT COALESCE(MAX(PROCESS_ID) + 1, 1)
                    into V_MED_PROCESS_ID
                    FROM cic.CIC_PROCESS;
                  insert into cic.CIC_PROCESS
                    (PROCESS_ID, PROCESS_TYPE, FLOW_VERSION_ID, PROCESS_NAME, COMMENTS)
                  values
                    (V_MED_PROCESS_ID, 2, V_FLOW_VERSION_ID, 'Judge-' || cur.template_name, null);
                  insert into cic.CIC_RULE
                    (PROCESS_ID, RULE_EXPRESSION)
                  values
                    (V_MED_PROCESS_ID, null);

                  select count(1)
                    into v_flag
                    from dc_msg_template_judge
                   where event_code = V_event_code and template_name = cur.template_name;
                  if v_flag > 0 then
                    for cur_judge in (select *
                                        from dc_msg_template_judge
                                       where event_code = V_event_code and template_name = cur.template_name order by block_id asc
                                       ) loop
                      if cur_judge.input_value is null then
                        V_INPUT_VALUE := cur.input_value;
                      else
                        V_INPUT_VALUE := cur_judge.input_value;
                      end if;
                      DC_PROC_MSG_JUDGE(cur_judge.template_name,cur_judge.attr_code_path,cur_judge.enrich_service_name,cur_judge.FIELD_CODE_PATH,cur_judge.BLOCK_ID,cur_judge.OPERATOR_NAME,V_EVENT_ID,V_MED_PROCESS_ID,V_INPUT_VALUE);
                    end loop;
                   else
                    for cur_judge in (select *
                                        from dc_msg_template_judge where template_label_name = (select label_name
                                         from cic.cic_label where label_id = V_LABEL_ID) and template_name is null and event_code = V_event_code order by block_id asc
                                       ) loop
                      if cur_judge.input_value is null then
                        V_INPUT_VALUE := cur.input_value;
                      else
                        V_INPUT_VALUE := cur_judge.input_value;
                      end if;
                      DC_PROC_MSG_JUDGE(cur.template_name,cur_judge.attr_code_path,cur_judge.enrich_service_name,cur_judge.FIELD_CODE_PATH,cur_judge.BLOCK_ID,cur_judge.OPERATOR_NAME,V_EVENT_ID,V_MED_PROCESS_ID,V_INPUT_VALUE);
                    end loop;

                  end if;

                  --sms node
                  SELECT COALESCE(MAX(PROCESS_ID) + 1, 1)
                    into V_TO_PROCESS_ID
                    FROM cic.CIC_PROCESS;
                  insert into cic.CIC_PROCESS
                    (PROCESS_ID, PROCESS_TYPE, FLOW_VERSION_ID, PROCESS_NAME, COMMENTS)
                  values
                    (V_TO_PROCESS_ID, 4, V_FLOW_VERSION_ID, cur.template_name, null);
                  /*Get MSG base information*/
                  for cur_msg in (SELECT *
                                    FROM DC_CIC_TEMPLATE_REL
                                   where template_name = cur.template_name) loop
                    SELECT distinct cc.catalog_id
                      into V_T_CATALOG_ID
                      FROM dc_cic_template_rel dr, cic.cic_catalog cc
                     where cc.catalog_name = cur_msg.catalog_name;
                    select distinct cn.src_nbr_id
                      into V_SRC_NBR_ID
                      FROM cic.cic_source_nbr cn, dc_cic_template_rel dr
                     where cn.src_nbr = cur_msg.src_nbr;
                    select distinct cn.contact_channel
                      into V_CONTACT_CHANNEL
                      FROM cic.cic_source_nbr cn, dc_cic_template_rel dr
                     where cn.src_nbr = cur_msg.src_nbr;
                    V_REG_DELIVERY     := cur_msg.reg_delivery;
                    V_FLASH_SMS        := cur_msg.flash_sms;
                    V_INPUT_VALUE_TYPE := cur_msg.input_value_type;
                    select action_id
                      into V_ACTION_ID
                      from cic.cic_action
                     where action_name = cur_msg.action_name;
                    select reg_service_id
                      into V_reg_service_id
                      from cic.cic_action
                     where action_name = cur_msg.action_name;
                    SELECT input_param_id
                      INTO V_input_param_id
                      FROM cic.cic_input_param
                     where param_code = cur_msg.action_param_code
                       and reg_service_id = V_reg_service_id;
                    SELECT TIME_WIN_ID
                      INTO v_TIME_WIN_ID
                      FROM cic.CIC_CONTACT_TIME_WINDOW
                     WHERE time_wind_start =
                           substr(cur_msg.time_window,
                                  1,
                                  instr(cur_msg.time_window, '-') - 1)
                       and time_wind_end =
                           substr(cur_msg.time_window,
                                  instr(cur_msg.time_window, '-') + 1);
                    select case when MAX(TEMPLATE_ID) > 4999 then MAX(TEMPLATE_ID) + 1 else 5000 end
                      into V_TEMPLATE_ID
                      from cic.CIC_MSG_TEMPLATE;
                    insert into cic.CIC_MSG_TEMPLATE
                      (TEMPLATE_ID,
                       CATALOG_ID,
                       TIME_WIN_ID,
                       SRC_NBR_ID,
                       STD_CODE,
                       CONTACT_CHANNEL,
                       CONTENT_FORMAT,
                       PRIORITY,
                       DELAY_TIME,
                       REG_DELIVERY,
                       TEMPLATE_NAME,
                       FLASH_SMS,
                       FEEDBACK_STATE)
                    values
                      (V_TEMPLATE_ID,
                       V_T_CATALOG_ID,
                       v_TIME_WIN_ID,
                       V_SRC_NBR_ID,
                       '',
                       V_CONTACT_CHANNEL,
                       '',
                       null,
                       null,
                       V_REG_DELIVERY,
                       Cur.Template_Name,
                       V_FLASH_SMS,
                       cur_msg.FEEDBACK_STATE);
                    insert into cic.CIC_ACTION_PROCESS
                      (PROCESS_ID, TEMPLATE_ID, ACTION_ID)
                    values
                      (V_TO_PROCESS_ID, V_TEMPLATE_ID, V_ACTION_ID);
                  /*Get attribute on obj*/
                      if cur_msg.attr_code_path is not null then
                        SELECT EVENT_ATTR_ID
                          into V_EVENT_ATTR_ID2
                          FROM cic.cic_inter_event_attr
                         where attr_code_path = cur_msg.attr_code_path
                           and inter_event_id = V_EVENT_ID;
                      elsif cur_msg.field_code_path is not null then
                        SELECT rtn_field_id
                          into V_EVENT_ATTR_ID2
                          FROM cic.cic_serv_rtn csr, cic.cic_enrich_service ces
                         where csr.reg_service_id = ces.reg_service_id
                           and FIELD_CODE_PATH = cur_msg.field_code_path
                           and ENRICH_SERVICE_NAME = cur_msg.enrich_service_name;
                      end if;
                    --sent to obj
                    insert into cic.CIC_ACTION_PARAM_VALUE
                      (PROCESS_ID,
                       ACTION_PARAM_ID,
                       INPUT_VALUE_TYPE,
                       EVENT_ATTR_ID,
                       RTN_FIELD_ID,
                       CAL_EXPRESSION_ID,
                       SPLIT_PARAM_ID,
                       INPUT_VALUE,
                       ACTION_FIELD_ID,
                       FIX_OUTPUT_ID,
                       ACM_ID,
                       OBJ_DIM_RTN_FIELD_ID)
                    values
                      (V_TO_PROCESS_ID,
                       V_input_param_id,
                       case when V_ATTR_CODE_PATH is not null then 'EV' when
                             V_FIELD_CODE_PATH is not null then 'ES' end,
                       decode(cur_msg.attr_code_path, null, null, V_EVENT_ATTR_ID2),
                       decode(cur_msg.field_code_path, null, null, V_EVENT_ATTR_ID2),
                       null,
                       null,
                       null,
                       null,
                       null,
                       null,
                       null);

                    SELECT case when MAX(TEMPLATE_LABEL_ID) > 9999 then MAX(TEMPLATE_LABEL_ID) + 1 else 10000 end
                      into V_TEMPLATE_LABEL_ID
                      FROM cic.CIC_TEMPLATE_LABEL;
                    insert into cic.CIC_TEMPLATE_LABEL
                      (LABEL_ID, TEMPLATE_ID, TEMPLATE_LABEL_ID)
                    values
                      (V_LABEL_ID, V_TEMPLATE_ID, V_TEMPLATE_LABEL_ID);
                    /*language configure*/
                    for cur_lang in (select *
                                       from DC_MSG_TEMPLATE
                                      where template_name = cur.template_name) loop
                      select attr_value
                        into v_lang_id
                        from attr_value
                       where attr_id =
                             (select attr_id
                                from attr_spec
                               where attr_nbr = 'INT_SUBS_LANGUAGE')

                         and attr_value_name = cur_lang.language_name;
                      select case when MAX(CONTENT_ID) > 9999 then MAX(CONTENT_ID)+ 1 else 10000 end
                        into V_CONTENT_ID
                        from cic.CIC_TEMPLATE_CONTENT;
                      insert into cic.CIC_TEMPLATE_CONTENT
                        (CONTENT_ID,
                         TEMPLATE_ID,
                         LANG_ID,
                         SUBJECT,
                         MSG_TEMPLATE,
                         MSG_LAYOUT,
                         HTML_TEMPLATE)
                      values
                        (V_CONTENT_ID,
                         V_TEMPLATE_ID,
                         v_lang_id,
                         cur_lang.subject,
                         cur_lang.text,
                         '<p>' || cur_lang.text || '<p>',
                         null);
                      /*parameter configure*/
                      SELECT count(1)
                        into count_p
                        FROM DC_MSG_TEMPLATE_PARAM
                       where template_name = cur_lang.template_name;
                      if count_p > 0 then
                        for cur_param in (select *
                                            from DC_MSG_TEMPLATE_PARAM
                                           where template_name = cur_lang.template_name) loop
                          SELECT case when MAX(TEMPLATE_ATTR_ID) > 19999 then MAX(TEMPLATE_ATTR_ID) + 1 else 20000 end
                            into V_TEMPLATE_ATTR_ID
                            FROM cic.CIC_MSG_TEMPLATE_ATTR;
                          if cur_param.attr_code_path is not null then
                            select replace(cur_param.attr_code_path,'${','${EV.') into V_PARAM_FIELD from dual;
                            SELECT EVENT_ATTR_ID
                              into V_EVENT_ATTR_ID3
                              FROM cic.CIC_INTER_EVENT_ATTR
                             where inter_event_id = V_EVENT_ID
                               and attr_code_path =
                                   substr(cur_param.attr_code_path,
                                          3,
                                          length(cur_param.attr_code_path) - 3);
                            insert into cic.CIC_MSG_TEMPLATE_ATTR
                              (TEMPLATE_ATTR_ID,
                               TEMPLATE_ID,
                               EVENT_ATTR_ID,
                               FUN_ID,
                               MEMBER_ATTR_ID,
                               ENRICH_SERV_FIELD,
                               FIX_OUTPUT_ID,
                               ACTION_FIELD_ID,
                               CAL_EXPRESSION_ID,
                               SPLIT_PARAM_ID,
                               CONTENT_ID,
                               ACM_ID,
                               OBJ_DIM_RTN_FIELD_ID,
                               PARENT_TMP_ATTR_ID)
                            values
                              (V_TEMPLATE_ATTR_ID,
                               V_TEMPLATE_ID,
                               V_EVENT_ATTR_ID3,
                               null,
                               null,
                               null,
                               null,
                               null,
                               null,
                               null,
                               V_CONTENT_ID,
                               null,
                               null,
                               null);
                          end if;
                          if cur_param.field_code_path is not null then
                            select replace(cur_param.field_code_path,'${','${ES.') into V_PARAM_FIELD from dual;
                            SELECT rtn_field_id
                              into V_RTN_FIELD_ID
                              FROM cic.cic_serv_rtn csr
                             where field_code_path =
                                   substr(trim(cur_param.field_code_path),
                                          3,
                                          length(trim(cur_param.field_code_path)) - 3)
                               and reg_service_id in
                                   (select reg_service_id
                                      from cic.cic_enrich_service
                                     where enrich_service_name =
                                           cur_param.enrich_service_name);
                            insert into cic.CIC_MSG_TEMPLATE_ATTR
                              (TEMPLATE_ATTR_ID,
                               TEMPLATE_ID,
                               EVENT_ATTR_ID,
                               FUN_ID,
                               MEMBER_ATTR_ID,
                               ENRICH_SERV_FIELD,
                               FIX_OUTPUT_ID,
                               ACTION_FIELD_ID,
                               CAL_EXPRESSION_ID,
                               SPLIT_PARAM_ID,
                               CONTENT_ID,
                               ACM_ID,
                               OBJ_DIM_RTN_FIELD_ID,
                               PARENT_TMP_ATTR_ID)
                            values
                              (V_TEMPLATE_ATTR_ID,
                               V_TEMPLATE_ID,
                               null,
                               null,
                               null,
                               V_RTN_FIELD_ID,
                               null,
                               null,
                               null,
                               null,
                               V_CONTENT_ID,
                               null,
                               null,
                               null);
                          end if;
                          /*parameter replace*/
                          update cic.CIC_TEMPLATE_CONTENT t
                             set msg_template = replace(msg_template,
                                                        cur_param.OLD_PARAM_NAME,
                                                        replace(V_PARAM_FIELD,
                                                                '.',
                                                                '@')),
                                 msg_layout   = replace(msg_layout,
                                                        cur_param.OLD_PARAM_NAME,
                                                        replace(V_PARAM_FIELD,
                                                                '.',
                                                                '@'))
                           where template_id = V_TEMPLATE_ID;
                          if cur_param.is_subject = 'Y' then
                             update cic.CIC_TEMPLATE_CONTENT t
                                                          set subject = replace(subject,
                                                                                     cur_param.OLD_PARAM_NAME,
                                                                                     replace(V_PARAM_FIELD,
                                                                                             '.',
                                                                                             '@'))
                                                        where template_id = V_TEMPLATE_ID;
                          end if;
                        end loop;
                      end if;
                    end loop;
                  end loop;
                  insert into cic.CIC_ACTION_PARAM_VALUE
                    (PROCESS_ID,
                     ACTION_PARAM_ID,
                     INPUT_VALUE_TYPE,
                     EVENT_ATTR_ID,
                     RTN_FIELD_ID,
                     CAL_EXPRESSION_ID,
                     SPLIT_PARAM_ID,
                     INPUT_VALUE,
                     ACTION_FIELD_ID,
                     FIX_OUTPUT_ID,
                     ACM_ID,
                     OBJ_DIM_RTN_FIELD_ID)
                  values
                    (V_TO_PROCESS_ID,
                     -1,
                     'IV',
                     null,
                     null,
                     null,
                     null,
                     V_TEMPLATE_ID,
                     null,
                     null,
                     null,
                     null);
                  /*connect info and judgement*/
                  select case when MAX(PROCESS_CONNECT_ID) > 19999 then MAX(PROCESS_CONNECT_ID)+ 1 else 20000 end
                    into V_PROCESS_CONNECT_ID
                    from cic.CIC_PROCESS_CONNECT;
                  insert into cic.CIC_PROCESS_CONNECT
                    (PROCESS_CONNECT_ID,
                     FROM_PROCESS_ID,
                     TO_PROCESS_ID,
                     FIX_OUTPUT,
                     CONDITION_OPER,
                     INPUT_VALUE)
                  values
                    (V_PROCESS_CONNECT_ID,
                     V_FROM_PROCESS_ID,
                     V_MED_PROCESS_ID,
                     null,
                     null,
                     null);
                  /*condition is true configure*/
                  select COALESCE(MAX(PROCESS_CONNECT_ID) + 1, 1)
                    into V_PROCESS_CONNECT_ID1
                    from cic.CIC_PROCESS_CONNECT;
                  insert into cic.CIC_PROCESS_CONNECT
                    (PROCESS_CONNECT_ID,
                     FROM_PROCESS_ID,
                     TO_PROCESS_ID,
                     FIX_OUTPUT,
                     CONDITION_OPER,
                     INPUT_VALUE)
                  values
                    (V_PROCESS_CONNECT_ID1,
                     V_MED_PROCESS_ID,
                     V_TO_PROCESS_ID,
                     1,
                     'IS',
                     'True');

                  /*前台查询数据库中保存的flow_layout，然后进行base64解码，解码失败的话就用的数据库中的flow_layout展示的
                  直接保存json明文，会转码失败，使用数据库中的json明文展示。  下述为随机生成json格式中的起止节点id*/
                  V_START_NODE      := dc_get_sid();
                  V_MED_NODE        := dc_get_sid();
                  V_END_NODE        := dc_get_sid();
                  V_TEMPLATE_LENGTH := 52.5 - V_TEMPLATE_LENGTH * 4.25;
                  V_FLOW_LAYOUT     := '{"elementType":"scene","mode":"normal","childs":[{"elementType":"Image","options":{"style":{"isAllowEdit":false,"image":"cic/modules/cic-event-mgr/styles/images/start.svg","width":35,"height":35,"fill":"#FFFFFF","textPosition":"insideBottom","textFill":"white","rich":{}},"tooltip":"' ||
                                       V_event_code ||
                                       '","name":"startNode","isEdit":false,"position":[' ||
                                       V_START_POINT_X || ',' || V_START_POINT_Y ||
                                       '],"operationIcons":[{"name":"STRAIGHT","options":{"symbol":{"type":"arrow","color":"#BBBBBB"},"style":{"stroke":"#BBBBBB","lineType":"straight"}}}],"id":"' ||
                                       V_START_NODE ||
                                       '"},"userData":{"processType":"1","processData":{"processId":' ||
                                       V_FROM_PROCESS_ID ||
                                       ',"processType":1,"flowVersionId":' ||
                                       V_FLOW_VERSION_ID || ',"processName":"' ||
                                       V_event_code ||
                                       '","cicInputEventDto":{"interEventId":' ||
                                       V_EVENT_ID ||
                                       '}}}},{"elementType":"Image","options":{"style":{"isAllowEdit":false,"x":0,"y":0,"image":"' ||
                                       V_IMAGE_RULE ||
                                       '","width":100,"height":60,"textFont":"12px Microsoft YaHei","textFill":"white","fill":"#FFFFFF","rich":{},"textPosition":[' ||
                                       V_TEMPLATE_LENGTH || ',"60%%"],"text":"' ||
                                       cur.template_name ||
                                       '"},"isEdit":false,"position":[' ||
                                       V_RULE_POINT_X || ',' || V_RULE_POINT_Y ||
                                       '],"operationIcons":[{"name":"DEL"},{"name":"STRAIGHT","options":{"symbol":{"type":"arrow","color":"#BBBBBB"},"style":{"stroke":"#BBBBBB","lineType":"straight"}}},{"name":"JAGGED"},{"name":"CURVE"}],"id":"' ||
                                       V_MED_NODE ||
                                       '"},"userData":{"processType":"2","processData":{"processId":' ||
                                       V_MED_PROCESS_ID ||
                                       ',"processType":2,"flowVersionId":' ||
                                       V_FLOW_VERSION_ID ||
                                       '}}},{"elementType":"connection","startNodeId":"' ||
                                       V_START_NODE || '","endNodeId":"' || V_MED_NODE ||
                                       '","options":{"symbol":{"type":"arrow","size":10,"color":"#BBBBBB","both":false,"offset":0},"style":{"lineWidth":1,"stroke":"#BBBBBB","lineType":"straight"},"hoverStyle":{"lineWidth":2,"stroke":"#74B7E0"},"arrowHoverStyle":{"fill":"#74B7E0"},"shape":{"points":[[' ||
                                       V_SHAPE_FPOINTS_X || ',' || V_SHAPE_FPOINTS_Y ||
                                       '],[' || V_SHAPE_TPOINTS_X || ',' ||
                                       V_SHAPE_TPOINTS_Y ||
                                       ']],"smooth":false,"smoothConstraint":null},"position":{"startPos":"right","endPos":"left","startOffset":[0,0],"endOffset":[0,0],"escapeDistance":[30,30],"points":null},"autoChangePosition":false,"textContextMenu":null,"isEdit":true,"text":{"text":null,"color":"#000000","textFont":"12px Microsoft YaHei","textPos":"center"},"z":0,"dockers":[{"x":' ||
                                       V_SHAPE_FPOINTS_X || ',"y":' ||
                                       V_SHAPE_FPOINTS_Y || '},{"x":' ||
                                       V_SHAPE_TPOINTS_X || ',"y":' ||
                                       V_SHAPE_TPOINTS_Y ||
                                       '}]},"icons":[],"userData":{"processData":{"processConnectId":' ||
                                       V_PROCESS_CONNECT_ID || ',"fromProcessId":' ||
                                       V_FROM_PROCESS_ID || ',"toProcessId":' ||
                                       V_MED_PROCESS_ID ||
                                       '}}},{"elementType":"Image","options":{"style":{"isAllowEdit":false,"x":0,"y":0,"image":"' ||
                                       V_IMAGE_SMS ||
                                       '","width":100,"height":60,"textFont":"12px Microsoft YaHei","textFill":"white","fill":"#FFFFFF","rich":{},"textPosition":[' ||
                                       V_TEMPLATE_LENGTH || ',"60%%"],"text":"' ||
                                       cur.template_name ||
                                       '"},"isEdit":false,"position":[' ||
                                       V_SMS_POINT_X || ',' || V_SMS_POINT_Y ||
                                       '],"operationIcons":[{"name":"DEL"},{"name":"STRAIGHT","options":{"symbol":{"type":"arrow","color":"#BBBBBB"},"style":{"stroke":"#BBBBBB","lineType":"straight"}}},{"name":"JAGGED"},{"name":"CURVE"}],"id":"' ||
                                       V_END_NODE ||
                                       '"},"userData":{"processType":"4","actionId":"-1","actionTypeId":"-1","processData":{"processId":' ||
                                       V_TO_PROCESS_ID ||
                                       ',"processType":4,"flowVersionId":' ||
                                       V_FLOW_VERSION_ID ||
                                       ',"cicActionProcessDto":{"actionId":-1}}}},{"elementType":"connection","startNodeId":"' ||
                                       V_MED_NODE || '","endNodeId":"' || V_END_NODE ||
                                       '","options":{"symbol":{"type":"arrow","size":10,"color":"#BBBBBB","both":false,"offset":0},"style":{"lineWidth":1,"stroke":"#BBBBBB","lineType":"straight"},"hoverStyle":{"lineWidth":2,"stroke":"#74B7E0","fill":null},"arrowHoverStyle":{"fill":"#74B7E0","stroke":null},"shape":{"points":[[' ||
                                       V_SHAPE_EPOINTS_X || ',' || V_SHAPE_EPOINTS_Y ||
                                       '],[' || V_SMS_POINT_X || ',' ||
                                       V_SHAPE_EPOINTS_Y ||
                                       ']],"smooth":false,"smoothConstraint":null},"position":{"startPos":"right","endPos":"left","startOffset":[0,0],"endOffset":[0,0],"escapeDistance":[30,30],"points":null},"autoChangePosition":false,"textContextMenu":null,"isEdit":true,"text":{"text":"True","color":"#000000","textFont":"12px Microsoft YaHei","textPos":"center"},"z":0,"dockers":[{"x":' ||
                                       V_SHAPE_EPOINTS_X || ',"y":' ||
                                       V_SHAPE_EPOINTS_Y || '},{"x":' || V_SMS_POINT_X ||
                                       ',"y":' || V_SHAPE_EPOINTS_Y ||
                                       '}]},"icons":[],"userData":{"processData":{"processConnectId":' ||
                                       V_PROCESS_CONNECT_ID1 || ',"fromProcessId":' ||
                                       V_MED_PROCESS_ID || ',"toProcessId":' ||
                                       V_TO_PROCESS_ID ||
                                       ',"fixOutput":1,"conditionOper":"IS","inputValue":"True"}}}]}';

                  --convert to base64 clob
                  V_FLOW_LAYOUT := DC_EncodeBASE64(V_FLOW_LAYOUT);
                  update cic.CIC_FLOW_VERSION
                     set EVENT_FLOW_ID = V_EVENT_FLOW_ID,
                         STATE         = 'P',
                         VER_NO        = 1,
                         eff_date      = to_date('01-01-2000', 'dd-mm-yyyy'),
                         exp_date      = to_date('01-01-2099', 'dd-mm-yyyy'),
                         FLOW_LAYOUT   = V_FLOW_LAYOUT
                   where FLOW_VERSION_ID = V_FLOW_VERSION_ID
                     and 1 = 1;
                end if;
              end loop;

            end;
  DC_PROC_FlowLayout:
    - |
      create or replace procedure DC_PROC_FlowLayout Authid Current_User is
                    count_p               integer;
                    v_flag                NUMBER;
                    v_mul_flag                NUMBER;
                    v_p_flag                NUMBER;
                    V_EVENT_ID            NUMBER;
                    V_OPERATOR            NUMBER(3);
                    v_lang_id             VARCHAR2(10);
                    V_PROCESS_TYPE        NUMBER(3);
                    V_threshold           NUMBER;
                    V_TIME_WIN_ID         NUMBER;
                    V_EVENT_ATTR_ID       NUMBER;
                    V_EVENT_ATTR_ID2      NUMBER;
                    V_EVENT_ATTR_ID3      NUMBER;
                    V_EMAIL_PARAM_ID      VARCHAR2(32);
                    V_EMAIL_PARAM_NAME    VARCHAR2(128);
                    V_EVENT_FLOW_ID       NUMBER;
                    V_FLOW_LABEL_ID       NUMBER;
                    V_FLOW_VERSION_ID     NUMBER;
                    V_TEMPLATE_ID         NUMBER;
                    V_TEMPLATE_ATTR_ID    NUMBER;
                    V_CONTACT_CHANNEL     NUMBER;
                    V_REG_DELIVERY        CHAR(1);
                    V_FLASH_SMS           CHAR(1);
                    V_ACTION_ID           NUMBER(9);
                    V_MSG_ACTION_ID       NUMBER(9);
                    V_ACTION_TYPE_ID      NUMBER(9);
                    V_INPUT_VALUE_TYPE    VARCHAR2(8);
                    V_input_param_id      NUMBER(9);
                    V_P_input_param_id    NUMBER(9);
                    V_reg_service_id      NUMBER(9);
                    V_T_CATALOG_ID        NUMBER;
                    V_SRC_NBR_ID          NUMBER;
                    V_RTN_FIELD_ID        NUMBER;
                    V_CONTENT_ID          NUMBER;
                    V_LABEL_ID            NUMBER;
                    V_F_LABEL_ID          NUMBER;
                    V_TEMPLATE_LABEL_ID   NUMBER;
                    V_FROM_PROCESS_ID     NUMBER;
                    V_MED_PROCESS_ID      NUMBER;
                    V_PROCESS_CONNECT_ID  NUMBER;
                    V_FLOW_LAYOUT         clob;
                    V_EVENT_CODE          VARCHAR2(120);
                    V_START_NODE          VARCHAR2(120);
                    V_MED_NODE            VARCHAR2(120);
                    V_PARAM_FIELD         VARCHAR2(120);
                    V_INPUT_VALUE         VARCHAR2(4000);
                    V_MSG_LAYOUT          VARCHAR2(4000);
                    V_START_POINT_X       FLOAT;
                    V_START_POINT_Y       FLOAT;
                    V_POINT_X          FLOAT;
                    V_POINT_Y          FLOAT;
                    V_TEMPLATE_LENGTH     FLOAT;
                    V_SHAPE_FPOINTS_X     FLOAT;
                    V_SHAPE_FPOINTS_Y     FLOAT;
                    V_SHAPE_TPOINTS_X     FLOAT;
                    V_SHAPE_TPOINTS_Y     FLOAT;
                    V_FIXOUTPUT_ID        NUMBER(3);
                    C_SPLIT_ID1           NUMBER;
                    C_SPLIT_ID2           NUMBER;
                    C_SPLIT_ID3           NUMBER;
                    V_CONFIG_ID           NUMBER;
                  begin
                    V_START_POINT_X   := 32;
                    V_START_POINT_Y   := 75;
                    C_SPLIT_ID1       := 20000;
                    C_SPLIT_ID2       := 10000;
                    C_SPLIT_ID3       := 5000;

                    FOR CUR IN (SELECT distinct flow_name FROM DC_CIC_PROCESS) LOOP
                      SELECT count(1)
                                  into v_flag
                                  FROM cic.cic_event_flow
                                 where flow_name = cur.flow_name;
                          if v_flag = 0 then
                      select count(1) into v_flag from cic.cic_event ce,DC_CIC_PROCESS dp where dp.process_name = ce.event_code and dp.process_type_name = 'Event' and dp.flow_name = cur.flow_name;
                      if v_flag > 0 then
                        select process_name into V_EVENT_CODE from DC_CIC_PROCESS dp where dp.process_type_name = 'Event' and dp.flow_name = cur.flow_name and dp.from_process_name is null;
                        SELECT event_id
                        into v_event_id
                        FROM cic.cic_event
                       where event_code = V_EVENT_CODE;
                       select length(V_EVENT_CODE) into V_TEMPLATE_LENGTH from dual;
                        /*flow configure*/
                        SELECT case when MAX(EVENT_FLOW_ID) >= C_SPLIT_ID3 then MAX(EVENT_FLOW_ID)+1 else C_SPLIT_ID3 end
                          into V_EVENT_FLOW_ID
                          FROM cic.cic_event_flow;
                        insert into cic.cic_event_flow
                          (EVENT_FLOW_ID,
                           INTER_EVENT_ID,
                           FLOW_NAME,
                           STATE,
                           STATE_DATE,
                           CREATED_BY,
                           CREATED_DATE,
                           UPDATE_BY,
                           UPDATE_DATE,
                           INTER_TIME_LIMIT,
                           SP_ID)
                        values
                          (V_EVENT_FLOW_ID,
                           v_event_id,
                           cur.flow_name,
                           'A',
                           to_date('01-01-2000 00:00:00', 'dd-mm-yyyy hh24:mi:ss'),
                           3044336,
                           to_date('01-01-2000 00:00:00', 'dd-mm-yyyy hh24:mi:ss'),
                           3044336,
                           to_date('01-01-2000 00:00:00', 'dd-mm-yyyy hh24:mi:ss'),
                           5,
                           null);
                        SELECT case when max(flow_label_id) >= C_SPLIT_ID3 then MAX(FLOW_LABEL_ID) + 1 else C_SPLIT_ID3 end
                          into V_FLOW_LABEL_ID
                          FROM cic.CIC_FLOW_LABEL;
                        SELECT count(1) into v_flag
                              FROM DC_CIC_PROCESS dp,cic.cic_label a where dp.flow_label_name = a.label_name and a.label_type = 'FLOW' and  process_id = '0'  AND FLOW_name = cur.flow_name;
                              if v_flag = 0 then
                                V_F_LABEL_ID := 20;
                              else
                                select A.LABEL_ID
                              into V_F_LABEL_ID
                              from DC_CIC_PROCESS dp,cic.cic_label a where dp.flow_label_name = a.label_name and a.label_type = 'FLOW' and  process_id = '0'  AND FLOW_name = cur.flow_name;
                              end if;
                        insert into cic.cic_flow_label
                          (FLOW_LABEL_ID, EVENT_FLOW_ID, LABEL_ID)
                        values
                          (V_FLOW_LABEL_ID, V_EVENT_FLOW_ID, V_F_LABEL_ID);
                        /*FLOWOUT coloumn initial*/
                        SELECT case when MAX(FLOW_VERSION_ID) >=C_SPLIT_ID3 then MAX(FLOW_VERSION_ID)+1 else C_SPLIT_ID3 end
                          into V_FLOW_VERSION_ID
                          from cic.CIC_FLOW_VERSION;
                        insert into cic.CIC_FLOW_VERSION
                          (FLOW_VERSION_ID,
                           EVENT_FLOW_ID,
                           STATE,
                           STATE_DATE,
                           VER_NO,
                           EFF_DATE,
                           EXP_DATE,
                           CREATED_BY,
                           CREATED_DATE,
                           UPDATE_BY,
                           UPDATE_DATE,
                           FLOW_LAYOUT)
                        values
                          (V_FLOW_VERSION_ID,
                           V_EVENT_FLOW_ID,
                           'D',
                           null,
                           1,
                           null,
                           null,
                           3044336,
                           sysdate,
                           3044336,
                           null,
                           null);
                        /*Start node*/
                        SELECT case when MAX(PROCESS_ID) >= C_SPLIT_ID1 then MAX(PROCESS_ID)+1 else C_SPLIT_ID1 end
                          into V_FROM_PROCESS_ID
                          FROM cic.CIC_PROCESS;
                        insert into cic.CIC_PROCESS
                          (PROCESS_ID, PROCESS_TYPE, FLOW_VERSION_ID, PROCESS_NAME, COMMENTS)
                        values
                          (V_FROM_PROCESS_ID, 1, V_FLOW_VERSION_ID,V_EVENT_CODE , null);

                        insert into cic.CIC_INPUT_EVENT
                          (PROCESS_ID, INTER_EVENT_ID)
                        values
                          (V_FROM_PROCESS_ID, V_EVENT_ID);
                        V_START_NODE      := dc_get_sid();
                        update dc_cic_process set r_process_id = V_FROM_PROCESS_ID,process_node = V_START_NODE where process_type_name = 'Event' and flow_name = cur.flow_name and from_process_name is null;
                        V_TEMPLATE_LENGTH := 52.5 - V_TEMPLATE_LENGTH * 4.25;
                        V_FLOW_LAYOUT     := '{"elementType":"scene","mode":"normal","childs":[{"elementType":"Image","options":{"style":{"isAllowEdit":false,"image":"cic/modules/cic-event-mgr/styles/images/start.svg","width":35,"height":35,"fill":"#FFFFFF","textPosition":"insideBottom","textFill":"white","rich":{}},"tooltip":"' ||
                                             V_event_code ||
                                             '","name":"startNode","isEdit":false,"position":[' ||
                                             V_START_POINT_X || ',' || V_START_POINT_Y ||
                                             '],"operationIcons":[{"name":"STRAIGHT","options":{"symbol":{"type":"arrow","color":"#BBBBBB"},"style":{"stroke":"#BBBBBB","lineType":"straight"}}}],"id":"' ||
                                             V_START_NODE ||
                                             '"},"userData":{"processType":"1","processData":{"processId":' ||
                                             V_FROM_PROCESS_ID ||
                                             ',"processType":1,"flowVersionId":' ||
                                             V_FLOW_VERSION_ID || ',"processName":"' ||
                                             V_event_code ||
                                             '","cicInputEventDto":{"interEventId":' ||
                                             V_EVENT_ID ||
                                             '}}}}';
                    end if;
                    for cur_pro in (select * from (SELECT * FROM DC_CIC_PROCESS where flow_name = cur.flow_name) start with process_id = 1 connect by PRIOR process_id = parent_process_id)loop
                        SELECT COALESCE(MAX(PROCESS_ID) + 1, 1)
                          into V_MED_PROCESS_ID
                          FROM cic.CIC_PROCESS;
                          SELECT process_type into V_PROCESS_TYPE FROM cic.cic_process_type where type_name = cur_pro.process_type_name;
                        insert into cic.CIC_PROCESS
                          (PROCESS_ID, PROCESS_TYPE, FLOW_VERSION_ID, PROCESS_NAME, COMMENTS)
                        values
                          (V_MED_PROCESS_ID, V_PROCESS_TYPE, V_FLOW_VERSION_ID, cur_pro.process_name, cur_pro.process_image);
                        V_MED_NODE := dc_get_sid();
                        --store actural process_id
                        update dc_cic_process set r_process_id = V_MED_PROCESS_ID, process_node = V_MED_NODE where process_name = cur_pro.process_name and flow_name = cur.flow_name and from_process_name is not null;
                        if cur_pro.action_name is not null then
                          select action_id
                                  into V_ACTION_ID
                                  from cic.cic_action
                                 where action_name = cur_pro.action_name;
                        end if;
                        --rule type process
                        if cur_pro.process_type_name = 'Rule' then
                          insert into cic.CIC_RULE
                          (PROCESS_ID, RULE_EXPRESSION)
                        values
                          (V_MED_PROCESS_ID, null);
                          select count(1)
                                into v_flag
                                from dc_msg_template_judge
                               where event_code = V_event_code and template_name = cur_pro.process_name;
                              if v_flag > 0 then
                                select count(1) into v_mul_flag from dc_msg_template_judge where event_code = V_event_code and template_name = cur_pro.process_name and block_id = 0;
                                for cur_judge in (select *
                                                    from dc_msg_template_judge
                                                   where event_code = V_event_code and template_name = cur_pro.process_name order by block_id asc
                                                   ) loop
                                  if cur_judge.BLOCK_ID = 0 then
                                       update cic.CIC_RULE set RULE_EXPRESSION = cur_judge.INPUT_VALUE where PROCESS_ID = V_MED_PROCESS_ID;
                                  else
                                       DC_PROC_MSG_JUDGE(v_mul_flag,cur_judge.template_name,cur_judge.attr_code_path,cur_judge.dim_name,cur_judge.dim_field_code_path,cur_judge.enrich_service_name,cur_judge.FIELD_CODE_PATH,cur_judge.BLOCK_ID,cur_judge.OPERATOR_NAME,V_EVENT_ID,V_MED_PROCESS_ID,cur_judge.input_value);
                                  end if;
                                end loop;
                                end if;
                        end if;
                        --action type process
                        if cur_pro.process_type_name = 'Action' and V_ACTION_ID > 0 then
                            insert into cic.CIC_ACTION_PROCESS
                                  (PROCESS_ID, TEMPLATE_ID, ACTION_ID)
                                values
                                  (V_MED_PROCESS_ID, '', V_ACTION_ID);
                          for cur_act in(select * from DC_CIC_ACTION_PARAM_VALUE where process_name = cur_pro.process_name)loop
                            SELECT instr(cur_act.ACTION_PARAM_NAME,'.') INTO V_FLAG FROM dual;
                            if V_FLAG = 0 then
                               SELECT INPUT_PARAM_ID into V_input_param_id FROM cic.CIC_INPUT_PARAM where PARAM_NAME = cur_act.ACTION_PARAM_NAME and reg_service_id in (select reg_service_id from cic.cic_action where action_id = V_ACTION_ID);
                             else
                               SELECT INPUT_PARAM_ID into V_P_input_param_id FROM cic.CIC_INPUT_PARAM where PARAM_NAME = substr(cur_act.ACTION_PARAM_NAME,1,instr(cur_act.ACTION_PARAM_NAME,'.')-1) and reg_service_id in (select reg_service_id from cic.cic_action where action_id = V_ACTION_ID);
                               SELECT INPUT_PARAM_ID into V_input_param_id FROM cic.CIC_INPUT_PARAM where PARAM_NAME = substr(cur_act.ACTION_PARAM_NAME,instr(cur_act.ACTION_PARAM_NAME,'.')+1) and parent_input_param_id = V_P_input_param_id and reg_service_id in (select reg_service_id from cic.cic_action where action_id = V_ACTION_ID);
                             end if;
                            if cur_act.attr_code_path is not null then
                              SELECT EVENT_ATTR_ID
                                into V_EVENT_ATTR_ID
                                FROM cic.cic_inter_event_attr
                               where attr_code_path = cur_act.attr_code_path
                                 and inter_event_id = V_EVENT_ID;
                            elsif cur_act.enrich_service_name is not null and cur_act.field_code_path is not null then
                              SELECT rtn_field_id
                                into V_RTN_FIELD_ID
                                FROM cic.cic_serv_rtn csr, cic.cic_enrich_service ces
                               where csr.reg_service_id = ces.reg_service_id
                                 and FIELD_CODE_PATH = cur_act.field_code_path
                                 and ENRICH_SERVICE_NAME = cur_act.enrich_service_name;
                            end if;
                            insert into cic.CIC_ACTION_PARAM_VALUE
                                  (PROCESS_ID,
                                   ACTION_PARAM_ID,
                                   INPUT_VALUE_TYPE,
                                   EVENT_ATTR_ID,
                                   RTN_FIELD_ID,
                                   CAL_EXPRESSION_ID,
                                   SPLIT_PARAM_ID,
                                   INPUT_VALUE,
                                   ACTION_FIELD_ID,
                                   FIX_OUTPUT_ID,
                                   ACM_ID,
                                   OBJ_DIM_RTN_FIELD_ID)
                                values
                                  (V_MED_PROCESS_ID,
                                   V_input_param_id,
                                   cur_act.input_value_type,
                                   V_EVENT_ATTR_ID,
                                   V_RTN_FIELD_ID,
                                   null,
                                   null,
                                   cur_act.INPUT_VALUE,
                                   null,
                                   null,
                                   null,
                                   null);
                             V_RTN_FIELD_ID := '';
                             V_EVENT_ATTR_ID := '';
                          end loop;
                        end if;
                        --sms/ivr/tv/email...process
                        if cur_pro.process_type_name = 'Action' and V_ACTION_ID < 0 then
                            select label_id
                              into V_LABEL_ID
                              from cic.cic_label
                             where label_name =
                                   (select template_label_name
                                      from dc_cic_template_rel
                                     where template_name = cur_pro.process_name and label_type = 'MSG_TMP');
                          for cur_msg in (SELECT *
                                                FROM DC_CIC_TEMPLATE_REL
                                               where template_name = cur_pro.process_name) loop
                                SELECT distinct cc.catalog_id
                                  into V_T_CATALOG_ID
                                  FROM dc_cic_template_rel dr, cic.cic_catalog cc
                                 where cc.catalog_name = cur_msg.catalog_name;
                            if cur_msg.src_nbr is null then
                                V_SRC_NBR_ID := '';
                                V_CONTACT_CHANNEL := '';
                            else select distinct cn.src_nbr_id
                                  into V_SRC_NBR_ID
                                  FROM cic.cic_source_nbr cn, dc_cic_template_rel dr
                                 where cn.src_nbr = cur_msg.src_nbr;
                                select distinct cn.contact_channel
                                  into V_CONTACT_CHANNEL
                                  FROM cic.cic_source_nbr cn, dc_cic_template_rel dr
                                 where cn.src_nbr = cur_msg.src_nbr;
                            end if;
                                V_REG_DELIVERY     := cur_msg.reg_delivery;
                                V_FLASH_SMS        := cur_msg.flash_sms;
                                select action_id
                                  into V_MSG_ACTION_ID
                                  from cic.cic_action
                                 where action_name = cur_msg.action_name;
                                select reg_service_id
                                  into V_reg_service_id
                                  from cic.cic_action
                                 where action_name = cur_msg.action_name;
                                SELECT input_param_id
                                  INTO V_input_param_id
                                  FROM cic.cic_input_param
                                 where param_code = cur_msg.action_param_code
                                   and reg_service_id = V_reg_service_id;
                                 if cur_msg.time_window is not null then
                                SELECT TIME_WIN_ID
                                  INTO v_TIME_WIN_ID
                                  FROM cic.CIC_CONTACT_TIME_WINDOW
                                 WHERE time_wind_start =
                                       substr(cur_msg.time_window,
                                              1,
                                              instr(cur_msg.time_window, '-') - 1)
                                   and time_wind_end =
                                       substr(cur_msg.time_window,
                                              instr(cur_msg.time_window, '-') + 1);
                                  else v_TIME_WIN_ID := '';
                                  end if;
                                select case when MAX(TEMPLATE_ID) >= C_SPLIT_ID3 then MAX(TEMPLATE_ID) + 1 else C_SPLIT_ID3 end
                                  into V_TEMPLATE_ID
                                  from cic.CIC_MSG_TEMPLATE;
                                insert into cic.CIC_MSG_TEMPLATE
                                  (TEMPLATE_ID,
                                   CATALOG_ID,
                                   TIME_WIN_ID,
                                   SRC_NBR_ID,
                                   STD_CODE,
                                   CONTACT_CHANNEL,
                                   CONTENT_FORMAT,
                                   PRIORITY,
                                   DELAY_TIME,
                                   REG_DELIVERY,
                                   TEMPLATE_NAME,
                                   FLASH_SMS,
                                   FEEDBACK_STATE)
                                values
                                  (V_TEMPLATE_ID,
                                   V_T_CATALOG_ID,
                                   v_TIME_WIN_ID,
                                   V_SRC_NBR_ID,
                                   '',
                                   V_CONTACT_CHANNEL,
                                   cur_msg.CONTENT_FORMAT,
                                   null,
                                   null,
                                   V_REG_DELIVERY,
                                   cur_pro.process_name,
                                   V_FLASH_SMS,
                                   case when cur_msg.feedback_state is null then 'N' else cur_msg.feedback_state end);
                                insert into cic.CIC_ACTION_PROCESS
                                  (PROCESS_ID, TEMPLATE_ID, ACTION_ID)
                                values
                                  (V_MED_PROCESS_ID, V_TEMPLATE_ID, V_MSG_ACTION_ID);
                                /*Get attribute on obj*/
                                                      if cur_msg.attr_code_path is not null then
                                                        SELECT EVENT_ATTR_ID
                                                          into V_EVENT_ATTR_ID2
                                                          FROM cic.cic_inter_event_attr
                                                         where attr_code_path = cur_msg.attr_code_path
                                                           and inter_event_id = V_EVENT_ID;
                                                      elsif cur_msg.field_code_path is not null then
                                                        SELECT rtn_field_id
                                                          into V_EVENT_ATTR_ID2
                                                          FROM cic.cic_serv_rtn csr, cic.cic_enrich_service ces
                                                         where csr.reg_service_id = ces.reg_service_id
                                                           and FIELD_CODE_PATH = cur_msg.field_code_path
                                                           and ENRICH_SERVICE_NAME = cur_msg.enrich_service_name;
                                                      end if;
                                --sent to obj
                                insert into cic.CIC_ACTION_PARAM_VALUE
                                  (PROCESS_ID,
                                   ACTION_PARAM_ID,
                                   INPUT_VALUE_TYPE,
                                   EVENT_ATTR_ID,
                                   RTN_FIELD_ID,
                                   CAL_EXPRESSION_ID,
                                   SPLIT_PARAM_ID,
                                   INPUT_VALUE,
                                   ACTION_FIELD_ID,
                                   FIX_OUTPUT_ID,
                                   ACM_ID,
                                   OBJ_DIM_RTN_FIELD_ID)
                                values
                                  (V_MED_PROCESS_ID,
                                   V_input_param_id,
                       case when cur_msg.ATTR_CODE_PATH is not null then 'EV' when
                             cur_msg.FIELD_CODE_PATH is not null then 'ES' end,
                       decode(cur_msg.attr_code_path, null, null, V_EVENT_ATTR_ID2),
                       decode(cur_msg.field_code_path, null, null, V_EVENT_ATTR_ID2),
                                   null,
                                   null,
                                   null,
                                   null,
                                   null,
                                   null,
                                   null);

                                SELECT case when MAX(TEMPLATE_LABEL_ID) >= C_SPLIT_ID2 then MAX(TEMPLATE_LABEL_ID) + 1 else C_SPLIT_ID2 end
                                  into V_TEMPLATE_LABEL_ID
                                  FROM cic.CIC_TEMPLATE_LABEL;
                                insert into cic.CIC_TEMPLATE_LABEL
                                  (LABEL_ID, TEMPLATE_ID, TEMPLATE_LABEL_ID)
                                values
                                  (V_LABEL_ID, V_TEMPLATE_ID, V_TEMPLATE_LABEL_ID);
                                /*language configure*/
                                for cur_lang in (select *
                                                   from DC_MSG_TEMPLATE
                                                  where template_name = cur_pro.process_name) loop
                                  select substr(value,1,2)
                                    into v_lang_id
                                    from from BILL_ATTR_VALUE
                                   where attr_id =
                                         (select attr_id
                                            from BILL_ATTR
                                           where attr_code = 'INT_SUBS_LANGUAGE')
                                     and attr_value_name = cur_lang.language_name;
                                  select case when MAX(CONTENT_ID) >= C_SPLIT_ID2 then MAX(CONTENT_ID)+ 1 else C_SPLIT_ID2 end
                                    into V_CONTENT_ID
                                    from cic.CIC_TEMPLATE_CONTENT;
                                    if cur_msg.action_name != 'Send Email' then
                                       select '<p>' || cur_lang.text || '<p>' into V_MSG_LAYOUT from dual;
                                    elsif cur_msg.action_name = 'Send Email' and cur_msg.content_format = 'HTML'then
                                       select '{"htmlLayout":"<p>' || cur_lang.text ||'</p>","subjectLayout":"<p>'|| cur_lang.subject || '</p>"}' into V_MSG_LAYOUT from dual;
                                    elsif cur_msg.action_name = 'Send Email' and cur_msg.content_format = 'TXT' then
                                      select '{"txtLayout":"<p>' || cur_lang.text ||'</p>","subjectLayout":"<p>'|| cur_lang.subject || '</p>"}' into V_MSG_LAYOUT from dual;
                                    end if;
                                  insert into cic.CIC_TEMPLATE_CONTENT
                                    (CONTENT_ID,
                                     TEMPLATE_ID,
                                     LANG_ID,
                                     SUBJECT,
                                     MSG_TEMPLATE,
                                     MSG_LAYOUT,
                                     HTML_TEMPLATE)
                                  values
                                    (V_CONTENT_ID,
                                     V_TEMPLATE_ID,
                                     v_lang_id,
                                     cur_lang.subject,
                                     case when cur_msg.CONTENT_FORMAT = 'HTML' then null else cur_lang.text end ,
                                     V_MSG_LAYOUT,
                                     case when cur_msg.CONTENT_FORMAT = 'HTML' then '<p>' ||cur_lang.text  || '<p>' else null end);
                                  /*parameter configure*/
                                  SELECT count(1)
                                    into count_p
                                    FROM DC_MSG_TEMPLATE_PARAM
                                   where template_name = cur_lang.template_name;
                                  if count_p > 0 then
                                    for cur_param in (select *
                                                        from DC_MSG_TEMPLATE_PARAM
                                                       where template_name = cur_lang.template_name) loop
                                      SELECT case when MAX(TEMPLATE_ATTR_ID) >= C_SPLIT_ID1 then MAX(TEMPLATE_ATTR_ID) + 1 else C_SPLIT_ID1 end
                                        into V_TEMPLATE_ATTR_ID
                                        FROM cic.CIC_MSG_TEMPLATE_ATTR;
                                      if cur_param.attr_code_path is not null and cur_param.dim_field_code_path is null then
                                        select replace(cur_param.attr_code_path,'${','${EV.') into V_PARAM_FIELD from dual;
                                        SELECT EVENT_ATTR_ID
                                          into V_EVENT_ATTR_ID3
                                          FROM cic.CIC_INTER_EVENT_ATTR
                                         where inter_event_id = V_EVENT_ID
                                           and attr_code_path =
                                               substr(cur_param.attr_code_path,
                                                      3,
                                                      length(cur_param.attr_code_path) - 3);
                                        insert into cic.CIC_MSG_TEMPLATE_ATTR
                                          (TEMPLATE_ATTR_ID,
                                           TEMPLATE_ID,
                                           EVENT_ATTR_ID,
                                           FUN_ID,
                                           MEMBER_ATTR_ID,
                                           ENRICH_SERV_FIELD,
                                           FIX_OUTPUT_ID,
                                           ACTION_FIELD_ID,
                                           CAL_EXPRESSION_ID,
                                           SPLIT_PARAM_ID,
                                           CONTENT_ID,
                                           ACM_ID,
                                           OBJ_DIM_RTN_FIELD_ID,
                                           PARENT_TMP_ATTR_ID)
                                        values
                                          (V_TEMPLATE_ATTR_ID,
                                           V_TEMPLATE_ID,
                                           V_EVENT_ATTR_ID3,
                                           null,
                                           null,
                                           null,
                                           null,
                                           null,
                                           null,
                                           null,
                                           V_CONTENT_ID,
                                           null,
                                           null,
                                           null);
                                           select 'EV_'||V_EVENT_ATTR_ID3 into V_EMAIL_PARAM_ID from dual;
                                           select attr_name into V_EMAIL_PARAM_NAME from cic.CIC_INTER_EVENT_ATTR where EVENT_ATTR_ID = V_EVENT_ATTR_ID3;
                                      end if;
                                      if cur_param.field_code_path is not null then
                                        select replace(cur_param.field_code_path,'${','${ES.') into V_PARAM_FIELD from dual;
                                        SELECT rtn_field_id
                                          into V_RTN_FIELD_ID
                                          FROM cic.cic_serv_rtn csr
                                         where field_code_path =
                                               substr(trim(cur_param.field_code_path),
                                                      3,
                                                      length(trim(cur_param.field_code_path)) - 3)
                                           and reg_service_id in
                                               (select reg_service_id
                                                  from cic.cic_enrich_service
                                                 where enrich_service_name =
                                                       cur_param.enrich_service_name);
                                        insert into cic.CIC_MSG_TEMPLATE_ATTR
                                          (TEMPLATE_ATTR_ID,
                                           TEMPLATE_ID,
                                           EVENT_ATTR_ID,
                                           FUN_ID,
                                           MEMBER_ATTR_ID,
                                           ENRICH_SERV_FIELD,
                                           FIX_OUTPUT_ID,
                                           ACTION_FIELD_ID,
                                           CAL_EXPRESSION_ID,
                                           SPLIT_PARAM_ID,
                                           CONTENT_ID,
                                           ACM_ID,
                                           OBJ_DIM_RTN_FIELD_ID,
                                           PARENT_TMP_ATTR_ID)
                                        values
                                          (V_TEMPLATE_ATTR_ID,
                                           V_TEMPLATE_ID,
                                           null,
                                           null,
                                           null,
                                           V_RTN_FIELD_ID,
                                           null,
                                           null,
                                           null,
                                           null,
                                           V_CONTENT_ID,
                                           null,
                                           null,
                                           null);
                                           select 'ES_'||V_RTN_FIELD_ID into V_EMAIL_PARAM_ID from dual;
                                           select field_name into V_EMAIL_PARAM_NAME from cic.cic_serv_rtn csr where rtn_field_id = V_RTN_FIELD_ID;
                                      end if;
                                      if cur_param.dim_field_code_path is not null then
                                        SELECT EVENT_ATTR_ID  into V_EVENT_ATTR_ID3 FROM cic.CIC_INTER_EVENT_ATTR where inter_event_id = V_EVENT_ID and attr_code_path = substr(cur_param.attr_code_path, 3, length(cur_param.attr_code_path) - 3);
                                        select replace(replace(cur_param.attr_code_path,'${','${EV.'),'}','')||'.DIM.'||substr(cur_param.dim_field_code_path,3) into V_PARAM_FIELD from dual;
                                        SELECT rtn_field_id
                                          into V_RTN_FIELD_ID
                                          FROM cic.cic_serv_rtn csr
                                         where field_code_path =
                                               substr(trim(cur_param.dim_field_code_path),
                                                      3,
                                                      length(trim(cur_param.dim_field_code_path)) - 3)
                                           and reg_service_id in
                                               (select reg_service_id
                                                  from cic.cic_dim_service
                                                 where attr_dim_id in (select ATTR_DIM_ID from cic.cic_dim where attr_dim_name =
                                                                                                              cur_param.dim_name));
                                        insert into cic.CIC_MSG_TEMPLATE_ATTR
                                          (TEMPLATE_ATTR_ID,
                                           TEMPLATE_ID,
                                           EVENT_ATTR_ID,
                                           FUN_ID,
                                           MEMBER_ATTR_ID,
                                           ENRICH_SERV_FIELD,
                                           FIX_OUTPUT_ID,
                                           ACTION_FIELD_ID,
                                           CAL_EXPRESSION_ID,
                                           SPLIT_PARAM_ID,
                                           CONTENT_ID,
                                           ACM_ID,
                                           OBJ_DIM_RTN_FIELD_ID,
                                           PARENT_TMP_ATTR_ID)
                                        values
                                          (V_TEMPLATE_ATTR_ID,
                                           V_TEMPLATE_ID,
                                           V_EVENT_ATTR_ID3,
                                           null,
                                           null,
                                           null,
                                           null,
                                           null,
                                           null,
                                           null,
                                           V_CONTENT_ID,
                                           null,
                                           V_RTN_FIELD_ID,
                                           null);
                                           select 'DIM_'||V_RTN_FIELD_ID||'EV_'||V_EVENT_ATTR_ID3 into V_EMAIL_PARAM_ID from dual;
                                           select ci.attr_code_path||csr.field_code_path into V_EMAIL_PARAM_NAME from cic.CIC_INTER_EVENT_ATTR ci, cic.cic_serv_rtn csr where EVENT_ATTR_ID = V_EVENT_ATTR_ID3 and rtn_field_id = V_RTN_FIELD_ID;
                                      end if;
                                      if  cur_param.CONFIG_CODE is not null then
                                        select config_id into V_CONFIG_ID from cic.cic_config where config_code = substr(cur_param.CONFIG_CODE,6,length(cur_param.CONFIG_CODE)-6);
                                        insert into cic.CIC_MSG_TEMPLATE_ATTR
                                          (TEMPLATE_ATTR_ID,
                                           TEMPLATE_ID,
                                           EVENT_ATTR_ID,
                                           FUN_ID,
                                           MEMBER_ATTR_ID,
                                           ENRICH_SERV_FIELD,
                                           FIX_OUTPUT_ID,
                                           ACTION_FIELD_ID,
                                           CAL_EXPRESSION_ID,
                                           SPLIT_PARAM_ID,
                                           CONTENT_ID,
                                           ACM_ID,
                                           OBJ_DIM_RTN_FIELD_ID,
                                           PARENT_TMP_ATTR_ID,
                                           CONFIG_ID)
                                        values
                                          (V_TEMPLATE_ATTR_ID,
                                           V_TEMPLATE_ID,
                                           null,
                                           null,
                                           null,
                                           null,
                                           null,
                                           null,
                                           null,
                                           null,
                                           V_CONTENT_ID,
                                           null,
                                           null,
                                           null,
                                           V_CONFIG_ID);
                                      end if;
                                      /*parameter replace*/
                                       if cur_msg.action_name in ('Send Email','Send Ussd') or cur_param.dim_field_code_path is not null then
                                          update cic.CIC_TEMPLATE_CONTENT t set msg_layout = replace(msg_layout,
                                                                    cur_param.OLD_PARAM_NAME, '${<input type=\"button\" disabled=\"disabled\" class=\"js-drag-btn\" express_val=\"'
                                                                    ||cur_param.OLD_PARAM_NAME
                                                                    ||'\" id=\"'||V_EMAIL_PARAM_ID
                                                                    ||'\" value=\"'||V_EMAIL_PARAM_NAME
                                                                    ||'\" title=\"'||V_EMAIL_PARAM_NAME
                                                                    ||'\" style=\"border-width:0px;height:20px;line-height:20px;padding-left:5px;background:#a2d1f8;color:black;max-width:300px;\"/>}')
                                          where template_id = V_TEMPLATE_ID;
                                       end if;
                                       if cur_param.is_subject = 'Y' then
                                            update cic.CIC_TEMPLATE_CONTENT t set subject = replace(subject,
                                                                 cur_param.OLD_PARAM_NAME,
                                                                 replace(V_PARAM_FIELD,
                                                                         '.',
                                                                         '@')) where template_id = V_TEMPLATE_ID;
                                      end if;
                                      update cic.CIC_TEMPLATE_CONTENT t
                                         set msg_template = replace(msg_template,
                                                                    cur_param.OLD_PARAM_NAME,
                                                                    replace(V_PARAM_FIELD,
                                                                            '.',
                                                                            '@')),
                                             msg_layout   = replace(msg_layout,
                                                                    cur_param.OLD_PARAM_NAME,
                                                                    replace(V_PARAM_FIELD,
                                                                            '.',
                                                                            '@'))
                                       where template_id = V_TEMPLATE_ID;
                                    end loop;
                                  end if;
                                end loop;
                              end loop;
                              SELECT input_param_id into V_input_param_id FROM cic.cic_input_param where param_name = 'templateId' and reg_service_id = (SELECT reg_service_id FROM cic.cic_action where action_name = cur_pro.action_name);
                              insert into cic.CIC_ACTION_PARAM_VALUE
                                (PROCESS_ID,
                                 ACTION_PARAM_ID,
                                 INPUT_VALUE_TYPE,
                                 EVENT_ATTR_ID,
                                 RTN_FIELD_ID,
                                 CAL_EXPRESSION_ID,
                                 SPLIT_PARAM_ID,
                                 INPUT_VALUE,
                                 ACTION_FIELD_ID,
                                 FIX_OUTPUT_ID,
                                 ACM_ID,
                                 OBJ_DIM_RTN_FIELD_ID)
                              values
                                (V_MED_PROCESS_ID,
                                 V_input_param_id,
                                 'IV',
                                 null,
                                 null,
                                 null,
                                 null,
                                 V_TEMPLATE_ID,
                                 null,
                                 null,
                                 null,
                                 null);
                        end if;

                        select count(1) into v_flag from DC_CIC_PROCESS p,dc_cic_process c where p.process_id = c.parent_process_id and p.flow_name = c.flow_name and p.process_name = cur_pro.process_name and p.flow_name = cur.flow_name;
                        select count(1) into v_p_flag from DC_CIC_PROCESS p where p.parent_process_id = cur_pro.parent_process_id and p.flow_name = cur.flow_name;
                        if cur_pro.process_id = 1 then
                          V_POINT_X := V_START_POINT_X + 100;
                          V_POINT_Y := V_START_POINT_Y - 12;
                          V_SHAPE_FPOINTS_X := V_START_POINT_X + 35;
                          V_SHAPE_FPOINTS_Y := V_START_POINT_Y + 17;
                          elsif v_flag = 0 or v_p_flag = 1 then
                          V_POINT_X := V_POINT_X +200;
                          V_SHAPE_FPOINTS_X := V_POINT_X - 100;
                          V_SHAPE_FPOINTS_Y := V_POINT_Y +30;
                          elsif v_flag > 0 and cur_pro.process_id != 1 then
                          V_POINT_X := V_POINT_X -100;
                          V_POINT_Y := V_POINT_Y +100;
                          V_SHAPE_FPOINTS_X := V_POINT_X;
                          V_SHAPE_FPOINTS_Y := V_POINT_Y - 70;
                          END IF;
                          V_SHAPE_TPOINTS_X := V_POINT_X;
                          V_SHAPE_TPOINTS_Y := V_POINT_Y + 30;
                          SELECT length(cur_pro.process_name) into V_TEMPLATE_LENGTH FROM dual;
                          V_TEMPLATE_LENGTH := 52.5 - V_TEMPLATE_LENGTH * 4.25;
                        V_FLOW_LAYOUT := V_FLOW_LAYOUT||',{"elementType":"Image","options":{"style":{"isAllowEdit":false,"x":0,"y":0,"image":"' ||
                                             cur_pro.process_image ||
                                             '","width":100,"height":60,"textFont":"12px Microsoft YaHei","textFill":"white","fill":"#FFFFFF","rich":{},"textPosition":[' ||
                                             V_TEMPLATE_LENGTH || ',"60%%"],"text":"' ||
                                             cur_pro.process_name ||
                                             '"},"isEdit":false,"position":[' ||
                                             V_POINT_X || ',' || V_POINT_Y ||
                                             '],"operationIcons":[{"name":"DEL"},{"name":"STRAIGHT","options":{"symbol":{"type":"arrow","color":"#BBBBBB"},"style":{"stroke":"#BBBBBB","lineType":"straight"}}},{"name":"JAGGED"},{"name":"CURVE"}],"id":"' ||
                                             V_MED_NODE ||
                                             '"},"userData":{"processType":"'||V_PROCESS_TYPE;
                          if cur_pro.process_type_name = 'Rule' then
                            V_FLOW_LAYOUT := V_FLOW_LAYOUT||'","processData":{"processId":' || V_MED_PROCESS_ID ||',"processType":'||V_PROCESS_TYPE ||',"flowVersionId":' || V_FLOW_VERSION_ID || '}}}';
                          elsif cur_pro.process_type_name = 'Action' then
                            SELECT ACTION_TYPE_ID INTO V_ACTION_TYPE_ID FROM CIC.CIC_ACTION where action_id = V_ACTION_ID;
                            V_FLOW_LAYOUT := V_FLOW_LAYOUT||'","actionId":"'||V_ACTION_ID||'","actionTypeId":"'||V_ACTION_TYPE_ID||'",'||'"processData":{"processId":' || V_MED_PROCESS_ID ||',"processType":'||V_PROCESS_TYPE ||',"flowVersionId":'||
                            V_FLOW_VERSION_ID || ',"cicActionProcessDto":{"actionId":'||V_ACTION_ID||'}}}}';
                          end if;
                          SELECT p.r_process_id into V_FROM_PROCESS_ID FROM DC_CIC_PROCESS p,DC_CIC_PROCESS c  where c.parent_process_id = p.process_id and c.flow_name = p.flow_name and c.process_name = cur_pro.process_name and c.flow_name = cur.flow_name and c.from_process_name is not null ;
                          select process_node into V_START_NODE from DC_CIC_PROCESS where r_process_id = V_FROM_PROCESS_ID;
                          --连接线插入
                          select case when MAX(PROCESS_CONNECT_ID) >= C_SPLIT_ID1 then MAX(PROCESS_CONNECT_ID)+ 1 else C_SPLIT_ID1 end
                          into V_PROCESS_CONNECT_ID
                          from cic.CIC_PROCESS_CONNECT;
                        if cur_pro.fix_output_param_name is not null then
                          SELECT fix_output_id into V_FIXOUTPUT_ID from cic.cic_process_fix_output where param_name = cur_pro.fix_output_param_name;
                        else V_FIXOUTPUT_ID := 0;
                        end if;
                        insert into cic.CIC_PROCESS_CONNECT
                          t(PROCESS_CONNECT_ID,
                           FROM_PROCESS_ID,
                           TO_PROCESS_ID,
                           FIX_OUTPUT,
                           CONDITION_OPER,
                           INPUT_VALUE)
                        values
                          (V_PROCESS_CONNECT_ID,
                           V_FROM_PROCESS_ID,
                           V_MED_PROCESS_ID,
                           '',
                           cur_pro.condition_oper,
                           cur_pro.input_value);
                         V_FLOW_LAYOUT := V_FLOW_LAYOUT||',{"elementType":"connection","startNodeId":"' ||
                                             V_START_NODE || '","endNodeId":"' || V_MED_NODE ||
                                             '","options":{"symbol":{"type":"arrow","size":10,"color":"#BBBBBB","both":false,"offset":0},"style":{"lineWidth":1,"stroke":"#BBBBBB","lineType":"straight"},"hoverStyle":{"lineWidth":2,"stroke":"#74B7E0"},"arrowHoverStyle":{"fill":"#74B7E0"},"shape":{"points":[[' ||
                                             V_SHAPE_FPOINTS_X || ',' || V_SHAPE_FPOINTS_Y ||
                                             '],[' || V_SHAPE_TPOINTS_X || ',' ||
                                             V_SHAPE_TPOINTS_Y ||
                                             ']],"smooth":false,"smoothConstraint":null},"position":{"startPos":"right","endPos":"left","startOffset":[0,0],"endOffset":[0,0],"escapeDistance":[30,30],"points":null},"autoChangePosition":false,"textContextMenu":null,"isEdit":true,"text":{"text":"'
                                             ||cur_pro.input_value||'","color":"#000000","textFont":"12px Microsoft YaHei","textPos":"center"},"z":0,"dockers":[{"x":' ||
                                             V_SHAPE_FPOINTS_X || ',"y":' ||
                                             V_SHAPE_FPOINTS_Y || '},{"x":' ||
                                             V_SHAPE_TPOINTS_X || ',"y":' ||
                                             V_SHAPE_TPOINTS_Y ||
                                             '}]},"icons":[],"userData":{"processData":{"processConnectId":' ||
                                             V_PROCESS_CONNECT_ID || ',"fromProcessId":' ||
                                             V_FROM_PROCESS_ID || ',"toProcessId":' ||
                                             V_MED_PROCESS_ID ;
                          if V_FIXOUTPUT_ID > 0 then
                            update cic.CIC_PROCESS_CONNECT set FIX_OUTPUT = V_FIXOUTPUT_ID where process_connect_id = V_PROCESS_CONNECT_ID;
                            V_FLOW_LAYOUT := V_FLOW_LAYOUT||',"fixOutput":'||V_FIXOUTPUT_ID||',"conditionOper":"'||cur_pro.condition_oper||'","inputValue":"'||cur_pro.input_value||'"';
                          end if;
                          V_FLOW_LAYOUT := V_FLOW_LAYOUT||'}}}';
                          end loop;
                          V_FLOW_LAYOUT := V_FLOW_LAYOUT || ']}';


                        /*前台查询数据库中保存的flow_layout，然后进行base64解码，解码失败的话就用的数据库中的flow_layout展示的
                        直接保存json明文，会转码失败，使用数据库中的json明文展示。  下述为随机生成json格式中的起止节点id*/
                        --convert to base64 clob
                        V_FLOW_LAYOUT := DC_EncodeBASE64(V_FLOW_LAYOUT);
                        update cic.CIC_FLOW_VERSION
                           set EVENT_FLOW_ID = V_EVENT_FLOW_ID,
                               STATE         = 'P',
                               VER_NO        = 1,
                               eff_date      = to_date('01-01-2000', 'dd-mm-yyyy'),
                               exp_date      = to_date('01-01-2099', 'dd-mm-yyyy'),
                               FLOW_LAYOUT   = V_FLOW_LAYOUT
                         where FLOW_VERSION_ID = V_FLOW_VERSION_ID
                           and 1 = 1;
                      end if;
                    end loop;
                  end;

create_list:
  DC_MSG_TEMPLATE:
    - CIC
    - V20191121
    - table
    - VALUE_LIST:
        LANGUAGE_NAME:
            TYPE: sql
            SOURCE: select attr_value_name from cpc.attr_value where attr_id = (select attr_id from cpc.attr_spec t where t.attr_nbr = 'INT_SUBS_LANGUAGE') order by attr_value_name

  DC_TEMPLATE_OFFER:
    - CIC
    - V20191121
    - table
    - VALUE_LIST:
        OBJECT_TYPE:
          TYPE: list
          SOURCE: OFFER, PRODUCT

  DC_CIC_TEMPLATE_REL:
    - CIC
    - V20200723
    - table
    - VALUE_LIST:
        TEMPLATE_LABEL_NAME:
          TYPE: sql
          SOURCE: SELECT label_name FROM cic.cic_label where label_type = 'MSG_TMP' order by label_name
        EVENT_CODE:
          TYPE: sql
          SOURCE: SELECT event_code FROM cic.CIC_EVENT where state = 'P' order by event_code
        CATALOG_NAME:
          TYPE: sql
          SOURCE: select CATALOG_NAME from cic.cic_catalog
        FLASH_SMS:
          TYPE: list
          SOURCE: Y,N
        ACTION_NAME:
          TYPE: sql
          SOURCE: select ACTION_NAME from cic.CIC_ACTION where ACTION_ID < 0
        SRC_NBR:
          TYPE: sql
          SOURCE: SELECT SRC_NBR FROM cic.cic_source_nbr where contact_channel in (select contact_channel_id FROM cbec_contact_channel)
        TIME_WINDOW:
          TYPE: sql
          SOURCE: SELECT TIME_WIND_START||'-'||TIME_WIND_END FROM cic.cic_contact_time_window

  DC_MSG_TEMPLATE_JUDGE:
    - CIC
    - V20191121
    - table
    - VALUE_LIST:
        EVENT_CODE:
          TYPE: sql
          SOURCE: SELECT event_code FROM cic.CIC_EVENT where state = 'P' order by event_code
        TEMPLATE_LABEL_NAME:
          TYPE: sql
          SOURCE: SELECT label_name FROM cic.cic_label where label_type = 'MSG_TMP' order by label_name
        ENRICH_SERVICE_NAME:
          TYPE: sql
          SOURCE: select enrich_service_name from cic.cic_enrich_service where state = 'P' order by enrich_service_name
        OPERATOR_NAME:
          TYPE: sql
          SOURCE: select operator_name from cic.cic_operator order by operator_name
        BLOCK_ID:
          TYPE: list
          SOURCE: 1,2,3,4,5,6,7,8,9,10,0

  DC_MSG_TEMPLATE_PARAM:
    - CIC
    - V20200803
    - table
    - VALUE_LIST:
        EVENT_CODE:
          TYPE: sql
          SOURCE: SELECT event_code FROM cic.CIC_EVENT where state = 'P' order by event_code
        ENRICH_SERVICE_NAME:
          TYPE: sql
          SOURCE: select enrich_service_name from cic.cic_enrich_service where state = 'P' order by enrich_service_name

  DC_CIC_PROCESS:
    - CIC
    - V20191121
    - table
    - VALUE_LIST:
        PROCESS_TYPE_NAME:
          TYPE: sql
          SOURCE: SELECT TYPE_NAME FROM cic.cic_process_type order by TYPE_NAME
        ACTION_NAME:
          TYPE: sql
          SOURCE: SELECT action_name FROM cic.cic_action where state = 'P' order by action_name
        PROCESS_IMAGE:
          TYPE: sql
          SOURCE: SELECT 'cic/modules/cic-event-mgr/styles/icons/' || ACTION_PROCESS_PIC ||
            '.svg'
            FROM cic.cic_action
            WHERE STATE = 'P'
            union
            SELECT 'cic/modules/cic-event-mgr/styles/icons/icon-judgment-rule.svg'
            FROM dual
            union
            SELECT 'cic/modules/cic-event-mgr/styles/images/start.svg' FROM dual
        FIX_OUTPUT_PARAM_NAME:
          TYPE: sql
          SOURCE: SELECT param_name FROM cic.cic_process_fix_output
        CONDITION_OPER:
          TYPE: list
          SOURCE: IS
        INPUT_VALUE:
          TYPE: list
          SOURCE: True,False
        PROCESS_ID:
          TYPE: list
          SOURCE: 0,1,2,3,4,5,6,7,8,9,10
        PARENT_PROCESS_ID:
          TYPE: list
          SOURCE: 0,1,2,3,4,5,6,7,8,9,10

  DC_CIC_ACTION_PARAM_VALUE:
    - CIC
    - V20191121
    - table
    - VALUE_LIST:
        INPUT_VALUE_TYPE:
          TYPE: list
          SOURCE: IV,EV,ES,AC
        ENRICH_SERVICE_NAME:
          TYPE: sql
          SOURCE: select enrich_service_name from cic.cic_enrich_service where state = 'P' order by enrich_service_name

  DC_EncodeBASE64:
    - CIC
    - V20190911
    - function

  DC_PROC_MSG_JUDGE:
    - CIC
    - V20190911
    - procedure

  DC_PROC_MSG_FlowLayout:
    - CIC
    - V20200803
    - procedure

  DC_PROC_FlowLayout:
    - CIC
    - V20200723
    - procedure