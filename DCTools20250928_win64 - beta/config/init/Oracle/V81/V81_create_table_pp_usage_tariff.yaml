create:
    DC_CONFIG_PP_Usage_Tariff:
        - |
            create table DC_CONFIG_PP_Usage_Tariff
            (
              pp_name             VARCHAR2(200),
              pp_id               VARCHAR2(200),
              pp_type             VARCHAR2(1),
              serv_type           VARCHAR2(200),
              re_id               NUMBER(10),
              re_name             VARCHAR2(100),
              fea_name1           VARCHAR2(16),
              zone_map1           VARCHAR2(200),
              zone1               VARCHAR2(200),
              fea_name2           VARCHAR2(16),
              zone_map2           VARCHAR2(16),
              zone2               VARCHAR2(16),
              price_name          VARCHAR2(200),
              tm_sp_name          VARCHAR2(50),
              price               VARCHAR2(200),
              unit                VARCHAR2(200),
              acct_item_type_id   NUMBER(10),
              acct_item_type_name VARCHAR2(100)
            )
        - comment on table DC_CONFIG_PP_Usage_Tariff is  'The usage tariff of price plan'
        - comment on column DC_CONFIG_PP_Usage_Tariff.pp_name is 'the price plan name'
        - comment on column DC_CONFIG_PP_Usage_Tariff.pp_type is 'the price plan type,should be 1(system default Price Plan);3(Individual Price Plan)'
        - comment on column DC_CONFIG_PP_Usage_Tariff.serv_type is 'the service type:GPRS,SMS,VOICE;can be null'
        - comment on column DC_CONFIG_PP_Usage_Tariff.re_id is 'the re id of usage event'
        - comment on column DC_CONFIG_PP_Usage_Tariff.re_name is 'the event name'
        - comment on column DC_CONFIG_PP_Usage_Tariff.zone_map1 is  'if the price plan is mapping price and only have one feature,need to fill the specific zone map name of the zone_map'
        - comment on column DC_CONFIG_PP_Usage_Tariff.zone1 is  'if the price plan is mapping price and only have one feature,need to fill the specific zone name'
        - comment on column DC_CONFIG_PP_Usage_Tariff.fea_name1 is  'if the price plan is mapping price  and only have one feature,need to fill the specific event feature name'
        - comment on column DC_CONFIG_PP_Usage_Tariff.zone_map2 is  'if the price plan is mapping price and have two feature,need to fill the specific zone map name of the zone_map'
        - comment on column DC_CONFIG_PP_Usage_Tariff.zone2 is  'if the price plan is mapping price and have two feature,need to fill the specific zone name'
        - comment on column DC_CONFIG_PP_Usage_Tariff.fea_name2 is  'if the price plan is mapping price and have two feature,need to fill the specific event feature name'
        - comment on column DC_CONFIG_PP_Usage_Tariff.tm_sp_name is  'the time span name '
        - comment on column DC_CONFIG_PP_Usage_Tariff.price is  'the tariff of this price plan'
        - comment on column DC_CONFIG_PP_Usage_Tariff.unit is  'the unit of this tariff, can be:60 Seconds,1 Items,1 Bytes,1048576 Bytes'
        - comment on column DC_CONFIG_PP_Usage_Tariff.acct_item_type_id is  'the account item type id'
        - comment on column DC_CONFIG_PP_Usage_Tariff.acct_item_type_name is  'the account item type  name '

    DC_CONFIG_PP_Usage_Tariff_LOG:
        - |
            create table DC_CONFIG_PP_Usage_Tariff_LOG
            (
              pp_name             VARCHAR2(200),
              pp_id               VARCHAR2(200),
              pp_type             VARCHAR2(1),
              serv_type           VARCHAR2(200),
              re_id               NUMBER(10),
              re_name             VARCHAR2(100),
              fea_name1           VARCHAR2(16),
              zone_map1           VARCHAR2(200),
              zone1               VARCHAR2(200),
              fea_name2           VARCHAR2(16),
              zone_map2           VARCHAR2(16),
              zone2               VARCHAR2(16),
              price_name          VARCHAR2(200),
              tm_sp_name          VARCHAR2(50),
              price               VARCHAR2(200),
              unit                VARCHAR2(200),
              acct_item_type_id   NUMBER(10),
              acct_item_type_name VARCHAR2(100),
              error_log           VARCHAR2(1000),
              fix_sql             VARCHAR2(1000)
            )
        - comment on table DC_CONFIG_PP_Usage_Tariff_LOG is  'this table no need to fill ,keep it blank,this table records the error data when inserting data from DC_CONFIG_PP_Usage_Tariff'
        - comment on column DC_CONFIG_PP_Usage_Tariff_LOG.error_log is 'the error information description'
        - comment on column DC_CONFIG_PP_Usage_Tariff_LOG.fix_sql is  'the fix sql of this error record'

    DC_INSERT_PP_Usage_Tariff:
        - |
            CREATE OR REPLACE PROCEDURE DC_INSERT_PP_Usage_Tariff IS
            v_pp_name varchar2(200);
            v_pp_id number(10);
            v_pp_type number(2);
            v_m_pp_type number(2);
            v_flag number(2);
            v_offer_ver_id number(10);
            v_re_id number(10);
            v_re_name varchar2(50);
            v_rate_plan_id number(10);
            v_rate_plan_zone_id1 number(10);
            v_rate_plan_zone_id2 number(10);
            v_fea_name1 varchar2(40);
            v_zone_map1 number(10);
            v_fea_name2 varchar2(40);
            v_zone_map2 number(10);
            v_m_zone_map1 number(10);
            v_m_zone_map2 number(10);
            v_zone_map_name1 varchar2(100);
            v_zone_map_name2 varchar2(100);
            v_re_attr1 number(10);
            v_re_attr2 number(10);
            v_m_re_attr1 number(10);
            v_prio number(10);
            v_mapping_id number(20);
            v_zone1 varchar2(100);
            v_zone2 varchar2(100);
            v_zone_id1 number(10);
            v_zone_id2 number(10);
            v_price_ver_id number(10);
            v_price_id number(10);
            v_price_name varchar2(100);
            v_price_tariff VARCHAR2(120);
            v_m_price_tariff VARCHAR2(120);
            v_unit varchar2(40);
            v_acct_item_type_id number(20);
            v_m_acct_item_type_id number(20);
            v_ref_value_id1 number(10);
            v_ref_value_id2 number(10);
            v_rum number(10);
            v_m_rum number(10);
            v_serv_unit number(10);
            v_m_serv_unit number(10);

            begin
            for cur_pp in (select * from DC_CONFIG_PP_Usage_Tariff order by pp_name ) loop
              select cur_pp.pp_id,cur_pp.pp_name,cur_pp.pp_type into v_pp_id,v_pp_name,v_pp_type from dual;
              --插入offer,offer_ver,price plan,SUBS_PRICE_PLAN
              select count(1) into v_flag from OFFER where offer_id=v_pp_id and state='A';
              if v_flag=0 then
                SELECT OFFER_VER_ID_SEQ.NEXTVAL  into v_offer_ver_id FROM DUAL;
                INSERT INTO
                OFFER(OFFER_ID,OFFER_TYPE,OFFER_NAME,COMMENTS,OFFER_CODE,SALE_LIST_PRICE,RENT_LIST_PRICE,EFF_DATE,EXP_DATE,CREATED_DATE,STATE,STATE_DATE,EFF_TYPE,AUTO_CONTINUE_FLAG,CYCLE_QUANTITY,TIME_UNIT,DUPLICATE_FLAG,SP_ID,EXP_OFF,EXP_TIME_UNIT,AGREEMENT_EFF_TYPE,SALE_PRICE_GST_TYPE,RENT_PRICE_GST_TYPE)
                VALUES(v_pp_id,'4',v_pp_name,'','',null,null,to_date('2010-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'),null,to_date('2019-03-13 19:45:39','yyyy-mm-dd hh24:mi:ss'),'A',to_date('2019-03-13 19:45:39','yyyy-mm-dd hh24:mi:ss'),'B',null,null,null,null,0,null,null,null,null,null);
                INSERT INTO
                PRICE_PLAN(PRICE_PLAN_ID,APPLY_LEVEL,SERV_TYPE,PRIORITY,IS_PACKAGE,SP_ID)
                VALUES(v_pp_id,'S',null,88888,null,0);
                INSERT INTO SUBS_PRICE_PLAN
                (PRICE_PLAN_ID,PRICE_PLAN_TYPE,SP_ID)
                VALUES(v_pp_id,v_pp_type,0);
                INSERT INTO
                OFFER_VER(OFFER_VER_ID,OFFER_ID,EFF_DATE,EXP_DATE,SEQ,SP_ID,STATE)
                VALUES(v_offer_ver_id,v_pp_id,to_date('2010-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'),null,1,0,'A');
              elsif v_flag=1 then
                select count(1) into v_flag from offer_ver where offer_id=v_pp_id;
                if v_flag=0 then
                  SELECT OFFER_VER_ID_SEQ.NEXTVAL  into v_offer_ver_id FROM DUAL;
                  INSERT INTO
                  OFFER_VER(OFFER_VER_ID,OFFER_ID,EFF_DATE,EXP_DATE,SEQ,SP_ID,STATE)
                  VALUES(v_offer_ver_id,v_pp_id,to_date('2010-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'),null,1,0,'A');
                elsif v_flag=1 then
                  select offer_ver_id into v_offer_ver_id from offer_ver where offer_id=v_pp_id;
                else
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Offer Ver Error',null);
                  continue;
                end if;
                select PRICE_PLAN_TYPE into v_m_pp_type from SUBS_PRICE_PLAN where PRICE_PLAN_ID=v_pp_id;
                if v_m_pp_type<>v_pp_type then
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Price Plan Type Is Error','update SUBS_PRICE_PLAN set PRICE_PLAN_TYPE='||v_pp_type||' where PRICE_PLAN_ID='||v_pp_id||';');
                    continue;
                end if;
              else
                insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Offer Duplicate',null);
                continue;
              end if;
              --插入re
              select cur_pp.re_id,cur_pp.re_name into v_re_id ,v_re_name from dual;
              select count(1) into v_flag from re_price_plan where offer_ver_id=v_offer_ver_id and re_id=v_re_id;
              if v_flag=0 then
                INSERT INTO RE_PRICE_PLAN
                (RE_ID,OFFER_VER_ID,SP_ID)
                VALUES(v_re_id,v_offer_ver_id,0);
              end if;
              --插入rate plan
              select count(1) into v_flag from RATE_PLAN where OFFER_VER_ID=v_offer_ver_id and re_id=v_re_id;
              if v_flag=0 then
                SELECT RATE_PLAN_ID_SEQ.NEXTVAL into v_rate_plan_id FROM DUAL;
                INSERT INTO RATE_PLAN
                (RATE_PLAN_ID,RE_ID,OFFER_VER_ID,RATE_PLAN_TYPE,PRIORITY,RATE_PLAN_NAME,SP_ID,TEMPLATE_FLAG, COMMENTS,SRC_RATE_PLAN_ID,RATE_PLAN_CODE)
                VALUES(v_rate_plan_id,v_re_id,v_offer_ver_id,'1',null,v_re_name||'rate plan',0,'N',null,null,'');
              elsif v_flag=1 then
                select rate_plan_id into v_rate_plan_id from rate_plan where OFFER_VER_ID=v_offer_ver_id and re_id=v_re_id;
              else
                insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Rate Plan Duplicate',null);
                continue;
              end if;
              --插入 RATE_PLAN_MAPPING
              select count(1) into v_flag from RATE_PLAN_MAPPING where rate_plan_id=v_rate_plan_id and re_id=v_re_id and OFFER_VER_ID=v_offer_ver_id;
              if v_flag=0 then
                SELECT NVL(MAX(PRIORITY)+1,1) into v_prio FROM RATE_PLAN_MAPPING;
                INSERT INTO
                RATE_PLAN_MAPPING(RATE_PLAN_ID,RE_ID,OFFER_VER_ID,PRIORITY,SP_ID)
                VALUES(v_rate_plan_id,v_re_id,v_offer_ver_id,v_prio,0);
              end if;
              --判断是否是mapping资费，如果是需要插入rate plan zone,这里判断一个mapping feature的情况
              if cur_pp.fea_name1 <>'N/A' and cur_pp.fea_name2 ='N/A' then
                select cur_pp.fea_name1 ,cur_pp.zone_map1 into v_fea_name1 ,v_zone_map1 from dual;
                select re_attr into v_re_attr1 from re_attr where re_attr_name=v_fea_name1;
                select count(1) into v_flag from RATE_PLAN_ZONE where rate_plan_id=v_rate_plan_id;
                if v_flag=0 then
                  SELECT RATE_PLAN_ZONE_ID_SEQ.NEXTVAL into  v_rate_plan_zone_id1 FROM DUAL;
                  select  zone_map_name into v_zone_map_name1 from zone_map where zone_map_id=v_zone_map1;
                  INSERT INTO RATE_PLAN_ZONE
                  (RATE_PLAN_ZONE_ID,RATE_PLAN_ID,MAPPING_SRC_TYPE,MAPPING_SRC_VALUE,MAPPING_DES_TYPE,MAPPING_DES_VALUE,PRIORITY,SP_ID,LABEL_SHOW)
                  VALUES(v_rate_plan_zone_id1,v_rate_plan_id,'1',v_re_attr1,'0',v_zone_map1,1,0,substr(v_fea_name1||'-'||v_zone_map_name1,0,59));
                elsif v_flag=1 then
                  select rate_plan_zone_id ,MAPPING_SRC_VALUE ,MAPPING_DES_VALUE into v_rate_plan_zone_id1 ,v_m_re_attr1,v_m_zone_map1 from rate_plan_zone where rate_plan_id=v_rate_plan_id;
                  if v_m_re_attr1<> v_re_attr1 then
                    insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Rate Plan Zone Event Feature Error','update rate_plan_zone set MAPPING_SRC_VALUE='||v_re_attr1||' where rate_plan_id='||v_rate_plan_id||';');
                    continue;
                  end if;
                  if v_m_zone_map1<>v_zone_map1 then
                    insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Rate Plan Zone Zone Map Error','update rate_plan_zone set MAPPING_DES_VALUE='||v_zone_map1||' where rate_plan_id='||v_rate_plan_id||';');
                    continue;
                  end if;
                else
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Rate Plan Zone Duplicate,shoud be one record',null);
                  continue;
                end if;
                --当是mapping资费时，需要检查mapping ,mapping unit 是否正确
                select cur_pp.zone1 into v_zone1 from dual;
                select count(1) into v_flag from zone where zone_name=v_zone1 and zone_map_id=v_zone_map1;
                if v_flag=0 then
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Zone name doesnt exists',null);
                  continue;
                elsif v_flag=1 then
                  select zone_id into v_zone_id1 from zone where zone_name=v_zone1 and zone_map_id=v_zone_map1;
                else
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Zone name Duplicate,shoud be one record',null);
                  continue;
                end if;
                select count(1) into v_flag from mapping a,MAPPING_UNIT b
                where a.mapping_id=b.mapping_id
                and a.rate_plan_id=v_rate_plan_id
                and b.rate_plan_zone_id=v_rate_plan_zone_id1
                and b.mapping_value=v_zone_id1;
                if v_flag=0 then
                  SELECT MAPPING_ID_SEQ.NEXTVAL  into v_mapping_id FROM DUAL;
                  SELECT NVL(MAX(PRIORITY)+1,1) into v_prio FROM MAPPING;
                  INSERT INTO MAPPING
                  (MAPPING_ID,RATE_PLAN_ID,MAPPING_NAME,PRIORITY,SP_ID)
                  VALUES(v_mapping_id,v_rate_plan_id,substr(v_zone1,0,60),v_prio,0);
                  INSERT INTO MAPPING_UNIT
                  (MAPPING_ID,RATE_PLAN_ZONE_ID,MAPPING_TYPE,MAPPING_MATCH_TYPE,MAPPING_VALUE,SP_ID)
                  VALUES(v_mapping_id,v_rate_plan_zone_id1,'0','A',v_zone_id1,0);
                elsif v_flag=1 then
                  select a.mapping_id into v_mapping_id from mapping a,MAPPING_UNIT b
                  where a.mapping_id=b.mapping_id
                  and a.rate_plan_id=v_rate_plan_id
                  and b.rate_plan_zone_id=v_rate_plan_zone_id1
                  and b.mapping_value=v_zone_id1;
                else
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Mapping unit Duplicate,shoud be one record',null);
                  continue;
                end if;
              end if;

              --判断是否是mapping资费，如果是需要插入rate plan zone,这里判断有两个mapping feature的情况
              if cur_pp.fea_name1 <>'N/A' and cur_pp.fea_name2 <>'N/A' then
                select cur_pp.fea_name1 ,cur_pp.zone_map1 ,cur_pp.fea_name2,cur_pp.zone_map2 into v_fea_name1 ,v_zone_map1 ,v_fea_name2,v_zone_map2 from dual;
                select re_attr into v_re_attr1 from re_attr where re_attr_name=v_fea_name1;
                select re_attr into v_re_attr2 from re_attr where re_attr_name=v_fea_name2;
                select count(1) into v_flag from RATE_PLAN_ZONE where rate_plan_id=v_rate_plan_id and MAPPING_SRC_VALUE = v_re_attr1;
                if v_flag = 0 then
                  SELECT RATE_PLAN_ZONE_ID_SEQ.NEXTVAL into v_rate_plan_zone_id1 FROM DUAL;
                  select  zone_map_name into v_zone_map_name1 from zone_map where zone_map_id=v_zone_map1;
                  SELECT NVL(MAX(PRIORITY)+1,1) into v_prio FROM RATE_PLAN_ZONE  WHERE RATE_PLAN_ID =v_rate_plan_id;
                  INSERT INTO RATE_PLAN_ZONE
                  (RATE_PLAN_ZONE_ID,RATE_PLAN_ID,MAPPING_SRC_TYPE,MAPPING_SRC_VALUE,MAPPING_DES_TYPE,MAPPING_DES_VALUE,PRIORITY,SP_ID,LABEL_SHOW)
                  VALUES(v_rate_plan_zone_id1,v_rate_plan_id,'1',v_re_attr1,'0',v_zone_map1,v_prio,0,v_fea_name1||'-'||v_zone_map_name1);
                elsif v_flag= 1 then
                  select rate_plan_zone_id  ,MAPPING_DES_VALUE into v_rate_plan_zone_id1 ,v_m_zone_map1 from rate_plan_zone where rate_plan_id=v_rate_plan_id and MAPPING_SRC_VALUE = v_re_attr1;
                  if v_m_zone_map1<>v_zone_map1 then
                    insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Rate Plan Zone Zone Map Error','update rate_plan_zone set MAPPING_DES_VALUE='||v_zone_map1||' where rate_plan_id='||v_rate_plan_id||' and MAPPING_SRC_VALUE='||v_re_attr1||';');
                    continue;
                  end if;
                else
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Rate Plan Zone fea_name1 Duplicate,shoud be one record',null);
                  continue;
                end if;
                select count(1) into v_flag from RATE_PLAN_ZONE where rate_plan_id=v_rate_plan_id and MAPPING_SRC_VALUE = v_re_attr2;
                if v_flag = 0 then
                  SELECT RATE_PLAN_ZONE_ID_SEQ.NEXTVAL into v_rate_plan_zone_id2 FROM DUAL;
                  select  zone_map_name into v_zone_map_name2 from zone_map where zone_map_id=v_zone_map2;
                  SELECT NVL(MAX(PRIORITY)+1,1) into v_prio FROM RATE_PLAN_ZONE  WHERE RATE_PLAN_ID =v_rate_plan_id;
                  INSERT INTO RATE_PLAN_ZONE
                  (RATE_PLAN_ZONE_ID,RATE_PLAN_ID,MAPPING_SRC_TYPE,MAPPING_SRC_VALUE,MAPPING_DES_TYPE,MAPPING_DES_VALUE,PRIORITY,SP_ID,LABEL_SHOW)
                  VALUES(v_rate_plan_zone_id2,v_rate_plan_id,'1',v_re_attr2,'0',v_zone_map2,v_prio,0,v_fea_name2||'-'||v_zone_map_name2);
                elsif v_flag= 1 then
                  select rate_plan_zone_id  ,MAPPING_DES_VALUE into v_rate_plan_zone_id2 ,v_m_zone_map2 from rate_plan_zone where rate_plan_id=v_rate_plan_id and MAPPING_SRC_VALUE = v_re_attr2;
                  if v_m_zone_map2<>v_zone_map2 then
                    insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Rate Plan Zone Zone Map Error','update rate_plan_zone set MAPPING_DES_VALUE='||v_zone_map2||' where rate_plan_id='||v_rate_plan_id||' and MAPPING_SRC_VALUE='||v_re_attr2||';');
                    continue;
                  end if;
                else
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Rate Plan Zone fea_name2 Duplicate,shoud be one record',null);
                  continue;
                end if;
                select count(1) into v_flag from rate_plan_zone where rate_plan_id=v_rate_plan_id;
                if  v_flag<> 2 then
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Rate Plan Zone number error,shoud be two records',null);
                  continue;
                end if;
                --当是两个mapping资费时，需要检查mapping ,mapping unit 是否正确
                --check zone
                select cur_pp.zone1,cur_pp.zone2 into v_zone1,v_zone2 from dual;
                select count(1) into v_flag from zone where zone_name=v_zone1 and zone_map_id=v_zone_map1;
                if v_flag=0 then
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Zone name1 doesnt exists',null);
                  continue;
                elsif v_flag=1 then
                  select zone_id into v_zone_id1 from zone where zone_name=v_zone1 and zone_map_id=v_zone_map1;
                else
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Zone name1 Duplicate,shoud be one record',null);
                  continue;
                end if;
                select count(1) into v_flag from zone where zone_name=v_zone2 and zone_map_id=v_zone_map2;
                if v_flag=0 then
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Zone name2 doesnt exists',null);
                  continue;
                elsif v_flag=1 then
                  select zone_id into v_zone_id2 from zone where zone_name=v_zone2 and zone_map_id=v_zone_map2;
                else
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Zone name2 Duplicate,shoud be one record',null);
                  continue;
                end if;
                --check mapping,mapping unit
                select count(1) into v_flag from mapping a,mapping_unit b,mapping_unit c
                where a.mapping_id=b.mapping_id
                and a.rate_plan_id=v_rate_plan_id
                and b.rate_plan_zone_id=v_rate_plan_zone_id1
                and a.mapping_id=c.mapping_id
                and c.rate_plan_zone_id=v_rate_plan_zone_id2
                and b.mapping_value=v_zone_id1
                and c.mapping_value=v_zone_id2;
                if v_flag = 0 then
                  SELECT MAPPING_ID_SEQ.NEXTVAL into v_mapping_id FROM DUAL;
                  SELECT NVL(MAX(PRIORITY)+1,1) into v_prio FROM MAPPING;
                  INSERT INTO MAPPING
                  (MAPPING_ID,RATE_PLAN_ID,MAPPING_NAME,PRIORITY,SP_ID)
                  VALUES(v_mapping_id,v_rate_plan_id,v_zone1||' to '||v_zone2,v_prio,0);
                  INSERT INTO MAPPING_UNIT
                  (MAPPING_ID,RATE_PLAN_ZONE_ID,MAPPING_TYPE,MAPPING_MATCH_TYPE,MAPPING_VALUE,SP_ID)
                  VALUES(v_mapping_id,v_rate_plan_zone_id1,'0','A',v_zone_id1,0);
                  INSERT INTO MAPPING_UNIT
                  (MAPPING_ID,RATE_PLAN_ZONE_ID,MAPPING_TYPE,MAPPING_MATCH_TYPE,MAPPING_VALUE,SP_ID)
                  VALUES(v_mapping_id,v_rate_plan_zone_id2,'0','A',v_zone_id2,0);
                elsif v_flag =  1 then
                  select a.mapping_id into v_mapping_id from mapping a,mapping_unit b,mapping_unit c
                  where a.mapping_id=b.mapping_id
                  and a.rate_plan_id=v_rate_plan_id
                  and b.rate_plan_zone_id=v_rate_plan_zone_id1
                  and a.mapping_id=c.mapping_id
                  and c.rate_plan_zone_id=v_rate_plan_zone_id2
                  and b.mapping_value=v_zone_id1;
                else
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Mapping Unit Duplicate,shoud be one record',null);
                  continue;
                end if;
              end if;
              --check price_ver
              --不是mapping资费的情况
              if cur_pp.fea_name1 ='N/A' and cur_pp.fea_name2 = 'N/A' then
                select count(1) into v_flag from PRICE_VER where rate_plan_id=v_rate_plan_id and eff_date<sysdate and (exp_date>sysdate or exp_date is null);
                if v_flag = 0 then
                  SELECT PRICE_VER_ID_SEQ.NEXTVAL into v_price_ver_id FROM DUAL;
                  INSERT INTO PRICE_VER
                  (PRICE_VER_ID,RATE_PLAN_ID,MAPPING_ID,EFF_DATE,EXP_DATE,SP_ID)
                  VALUES(v_price_ver_id,v_rate_plan_id,null,to_date('2010-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'),null,0);
                elsif v_flag=1 then
                  select price_ver_id into v_price_ver_id from PRICE_VER where rate_plan_id=v_rate_plan_id;
                else
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Price ver Duplicate,shoud be one record',null);
                  continue;
                end if;
              --是maping资费的情况，包含两个maping资费
              else
                select count(1) into v_flag from PRICE_VER where rate_plan_id=v_rate_plan_id and mapping_id=v_mapping_id and eff_date<sysdate and (exp_date>sysdate or exp_date is null);
                if v_flag = 0 then
                  SELECT PRICE_VER_ID_SEQ.NEXTVAL into v_price_ver_id FROM DUAL;
                  INSERT INTO PRICE_VER
                  (PRICE_VER_ID,RATE_PLAN_ID,MAPPING_ID,EFF_DATE,EXP_DATE,SP_ID)
                  VALUES(v_price_ver_id,v_rate_plan_id,v_mapping_id,to_date('2010-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'),null,0);
                elsif v_flag=1 then
                  select price_ver_id into v_price_ver_id from PRICE_VER where rate_plan_id=v_rate_plan_id and mapping_id=v_mapping_id;
                else
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Price ver Duplicate,shoud be one record',null);
                  continue;
                end if;
              end if;
              --check price
              select cur_pp.price_name ,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id into v_price_name,v_price_tariff,v_unit,v_acct_item_type_id from dual;
              select to_number(v_price_tariff)*100000000 into v_price_tariff from dual;
              select case
              when cur_pp.unit='60 Seconds' then 106
              when cur_pp.unit='20 Seconds' then 106
              when cur_pp.unit='5 Seconds' then 106
              when cur_pp.unit='1 Items' then 112
              when cur_pp.unit='1 Bytes' then 102
              when cur_pp.unit='10240 Bytes' then 102
              when cur_pp.unit='1048576 Bytes' then 102
              end into v_serv_unit from dual;
              select case
              when cur_pp.unit='60 Seconds' then 60
              when cur_pp.unit='20 Seconds' then 20
              when cur_pp.unit='5 Seconds' then 5
              when cur_pp.unit='1 Items' then 1
              when cur_pp.unit='1 Bytes' then 1
              when cur_pp.unit='10240 Bytes' then 10240
              when cur_pp.unit='1048576 Bytes' then 1048576
              end into v_rum from dual;
              select count(1) into v_flag from  price a,ref_value b,ref_value c
              where a.price_id=b.price_id and a.value=b.ref_value_id
              and a.price_id=c.price_id
              and a.ACCT_ITEM_TYPE_ID_PARAM=c.ref_value_id
              and b.REF_VALUE_TYPE='1'
              and c.ref_value_type='8'
              and a.price_ver_id=v_price_ver_id
              and b.COST_VALUE_TYPE=1;
              if v_flag=0 then
                SELECT PRICE_ID_SEQ.NEXTVAL into v_price_id FROM DUAL;
                SELECT NVL(MAX(PRIORITY)+1,1) into v_prio FROM PRICE where PRICE_VER_ID = v_price_ver_id;
                SELECT REF_VALUE_ID_SEQ.NEXTVAL  into v_ref_value_id1 FROM DUAL;
                INSERT INTO
                REF_VALUE(REF_VALUE_ID,REF_VALUE_TYPE,VALUE_STRING,SIMPLE_PARAM_ID,TABLE_PARAM_ID,COL_ID,RE_ATTR,PARAM_VALUE_TYPE,COMMENTS, STAFF_ID,CREATED_DATE,STATE,STATE_DATE,SP_ID,COST_VALUE_TYPE,RATE_PRECISION,PRICE_ID,RATE_PLAN_ID, OFFER_VER_ID,PROMO_DISC_ACCT_ITEM_TYPE_ID)
                VALUES(v_ref_value_id1,'1',v_price_tariff,null,null,null,null,null,null, 41,to_date('2019-03-13 21:12:49','yyyy-mm-dd hh24:mi:ss'),'A',to_date('2019-03-13 21:12:49','yyyy-mm-dd hh24:mi:ss'),0,1,0,v_price_id,v_rate_plan_id, v_offer_ver_id,null);
                INSERT INTO
                REF_VALUE_TO_OFFER_VER(REF_VALUE_ID,OFFER_VER_ID,SP_ID)
                VALUES(v_ref_value_id1,v_offer_ver_id,0);
                SELECT REF_VALUE_ID_SEQ.NEXTVAL into v_ref_value_id2 FROM DUAL;
                INSERT INTO
                REF_VALUE(REF_VALUE_ID,REF_VALUE_TYPE,VALUE_STRING,SIMPLE_PARAM_ID,TABLE_PARAM_ID,COL_ID,RE_ATTR,PARAM_VALUE_TYPE,COMMENTS, STAFF_ID,CREATED_DATE,STATE,STATE_DATE,SP_ID,COST_VALUE_TYPE,RATE_PRECISION,PRICE_ID,RATE_PLAN_ID, OFFER_VER_ID,PROMO_DISC_ACCT_ITEM_TYPE_ID)
                VALUES(v_ref_value_id2,'8',v_acct_item_type_id,null,null,null,null,null,null, 41,to_date('2019-03-13 21:12:49','yyyy-mm-dd hh24:mi:ss'),'A',to_date('2019-03-13 21:12:49','yyyy-mm-dd hh24:mi:ss'),0,null,0,v_price_id,v_rate_plan_id, v_offer_ver_id,null);
                INSERT INTO
                REF_VALUE_TO_OFFER_VER(REF_VALUE_ID,OFFER_VER_ID,SP_ID)
                VALUES(v_ref_value_id2,v_offer_ver_id,0);
                INSERT INTO PRICE
                  (PRICE_ID, PRICE_NAME, VALUE, RE_ATTR, PRICE_VER_ID , ACCT_ITEM_TYPE_ID, RUM, COMMENTS, RATE_PRECISION, CALC_PRECISION , CREDIT_LIMIT, PRIORITY, PAY_INDICATOR, CALC_DIS_AIT_ID, SP_ID , PARENT_PRICE_ID, TEMPLATE_FLAG, SRC_PRICE_ID, PRICE_TYPE,ACCT_ITEM_TYPE_ID_PARAM,INNER_PRIORITY,LOOP_TYPE,TAX_INCLUSIVE) VALUES
                  (v_price_id, v_price_name, v_ref_value_id1, v_serv_unit, v_price_ver_id , null, v_rum, '', 0, 0 , null, v_prio, '000', null, 0 , null, 'N', null, null,v_ref_value_id2,null,'','N');
                  INSERT INTO UP
                (UP_ID,SP_ID,REPEAT_POS,ACMCALC_REPORT_POS,ACMCALC_REPORT_END,ACMCALC_REPORT_NUM)
                VALUES(v_price_id,0,null,null,null,null);
              elsif v_flag=1 then
                select a.price_id,a.re_attr,a.rum,b.ref_value_id,b.value_string,c.ref_value_id,c.value_string into v_price_id, v_m_serv_unit,v_m_rum,v_ref_value_id1,v_m_price_tariff ,v_ref_value_id2,v_m_acct_item_type_id from  price a,ref_value b,ref_value c
                where a.price_id=b.price_id and a.value=b.ref_value_id
                and a.price_id=c.price_id
                and a.ACCT_ITEM_TYPE_ID_PARAM=c.ref_value_id
                and b.REF_VALUE_TYPE='1'
                and c.ref_value_type='8'
                and a.price_ver_id=v_price_ver_id
                and b.COST_VALUE_TYPE=1;
                if v_m_acct_item_type_id<>v_acct_item_type_id then
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Price acct item type id is error','update ref_value set value_string='||v_acct_item_type_id||' where ref_value_id='||v_ref_value_id2||';');
                  continue;
                end if;
                if v_m_serv_unit<>v_serv_unit then
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Price serv unit is error','update price set re_attr='||v_serv_unit||' where price_id='||v_price_id||';');
                  continue;
                end if;
                if v_m_rum<>v_rum then
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Price rum is error','update price set rum='||v_rum||' where price_id='||v_price_id||';');
                  continue;

                end if;
                if v_m_price_tariff<>v_price_tariff then
                  insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Price tariff is error','update ref_value set value_string='||v_price_tariff||' where ref_value_id='||v_ref_value_id1||';');
                  continue;

                end if;
              else
                insert into DC_CONFIG_PP_Usage_Tariff_LOG values(cur_pp.pp_name,cur_pp.pp_id,cur_pp.pp_type,cur_pp.serv_type,cur_pp.re_id,cur_pp.re_name,cur_pp.fea_name1,cur_pp.zone_map1,cur_pp.zone1,cur_pp.fea_name2,cur_pp.zone_map2,cur_pp.zone2,cur_pp.price_name,cur_pp.price,cur_pp.unit,cur_pp.acct_item_type_id,cur_pp.acct_item_type_name,'Main Balance Price Duplicate,shoud be one record',null);
                continue;
              end if;
            end loop;
            end;

create_list:
    DC_CONFIG_PP_Usage_Tariff:
        - PP_USAGE_TARIFF
        - V20190516
        - TABLE


    DC_CONFIG_PP_Usage_Tariff_LOG:
        - PP_USAGE_TARIFF
        - V20190516
        - TABLE

    DC_INSERT_PP_Usage_Tariff:
        - PP_USAGE_TARIFF
        - V20190516
        - procedure