create:
  DC_CONFIG_PP_Usage_Tariff:
    - |
      create table DC_CONFIG_PP_Usage_Tariff
        (
          price_plan_id number(10),
          price_plan_name VARCHAR2(512) not null,
          re_id           NUMBER(9) not null,
          re_name         VARCHAR2(200),
          zone_map_name    VARCHAR2(200),
          zone_name       VARCHAR2(200),
          featur          VARCHAR2(30),
          connect_type    CHAR(1),
          price           varchar2(20) not null,
          precision       number(9) not null,
          unit            VARCHAR2(10) not null,
          pulse           number(10),
          con_res_id      NUMBER(9) not null,
          bal_source_type NUMBER(3) not null,
          con_res_name    VARCHAR2(255),
          TIME_SPAN_NAME   VARCHAR2(255),
          TIME_SPAN_SEQ   NUMBER(3)
        )
    - comment on table DC_CONFIG_PP_Usage_Tariff is  'The usage tariff of price plan'
    - comment on column DC_CONFIG_PP_Usage_Tariff.price_plan_id is 'the price plan id ,can be null'
    - comment on column DC_CONFIG_PP_Usage_Tariff.price_plan_name is 'the price plan name'
    - comment on column DC_CONFIG_PP_Usage_Tariff.re_id is 'the re id of usage event'
    - comment on column DC_CONFIG_PP_Usage_Tariff.re_name is 'the event name'
    - comment on column DC_CONFIG_PP_Usage_Tariff.zone_map_name is  'if the price plan is mapping price,need to fill the specific zone map name of the zone map'
    - comment on column DC_CONFIG_PP_Usage_Tariff.zone_name is  'if the price plan is mapping price,need to fill the specific zone name'
    - comment on column DC_CONFIG_PP_Usage_Tariff.featur is  'if the price plan is mapping price,need to fill the specific event feature name'
    - comment on column DC_CONFIG_PP_Usage_Tariff.connect_type is  'when voice tariff,the connect type should be:Y or N or R or T,N means Basic price. R means repeat price. Y Means Charge by times use rank,can be null, T Means use Time Span.defualt value N'
    - comment on column DC_CONFIG_PP_Usage_Tariff.price is  'the tariff of this price plan'
    - comment on column DC_CONFIG_PP_Usage_Tariff.precision is  'the precision of main balance price, input:8 means 8 digit precision,default value 8.If deduct benefit balance, the precision will be 1'
    - comment on column DC_CONFIG_PP_Usage_Tariff.unit is  'the unit of this tariff, can be:occ(occurrence),min(1 minute),mb(megabyte),con(connection),5Mins(5minute),15Sec(15 seconds)'
    - comment on column DC_CONFIG_PP_Usage_Tariff.pulse is  'the minimum of charging step when bal source type is 1, when unit is min,default value 1s, when unit is mb,defualt value 10240 bytes. when unit is con or occ not work, when bal source type is 4 default value not work '
    - comment on column DC_CONFIG_PP_Usage_Tariff.con_res_id is  'the consume id of consume type name'
    - comment on column DC_CONFIG_PP_Usage_Tariff.bal_source_type is  'the balance source type of consume type name,1:Basic Balance;4:Non Currency Balance'
    - comment on column DC_CONFIG_PP_Usage_Tariff.con_res_name is  'the consume type name '
    - comment on column DC_CONFIG_PP_Usage_Tariff.TIME_SPAN_NAME is  'time span name '
    - comment on column DC_CONFIG_PP_Usage_Tariff.TIME_SPAN_SEQ is  'time span seq '


  DC_CONFIG_PP_Usage_Tariff_LOG:
    - |
      create table DC_CONFIG_PP_Usage_Tariff_LOG
      (
        price_plan_id number(10),
        price_plan_name VARCHAR2(512),
        re_id           NUMBER(9) not null,
        re_name         VARCHAR2(200) not null,
        zone_map_name   VARCHAR2(200),
        zone_name       VARCHAR2(200),
        featur          CHAR(30),
        connect_type    CHAR(1),
        price           VARCHAR2(20),
        precision       number(9) not null,
        unit            VARCHAR2(10),
        pulse           number(10),
        con_res_id      NUMBER(9) not null,
        bal_source_type NUMBER(3),
        con_res_name    VARCHAR2(255) not null,
        loginfo         VARCHAR2(200),
        fix_sql         VARCHAR2(1000)
      )
    - comment on table DCinsert into DC_CONFIG_PP_Usage_Tariff_LOG_CONFIG_PP_Usage_Tariff_LOG is  'this table no need to fill ,keep it blank,this table records the error data when inserting data from DC_CONFIG_PP_Usage_Tariff'
    - comment on column DC_CONFIG_PP_Usage_Tariff_LOG.loginfo is 'the error information description'
    - comment on column DC_CONFIG_PP_Usage_Tariff_LOG.fix_sql is  'the fix sql of this error record'


  DC_PROC_PRICE:
    - |
      CREATE OR REPLACE PROCEDURE DC_PROC_PRICE IS
        v_pp_name varchar2(200);
        v_pp_id number(10);
        v_pp_ver_id number(10);
        v_prio number(10);
        v_price_set_id number(10);
        v_re_ps_id number(10);
        v_flag number(2);
        v_re_id number(10);
        v_rate_plan_id number(10);
        v_re_name varchar2(200);
        v_zone_name varchar2(200);
        v_map_id varchar2(200);
        v_price_ver_id number(10);
        v_featur varchar2(40);
        v_featur_id varchar2(60);
        v_featur_id_m varchar2(60);
        v_zone_map_id varchar2(60);
        v_zone_map_id_m varchar2(60);
        v_rate_plan_zone_id number(10);
        v_zone_id number(10);
        v_ref_value_id_con varchar2(60);
        v_con_res_id varchar2(60);
        v_con_res_id_m varchar2(60);
        v_ref_value_id_price varchar2(60);
        v_re_attr varchar2(10);
        v_re_attr_m varchar2(10);
        v_price_value varchar2(60);
        v_price_value_m varchar2(60);
        v_price_id number(20);
        v_bal_source_id number(20);
        v_first_work_node_id number(20);
        v_work_node_id number(20);
        v_work_action_id number(20);
        v_action_price_id number(20);
        v_rum number(12);
        v_min_rum number(12);
        v_rate_plan_name varchar2(100);
        v_mapping_type varchar2(10);
        v_work_condition_id_seq number(10);
        v_rank_up_id number(10);
        v_precision number(10);
        v_highest_prio varchar2(4);
        v_TIME_SPAN_UP_id  number(10);
        v_TIME_SPAN_ID   number(10);
        v_SEQ_ID   number(2);

        begin
        for cur_pp in  (select * from DC_CONFIG_PP_Usage_Tariff order by price_plan_name ) loop
          if cur_pp.price_plan_id is null then
            select cur_pp.price_plan_name into v_pp_name from dual;
            select count(1) into v_flag from price_plan where price_plan_name=v_pp_name;
            if v_flag=1 then
              select price_plan_id into v_pp_id from price_plan where price_plan_name=v_pp_name;
            elsif v_flag=0 then
              select price_plan_id_seq.nextval into v_pp_id from dual;
              select COALESCE(max(PRIORITY) + 1, 1) into v_prio from price_plan;
              INSERT INTO PRICE_PLAN (PRICE_PLAN_ID,PRICE_PLAN_NAME,PRICE_PLAN_CODE,APPLY_LEVEL,PRICE_PLAN_TYPE,PRICE_PLAN_GENRE,PRIORITY,LOCK_FLAG,PRICE_PLAN_CATALOG,SP_ID,STATE,ACTIVE_DATE,ACTIVE_STAFF_ID,INACTIVE_DATE,INACTIVE_STAFF_ID,PRICE_PLAN_EXIT,POLICY_PLAN_FLAG)
              VALUES (v_pp_id,v_pp_name,substr(v_pp_name,0,58),'S','3','A',v_prio,'N',null,null,'A',null,null,null,null,'N','N');
            else
              insert into DC_CONFIG_PP_Usage_Tariff_LOG
              values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PP ID!',null);
              continue;
            end if;
          else
            select cur_pp.price_plan_id into v_pp_id from dual;
            select count(1) into v_flag from price_plan where price_plan_id=v_pp_id;
            if v_flag=1 then
              select price_plan_id into v_pp_id from price_plan where price_plan_id=v_pp_id;
            elsif v_flag=0 then
              select cur_pp.price_plan_name into v_pp_name from dual;
              select COALESCE(max(PRIORITY) + 1, 1) into v_prio from price_plan;
              INSERT INTO PRICE_PLAN (PRICE_PLAN_ID,PRICE_PLAN_NAME,PRICE_PLAN_CODE,APPLY_LEVEL,PRICE_PLAN_TYPE,PRICE_PLAN_GENRE,PRIORITY,LOCK_FLAG,PRICE_PLAN_CATALOG,SP_ID,STATE,ACTIVE_DATE,ACTIVE_STAFF_ID,INACTIVE_DATE,INACTIVE_STAFF_ID,PRICE_PLAN_EXIT,POLICY_PLAN_FLAG)
              VALUES (v_pp_id,v_pp_name,substr(v_pp_name,0,58),'S','3','A',v_prio,'N',null,null,'A',null,null,null,null,'N','N');
            else
              insert into DC_CONFIG_PP_Usage_Tariff_LOG
              values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PP ID!',null);
              continue;
            end if;
          end if;

          select count(1) into v_flag from price_plan_ver where price_plan_id=v_pp_id;
          if v_flag=1 then
            select price_plan_ver_id into v_pp_ver_id from price_plan_ver where price_plan_id=v_pp_id;
          elsif v_flag=0 then
            select price_plan_ver_id_seq.nextval into  v_pp_ver_id from dual;
            INSERT INTO PRICE_PLAN_VER(PRICE_PLAN_VER_ID,PRICE_PLAN_ID,SEQ,SP_ID,EFF_DATE,EXP_DATE,USING_STATE,STATE,CREATED_DATE,CREATED_STAFF_ID,RELEASE_DATE,RELEASE_STAFF_ID,RETIRE_DATE,RETIRE_STAFF_ID,SUBMIT_DATE,SUBMIT_STAFF_ID,APPROVED_DATE,APPROVED_STAFF_ID)
            VALUES(v_pp_ver_id,v_pp_id,1,null,to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'),null,'A','A',to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'),null,null,null,null,null,null,null,null,null);

          else
            insert into DC_CONFIG_PP_Usage_Tariff_LOG
            values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PP VER!',null);
            continue;
          end if;


          select count(1) into v_flag from PRICE_PLAN_MEMBER where price_plan_ver_id=v_pp_ver_id;
          if v_flag=1 then
            select price_set_id into v_price_set_id from PRICE_PLAN_MEMBER where price_plan_ver_id=v_pp_ver_id;
          elsif v_flag=0 then
            select price_set_id_seq.nextval into v_price_set_id from dual;
            INSERT INTO PRICE_SET (PRICE_SET_ID, APPLY_LEVEL, PRICE_SET_PRIORITY_ID, PRIORITY, SP_ID)
            values(v_price_set_id,'S',10000,1,null);
            INSERT INTO PRICE_PLAN_MEMBER (PRICE_PLAN_VER_ID, PRICE_SET_ID, CREATED_DATE, SP_ID)
            values(v_pp_ver_id,v_price_set_id,to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'),null);
          else
            insert into DC_CONFIG_PP_Usage_Tariff_LOG
            values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PP MEMBER!',null);
            continue;
          end if;

          select cur_pp.re_name into v_re_name from dual;
          select cur_pp.re_id into v_re_id from dual;
          select case
          when to_number(cur_pp.price)=0 then 'Y'
          else null
          end into v_highest_prio from dual;
          select count(1) into v_flag from re_price_set where price_set_id=v_price_set_id and re_id=v_re_id;
          if v_flag=1 then
            select re_price_set_id into v_re_ps_id from re_price_set where price_set_id=v_price_set_id and re_id=v_re_id;
          elsif v_flag=0 then
            select re_price_set_id_seq.nextval into v_re_ps_id from dual;
            insert into RE_PRICE_SET (RE_PRICE_SET_ID, RE_ID, PRICE_SET_ID, WORKFLOW_ID, SP_ID , POST_WORKFLOW_ID, PARAM, SCRIPT_TEMPLET_ID, RULE_SCRIPT, SCRIPT_PAGE, RULE_COMMENTS, HIGHEST_PRIORITY)
            values (v_re_ps_id, v_re_id, v_price_set_id, null, null , null, null, null, null, null , null, v_highest_prio);
          else
            insert into DC_CONFIG_PP_Usage_Tariff_LOG
            values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PP EVENT!',null);
            continue;
          end if;

          if cur_pp.zone_name is not null then
            select cur_pp.zone_name into v_zone_name from dual;
          end if;

          select case
          when nvl(cur_pp.connect_type,'N')='Y' then v_re_name||'-Time'
            when nvl(cur_pp.connect_type,'N')='R' then v_re_name||'-Repeated'
              when nvl(cur_pp.connect_type,'N')='N' then v_re_name||'-Basic'
          end into v_rate_plan_name from dual;


          select count(1) into v_flag from rate_plan where re_price_set_id=v_re_ps_id and rate_plan_name = v_rate_plan_name;
          if v_flag=1 then
            select rate_plan_id,mapping_type into v_rate_plan_id,v_mapping_type from rate_plan where re_price_set_id=v_re_ps_id and rate_plan_name = v_rate_plan_name;
            if cur_pp.zone_name is null then
              if v_mapping_type<>'D' then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PP MAPPING TYPE ERROR!should be D!',null);
                continue;
              end if;
            else
              if v_mapping_type<>'1' then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PP MAPPING TYPE ERROR!should be 1!',null);
                continue;
              end if;
            end if;
          elsif v_flag=0 then
            if cur_pp.zone_name is null then
              select rate_plan_id_seq.nextval into v_rate_plan_id from dual;
              select COALESCE(max(PRIORITY) + 1, 1) into v_prio from RATE_PLAN where RE_PRICE_SET_ID = v_re_ps_id;
              insert into RATE_PLAN (RATE_PLAN_ID, RATE_PLAN_NAME, RATE_PLAN_TYPE, RATE_CHARGE_TYPE, RE_PRICE_SET_ID, MAPPING_TYPE, PRIORITY, COMMENTS, CREATED_DATE, STATE, STATE_DATE, MAPPING_EXIT, SP_ID)
              values (v_rate_plan_id, v_rate_plan_name, 1, 'M', v_re_ps_id,'D',v_prio, null, to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'),'A', to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), null, null);
            else
              select rate_plan_id_seq.nextval into v_rate_plan_id from dual;
              select COALESCE(max(PRIORITY) + 1, 1) into v_prio from RATE_PLAN where RE_PRICE_SET_ID = v_re_ps_id;
              insert into RATE_PLAN (RATE_PLAN_ID, RATE_PLAN_NAME, RATE_PLAN_TYPE, RATE_CHARGE_TYPE, RE_PRICE_SET_ID, MAPPING_TYPE, PRIORITY, COMMENTS, CREATED_DATE, STATE, STATE_DATE, MAPPING_EXIT, SP_ID)
              values (v_rate_plan_id, v_rate_plan_name, 1, 'M', v_re_ps_id,'1',v_prio, null, to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'),'A', to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), 'Y', null);
            end if;
          else
            insert into DC_CONFIG_PP_Usage_Tariff_LOG
            values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PP RATEPLAN!',null);
            continue;
          end if;

          if cur_pp.zone_name is null then
            select count(1) into v_flag from mapping where rate_plan_id=v_rate_plan_id;
            if v_flag=1 then
              select mapping_id into v_map_id from mapping where rate_plan_id=v_rate_plan_id;
            elsif v_flag=0 then
              select mapping_id_seq.nextval into v_map_id from dual;
              INSERT INTO MAPPING (MAPPING_ID,MAPPING_NAME,RATE_PLAN_ID,PRIORITY,MAPPING_DEFAULT,SP_ID)
              VALUES(v_map_id, v_re_name, v_rate_plan_id, 1, null, null);
            else
              insert into DC_CONFIG_PP_Usage_Tariff_LOG
              values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PP MAPPING!',null);
              continue;
            end if;

          else
            select count(1) into v_flag from mapping where rate_plan_id=v_rate_plan_id and mapping_name=v_zone_name;
            if v_flag=1 then
              select mapping_id into v_map_id from mapping where rate_plan_id=v_rate_plan_id and mapping_name=v_zone_name;
            elsif v_flag=0 then
              select COALESCE(max(PRIORITY) + 1, 1) into v_prio from mapping where RATE_PLAN_ID=v_rate_plan_id;
              select mapping_id_seq.nextval into v_map_id from dual;
              insert into mapping (MAPPING_ID, MAPPING_NAME, RATE_PLAN_ID, PRIORITY, MAPPING_DEFAULT,SP_ID) values (v_map_id,v_zone_name, v_rate_plan_id,v_prio , null , null);
            else
              insert into DC_CONFIG_PP_Usage_Tariff_LOG
              values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PP MAPPING!',null);
              continue;
            end if;
          end if;

          select count(1) into v_flag from price_ver where mapping_id=v_map_id;
          if v_flag=1 then
            select price_ver_id into v_price_ver_id from price_ver where mapping_id=v_map_id;
          elsif v_flag=0 then
            SELECT PRICE_VER_ID_SEQ.NEXTVAL into v_price_ver_id  FROM DUAL;
            insert into PRICE_VER (PRICE_VER_ID, MAPPING_ID, EFF_DATE, EXP_DATE, SP_ID) values (v_price_ver_id, v_map_id, to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), null, null);
          else
            insert into DC_CONFIG_PP_Usage_Tariff_LOG
            values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PRICE VER!',null);
            continue;
          end if;


          if cur_pp.zone_name is not null then
            select count(1) into v_flag from rate_plan_zone where rate_plan_id=v_rate_plan_id;
            select cur_pp.featur into v_featur  from dual;
            select zone_map_id into v_zone_map_id from zone_map where zone_map_name=cur_pp.zone_map_name;
            select re_attr into v_featur_id from re_attr where re_attr_name=v_featur;
            if v_flag=1 then
              select mapping_src_value,mapping_des_value into v_featur_id_m,v_zone_map_id_m from rate_plan_zone where rate_plan_id=v_rate_plan_id;
              if v_featur_id<>v_featur_id_m then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'mapping_src_value error!',
                  'update rate_plan_zone set mapping_src_value='||v_featur_id||' where rate_plan_id='||v_rate_plan_id||';');
                continue;
              end if;

              if v_zone_map_id<>v_zone_map_id_m then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'maping_des_value eror!',
                  'update rate_plan_zone set maping_des_value='||v_zone_map_id||' where rate_plan_id='||v_rate_plan_id||';');
                continue;
              end if;

              select rate_plan_zone_id into v_rate_plan_zone_id from rate_plan_zone where rate_plan_id=v_rate_plan_id;

            elsif v_flag=0 then
              SELECT RATE_PLAN_ZONE_ID_SEQ.NEXTVAL into v_rate_plan_zone_id FROM DUAL;
              insert into RATE_PLAN_ZONE (RATE_PLAN_ZONE_ID, RATE_PLAN_ID, PRIORITY, SP_ID, MAPPING_SRC_TYPE , MAPPING_SRC_VALUE, MAPPING_DES_TYPE, MAPPING_DES_VALUE, LABEL_SHOW)
              values(v_rate_plan_zone_id, v_rate_plan_id, 1, null, '1' , v_featur_id, '0', v_zone_map_id, null);
            else
              insert into DC_CONFIG_PP_Usage_Tariff_LOG
              values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PRICE RATE_PLAN_ZONE!',null);
              continue;
            end if;
          end if;

          if cur_pp.zone_name is not null then
            select  zone_id into v_zone_id from zone where zone_name=v_zone_name and zone_map_id=v_zone_map_id;
            select count(1) into v_flag from mapping_unit where rate_plan_zone_id=v_rate_plan_zone_id and mapping_value=v_zone_id;
            if v_flag=0 then
              insert into MAPPING_UNIT (MAPPING_ID, RATE_PLAN_ZONE_ID, SP_ID, MAPPING_MATCH_TYPE, MAPPING_TYPE , MAPPING_VALUE)
              values(v_map_id,v_rate_plan_zone_id,null,'A','0',v_zone_id);
            elsif v_flag>1 then
              insert into DC_CONFIG_PP_Usage_Tariff_LOG
              values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE mapping_unit!',null);
              continue;
            end if;
          end if;

          select cur_pp.con_res_id into v_con_res_id from dual;
          if cur_pp.bal_source_type=1 then
            select case
            when cur_pp.unit='occ' then 10002
            when cur_pp.unit in ('min','5Mins','3Mins','4Mins','20Mins','30Sec','20Sec','15Sec' ) then 10000
            when cur_pp.unit='mb' then 10003
            when cur_pp.unit='con' then 10000
            end into v_re_attr from dual;
            select case
            when cur_pp.unit='occ' then 1
            when cur_pp.unit='min' then 60
            when cur_pp.unit='5Mins' then 300
            when cur_pp.unit='3Mins' then 180
            when cur_pp.unit='4Mins' then 240
            when cur_pp.unit='20Mins' then 1200
            when cur_pp.unit='30Sec' then 30
            when cur_pp.unit='20Sec' then 20
            when cur_pp.unit='15Sec' then 15
            when cur_pp.unit='mb' then 1048576
            when cur_pp.unit='con' then 60
            end into v_rum from dual;
            select case
            when cur_pp.unit='occ' then null
            when cur_pp.unit in ('min','5Mins','3Mins','4Mins','20Mins','30Sec','20Sec','15Sec') then nvl(cur_pp.pulse,1)
            when cur_pp.unit='mb' then nvl(cur_pp.pulse,10240)
            when cur_pp.unit='con' then null
            end into v_min_rum from dual;
          else
            select case
            when cur_pp.unit='occ' then 10002
            when cur_pp.unit='min' then 10000
            when cur_pp.unit='mb' then 10003
            end into v_re_attr from dual;
            select case
            when cur_pp.unit='occ' then 1
            when cur_pp.unit='min' then 1
            when cur_pp.unit='mb' then 1
            end into v_rum from dual;
            select case
            when cur_pp.unit='occ' then null
            when cur_pp.unit='min' then null
            when cur_pp.unit='mb' then null
            end into v_min_rum from dual;
          end if;
          if v_min_rum>=v_rum then
            select null into v_min_rum from dual;
          end if;
          select cur_pp.bal_source_type into v_bal_source_id from dual;
          select case
          when v_bal_source_id= 1 then nvl(cur_pp.precision,8)
          when v_bal_source_id= 4 then 0
          end into v_precision from dual;
          select to_char(round(cur_pp.price,v_precision)) into v_price_value from dual;
          if v_price_value like '.%%' then
            select replace(v_price_value,'.','0.') into v_price_value from dual;
          end if;
          if nvl(cur_pp.connect_type,'N')='N' then
            select count(1) into v_flag from price a,PRICE_WORK_NODE b,WORK_NODE c,WORK_ACTION d,ACTION_PRICE e,ref_value f,con_res g
            where a.price_ver_id=v_price_ver_id
            and a.price_id=b.price_id
            and b.work_node_id=c.work_node_id
            and c.is_first_node='Y'
            and c.work_node_id=d.work_node_id
            and d.work_action_id=e.work_action_id
            and e.con_res_id=f.ref_value_id
            and f.ref_value_type='9'
            and g.con_res_id=f.value_string
            and g.bal_source_type=v_bal_source_id;
            if v_flag=1 then
              select a.price_id,f.ref_value_id,f.value_string into v_price_id,v_ref_value_id_con,v_con_res_id_m from price a,PRICE_WORK_NODE b,WORK_NODE c,WORK_ACTION d,ACTION_PRICE e,ref_value f,con_res g
              where a.price_ver_id=v_price_ver_id
              and a.price_id=b.price_id
              and b.work_node_id=c.work_node_id
              and c.is_first_node='Y'
              and c.work_node_id=d.work_node_id
              and d.work_action_id=e.work_action_id
              and e.con_res_id=f.ref_value_id
              and f.ref_value_type='9'
              and g.con_res_id=f.value_string
              and g.bal_source_type=v_bal_source_id;

              select a.ref_value_id,e.re_attr,f.value_string into v_ref_value_id_price,v_re_attr_m,v_price_value_m from price a,PRICE_WORK_NODE b,WORK_NODE c,WORK_ACTION d,ACTION_PRICE e,ref_value f
              where a.price_id=v_price_id
              and a.price_id=b.price_id
              and b.work_node_id=c.work_node_id
              and c.is_first_node='Y'
              and c.work_node_id=d.work_node_id
              and d.work_action_id=e.work_action_id
              and a.ref_value_id=f.ref_value_id
              and f.ref_value_type='1';
              if v_con_res_id_m<>v_con_res_id then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'the main balance consume id is error!',
                'update ref_value set value_string='||v_con_res_id||' where ref_value_id='||v_ref_value_id_con||';');
                continue;
              end if;
              if v_re_attr<>v_re_attr_m then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'the main balance consume type is error!',
                'update ACTION_PRICE set re_attr='||v_re_attr||' where ref_value_id='||v_ref_value_id_price||'; update price set re_attr='||v_re_attr||' where price_id='||v_price_id||';');
                continue;
              end if;
              if v_price_value_m<>v_price_value then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'the main balance consume money is error!',
                'update ref_value set value_string='''||v_price_value||''' where ref_value_id='||v_ref_value_id_price||';');
                continue;
              end if;
            elsif v_flag=0 then
              SELECT PRICE_ID_SEQ.NEXTVAL INTO v_price_id FROM DUAL;
              select COALESCE(max(PRIORITY) + 1, 1) into v_prio from PRICE where PRICE_VER_ID =v_price_ver_id;
              SELECT WORK_NODE_ID_SEQ.NEXTVAL into v_work_node_id FROM DUAL;
              insert into WORK_NODE (WORK_NODE_ID, WORK_NODE_NAME, IS_FIRST_NODE, FIRST_WORK_NODE_ID, WORK_NODE_TYPE , WORK_NEXT_NODE_ID, POSITION, COMMENTS, SP_ID)
              values (v_work_node_id,'price', 'Y', v_work_node_id, 'A' , null, '{"position":"[130,23]","type":"price"}', null, null);
              SELECT WORK_ACTION_ID_SEQ.NEXTVAL into  v_work_action_id from DUAL;
              insert into WORK_ACTION (WORK_ACTION_ID, WORK_ACTION_TYPE, EXEC_SEQ, WORK_NODE_ID, WORK_ACTION_NAME , POSITION, COMMENTS, SP_ID)
              values (v_work_action_id, 'price', 1, v_work_node_id, 'price action' , null, null, null);
              SELECT REF_VALUE_ID_SEQ.NEXTVAL into v_ref_value_id_price FROM DUAL;
              insert into REF_VALUE (REF_VALUE_ID, REF_VALUE_TYPE, VALUE_STRING, COL_ID, RE_ATTR , BUNDLE_MEMBER_ALISA, FUNCTION_PARAM1, FUNCTION_PARAM2, COMMENTS, STAFF_ID , CREATED_DATE, STATE, STATE_DATE, PRICE_ID, RATE_PLAN_ID , PRICE_SET_ID, SP_ID)
              values (v_ref_value_id_price, '1', v_price_value, null, null , null, null, null, null, null , to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), 'A', to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), null, v_rate_plan_id, v_price_set_id, null);
              SELECT REF_VALUE_ID_SEQ.NEXTVAL into v_ref_value_id_con FROM DUAL;
              insert into REF_VALUE (REF_VALUE_ID, REF_VALUE_TYPE, VALUE_STRING, COL_ID, RE_ATTR , BUNDLE_MEMBER_ALISA, FUNCTION_PARAM1, FUNCTION_PARAM2, COMMENTS, STAFF_ID , CREATED_DATE, STATE, STATE_DATE, PRICE_ID, RATE_PLAN_ID , PRICE_SET_ID, SP_ID)
              values (v_ref_value_id_con, '9', v_con_res_id, null, null , null, null, null, null, null , to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), 'A', to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), null, v_rate_plan_id , v_price_set_id, null);
              SELECT ACTION_PRICE_ID_SEQ.NEXTVAL into v_action_price_id FROM DUAL;
              insert into ACTION_PRICE (ACTION_PRICE_ID, WORK_ACTION_ID, RUM, OVERLAP_FLAG, COMMENTS , RE_ATTR, CON_RES_ID, REF_VALUE_ID, SP_ID, MIN_RUM)
              values (v_action_price_id, v_work_action_id, v_rum, null, null , v_re_attr, v_ref_value_id_con, v_ref_value_id_price, null, v_min_rum);
              insert into PRICE (PRICE_ID, PRICE_NAME, REF_VALUE_ID, RUM, RE_ATTR , PRICE_TYPE, CALC_TYPE, PRICE_VER_ID, CON_RES_ID, CURRENCY_TYPE_ID , COMMENTS, PRIORITY, SRC_PRICE_ID, SP_ID, CONFIGURE_TYPE , MIN_RUM)
              values (v_price_id, v_re_name||' Price', v_ref_value_id_price, v_rum, v_re_attr , null, null, v_price_ver_id, null, null , null, v_prio, null, null, '1' , v_min_rum);
              select COALESCE(max(SEQ) + 1, 1) into v_prio from PRICE_WORK_NODE where PRICE_ID = v_price_id;
              insert into PRICE_WORK_NODE (PRICE_ID, SEQ, PRICE_NODE_NAME, WORK_NODE_ID, COMMENTS , SP_ID) values (v_price_id, v_prio, 'start', v_work_node_id, null , null);
              update REF_VALUE set STATE_DATE = to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), PRICE_ID = v_price_id, RATE_PLAN_ID = v_rate_plan_id, PRICE_SET_ID = v_price_set_id where REF_VALUE_ID = v_ref_value_id_price;
              update REF_VALUE set STATE_DATE = to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), PRICE_ID = v_price_id, RATE_PLAN_ID = v_rate_plan_id, PRICE_SET_ID = v_price_set_id where REF_VALUE_ID = v_ref_value_id_con;
            else
              insert into DC_CONFIG_PP_Usage_Tariff_LOG
              values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PRICE',null);
              continue;
            end if;
          end if;

          if nvl(cur_pp.connect_type,'N')='R' then
            select count(1) into v_flag from price a,PRICE_WORK_NODE b,WORK_NODE c,WORK_ACTION d,ACTION_PRICE e,ref_value f,con_res g
            where a.price_ver_id=v_price_ver_id
            and a.price_id=b.price_id
            and b.work_node_id=c.work_node_id
            and c.is_first_node='Y'
            and c.work_node_id=d.work_node_id
            and d.work_action_id=e.work_action_id
            and e.con_res_id=f.ref_value_id
            and f.ref_value_type='9'
            and g.con_res_id=f.value_string
            and g.bal_source_type=v_bal_source_id;
            if v_flag=1 then
              select a.price_id,f.ref_value_id,f.value_string into v_price_id,v_ref_value_id_con,v_con_res_id_m from price a,PRICE_WORK_NODE b,WORK_NODE c,WORK_ACTION d,ACTION_PRICE e,ref_value f,con_res g
              where a.price_ver_id=v_price_ver_id
              and a.price_id=b.price_id
              and b.work_node_id=c.work_node_id
              and c.is_first_node='Y'
              and c.work_node_id=d.work_node_id
              and d.work_action_id=e.work_action_id
              and e.con_res_id=f.ref_value_id
              and f.ref_value_type='9'
              and g.con_res_id=f.value_string
              and g.bal_source_type=v_bal_source_id;

              select a.ref_value_id,e.re_attr,f.value_string into v_ref_value_id_price,v_re_attr_m,v_price_value_m from price a,PRICE_WORK_NODE b,WORK_NODE c,WORK_ACTION d,ACTION_PRICE e,ref_value f
              where a.price_id=v_price_id
              and a.price_id=b.price_id
              and b.work_node_id=c.work_node_id
              and c.is_first_node='Y'
              and c.work_node_id=d.work_node_id
              and d.work_action_id=e.work_action_id
              and a.ref_value_id=f.ref_value_id
              and f.ref_value_type='1';
              if v_con_res_id_m<>v_con_res_id then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'the main balance consume id is error!',
                'update ref_value set value_string='||v_con_res_id||' where ref_value_id='||v_ref_value_id_con||';');
                continue;
              end if;
              if v_re_attr<>v_re_attr_m then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'the main balance consume type is error!',
                'update ACTION_PRICE set re_attr='||v_re_attr||' where ref_value_id='||v_ref_value_id_price||'; update price set re_attr='||v_re_attr||' where price_id='||v_price_id||';');
                continue;
              end if;
              if v_price_value_m<>v_price_value then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'the main balance consume money is error!',
                'update ref_value set value_string='''||v_price_value||''' where ref_value_id='||v_ref_value_id_price||';');
                continue;
              end if;
            elsif v_flag=0 then
              SELECT PRICE_ID_SEQ.NEXTVAL INTO v_price_id FROM DUAL;
              select COALESCE(max(PRIORITY) + 1, 1) into v_prio from PRICE where PRICE_VER_ID =v_price_ver_id;
              SELECT WORK_NODE_ID_SEQ.NEXTVAL into v_work_node_id FROM DUAL;
              insert into WORK_NODE (WORK_NODE_ID, WORK_NODE_NAME, IS_FIRST_NODE, FIRST_WORK_NODE_ID, WORK_NODE_TYPE , WORK_NEXT_NODE_ID, POSITION, COMMENTS, SP_ID)
              values (v_work_node_id,'Repeat', 'Y', v_work_node_id, 'A' , null, '{"position":"[130,23]","type":"price"}', null, null);
              SELECT WORK_ACTION_ID_SEQ.NEXTVAL into  v_work_action_id from DUAL;
              insert into WORK_ACTION (WORK_ACTION_ID, WORK_ACTION_TYPE, EXEC_SEQ, WORK_NODE_ID, WORK_ACTION_NAME , POSITION, COMMENTS, SP_ID)
              values (v_work_action_id, 'price', 1, v_work_node_id, 'price action' , null, null, null);
              SELECT REF_VALUE_ID_SEQ.NEXTVAL into v_ref_value_id_price FROM DUAL;
              insert into REF_VALUE (REF_VALUE_ID, REF_VALUE_TYPE, VALUE_STRING, COL_ID, RE_ATTR , BUNDLE_MEMBER_ALISA, FUNCTION_PARAM1, FUNCTION_PARAM2, COMMENTS, STAFF_ID , CREATED_DATE, STATE, STATE_DATE, PRICE_ID, RATE_PLAN_ID , PRICE_SET_ID, SP_ID)
              values (v_ref_value_id_price, '1', v_price_value, null, null , null, null, null, null, null , to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), 'A', to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), null, v_rate_plan_id, v_price_set_id, null);
              SELECT REF_VALUE_ID_SEQ.NEXTVAL into v_ref_value_id_con FROM DUAL;
              insert into REF_VALUE (REF_VALUE_ID, REF_VALUE_TYPE, VALUE_STRING, COL_ID, RE_ATTR , BUNDLE_MEMBER_ALISA, FUNCTION_PARAM1, FUNCTION_PARAM2, COMMENTS, STAFF_ID , CREATED_DATE, STATE, STATE_DATE, PRICE_ID, RATE_PLAN_ID , PRICE_SET_ID, SP_ID)
              values (v_ref_value_id_con, '9', v_con_res_id, null, null , null, null, null, null, null , to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), 'A', to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), null, v_rate_plan_id , v_price_set_id, null);
              SELECT ACTION_PRICE_ID_SEQ.NEXTVAL into v_action_price_id FROM DUAL;
              insert into ACTION_PRICE (ACTION_PRICE_ID, WORK_ACTION_ID, RUM, OVERLAP_FLAG, COMMENTS , RE_ATTR, CON_RES_ID, REF_VALUE_ID, SP_ID, MIN_RUM)
              values (v_action_price_id, v_work_action_id, v_rum, null, null , v_re_attr, v_ref_value_id_con, v_ref_value_id_price, null, v_min_rum);
              insert into PRICE (PRICE_ID, PRICE_NAME, REF_VALUE_ID, RUM, RE_ATTR , PRICE_TYPE, CALC_TYPE, PRICE_VER_ID, CON_RES_ID, CURRENCY_TYPE_ID , COMMENTS, PRIORITY, SRC_PRICE_ID, SP_ID, CONFIGURE_TYPE , MIN_RUM)
              values (v_price_id, v_re_name||' Price', v_ref_value_id_price, v_rum, v_re_attr , null, null, v_price_ver_id, null, null , null, v_prio, null, null, '1' , v_min_rum);
              select COALESCE(max(SEQ) + 1, 1) into v_prio from PRICE_WORK_NODE where PRICE_ID = v_price_id;
              insert into PRICE_WORK_NODE (PRICE_ID, SEQ, PRICE_NODE_NAME, WORK_NODE_ID, COMMENTS , SP_ID) values (v_price_id, v_prio, 'start', v_work_node_id, null , null);
              update REF_VALUE set STATE_DATE = to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), PRICE_ID = v_price_id, RATE_PLAN_ID = v_rate_plan_id, PRICE_SET_ID = v_price_set_id where REF_VALUE_ID = v_ref_value_id_price;
              update REF_VALUE set STATE_DATE = to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), PRICE_ID = v_price_id, RATE_PLAN_ID = v_rate_plan_id, PRICE_SET_ID = v_price_set_id where REF_VALUE_ID = v_ref_value_id_con;
            else
              insert into DC_CONFIG_PP_Usage_Tariff_LOG
              values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'DUPLICATE PRICE',null);
              continue;
            end if;
          end if;

          if nvl(cur_pp.connect_type,'N')='Y' then
            select count(1) into v_flag from price a,PRICE_WORK_NODE b,WORK_NODE c,WORK_ACTION d,ACTION_PRICE e,ref_value f,
              con_res g,work_condition h,COND_RANK i, work_node j,ref_value k
              where a.price_ver_id=v_price_ver_id
              and a.price_id=b.price_id
              and b.work_node_id=c.work_node_id
              and c.is_first_node='Y'
              and c.work_node_id=h.work_node_id
              and h.work_condition_id=i.work_condition_id
              and h.work_out_node_id=j.work_node_id
              and j.first_work_node_id=c.work_node_id
              and d.work_node_id=j.work_node_id
              and d.work_action_id=e.work_action_id
              and e.con_res_id=f.ref_value_id
              and e.ref_value_id=k.ref_value_id
              and f.ref_value_type='9'
              and k.ref_value_type='1'
              and g.con_res_id=f.value_string
              and g.bal_source_type=v_bal_source_id;

              if v_flag=2 then

                  select f.ref_value_id,f.value_string, k.ref_value_id,k.value_string,d.work_action_id into v_ref_value_id_con,v_con_res_id_m,v_ref_value_id_price,v_price_value_m,v_work_action_id
                from price a,PRICE_WORK_NODE b,WORK_NODE c,WORK_ACTION d,ACTION_PRICE e,ref_value f,
                con_res g,work_condition h,COND_RANK i, work_node j,ref_value k
                where a.price_ver_id=v_price_ver_id
                and a.price_id=b.price_id
                and b.work_node_id=c.work_node_id
                and c.is_first_node='Y'
                and c.work_node_id=h.work_node_id
                and h.work_condition_id=i.work_condition_id
                and h.work_out_node_id=j.work_node_id
                and j.first_work_node_id=c.work_node_id
                and d.work_node_id=j.work_node_id
                and d.work_action_id=e.work_action_id
                and e.con_res_id=f.ref_value_id
                and e.ref_value_id=k.ref_value_id
                and f.ref_value_type='9'
                and k.ref_value_type='1'
                and g.con_res_id=f.value_string
                and i.offset=0
                and g.bal_source_type=v_bal_source_id;

                if v_con_res_id_m<>v_con_res_id then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'the main balance consume id is error!',
                'update ref_value set value_string='||v_con_res_id||' where ref_value_id='||v_ref_value_id_con||';');
                continue;
              end if;
              if v_price_value_m<>v_price_value then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'the main balance consume money is error!',
                'update ref_value set value_string='''||v_price_value||''' where ref_value_id='||v_ref_value_id_price||';'||CHR(10)
                ||'update WORK_ACTION set WORK_ACTION_NAME='''||v_price_value||'/60(Second)Duration'''||' where work_action_id='||v_work_action_id||';');
                continue;
              end if;

                  select f.ref_value_id,f.value_string, k.ref_value_id,k.value_string,d.work_action_id into v_ref_value_id_con,v_con_res_id_m,v_ref_value_id_price,v_price_value_m,v_work_action_id
                from price a,PRICE_WORK_NODE b,WORK_NODE c,WORK_ACTION d,ACTION_PRICE e,ref_value f,
                con_res g,work_condition h,COND_RANK i, work_node j,ref_value k
                where a.price_ver_id=v_price_ver_id
                and a.price_id=b.price_id
                and b.work_node_id=c.work_node_id
                and c.is_first_node='Y'
                and c.work_node_id=h.work_node_id
                and h.work_condition_id=i.work_condition_id
                and h.work_out_node_id=j.work_node_id
                and j.first_work_node_id=c.work_node_id
                and d.work_node_id=j.work_node_id
                and d.work_action_id=e.work_action_id
                and e.con_res_id=f.ref_value_id
                and e.ref_value_id=k.ref_value_id
                and f.ref_value_type='9'
                and k.ref_value_type='1'
                and g.con_res_id=f.value_string
                and i.offset=60
                and g.bal_source_type=v_bal_source_id;

                if v_con_res_id_m<>v_con_res_id then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'the main balance consume id is error!',
                'update ref_value set value_string='||v_con_res_id||' where ref_value_id='||v_ref_value_id_con||';');
                continue;
              end if;
              if v_price_value_m<>0 then
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
                values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'the main balance consume money is error!',
                'update ref_value set value_string=0 where ref_value_id='||v_ref_value_id_price||';'||CHR(10)
                ||'update WORK_ACTION set WORK_ACTION_NAME='''||'0/60(Second)Duration'''||' where work_action_id='||v_work_action_id||';');
                continue;
              end if;

              elsif v_flag=0 then
                SELECT PRICE_ID_SEQ.NEXTVAL INTO v_price_id FROM DUAL;

              select COALESCE(max(PRIORITY) + 1, 1) into v_prio from PRICE where PRICE_VER_ID =v_price_ver_id;
              SELECT WORK_NODE_ID_SEQ.NEXTVAL into v_first_work_node_id FROM DUAL;
              insert into WORK_NODE (WORK_NODE_ID, WORK_NODE_NAME, IS_FIRST_NODE, FIRST_WORK_NODE_ID, WORK_NODE_TYPE , WORK_NEXT_NODE_ID, POSITION, COMMENTS, SP_ID)
              values (v_first_work_node_id,'rank', 'Y', v_first_work_node_id, 'C' , null, '{"position":"[130,23]","type":"price"}', null, null);

              SELECT WORK_NODE_ID_SEQ.NEXTVAL into v_work_node_id FROM DUAL;
                insert into work_node (WORK_NODE_ID, WORK_NODE_NAME, IS_FIRST_NODE, FIRST_WORK_NODE_ID, WORK_NODE_TYPE,
                WORK_NEXT_NODE_ID, POSITION, COMMENTS, SP_ID)
                values(v_work_node_id,'rank','N',v_first_work_node_id,'A',NULL,'{"position":[480,29],"type":"price"}',NULL,NULL);

                select work_condition_id_seq.nextval into  v_work_condition_id_seq from dual;
              insert into WORK_CONDITION (WORK_CONDITION_ID, WORK_CONDITION_TYPE, EXEC_SEQ, WORK_NODE_ID, WORK_CONDITION_NAME, WORK_OUT_NODE_ID, POSITION, COMMENTS, SP_ID)
                values(v_work_condition_id_seq,'rank','1',v_first_work_node_id,'0~60',v_work_node_id,NULL,NULL,NULL);


                select rank_up_id_seq.nextval into v_rank_up_id from dual;
                insert into COND_RANK (RANK_UP_ID, SEQ, WORK_CONDITION_ID, OFFSET, DURATION, INTERVALS, LOOPTIME, OFFSET_TYPE, COMMENTS, SP_ID, SETUP_FEE_FLAG)
              values(v_rank_up_id,'1',v_work_condition_id_seq,'0','60',NULL,NULL,NULL,'',NULL,'Y');

              SELECT WORK_ACTION_ID_SEQ.NEXTVAL into  v_work_action_id from DUAL;
                insert into WORK_ACTION (WORK_ACTION_ID, WORK_ACTION_TYPE, EXEC_SEQ, WORK_NODE_ID, WORK_ACTION_NAME, POSITION, COMMENTS, SP_ID)
                values(v_work_action_id,'price','1',v_work_node_id,v_price_value||'/60(Second)Duration',NULL,NULL,NULL);


              SELECT REF_VALUE_ID_SEQ.NEXTVAL into v_ref_value_id_price FROM DUAL;
                insert into REF_VALUE (REF_VALUE_ID, REF_VALUE_TYPE, VALUE_STRING, COL_ID, RE_ATTR , BUNDLE_MEMBER_ALISA, FUNCTION_PARAM1, FUNCTION_PARAM2, COMMENTS, STAFF_ID , CREATED_DATE, STATE, STATE_DATE, PRICE_ID, RATE_PLAN_ID , PRICE_SET_ID, SP_ID)
                values (v_ref_value_id_price, '1', v_price_value, null, null , null, null, null, null, null , to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), 'A', to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), v_price_id, v_rate_plan_id, v_price_set_id, null);

                SELECT REF_VALUE_ID_SEQ.NEXTVAL into v_ref_value_id_con FROM DUAL;
                insert into REF_VALUE (REF_VALUE_ID, REF_VALUE_TYPE, VALUE_STRING, COL_ID, RE_ATTR , BUNDLE_MEMBER_ALISA, FUNCTION_PARAM1, FUNCTION_PARAM2, COMMENTS, STAFF_ID , CREATED_DATE, STATE, STATE_DATE, PRICE_ID, RATE_PLAN_ID , PRICE_SET_ID, SP_ID)
                values (v_ref_value_id_con, '9', v_con_res_id, null, null , null, null, null, null, null , to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), 'A', to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), v_price_id, v_rate_plan_id , v_price_set_id, null);

                SELECT ACTION_PRICE_ID_SEQ.NEXTVAL into v_action_price_id FROM DUAL;
                insert into ACTION_PRICE (ACTION_PRICE_ID, WORK_ACTION_ID, RUM, OVERLAP_FLAG, COMMENTS , RE_ATTR, CON_RES_ID, REF_VALUE_ID, SP_ID, MIN_RUM)
                values (v_action_price_id, v_work_action_id, v_rum, 'N', null , v_re_attr, v_ref_value_id_con, v_ref_value_id_price, null, null);


                SELECT WORK_NODE_ID_SEQ.NEXTVAL into v_work_node_id FROM DUAL;
              insert into work_node (WORK_NODE_ID, WORK_NODE_NAME, IS_FIRST_NODE, FIRST_WORK_NODE_ID, WORK_NODE_TYPE,
              WORK_NEXT_NODE_ID, POSITION, COMMENTS, SP_ID)
              values(v_work_node_id,'rank','N',v_first_work_node_id,'A',NULL,'{"position":[477,128],"type":"price"}',NULL,NULL);

              select work_condition_id_seq.nextval into  v_work_condition_id_seq from dual;
              insert into WORK_CONDITION (WORK_CONDITION_ID, WORK_CONDITION_TYPE, EXEC_SEQ, WORK_NODE_ID, WORK_CONDITION_NAME, WORK_OUT_NODE_ID, POSITION, COMMENTS, SP_ID)
              values(v_work_condition_id_seq,'rank','2',v_first_work_node_id,'60~99999999',v_work_node_id,NULL,NULL,NULL);

              select rank_up_id_seq.nextval into v_rank_up_id from dual;
              insert into COND_RANK (RANK_UP_ID, SEQ, WORK_CONDITION_ID, OFFSET, DURATION, INTERVALS, LOOPTIME, OFFSET_TYPE, COMMENTS, SP_ID, SETUP_FEE_FLAG)
              values(v_rank_up_id,'1',v_work_condition_id_seq,'60','99999939',NULL,NULL,NULL,'',NULL,'Y');

              SELECT WORK_ACTION_ID_SEQ.NEXTVAL into  v_work_action_id from DUAL;
              insert into WORK_ACTION (WORK_ACTION_ID, WORK_ACTION_TYPE, EXEC_SEQ, WORK_NODE_ID, WORK_ACTION_NAME, POSITION, COMMENTS, SP_ID)
              values(v_work_action_id,'price','1',v_work_node_id,'0/60(Second)Duration',NULL,NULL,NULL);

              SELECT REF_VALUE_ID_SEQ.NEXTVAL into v_ref_value_id_price FROM DUAL;
              insert into REF_VALUE (REF_VALUE_ID, REF_VALUE_TYPE, VALUE_STRING, COL_ID, RE_ATTR , BUNDLE_MEMBER_ALISA, FUNCTION_PARAM1, FUNCTION_PARAM2, COMMENTS, STAFF_ID , CREATED_DATE, STATE, STATE_DATE, PRICE_ID, RATE_PLAN_ID , PRICE_SET_ID, SP_ID)
              values (v_ref_value_id_price, '1', '0', null, null , null, null, null, null, null , to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), 'A', to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), v_price_id, v_rate_plan_id, v_price_set_id, null);

              SELECT REF_VALUE_ID_SEQ.NEXTVAL into v_ref_value_id_con FROM DUAL;
              insert into REF_VALUE (REF_VALUE_ID, REF_VALUE_TYPE, VALUE_STRING, COL_ID, RE_ATTR , BUNDLE_MEMBER_ALISA, FUNCTION_PARAM1, FUNCTION_PARAM2, COMMENTS, STAFF_ID , CREATED_DATE, STATE, STATE_DATE, PRICE_ID, RATE_PLAN_ID , PRICE_SET_ID, SP_ID)
              values (v_ref_value_id_con, '9', v_con_res_id, null, null , null, null, null, null, null , to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), 'A', to_date('1990-01-01 00:00:00','yyyy-mm-dd hh24:mi:ss'), v_price_id, v_rate_plan_id , v_price_set_id, null);

              SELECT ACTION_PRICE_ID_SEQ.NEXTVAL into v_action_price_id FROM DUAL;
              insert into ACTION_PRICE (ACTION_PRICE_ID, WORK_ACTION_ID, RUM, OVERLAP_FLAG, COMMENTS , RE_ATTR, CON_RES_ID, REF_VALUE_ID, SP_ID, MIN_RUM)
              values (v_action_price_id, v_work_action_id, v_rum, 'N', null , v_re_attr, v_ref_value_id_con, v_ref_value_id_price, null, null);

              insert into PRICE (PRICE_ID, PRICE_NAME, REF_VALUE_ID, RUM, RE_ATTR , PRICE_TYPE, CALC_TYPE, PRICE_VER_ID, CON_RES_ID, CURRENCY_TYPE_ID , COMMENTS, PRIORITY, SRC_PRICE_ID, SP_ID, CONFIGURE_TYPE , MIN_RUM)
              values (v_price_id, v_re_name||' Price', null, -1, v_re_attr , null, null, v_price_ver_id, null, null , null, v_prio, null, null, '2' , null);
              select COALESCE(max(SEQ) + 1, 1) into v_prio from PRICE_WORK_NODE where PRICE_ID = v_price_id;
              insert into PRICE_WORK_NODE (PRICE_ID, SEQ, PRICE_NODE_NAME, WORK_NODE_ID, COMMENTS , SP_ID) values (v_price_id, v_prio, 'start', v_first_work_node_id, null , null);
              else
                insert into DC_CONFIG_PP_Usage_Tariff_LOG
              values (cur_pp.price_plan_id,cur_pp.price_plan_name,cur_pp.re_id,cur_pp.re_name,cur_pp.zone_map_name,cur_pp.zone_name,cur_pp.featur,cur_pp.connect_type,cur_pp.price,cur_pp.precision,cur_pp.unit,cur_pp.pulse,cur_pp.con_res_id,cur_pp.bal_source_type,cur_pp.con_res_name,'The number of set up rank price is error!!!',null);
              continue;
              end if;
          end if;
        end loop;
        end;


create_list:
  DC_CONFIG_PP_Usage_Tariff:
    - PP_USAGE_TARIFF
    - V20190515
    - TABLE
    - VALUE_LIST:
        CONNECT_TYPE:
          TYPE: list
          SOURCE: Y,N,R,T
        UNIT:
          TYPE: list
          SOURCE: occ,mb,con,min,3Mins,4Mins,5Mins,20Mins,30Sec,20Sec,15Sec
        BAL_SOURCE_TYPE:
          TYPE: list
          SOURCE: 1,4

  DC_CONFIG_PP_Usage_Tariff_LOG:
    - PP_USAGE_TARIFF
    - V20190515
    - TABLE

  DC_PROC_PRICE:
    - PROC_PP_INSERT
    - V20190515
    - procedure