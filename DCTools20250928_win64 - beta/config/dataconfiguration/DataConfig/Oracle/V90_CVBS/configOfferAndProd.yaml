param_list:

  OfferAndProd:
    default_sp_id:
      0
    default_access_prod:
      0
    default_create_user:
      3044336
    default_create_date:
      sysdate
    default_exp_date:
      "to_date('2099-12-31', 'yyyy-mm-dd')"
    default_eff_date:
      "to_date('2010-01-01','yyyy-mm-dd')"
    default_eff_period:
      "''"
    default_date_format:
      "'yyyy/mm/dd hh24:mi:ss'"
    default_price_plan_apply_level:
      "'S'"
    default_price_plan_type:
      "'3'"
    default_price_plan_genre:
      "'A'"


OfferAndProd:
  dst_table:
    - cpc.BILL_CATG
    - cpc.BILL_PROD
    - cpc.BILL_CATG_MEM
    - cpc.BILL_PROD_ATTR
    - cpc.BILL_OFFER
    - cpc.Bill_OFFER_OBJECT
    - cpc.BILL_OFFER_ATTR
    - cpc.BILL_OFFER_COMPONENT_ATTR
    - cpc.BILL_COMPONENT_ATTR_VALUE
    - cpc.BILL_OFFER_GROUP
    - cpc.BILL_OFFER_GROUP_MEM
    - cpc.BILL_OFFER_GROUP_RELA
    - cpc.price_plan
    - cpc.price_plan_ver
    - cpc.price_set
    - cpc.price_plan_member
    - cpc.tariff_plan_rela
    - cpc.tariff_plan
    - cpc.OFFER_PRICE
    - cpc.BILL_OFFER_RELA



  mid_table:
    - DC_BILL_CATG
    - DC_CONFIG_PROD_BASIC_INFO
    - DC_CONFIG_PROD_ATTRIBUTE
    - DC_CONFIG_OFFER_APPLICABLE_CHANNEL
    - DC_CONFIG_OFFER_BASIC_INFO
    - DC_CONFIG_PROD_BASIC_INFO
    - DC_CONFIG_OFFER_PROD_REL
    - DC_CONFIG_OFFER_PROD_ATTR_REL
    - DC_CONFIG_OFFER_GROUP
    - DC_CONFIG_OFFER_GROUP_MEM
    - DC_CONFIG_OFFER_GROUP_RELA
    - DC_CONFIG_OFFER_PRICE_PLAN_REL
    - DC_CONFIG_PRICE_PLAN_BASIC_INFO
    - DC_CONFIG_OFFER_REL


  insert_BILL_CATG:
    - |
      insert into cpc.bill_catg
        (catg_id,
         parent_catg_id,
         catg_type,
         catg_name,
         sp_id)
         select cpc.BILL_CATG_ID_SEQ.nextval,
                t2.catg_id,
                t2.catg_type,
                t1.catg_name,
                %(default_sp_id)s
           from dc_bill_catg t1
           left join bill_catg t2
             on t1.PARENT_CATG=t2.catg_name
           left join bill_catg t3
             on t3.catg_name=t1.catg_name
          where t3.catg_id is null



  insert_DC_CONFIG_PROD_BASIC_INFO:
    - |
      insert into cpc.BILL_PROD
        (PROD_ID,
         PROD_TYPE ,
         PROD_NAME ,
         PROD_CODE  ,
         NETWORK_TYPE ,
         SERV_TYPE  ,
         PARENT_PROD_ID,
         SERV_NUM_TYPE ,
         SP_ID ,
         REMARKS )
      select  nvl(t1.OLD_PROD_ID,cpc.BILL_PROD_ID_SEQ.nextval),
             t2.CODE_VALUE,
             t1.PROD_NAME,
             t1.PROD_CODE,null ,t6.SERV_TYPE ,
             t3.PROD_ID,
             t4.CODE_VALUE,
             %(default_sp_id)s,
             t1.REMARK
         from dc_config_prod_basic_info t1
          inner join cpc.CBEC_DOMAIN_DATA t2
            on t2.LOOKUP_NAME=t1.PROD_TYPE
              and t2.DOMAIN_TYPE_CODE='PROD_TYPE'
          left join cpc.BILL_PROD t3
            on t3.PROD_NAME = t1.PARENT_PROD_NAME
          inner join cpc.CBEC_DOMAIN_DATA t4
            on t4.LOOKUP_NAME=t1.SERV_NUM_TYPE
              and t4.DOMAIN_TYPE_CODE='PROD.SERV_NUM_TYPE'
          left join cpc.BILL_SERV_TYPE t6
            on t6.SERV_TYPE_name= t1.SERV_TYPE
          left join cpc.BILL_PROD t5
           on t5.PROD_NAME=t1.PROD_NAME
               and t5.PROD_TYPE = t2.CODE_VALUE
               and t5.prod_code = t1.prod_code
         where t5.PROD_ID is null

    - |
      insert into cpc.BILL_CATG_MEM
        (CATG_MEM_ID ,
         CATG_ID,
         MEMBER_ID  ,
         SEQ ,
         SP_ID )
        select  cpc.BILL_CATG_MEM_ID_SEQ.nextval,
               t2.CATG_ID,
               t3.PROD_ID,
               0,
               %(default_sp_id)s
          from dc_config_prod_basic_info t1
          left join cpc.BILL_CATG t2
            on t2.CATG_NAME=t1.CATALOG_NAME
          left join cpc.BILL_PROD t3
            on t3.PROD_NAME=t1.PROD_NAME
           and t3.prod_code = t1.prod_code
          left join cpc.BILL_CATG_MEM t4
            on t4.CATG_ID=t2.CATG_ID
               and t4.MEMBER_ID=t3.PROD_ID
         where  t4.CATG_MEM_ID is null
    - |
      DECLARE
      I number(30) := 0;
      BEGIN
        FOR I IN ( SELECT distinct  b.CATG_ID FROM  dc_config_prod_basic_info c,BILL_CATG b where c.CATALOG_NAME=b.CATG_NAME   ) LOOP
          MERGE INTO  BILL_CATG_MEM B
          USING (SELECT ROWNUM ROWN, A.*
                   FROM (SELECT *
                           FROM  BILL_CATG_MEM
                          WHERE CATG_ID =  I.CATG_ID
                           ) A) T
          ON (B.MEMBER_ID = T.MEMBER_ID)
          WHEN MATCHED THEN
            UPDATE SET B.SEQ = T.ROWN;
          COMMIT;
        END LOOP;
        COMMIT;
      END;

  insert_DC_CONFIG_PROD_ATTRIBUTE:
    - |
      insert into cpc.BILL_PROD_ATTR
        (PROD_ATTR_ID,
         PROD_ID,
         ATTR_ID,
         EFF_DATE,
         EXP_DATE,
         DEFAULT_VALUE,
         SP_ID ,
         DISP_ORDER )
        select cpc.BILL_PROD_ATTR_ID_SEQ.nextval,
               t2.PROD_ID,
               t3.ATTR_ID,
               nvl(to_date(t1.EFF_DATE,%(default_date_format)s),%(default_eff_date)s),
               nvl(to_date(t1.EXP_DATE,%(default_date_format)s),%(default_exp_date)s),
               coalesce(t4.VALUE, t1.DEFAULT_VALUE,t3.default_value),
               %(default_sp_id)s,1
          from DC_CONFIG_PROD_ATTRIBUTE t1
         inner join cpc.BILL_PROD t2
            on t1.PROD_NAME=t2.PROD_NAME
         inner join cpc.BILL_ATTR t3
              on t3.ATTR_Name=t1.ATTR_NAME
         left join cpc.BILL_ATTR_VALUE t4
              on t3.ATTR_ID=t4.ATTR_ID
              and trim(t4.VALUE_MARK) = t1.default_value
         left join cpc.BILL_PROD_ATTR t4
            on t2.prod_id = t4.prod_id
            and t3.attr_id = t4.attr_id
         where t4.PROD_ATTR_ID is null

  insert_DC_CONFIG_OFFER_BASIC_INFO:
    - |
      insert into cpc.bill_offer
        (OFFER_ID ,
         OFFER_TYPE ,
         OFFER_CATEGORY ,
         OFFER_NAME ,
         OFFER_CODE ,
         BUNDLE_FLAG ,
         EFF_DATE ,
         EXP_DATE ,
         STATE ,
         EFF_TYPE ,
         PAYMENT_MODE_CD ,
         SALE_FLAG  ,
         GRADE  ,
         SALE_LIST_PRICE ,
         RENT_LIST_PRICE ,
         SP_ID  ,
         COMMENTS)
        select nvl(t1.new_offer_id, cpc.BILL_OFFER_ID_SEQ.nextval),
               t3.CODE_VALUE,t4.CODE_VALUE,t1.OFFER_NAME,
               nvl(t1.OFFER_NBR, t1.OLD_OFFER_ID),t1.BUNDLE_FLAG,
               nvl(to_date(t1.EFF_DATE,%(default_date_format)s), %(default_eff_date)s),
               nvl(to_date(t1.EXP_DATE,%(default_date_format)s), %(default_exp_date)s),
               t5.CODE_VALUE,t6.CODE_VALUE,t7.CODE_VALUE,t8.CODE_VALUE,t1.GRADE,
               t1.SALE_LIST_PRICE,t1.RENT_LIST_PRICE,
               %(default_sp_id)s,
               t1.OFFER_DESC
         from DC_CONFIG_OFFER_BASIC_INFO t1
           left join cpc.bill_offer t2
             on (t1.offer_name = t2.offer_name
             or t1.new_offer_id = t2.offer_id )
             and t2.OFFER_CODE = t1.OFFER_NBR
           left join cpc.CBEC_DOMAIN_DATA t3
             on t3.DOMAIN_TYPE_CODE='OFFER_TYPE'
               and t1.OFFER_TYPE=t3.LOOKUP_NAME
           left join cpc.CBEC_DOMAIN_DATA t4
             on t4.DOMAIN_TYPE_CODE='OFFER_CATG'
               and t1.OFFER_CATEGORY=t4.LOOKUP_NAME
           inner join cpc.CBEC_DOMAIN_DATA t5
             on t5.DOMAIN_TYPE_CODE='OFFER_STATE'
               and t1.OFFER_STATE=t5.LOOKUP_NAME
           left join cpc.CBEC_DOMAIN_DATA t6
            on t6.DOMAIN_TYPE_CODE='OFFER_EFF_TYPE'
               and t1.EFF_TYPE=t6.LOOKUP_NAME
           left join cpc.CBEC_DOMAIN_DATA t7
            on t7.DOMAIN_TYPE_CODE='PAYMENT_MODE_CD'
               and t1.PAYMENT_MODE=t7.LOOKUP_NAME
           left join cpc.CBEC_DOMAIN_DATA t8
            on t8.DOMAIN_TYPE_CODE='OFFER_SALE_FLAG'
               and t1.SALE_TYPE=t8.LOOKUP_NAME
          where t2.offer_id is null

    - |
      insert into cpc.BILL_CATG_MEM
        (CATG_MEM_ID,
         CATG_ID,
         MEMBER_ID,
         SEQ,
         SP_ID )
        select cpc.BILL_CATG_MEM_ID_SEQ.nextval,
               t2.CATG_ID,
               t3.OFFER_ID,
               0,
               %(default_sp_id)s
          from DC_CONFIG_OFFER_BASIC_INFO t1
          inner join cpc.BILL_CATG t2
            on t2.CATG_NAME=t1.CATALOG_ITEM_NAME
          inner join cpc.BILL_offer t3
            on t3.OFFER_NAME=t1.OFFER_NAME
               and t3.OFFER_CODE = t1.OFFER_NBR
          left join cpc.BILL_CATG_MEM t4
            on t4.CATG_ID=t2.CATG_ID
               and t4.MEMBER_ID=t3.OFFER_ID
         where  t4.CATG_MEM_ID is null
    - |
      DECLARE
      I number(30) := 0;
      BEGIN
        FOR I IN ( SELECT distinct  b.CATG_ID FROM  DC_CONFIG_OFFER_BASIC_INFO c,BILL_CATG b where c.CATALOG_ITEM_NAME=b.CATG_NAME   ) LOOP
          MERGE INTO  BILL_CATG_MEM B
          USING (SELECT ROWNUM ROWN, A.*
                   FROM (SELECT *
                           FROM  BILL_CATG_MEM
                          WHERE CATG_ID =  I.CATG_ID
                           ) A) T
          ON (B.MEMBER_ID = T.MEMBER_ID)
          WHEN MATCHED THEN
            UPDATE SET B.SEQ = T.ROWN;
          COMMIT;
        END LOOP;
        COMMIT;
      END;

    - |
      insert into cpc.bill_offer_object
        (OFFER_OBJECT_ID,
         OFFER_ID,
         OBJECT_TYPE,
         OBJECT_ID,
         NECESSARY,
         SP_ID)
        select cpc.BILL_OFFER_OBJECT_ID_SEQ.nextval,
               t2.OFFER_ID,
               '1',
               t3.PROD_ID,
               '1',
               %(default_sp_id)s
          from DC_CONFIG_OFFER_BASIC_INFO t1
           left join cpc.bill_offer t2
             on t2.OFFER_NAME=t1.OFFER_NAME
               and t2.OFFER_CODE = t1.OFFER_NBR
           left join cpc.BILL_PROD t3
             on t3.PROD_name =t1.MAIN_PRODUCT_NAME
           left join bill_offer_object t4
             on t4.OFFER_ID=t2.OFFER_ID
             and t4.OBJECT_ID=t3.PROD_ID
             and t4.OBJECT_TYPE='1'
         where t4.OFFER_OBJECT_ID is null
               and t1.MAIN_PRODUCT_NAME is not null

  insert_DC_CONFIG_OFFER_ATTRIBUTE:
    - |
      insert into cpc.BILL_OFFER_ATTR
        (OFFER_ATTR_ID,
         OFFER_ID,
         ATTR_ID,
         DEFAULT_VALUE,
         EFF_DATE,
         EXP_DATE,
         SP_ID )
        select cpc.BILL_OFFER_ATTR_ID_SEQ.nextval,
               t2.OFFER_ID,
               t3.ATTR_ID,
               coalesce(t4.VALUE, t1.DEFAULT_VALUE,t3.default_value),
               nvl(to_date(t1.EFF_DATE,%(default_date_format)s),%(default_eff_date)s),
               nvl(to_date(t1.EXP_DATE,%(default_date_format)s),%(default_exp_date)s),
               %(default_sp_id)s
          from DC_CONFIG_OFFER_ATTRIBUTE t1
         inner join cpc.BILL_offer t2
            on t1.OFFER_NAME=t2.OFFER_NAME
            and OFFER_TYPE=1
         inner join cpc.BILL_ATTR t3
              on t3.ATTR_CODE=t1.ATTR_CODE
         left join cpc.BILL_ATTR_VALUE t4
              on t3.ATTR_ID=t4.ATTR_ID
              and trim(t4.VALUE_MARK) = t1.default_value
         left join cpc.BILL_OFFER_ATTR t4
            on t2.OFFER_ID = t4.OFFER_ID
            and t3.attr_id = t4.attr_id
         where t4.OFFER_ATTR_ID is null

  insert_DC_CONFIG_OFFER_PROD_REL:
    - |
      insert into cpc.bill_offer_object
        (OFFER_OBJECT_ID,
         OFFER_ID,
         OBJECT_TYPE,
         OBJECT_ID,
         OBJECT_ALIAS ,
         NECESSARY,
         SP_ID)
        select cpc.BILL_OFFER_OBJECT_ID_SEQ.nextval,
               t2.OFFER_ID,
               case when t1.PROD_TYPE = 'Main Product' then
                        '1'
                    when t1.PROD_TYPE = 'Related Produnt' then
                        '5'
                    else '5'
               end OBJECT_TYPE,
               t3.PROD_ID,t1.prod_alias,
               case when t1.NECESSARY = 'Y' then
                        '1'
                    else
                        '0'
                    end NECESSARY,
               %(default_sp_id)s
          from DC_CONFIG_OFFER_PROD_REL t1
           inner join cpc.bill_offer t2
             on t2.OFFER_NAME=t1.OFFER_NAME
           inner join cpc.CBEC_DOMAIN_DATA t5
            on t5.LOOKUP_NAME=t1.PROD_TYPE
              and t5.DOMAIN_TYPE_CODE='PROD_TYPE'
           inner join cpc.BILL_PROD t3
             on t3.PROD_NAME =t1.PROD_NAME
               and t3.PROD_TYPE= t5.CODE_VALUE
           left join bill_offer_object t4
             on t4.OFFER_ID=t2.OFFER_ID
             and t4.OBJECT_ID=t3.PROD_ID
         where t4.OFFER_OBJECT_ID is null

    - |
      insert into cpc.BILL_OFFER_COMPONENT_ATTR
        (COMPONENT_ATTR_ID ,
         OFFER_ID ,
         PRODUCT_ID ,
         ATTR_ID  ,
         DEFAULT_VALUE ,
         SP_ID,
         EFF_DATE  ,
         EXP_DATE
        )
        select  cpc.BILL_OFFER_COMP_ATTR_SEQ.nextval,
               t4.OFFER_ID,
               t4.OBJECT_ID,
               t5.ATTR_ID,
               t5.DEFAULT_VALUE,
               %(default_sp_id)s,
               t5.EFF_DATE,
               t5.EXP_DATE
          from DC_CONFIG_OFFER_PROD_REL t1
           inner join bill_offer t2
               on t2.OFFER_NAME=t1.OFFER_NAME
           inner join bill_prod t3
               on t3.PROD_NAME = t1.PROD_NAME
           inner join bill_offer_object t4
                on t4.OFFER_ID= t2.OFFER_ID
                and t4.OBJECT_ID=t3.PROD_ID
           inner join BILL_PROD_ATTR t5
                on t5.PROD_ID = t3.PROD_ID
           left join bill_offer_component_attr t6
                on t6.OFFER_ID=t2.OFFER_ID
                and t6.PRODUCT_ID=t3.PROD_ID
                and t6.ATTR_ID = t5.ATTR_ID
         where t6.COMPONENT_ATTR_ID is null

    - |
      insert into cpc.BILL_COMPONENT_ATTR_VALUE
        (COMPONET_ATTR_VALUE_ID,
         COMPONENT_ATTR_ID,
         ATTR_ID,
         ATTR_VALUE_ID,
         VALUE,
         SP_ID
        )
        select  cpc.BILL_COMP_ATTR_VALUE_SEQ.nextval,
                t6.COMPONENT_ATTR_ID,
                t7.ATTR_ID,
                t7.ATTR_VALUE_ID,
                t7.VALUE,
                %(default_sp_id)s
          from DC_CONFIG_OFFER_PROD_REL t1
           inner join bill_offer t2
               on t2.OFFER_NAME=t1.OFFER_NAME
           inner join bill_prod t3
               on t3.PROD_NAME = t1.PROD_NAME
           inner join bill_offer_object t4
                on t4.OFFER_ID= t2.OFFER_ID
                and t4.OBJECT_ID=t3.PROD_ID
           inner join BILL_PROD_ATTR t5
                on t5.PROD_ID = t3.PROD_ID
           inner join bill_offer_component_attr t6
                on t6.OFFER_ID=t2.OFFER_ID
                and t6.PRODUCT_ID=t3.PROD_ID
                and t6.ATTR_ID = t5.ATTR_ID
           inner join bill_attr_value t7
                on t7.ATTR_ID = t6.ATTR_ID
                and t7.VALUE = t5.DEFAULT_VALUE
           left join BILL_COMPONENT_ATTR_VALUE t8
                on t8.ATTR_ID = t6.ATTR_ID
                and t8.COMPONENT_ATTR_ID = t6.COMPONENT_ATTR_ID
                and t8.VALUE = t7.VALUE
         where  t8.COMPONET_ATTR_VALUE_ID  is null


  update_BILL_OFFER_PROD_COMPONENT_ATTR:
    - |
      update cpc.BILL_OFFER_COMPONENT_ATTR tt1
         set eff_date = sysdate,
             default_value  =
             (select  coalesce(t8.VALUE, t1.DEFAULT_VALUE)
                from DC_CONFIG_OFFER_PROD_ATTR_REL t1
                 inner join bill_offer t2
                    on t2.OFFER_NAME=t1.OFFER_NAME
                 inner join bill_prod t3
                    on t3.PROD_name=t1.PROD_NAME
                 inner join BILL_attr t4
                    on t4.ATTR_NAME = t1.ATTR_NAME
                 inner join BILL_PROD_ATTR t5
                    on t5.ATTR_ID = t4.ATTR_ID
                    and t5.PROD_ID = t3.PROD_ID
                 inner join BILL_OFFER_COMPONENT_ATTR t6
                    on t6.ATTR_ID = t5.ATTR_ID
                    and t5.PROD_ID = t6.PRODUCT_ID
                    and t6.OFFER_ID = t2.OFFER_ID
                 left join BILL_attr_value t8
                    on t8.VALUE_MARK = t1.DEFAULT_VALUE
                    and t8.ATTR_ID = t4.ATTR_ID
                where t1.DEFAULT_VALUE is not null
                       and tt1.COMPONENT_ATTR_ID = t6.COMPONENT_ATTR_ID  )
        where ( tt1.offer_id, tt1.Product_id, tt1.attr_id ) in
              (select t3.OFFER_ID,t4.PROD_ID,t5.ATTR_ID
                from DC_CONFIG_OFFER_PROD_ATTR_REL t2
                inner join cpc.Bill_offer t3
                  on t3.offer_name = t2.offer_name
                inner join cpc.Bill_prod t4
                  on t2.PROD_NAME = t4.prod_name
                inner join cpc.BILL_ATTR t5
                  on t2.ATTR_NAME = t5.ATTR_NAME
                where t2.DEFAULT_VALUE is not null )

    - |
      delete from BILL_COMPONENT_ATTR_VALUE t where
               t.COMPONENT_ATTR_ID in ( select t7.COMPONET_ATTR_VALUE_ID
                   from DC_CONFIG_OFFER_PROD_ATTR_REL t1
                       inner join bill_offer t2
                          on t2.OFFER_NAME=t1.OFFER_NAME
                       inner join bill_prod t3
                          on t3.PROD_name=t1.PROD_NAME
                       inner join BILL_attr t4
                          on t4.ATTR_NAME = t1.ATTR_NAME
                       left join BILL_PROD_ATTR t5
                          on t5.ATTR_ID = t4.ATTR_ID
                          and t5.PROD_ID = t3.PROD_ID
                       inner join BILL_OFFER_COMPONENT_ATTR t6
                          on t6.ATTR_ID = t5.ATTR_ID
                          and t5.PROD_ID = t6.PRODUCT_ID
                          and t6.OFFER_ID = t2.OFFER_ID
                        inner  join BILL_COMPONENT_ATTR_VALUE t7
                          on t7.COMPONENT_ATTR_ID=t6.COMPONENT_ATTR_ID
                       where t7.COMPONET_ATTR_VALUE_ID is not null and t1.ATTR_NAME is not null
              )

    - |
      insert into cpc.BILL_COMPONENT_ATTR_VALUE
        (COMPONET_ATTR_VALUE_ID,
         COMPONENT_ATTR_ID,
         ATTR_ID,
         ATTR_VALUE_ID,
         VALUE,
         SP_ID
        )
        select  cpc.BILL_COMP_ATTR_VALUE_SEQ.nextval,
                t6.COMPONENT_ATTR_ID,
                t7.ATTR_ID,
                t7.ATTR_VALUE_ID,
                t7.VALUE,
                %(default_sp_id)s
          from DC_CONFIG_OFFER_PROD_ATTR_REL t1
           inner join bill_offer t2
               on t2.OFFER_NAME=t1.OFFER_NAME
           inner join bill_prod t3
               on t3.PROD_NAME = t1.PROD_NAME
           inner join bill_offer_object t4
                on t4.OFFER_ID= t2.OFFER_ID
                and t4.OBJECT_ID=t3.PROD_ID
           inner join bill_attr t5
                on t5.ATTR_NAME = t1.ATTR_NAME
           inner join bill_offer_component_attr t6
                on t6.OFFER_ID=t2.OFFER_ID
                and t6.PRODUCT_ID=t3.PROD_ID
                and t6.ATTR_ID = t5.ATTR_ID
           inner join bill_attr_value t7
                on t7.VALUE_MARK = t1.ATTR_VALUE_NAME
                and t7.ATTR_ID=t5.ATTR_ID
            left join BILL_COMPONENT_ATTR_VALUE t8
                on t8.ATTR_ID = t6.ATTR_ID
                and t8.COMPONENT_ATTR_ID = t6.COMPONENT_ATTR_ID
                and t8.VALUE = t7.VALUE
         where t1.ATTR_NAME is not null
               and  t8.COMPONET_ATTR_VALUE_ID  is null

  insert_DC_CONFIG_OFFER_GROUP:
    - |
      insert into cpc.BILL_OFFER_GROUP
        (OFFER_GROUP_ID,
         OFFER_GROUP_NAME,
         OFFER_GROUP_TYPE,
         GROUP_TYPE,
         UPPER_LIMIT,
         LOWER_LIMIT,
         COMMENTS ,
         SP_ID )
        select cpc.BILL_OFFER_GROUP_SEQ.nextval,
               t1.OFFER_GROUP_NAME,
               t2.CODE_VALUE,
               t3.CODE_VALUE,
               t1.UPPER_LIMIT,
               t1.LOWER_LIMIT,
               t1.COMMENTS,
               %(default_sp_id)s
          from DC_CONFIG_OFFER_GROUP t1
           left join cpc.CBEC_DOMAIN_DATA t2
             on t2.LOOKUP_NAME=t1.OFFER_GROUP_TYPE
             and t2.DOMAIN_TYPE_CODE='OFFER_GROUP_TYPE'
           left join cpc.CBEC_DOMAIN_DATA t3
             on t3.LOOKUP_NAME=t1.GROUP_TYPE
             and t3.DOMAIN_TYPE_CODE ='GROUP_TYPE'
           left join BILL_OFFER_GROUP t4
             on  t4.OFFER_GROUP_NAME=t1.OFFER_GROUP_NAME
         where t4.OFFER_GROUP_ID is null


  insert_DC_CONFIG_OFFER_GROUP_MEM:
    - |
      insert into cpc.BILL_OFFER_GROUP_MEM
        (OFFER_GROUP_MEM_ID  ,
         OFFER_GROUP_ID ,
         OFFER_ID ,
         DEFAULT_FLAG ,
         HIDE_FLAG ,
         SEQ ,
         SP_ID )
        select  cpc.BILL_OFFER_GROUP_MEM_SEQ.nextval,
                t2.OFFER_GROUP_ID,
                t3.OFFER_ID,
                t1.DEFAULT_FLAG,
                t1.HIDE_FLAG,
                1 ,
                %(default_sp_id)s
          from DC_CONFIG_OFFER_GROUP_MEM t1
           left join cpc.BILL_OFFER_GROUP t2
             on t2.OFFER_GROUP_NAME=t1.OFFER_GROUP_NAME
           left join cpc.BILL_OFFER t3
             on t3.OFFER_NAME=t1.OFFER_NAME
           left join BILL_OFFER_GROUP_MEM t4
             on  t4.OFFER_GROUP_ID=t2.OFFER_GROUP_ID
             and t4.OFFER_ID=t3.OFFER_ID
         where t4.OFFER_GROUP_MEM_ID is null

    - |
      DECLARE
      I number(30) := 0;
      BEGIN
        FOR I IN ( SELECT distinct  c.OFFER_GROUP_ID FROM  BILL_OFFER_GROUP c,DC_CONFIG_OFFER_GROUP_MEM b where c.OFFER_GROUP_NAME=b.OFFER_GROUP_NAME  ) LOOP
          MERGE INTO  BILL_OFFER_GROUP_MEM B
          USING (SELECT ROWNUM ROWN, A.*
                   FROM (SELECT *
                           FROM  BILL_OFFER_GROUP_MEM
                          WHERE OFFER_GROUP_ID =  I.OFFER_GROUP_ID
                           ) A) T
          ON (B.OFFER_ID = T.OFFER_ID)
          WHEN MATCHED THEN
            UPDATE SET B.SEQ = T.ROWN;
          COMMIT;
        END LOOP;
        COMMIT;
      END;

  insert_DC_CONFIG_OFFER_GROUP_RELA:
    - |
      insert into cpc.BILL_OFFER_GROUP_RELA
        (OFFER_GROUP_RELA_ID ,
         OFFER_ID ,
         INCLUDE_TYPE  ,
         OBJECT_ID ,
         NECESSARY  ,
         SEQ ,
         SP_ID )
        select  cpc.BILL_OFFER_GROUP_RELA_SEQ.nextval,
                t3.OFFER_ID,
                '1',
                 t2.OFFER_GROUP_ID,
                '0',
                 1  ,
                 %(default_sp_id)s
          from DC_CONFIG_OFFER_GROUP_RELA t1
           left join cpc.BILL_OFFER_GROUP t2
             on t2.OFFER_GROUP_NAME=t1.OFFER_GROUP_NAME
           left join cpc.BILL_OFFER t3
             on t3.OFFER_NAME=t1.OFFER_NAME
           left join BILL_OFFER_GROUP_RELA t4
             on  t4.OBJECT_ID=t2.OFFER_GROUP_ID
             and t4.OFFER_ID=t3.OFFER_ID
         where t4.OFFER_GROUP_RELA_ID is null

    - |
      DECLARE
      I number(30) := 0;
      BEGIN
        FOR I IN ( SELECT distinct  c.OFFER_ID FROM  BILL_OFFER c,DC_CONFIG_OFFER_GROUP_RELA b where c.OFFER_NAME=b.OFFER_NAME  ) LOOP
          MERGE INTO  BILL_OFFER_GROUP_RELA B
          USING (SELECT ROWNUM ROWN, A.*
                   FROM (SELECT *
                           FROM  BILL_OFFER_GROUP_RELA
                          WHERE  OFFER_ID =  I.OFFER_ID
                           ) A) T
          ON (B.OBJECT_ID = T.OBJECT_ID)
          WHEN MATCHED THEN
            UPDATE SET B.SEQ = T.ROWN;
          COMMIT;
        END LOOP;
        COMMIT;
      END;


    - |
      insert into cpc.BILL_OFFER_COMPONENT_ATTR
        (COMPONENT_ATTR_ID ,
         OFFER_ID ,
         COMPONENT_OFFER_ID,
         ATTR_ID  ,
         DEFAULT_VALUE ,
         SP_ID,
         EFF_DATE  ,
         EXP_DATE
        )
        select cpc.BILL_OFFER_COMP_ATTR_SEQ.nextval,
               t2.OFFER_ID,
               t4.OFFER_ID,
               t5.ATTR_ID,
               t5.DEFAULT_VALUE,
               %(default_sp_id)s,
               t5.EFF_DATE,
               t5.EXP_DATE
          from DC_CONFIG_OFFER_GROUP_RELA t1
           inner join bill_offer t2
               on t2.OFFER_NAME=t1.OFFER_NAME
           inner join BILL_OFFER_GROUP t3
               on t3.OFFER_GROUP_NAME = t1.OFFER_GROUP_NAME
           inner join BILL_OFFER_GROUP_MEM t4
               on t4.OFFER_GROUP_ID = t3.OFFER_GROUP_ID
           inner join bill_offer_attr t5
                on t5.OFFER_ID= t4.OFFER_ID
           left join bill_offer_component_attr t6
                on t6.OFFER_ID=t2.OFFER_ID
                and t6.COMPONENT_OFFER_ID= t4.OFFER_ID
                and t6.ATTR_ID = t5.ATTR_ID
         where t6.COMPONENT_ATTR_ID is null


    - |
      insert into cpc.BILL_COMPONENT_ATTR_VALUE
        (COMPONET_ATTR_VALUE_ID,
         COMPONENT_ATTR_ID,
         ATTR_ID,
         ATTR_VALUE_ID,
         VALUE,
         SP_ID
        )
        select  cpc.BILL_COMP_ATTR_VALUE_SEQ.nextval,
                t6.COMPONENT_ATTR_ID,
                t7.ATTR_ID,
                t7.ATTR_VALUE_ID,
                t7.VALUE,
                %(default_sp_id)s
          from DC_CONFIG_OFFER_GROUP_RELA t1
           inner join bill_offer t2
               on t2.OFFER_NAME=t1.OFFER_NAME
           inner join BILL_OFFER_GROUP t3
               on t3.OFFER_GROUP_NAME = t1.OFFER_GROUP_NAME
           inner join BILL_OFFER_GROUP_MEM t4
               on t4.OFFER_GROUP_ID = t3.OFFER_GROUP_ID
           inner join bill_offer_attr t5
                on t5.OFFER_ID= t4.OFFER_ID
           left join bill_offer_component_attr t6
                on t6.OFFER_ID=t2.OFFER_ID
                and t6.COMPONENT_OFFER_ID= t4.OFFER_ID
                and t6.ATTR_ID = t5.ATTR_ID
           inner join bill_attr_value t7
                on t7.ATTR_ID = t6.ATTR_ID
           left join BILL_COMPONENT_ATTR_VALUE t8
                on t8.ATTR_ID = t6.ATTR_ID
                and t8.COMPONENT_ATTR_ID = t6.COMPONENT_ATTR_ID
                and t8.VALUE = t7.VALUE
         where  t8.COMPONET_ATTR_VALUE_ID  is null


  insert_DC_CONFIG_PRICE_PLAN_BASIC_INFO:
    - |
      insert into cpc.price_plan
        (price_plan_id,
         price_plan_code,
         price_plan_name,
         apply_level,
         price_plan_type,
         price_plan_genre,
         priority,
         lock_flag,
         state,
         price_plan_exit,
         active_date,
         active_staff_id,
         policy_plan_flag)
        select t2.price_plan_id,
               nvl(t2.PRICE_PLAN_CODE, substr(regexp_replace(T2.PRICE_PLAN_NAME, '[^A-Za-z0-9]+', '_'),0,58)||substr(t2.price_plan_id,-2)),
               t2.PRICE_PLAN_NAME,
               nvl(t5.apply_level,%(default_price_plan_apply_level)s),
               nvl(t3.price_plan_type,%(default_price_plan_type)s),
               nvl(t4.price_plan_genre,%(default_price_plan_genre)s),
               nvl(t2.priority,total_cnt+rownum),
               'N',
               'A',
               t2.price_plan_exit,
               %(default_eff_date)s,
               %(default_create_user)s,
               'N'
          from dc_config_price_plan_basic_info t2
          left join cpc.price_plan_type t3
            on t2.price_plan_type = t3.price_plan_type_name
          left join cpc.price_plan_genre t4
            on t4.genre_name = t2.price_plan_genre
          left join cpc.apply_level t5
            on t5.apply_level_name = t2.apply_level
          left join cpc.price_plan t6
            on t2.price_plan_name = t6.price_plan_name
            or t2.price_plan_id = t6.price_plan_id
          left join (select count(*) total_cnt
                       from cpc.price_plan
                      where price_plan_type = 3
                        and policy_plan_flag = 'N') t7
            on 1=1
         where t6.price_plan_code is null
    - |
      insert into cpc.price_plan_ver
        (price_plan_ver_id,
         price_plan_id,
         seq,
         eff_date,
         using_state,
         state,
         created_date,
         created_staff_id,
         release_date,
         release_staff_id,
         submit_date,
         submit_staff_id,
         approved_date,
         approved_staff_id)
        select cpc.price_plan_ver_id_seq.nextval,
               t1.price_plan_id,
               1,
               %(default_eff_date)s,
               'A',
               'A',
               %(default_eff_date)s,
               %(default_create_user)s,
               %(default_eff_date)s,
               %(default_create_user)s,
               %(default_eff_date)s,
               %(default_create_user)s,
               %(default_eff_date)s,
               %(default_create_user)s
          from cpc.price_plan t1
          left join cpc.price_plan_ver t2
            on t1.price_plan_id = t2.price_plan_id
         where t2.price_plan_ver_id is null

    - |
      insert into cpc.price_set
        (price_set_id, apply_level, price_set_priority_id, priority)
        select cpc.price_set_id_seq.nextval, t4.apply_level, 10000, 1
          from cpc.price_plan_ver t1
         inner join cpc.price_plan t4
            on t1.price_plan_id = t4.price_plan_id
          left join cpc.price_plan_member t2
            on t1.price_plan_ver_id = t2.price_plan_ver_id
          left join cpc.price_set t3
            on t3.price_set_id = t2.price_set_id
         where t3.price_set_id is null

    - |
      insert into cpc.price_plan_member
        (price_plan_ver_id, price_set_id, created_date)
        select t1.price_plan_ver_id, t2.price_set_id, %(default_eff_date)s
          from (select t1.price_plan_ver_id, rownum row_count
                  from cpc.price_plan_ver t1
                  left join cpc.price_plan_member t2
                    on t1.price_plan_ver_id = t2.price_plan_ver_id
                 where t2.price_set_id is null
                   order by t1.price_plan_ver_id) t1
          left join (select t1.price_set_id, rownum row_count
                       from cpc.price_set t1
                       left join cpc.price_plan_member t2
                         on t1.price_set_id = t2.price_set_id
                      where t2.price_set_id is null
                        order by t1.price_set_id) t2
            on t1.row_count = t2.row_count


  insert_DC_CONFIG_OFFER_PRICE_PLAN_REL:

    - |
      insert into cpc.tariff_plan
        (tariff_plan_id,
         tariff_plan_name,
         tariff_plan_code,
         CREATED_DATE,
         state,
         tariff_plan_type,
         state_date,
         active_date)
        select cpc.TARIFF_PLAN_ID_SEQ.nextval,
               t1.offer_name,
               substr(regexp_replace(t1.offer_name, '[^A-Za-z0-9]+', '_'),0,58)||substr(cpc.TARIFF_PLAN_ID_SEQ.currval,-2),
               %(default_eff_date)s,
               'B',
               'B',
               %(default_eff_date)s,
               %(default_eff_date)s
          from dc_config_offer_price_plan_rel t1
          left join cpc.tariff_plan t2
            on t1.offer_name = t2.tariff_plan_name
         where t2.tariff_plan_name is null

    - |
      insert into cpc.tariff_plan_rela
        (tariff_plan_rela_id,
         tariff_plan_id,
         price_plan_id,
         priority,
         rent_rela_type,
         created_date,
         state,
         state_date,
         active_date,
         tariff_plan_rela_name)
        select cpc.TARIFF_PLAN_RELA_ID_SEQ.nextval,
               t3.tariff_plan_id,
               t4.price_plan_id,
               1,
               0,
               %(default_eff_date)s,
               'B',
               %(default_eff_date)s,
               %(default_eff_date)s,
               t2.offer_name
          from dc_config_offer_price_plan_rel t2
         inner join cpc.tariff_plan t3
            on t2.offer_name = t3.tariff_plan_name
         inner join cpc.price_plan t4
            on t2.price_plan_name = t4.price_plan_name
          left join cpc.tariff_plan_rela t5
            on t3.tariff_plan_id = t5.tariff_plan_id
           and t5.price_plan_id = t4.price_plan_id
         where t5.tariff_plan_rela_id is null

    - |
      insert into cpc.OFFER_PRICE
        (OFFER_PRICE_ID,
         OFFER_ID,
         TARIFF_PLAN_ID)
        select cpc.OFFER_PRICE_SEQ.nextval,
               t3.OFFER_ID,
               t2.TARIFF_PLAN_ID
          from dc_config_offer_price_plan_rel t1
          left join cpc.tariff_plan t2
            on t1.offer_name = t2.tariff_plan_name
          left join cpc.bill_offer t3
            on t1.OFFER_NAME = t3.OFFER_NAME
          left join OFFER_PRICE t4
            on  t4.OFFER_ID = t3.OFFER_ID
            and t4.TARIFF_PLAN_ID = t2.TARIFF_PLAN_ID
         where t4.OFFER_PRICE_ID  is null


  insert_DC_CONFIG_OFFER_REL:
    - |
      insert into cpc.BILL_OFFER_RELA
        (OFFER_RELA_ID,
         ORI_OFFER_ID,
         RELA_TYPE,
         DEST_OFFER_ID,
         SP_ID)
        select cpc.BILL_OFFER_RELA_SEQ.nextval,
               t2.OFFER_ID,
               t4.CODE_VALUE,
               t3.OFFER_ID,
               %(default_sp_id)s
          from DC_CONFIG_OFFER_REL t1
          inner join cpc.bill_offer t2
            on t2.OFFER_NAME=t1.SOURCE_OFFER_NAME
          inner join cpc.bill_offer t3
            on t3.OFFER_NAME=t1.DES_OFFER_NAME
          inner join CBEC_DOMAIN_DATA t4
            on t4.LOOKUP_NAME= t1.REL_TYPE
               and t4.DOMAIN_TYPE_CODE='OFFER_RELA_TYPE'
          left join   cpc.BILL_OFFER_RELA t5
            on t5.DEST_OFFER_ID = t3.OFFER_ID
            and t5.ORI_OFFER_ID=t2.OFFER_ID
            and t5.RELA_TYPE = t4.CODE_VALUE
         where t5.OFFER_RELA_ID is null
               and  (t1.oper_type is null or t1.oper_type = 'A')

    - |
      delete from CPC.BILL_OFFER_RELA
         where OFFER_RELA_ID in
            (select   t5.OFFER_RELA_ID
                from DC_CONFIG_OFFER_REL t1
                                inner join cpc.bill_offer t2
                                           on t2.OFFER_NAME = t1.SOURCE_OFFER_NAME
                                inner join cpc.bill_offer t3
                                           on t3.OFFER_NAME = t1.DES_OFFER_NAME
                                left join cpc.BILL_OFFER_RELA t5
                                           on t5.DEST_OFFER_ID = t3.OFFER_ID
                                               and t5.ORI_OFFER_ID = t2.OFFER_ID
                                WHERE t1.oper_type = 'D')

