param_list:
  OfferAndProd:
    default_access_prod:
      0
    default_create_user:
      3044336
    default_create_date:
      now()
    default_exp_date:
      "to_date('2099-12-31', 'yyyy-mm-dd')"
    default_prod_rel_role:
      70000045
    default_apply_region_id:
      731
    default_manage_grade:
      "'10'"
    default_bill_prod_type:
      "'2000'"
    default_prod_use_type:
      "'2000'"
    default_func_product_rel:
      "'Master-slave relationship'"
    default_eff_date:
      "to_date('2010-01-01','yyyy-mm-dd')"
    default_service_offer:
      "'Order Offer', 'Unsubscribe Offer', 'Modify Offer',''"
    default_offer_prod_rel_role:
      70000045
    default_offer_rel_role:
      70000045
    default_offer_eff_type:
      "'1300'"
    default_existing_type:
      "'1200'"
    default_eff_base_type:
      "'1000'"
    default_period_time_type:
      1200
    default_eff_period:
      "''"
    default_date_format:
      "'%%Y/%%m/%%d %%H:%%i:%%s'"
    default_prod_catalog:
      "'Main products'"
    default_offer_catalog:
      "'Mobile phone (local voice only)'"
    default_price_plan_apply_level:
      "'S'"
    default_price_plan_type:
      "'3'"
    default_price_plan_genre:
      "'A'"
    default_channel_type:
      "'Rural Entity Channel','Urban Entity Channel','Other','Rural agent','City Agent','Online Business Electronic Channel','10000 electronic channel','Pocket Business Hall Electronic Channel','SMS electronic channel','Group Marketing Channel'"


OfferAndProd:
  dst_table:
    - cpc.count_limit_comp_mbr
    - cpc.cpc_rent_priority
    - cpc.OBJ_COUNT_LIMIT_RUL
    - cpc.offer_attr_ext
    - cpc.offer_attr_value
    - cpc.offer_attr
    - cpc.offer_catalog_location
    - cpc.offer_eff_exp_config
    - cpc.offer_exp_cfg
    - cpc.offer_ext_attr
    - cpc.offer_payment_mode
    - cpc.OFFER_REL_RSTR_CFG
    - cpc.offer_restrict
    - cpc.offer_service_rel
    - coc.product_ext
    - cpc.prod_attr
    - cpc.prod_attr_ext
    - cpc.prod_attr_value
    - cpc.prod_catalog_location
    - cpc.prod_region_rel
    - cpc.PROD_REL
    - cpc.object_label_rel
    - cpc.product_offer_detail_base
    - cpc.tariff_plan_rela_apply
    - cpc.price_plan_member
    - cpc.price_set
    - cpc.price_plan_ver
    - cpc.tariff_plan_rela
    - cpc.tariff_plan
    - cpc.price_plan
    - cpc.offer_grp_member
    - cpc.offer_grp
    - cpc.attr_restrict_value
    - cpc.prod_attr_value_restrict
    - cpc.offer_obj_rel
    - cpc.offer_prod_rel
    - cpc.offer_prod_rel_rstr_cfg
    - cpc.offer_rel
    - cpc.product
    - cpc.offer

  mid_table:
    - DC_CONFIG_PROD_AREA
    - DC_CONFIG_OFFER_SERVICE
    - DC_CONFIG_OFFER_APPLICABLE_CHANNEL
    - DC_CONFIG_OFFER_BASIC_INFO
    - DC_CONFIG_OFFER_CUSTOMER_TAG
    - DC_CONFIG_OFFER_EFFECT_EXPIRY
    - DC_CONFIG_OFFER_GRP_BASIC_INFO
    - DC_CONFIG_OFFER_GRP_MEMBER
    - DC_CONFIG_OFFER_PRICE_PLAN_REL
    - DC_CONFIG_OFFER_PROD_REL
    - DC_CONFIG_OFFER_PROD_ATTR_REL
    - DC_CONFIG_OFFER_REL
    - DC_CONFIG_OFFER_SALES_AREA
    - DC_CONFIG_OFFER_TAG
    - DC_CONFIG_PRICE_PLAN_BASIC_INFO
    - DC_CONFIG_PROD_BASIC_INFO
    - DC_CONFIG_PROD_REL

  insert_DC_CONFIG_PROD_BASIC_INFO:
    - |
      insert into ${product_basic}
        select %(default_create_date)s,
               %(default_create_user)s,
               now(),
               SEQ_PRODUCT.nextval,
               t1.prod_nbr,
               t1.prod_nbr,
               'Mobile Phone Test',
               'Mobile Phone Test',
               %(default_manage_grade)s,
               NOW(),
               NOW(),
               t1.prod_comp_type,
               t1.prod_func_type,
               %(default_bill_prod_type)s,
               %(default_prod_use_type)s,
               %(default_apply_region_id)s,
               '1000',
               1,
               12,
               substr(t1.prod_name, 1,50),
               t1.grp_prod_nbr
          from product t1
         where prod_id = 80000045

    - |
      exec_py: FuncScript.test_func(prod_info = ${product_basic})

    - |
      insert into product_ext(prod_id,prod_cat_type,hb_product_id) from param ${product_ext}

    - |
      insert into product
        (create_date,
         create_staff,
         update_date,
         prod_id,
         prod_nbr,
         prod_sys_nbr,
         prod_name,
         prod_desc,
         manage_grade,
         eff_date,
         exp_date,
         prod_comp_type,
         prod_func_type,
         bill_prod_type,
         prod_use_type,
         manage_region_id,
         status_cd,
         no_rent_flag,
         product_family_id,
         alias_name,
         grp_prod_nbr)
      from param ${product_basic}

    - |
      insert into product
        (create_date,
         create_staff,
         update_date,
         prod_id,
         prod_nbr,
         prod_sys_nbr,
         prod_name,
         prod_desc,
         manage_grade,
         eff_date,
         exp_date,
         prod_comp_type,
         prod_func_type,
         bill_prod_type,
         prod_use_type,
         manage_region_id,
         status_cd,
         no_rent_flag,
         product_family_id,
         alias_name,
         grp_prod_nbr)
        select %(default_create_date)s,
               %(default_create_user)s,
               now(),
               t1.new_prod_id,
               t1.prod_nbr,
               SEQ_PRODUCT.nextval,
               t1.prod_name,
               t1.prod_desc,
               %(default_manage_grade)s,
               IF(t1.eff_date='',NOW(),STR_TO_DATE(t1.eff_date,%(default_date_format)s)),
               IF(t1.exp_date='',NOW(),STR_TO_DATE(t1.exp_date,%(default_date_format)s)),
               t3.attr_value,
               t4.attr_value,
               %(default_bill_prod_type)s,
               %(default_prod_use_type)s,
               %(default_apply_region_id)s,
               '1000',
               1,
               12,
               substr(t1.prod_name, 1,50),
               t1.internal_nbr
          from dc_config_prod_basic_info t1
          left join product t2
            on t1.prod_name = t2.prod_name
            or t1.new_prod_id = t2.prod_id
          left join attr_value t3
            on trim(t1.prod_comp_type) = trim(t3.attr_value_name)
           and t3.status_cd='1000'
           and t3.attr_id = 800052187
          left join attr_value t4
            on t1.prod_func_type = trim(t4.attr_value_name)
           and t4.attr_id = 800052188
           and t4.status_cd = '1000'
         where t2.prod_id is null

    - |
      insert into product_ext
        (prod_id, prod_cat_type, hb_product_id)
        select t2.prod_id, t4.attr_value, t2.prod_id
          from dc_config_prod_basic_info t1
         inner join product t2
            on t1.prod_name = t2.prod_name
          left join attr_value t4
            on t4.attr_id = 1900204241
           and t4.status_cd = '1000'
           and t1.Prod_cat_type = trim(t4.attr_value_name)
          left join product_ext t3
            on t2.prod_id = t3.prod_id
         where t3.prod_id is null
           and t1.Prod_cat_type is not null

    - |
      insert into cpc.prod_catalog_location
        (create_date,
         create_staff,
         update_date,
         catalog_loc_id,
         prod_id,
         catalog_item_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.SEQ_PROD_CATALOG_LOCATION.Nextval,
               t2.prod_id,
               t3.catalog_item_id,
               1000
          from dc_config_prod_basic_info t1
         inner join cpc.product t2
            on t1.prod_name = t2.prod_name
          left join cpc.catalog_item t3
            on nvl(t1.catalog_item_name,%(default_prod_catalog)s) = t3.catalog_item_name
           and t3.catalog_id in (91001115,91001135)
          left join cpc.prod_catalog_location t4
            on t2.prod_id = t4.prod_id
           and t3.catalog_item_id = t4.catalog_item_id
         where t4.catalog_loc_id is null

    - |
      insert into cpc.PROD_REL
        (PROD_REL_ID,
         REL_TYPE,
         ROLE_ID,
         EFF_DATE,
         EXP_DATE,
         APPLY_REGION_ID,
         STATUS_CD,
         CREATE_STAFF,
         CREATE_DATE,
         A_PROD_ID,
         Z_PROD_ID)
        select cpc.SEQ_PROD_REL.NEXTVAL,
               t4.attr_value,
               %(default_prod_rel_role)s,
               nvl(to_date(t1.EFF_DATE,%(default_date_format)s), %(default_eff_date)s),
               nvl(to_date(t1.EXP_DATE,%(default_date_format)s), %(default_exp_date)s),
               %(default_apply_region_id)s,
               '1000',
               %(default_create_user)s,
               %(default_create_date)s,
               %(default_access_prod)s,
               t3.prod_id
          from dc_config_prod_basic_info t1
          left join DC_CONFIG_PROD_REL t2
            on t1.prod_name = t2.des_prod_name
           and t2.rel_type = %(default_func_product_rel)s
         inner join cpc.product t3
            on t1.prod_name = t3.prod_name
         inner join cpc.attr_value t4
            on t4.attr_id = 800052191
           and t4.status_cd = '1000'
           and trim(t4.attr_value_name) = %(default_func_product_rel)s
          left join cpc.PROD_REL t7
            on t7.a_prod_id = %(default_access_prod)s
           and t3.prod_id = t7.z_prod_id
           and t4.attr_value = t7.rel_type
         where t7.prod_rel_id is null
           and t1.prod_func_type = 'Function Product'
           and t2.des_prod_name is null
           and %(default_access_prod)s<>0

    - |
      insert into cpc.prod_region_rel
        (create_date,
         create_staff,
         update_date,
         prod_region_rel_id,
         prod_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.SEQ_PROD_REGION_REL_ID.NEXTVAL,
               t3.prod_id,
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_PROD_BASIC_INFO t1
          left join DC_CONFIG_PROD_AREA t2
            on t1.prod_name = t2.prod_name
         inner join cpc.product t3
            on t1.prod_name = t3.prod_name
          left join cpc.prod_region_rel t7
            on t3.prod_id = t7.prod_id
           and %(default_apply_region_id)s = t7.apply_region_id
         where t7.prod_region_rel_id is null
           and t2.prod_name is null

    - |
      insert into cpc.prod_attr
        (prod_attr_id,
         prod_id,
         par_prod_attr_id,
         default_value,
         apply_region_id,
         status_cd,
         create_staff,
         create_date,
         status_date,
         update_date,
         attr_id,
         attr_nbr,
         grp_attr_nbr,
         remark)
        select cpc.seq_prod_attr.nextval,
               t2.prod_id,
               -1,
               t3.default_value,
               %(default_apply_region_id)s,
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               sysdate,
               t3.attr_id,
               -1,
               -1,
               t3.attr_name
          from DC_CONFIG_PROD_BASIC_INFO t1
         inner join cpc.product t2
            on t1.prod_name = t2.prod_name
         inner join DC_CONFIG_ATTRIBUTE_DETAIL t3
            on t3.attr_name = 'Whether to Provisioning'
          left join cpc.prod_attr t6
            on t2.prod_id = t6.prod_id
           and t3.attr_id = t6.attr_id
         where t1.internal_nbr is not null
           and t6.prod_attr_id is null
           and t2.prod_func_type <> '101'
    - |
      insert into cpc.prod_attr_ext
        (prod_attr_id,
         table_name,
         field_name,
         cname,
         attr_value_type_id,
         is_check,
         is_make_to_table,
         is_edit,
         is_make,
         is_send_bill,
         is_print)
        select t1.prod_attr_id,
               t2.table_name,
               t2.field_name,
               t2.display_name,
               t2.value_type,
               t2.is_check,
               t2.is_make_to_table,
               t2.is_edit,
               t2.is_make,
               t2.is_send_bill,
               t2.is_print
          from cpc.prod_attr t1
         inner join DC_CONFIG_ATTRIBUTE_DETAIL t2
            on t1.attr_id = t2.attr_id
          left join cpc.prod_attr_ext t3
            on t1.prod_attr_id = t3.prod_attr_id
         where t3.prod_attr_id is null
    - |
      insert into cpc.prod_attr_value
        (prod_attr_value_id,
         prod_attr_id,
         apply_region_id,
         status_cd,
         create_staff,
         update_staff,
         create_date,
         status_date,
         update_date,
         attr_value_id)
        select cpc.seq_prod_attr_value.nextval,
               t1.prod_attr_id,
               t1.APPLY_REGION_ID,
               1000,
               %(default_create_user)s,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               sysdate,
               t2.attr_value_id
          from cpc.prod_attr t1
         inner join DC_CONFIG_ATTRIBUTE_DETAIL t4
            on t1.attr_id = t4.attr_id
         inner join cpc.attr_value t2
            on t1.attr_id = t2.attr_id
           and t2.status_cd = '1000'
          left join cpc.prod_attr_value t3
            on t1.prod_attr_id = t3.prod_attr_id
         where t3.prod_attr_id is null

  update_DC_CONFIG_PROD_BASIC_INFO:
    - |
      update cpc.product t1
         set (prod_nbr,
              prod_name,
              prod_desc,
              eff_date,
              exp_date,
              prod_comp_type,
              prod_func_type,
              update_date,
              grp_prod_nbr) =
             (select nvl(tt1.prod_nbr, tt2.prod_nbr),
                     tt1.prod_name,
                     tt1.prod_desc,
                     nvl(to_date(tt1.EFF_DATE,%(default_date_format)s), tt2.EFF_DATE),
                     nvl(to_date(tt1.EXP_DATE,%(default_date_format)s), tt2.EXP_DATE),
                     tt3.attr_value,
                     tt4.attr_value,
                     sysdate,
                     nvl(tt1.INTERNAL_NBR,tt2.grp_prod_nbr)
                from cpc.dc_config_prod_basic_info tt1
               inner join cpc.product tt2
                  on tt1.new_prod_id = tt2.prod_id
                left join cpc.attr_value tt3
                  on tt1.prod_comp_type = trim(tt3.attr_value_name)
                 and tt3.attr_id = 800052187
                 and tt3.status_cd = '1000'
                left join cpc.attr_value tt4
                  on tt1.prod_func_type = trim(tt4.attr_value_name)
                 and tt4.attr_id = 800052188
                 and tt4.status_cd = '1000'
               where t1.prod_id = tt2.prod_id)
       where t1.prod_id in
             (select new_prod_id from cpc.dc_config_prod_basic_info)

  insert_DC_CONFIG_PROD_REL:
    - |
      insert into cpc.PROD_REL
        (PROD_REL_ID,
         REL_TYPE,
         ROLE_ID,
         EFF_DATE,
         EXP_DATE,
         APPLY_REGION_ID,
         STATUS_CD,
         CREATE_STAFF,
         CREATE_DATE,
         A_PROD_ID,
         Z_PROD_ID)
        select cpc.SEQ_PROD_REL.NEXTVAL,
               t4.attr_value,
               nvl(t5.role_id,%(default_prod_rel_role)s),
               nvl(to_date(t1.EFF_DATE,%(default_date_format)s),%(default_eff_date)s),
               nvl(to_date(t1.EXP_DATE,%(default_date_format)s),%(default_exp_date)s),
               %(default_apply_region_id)s,
               '1000',
               %(default_create_user)s,
               %(default_create_date)s,
               t2.prod_id,
               t3.prod_id
          from DC_CONFIG_PROD_REL t1
         inner join cpc.product t2
            on t1.source_prod_name = t2.prod_name
         inner join cpc.product t3
            on t1.des_prod_name = t3.prod_name
         inner join cpc.attr_value t4
            on t1.rel_type = trim(t4.attr_value_name)
           and t4.attr_id = 800052191
           and t4.status_cd = '1000'
          left join cpc.prod_rel_role t5
            on t5.role_name = t1.PROD_REL_ROLE_NAME
          left join cpc.PROD_REL t7
            on t2.prod_id = t7.a_prod_id
           and t3.prod_id = t7.z_prod_id
           and t4.attr_value = t7.rel_type
         where t7.prod_rel_id is null

  update_DC_CONFIG_PROD_REL:
    - |
      update cpc.PROD_REL tt1
         set update_date = sysdate,
             (ROLE_ID, EFF_DATE, EXP_DATE) =
             (select nvl(t5.role_id, t7.role_id),
                     nvl(to_date(t1.EFF_DATE,%(default_date_format)s), t7.eff_date),
                     nvl(to_date(t1.EXP_DATE,%(default_date_format)s), t7.EXP_DATE)
                from DC_CONFIG_PROD_REL t1
               inner join cpc.product t2
                  on t1.source_prod_name = t2.prod_name
               inner join cpc.product t3
                  on t1.des_prod_name = t3.prod_name
               inner join cpc.attr_value t4
                  on t1.rel_type = trim(t4.attr_value_name)
                 and t4.status_cd = '1000'
                 and t4.attr_id=800052191
                left join cpc.prod_rel_role t5
                  on t5.role_name = t1.PROD_REL_ROLE_NAME
               inner join cpc.PROD_REL t7
                  on t2.prod_id = t7.a_prod_id
                 and t3.prod_id = t7.z_prod_id
                 and t4.attr_value = t7.rel_type
               where t7.prod_rel_id = tt1.prod_rel_id)
       where (a_prod_id, z_prod_id, rel_type) in
             (select t2.prod_id, t3.prod_id, t4.attr_value
                from DC_CONFIG_PROD_REL t1
               inner join cpc.product t2
                  on t1.source_prod_name = t2.prod_name
               inner join cpc.product t3
                  on t1.des_prod_name = t3.prod_name
               inner join cpc.attr_value t4
                  on t1.rel_type = trim(t4.attr_value_name)
                 and t4.attr_id=800052191
                 and t4.status_cd = '1000')

  insert_DC_CONFIG_PRICE_PLAN_BASIC_INFO:
    - |
      insert into cpc.price_plan
        (price_plan_id,
         price_plan_code,
         price_plan_name,
         apply_level,
         price_plan_type,
         price_plan_genre,
         priority,
         lock_flag,
         state,
         price_plan_exit,
         active_date,
         active_staff_id,
         policy_plan_flag)
        select t2.price_plan_id,
               substr(regexp_replace(T2.PRICE_PLAN_NAME, '[^A-Za-z0-9]+', '_'),0,58)||substr(t2.price_plan_id,-2),
               t2.PRICE_PLAN_NAME,
               nvl(t5.apply_level,%(default_price_plan_apply_level)s),
               nvl(t3.price_plan_type,%(default_price_plan_type)s),
               nvl(t4.price_plan_genre,%(default_price_plan_genre)s),
               nvl(t2.priority,total_cnt+rownum),
               'N',
               'A',
               t2.price_plan_exit,
               %(default_create_date)s,
               %(default_create_user)s,
               'N'
          from dc_config_price_plan_basic_info t2
          left join cpc.price_plan_type t3
            on t2.price_plan_type = t3.price_plan_type_name
          left join cpc.price_plan_genre t4
            on t4.genre_name = t2.price_plan_genre
          left join cpc.apply_level t5
            on t5.apply_level_name = t2.apply_level
          left join cpc.price_plan t6
            on t2.price_plan_name = t6.price_plan_name
            or t2.price_plan_id = t6.price_plan_id
          left join (select count(*) total_cnt
                       from cpc.price_plan
                      where price_plan_type = 3
                        and policy_plan_flag = 'N') t7
            on 1=1
         where t6.price_plan_code is null
    - |
      insert into cpc.price_plan_ver
        (price_plan_ver_id,
         price_plan_id,
         seq,
         eff_date,
         using_state,
         state,
         created_date,
         created_staff_id,
         release_date,
         release_staff_id,
         submit_date,
         submit_staff_id,
         approved_date,
         approved_staff_id)
        select cpc.price_plan_ver_id_seq.nextval,
               t1.price_plan_id,
               1,
               %(default_eff_date)s,
               'A',
               'D',
               %(default_create_date)s,
               %(default_create_user)s,
               %(default_create_date)s,
               %(default_create_user)s,
               %(default_create_date)s,
               %(default_create_user)s,
               %(default_create_date)s,
               %(default_create_user)s
          from cpc.price_plan t1
          left join cpc.price_plan_ver t2
            on t1.price_plan_id = t2.price_plan_id
         where t2.price_plan_ver_id is null

    - |
      insert into cpc.price_set
        (price_set_id, apply_level, price_set_priority_id, priority)
        select cpc.price_set_id_seq.nextval, t4.apply_level, 10000, 1
          from cpc.price_plan_ver t1
         inner join cpc.price_plan t4
            on t1.price_plan_id = t4.price_plan_id
          left join cpc.price_plan_member t2
            on t1.price_plan_ver_id = t2.price_plan_ver_id
          left join cpc.price_set t3
            on t3.price_set_id = t2.price_set_id
         where t3.price_set_id is null

    - |
      insert into cpc.price_plan_member
        (price_plan_ver_id, price_set_id, created_date)
        select t1.price_plan_ver_id, t2.price_set_id, %(default_create_date)s
          from (select t1.price_plan_ver_id, rownum row_count
                  from cpc.price_plan_ver t1
                  left join cpc.price_plan_member t2
                    on t1.price_plan_ver_id = t2.price_plan_ver_id
                 where t2.price_set_id is null
                   order by t1.price_plan_ver_id) t1
          left join (select t1.price_set_id, rownum row_count
                       from cpc.price_set t1
                       left join cpc.price_plan_member t2
                         on t1.price_set_id = t2.price_set_id
                      where t2.price_set_id is null
                        order by t1.price_set_id) t2
            on t1.row_count = t2.row_count

  insert_dc_config_prod_charging_product:
    - |
      insert into cpc.tariff_plan
        (tariff_plan_id,
         tariff_plan_name,
         tariff_plan_code,
         CREATED_DATE,
         state,
         tariff_plan_type,
         state_date,
         active_date)
        select cpc.tariff_plan_id_seq.nextval,
               t1.prod_name,
               substr(regexp_replace(t1.prod_name, '[^A-Za-z0-9]+', '_'),0,58)||substr(cpc.tariff_plan_id_seq.currval,-2),
               %(default_create_date)s,
               'B',
               'B',
               sysdate,
               %(default_create_date)s
          from dc_config_prod_basic_info t1
          left join cpc.tariff_plan t2
            on t1.prod_name = t2.tariff_plan_name
         where t2.tariff_plan_name is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.offer
        (create_date,
         create_staff,
         update_date,
         offer_id,
         offer_type,
         offer_sys_type,
         offer_name,
         offer_sys_name,
         offer_nbr,
         offer_sys_nbr,
         offer_desc,
         eff_date,
         manage_grade,
         exp_date,
         offer_provider_id,
         brand_id,
         value_added_flag,
         initial_cred_value,
         pricing_plan_id,
         is_independent,
         manage_region_id,
         status_cd,
         main_flag,
         priority_value,
         offer_grade)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               t1.new_prod_id,
               '12',
               '1200',
               t1.prod_name,
               t1.prod_name,
               nvl(t1.prod_nbr, cpc.seq_offer_sys_nbr.nextval),
               nvl(t1.prod_nbr, cpc.seq_offer_sys_nbr.currval),
               t1.prod_name || 'charging offer',
               nvl(to_date(t1.EFF_DATE,%(default_date_format)s), %(default_eff_date)s),
               '12',
               nvl(to_date(t1.EXP_DATE,%(default_date_format)s), %(default_exp_date)s),
               '10',
               null,
               '9',
               0,
               t5.tariff_plan_id,
               0,
               %(default_apply_region_id)s,
               '1000',
               0,
               5,
               0
          from DC_CONFIG_PROD_BASIC_INFO t1
          left join cpc.offer t2
            on t1.prod_name = t2.offer_name
            or t1.new_prod_id = t2.offer_id
          left join cpc.tariff_plan t5
            on t1.prod_name = t5.tariff_plan_name
         where t2.offer_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.offer_catalog_location
        (create_date,
         create_staff,
         update_date,
         offer_cat_loc_id,
         offer_id,
         catalog_item_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_cat_loc.nextval,
               t2.offer_id,
               t3.catalog_item_id,
               1000
          from DC_CONFIG_PROD_BASIC_INFO t1
         inner join cpc.offer t2
            on t1.prod_name = t2.offer_name
           and t1.new_prod_id = t2.offer_id
           and t2.offer_type='12'
         inner join cpc.catalog_item t3
            on %(default_offer_catalog)s = t3.catalog_item_name
           and t3.catalog_id = 871
          left join cpc.offer_catalog_location t4
            on t2.offer_id = t4.offer_id
         where t4.offer_cat_loc_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.offer_service_rel
        (create_date,
         create_staff,
         update_date,
         offer_serv_rel_id,
         offer_id,
         service_offer_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_service_rel.nextval,
               t3.offer_id,
               t4.service_offer_id,
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_PROD_BASIC_INFO t1
         inner join cpc.offer t3
            on t1.prod_name = t3.offer_name
           and t1.new_prod_id = t3.offer_id
           and t3.offer_type='12'
         inner join cpc.service_offer t4
            on t4.service_offer_name in
               (%(default_service_offer)s)
          left join cpc.offer_service_rel t5
            on t3.offer_id = t5.offer_id
           and t4.service_offer_id = t5.service_offer_id
         where t5.offer_serv_rel_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.offer_prod_rel
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_id,
         offer_id,
         prod_id,
         rel_type,
         prod_exist_type,
         role_id,
         apply_region_id,
         status_cd,
         par_offer_prod_rel_id,
         remark)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_obj_rel.nextval,
               t3.offer_id,
               t5.a_prod_id,
               '1000',
               '1200',
               t6.role_id,
               %(default_apply_region_id)s,
               1000,
                -1,
               'Default Selection'
          from DC_CONFIG_PROD_BASIC_INFO t1
          inner join cpc.offer t3
            on t1.prod_name = t3.offer_name
           and t1.new_prod_id = t3.offer_id
           and t3.offer_type='12'
          inner join cpc.prod_rel t5
            on t1.new_prod_id = t5.z_prod_id
           and t5.rel_type = 100600
          inner join cpc.offer_obj_rel t6
             on t6.obj_id = t5.a_prod_id
          inner join cpc.offer t7
             on t7.offer_id = t6.offer_id
            and t7.offer_type = '10'
            and t7.status_cd = '1000'
          left join cpc.offer_prod_rel t4
            on t3.offer_id = t4.offer_id
           and t4.prod_id = t5.a_prod_id
           and t4.par_offer_prod_rel_id = -1
         where t4.offer_prod_rel_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.offer_prod_rel
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_id,
         offer_id,
         prod_id,
         rel_type,
         prod_exist_type,
         role_id,
         apply_region_id,
         status_cd,
         par_offer_prod_rel_id,
         remark)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_obj_rel.nextval,
               t3.offer_id,
               t1.new_prod_id,
               t2.rel_type,
               t2.prod_exist_type,
               t2.role_id,
               %(default_apply_region_id)s,
               1000,
                t2.offer_prod_rel_id,
               'Required'
          from DC_CONFIG_PROD_BASIC_INFO t1
          inner join cpc.offer t3
            on t1.prod_name = t3.offer_name
           and t1.new_prod_id = t3.offer_id
           and t3.offer_type='12'
         inner join cpc.prod_rel t5
            on t1.new_prod_id = t5.z_prod_id
           and t5.rel_type = 100600
         inner join cpc.offer_prod_rel t2
            on t5.a_prod_id = t2.prod_id
           and t3.offer_id = t2.offer_id
           and t2.par_offer_prod_rel_id = -1
          left join cpc.offer_prod_rel t4
            on t3.offer_id = t4.offer_id
           and t4.prod_id = t1.new_prod_id
           and t2.offer_prod_rel_id = t4.par_offer_prod_rel_id
           and t4.remark = 'Required'
         where t4.offer_prod_rel_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.offer_prod_rel
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_id,
         offer_id,
         prod_id,
         rel_type,
         prod_exist_type,
         role_id,
         apply_region_id,
         status_cd,
         par_offer_prod_rel_id,
         remark)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_obj_rel.nextval,
               t3.offer_id,
               t1.new_prod_id,
               t2.rel_type,
               t2.prod_exist_type,
               t2.role_id,
               %(default_apply_region_id)s,
               1000,
                t2.offer_prod_rel_id,
               'The function product is canceled forcibly when dismantled'
          from DC_CONFIG_PROD_BASIC_INFO t1
          inner join cpc.offer t3
            on t1.prod_name = t3.offer_name
           and t1.new_prod_id = t3.offer_id
           and t3.offer_type='12'
         inner join cpc.prod_rel t5
            on t1.new_prod_id = t5.z_prod_id
           and t5.rel_type = 100600
         inner join cpc.offer_prod_rel t2
            on t5.a_prod_id = t2.prod_id
           and t3.offer_id = t2.offer_id
           and t2.par_offer_prod_rel_id = -1
          left join cpc.offer_prod_rel t4
            on t3.offer_id = t4.offer_id
           and t4.prod_id = t1.new_prod_id
           and t2.offer_prod_rel_id = t4.par_offer_prod_rel_id
           and t4.remark = 'The function product is canceled forcibly when dismantled'
         where t4.offer_prod_rel_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.offer_obj_rel
        (create_date,
         create_staff,
         update_date,
         offer_obj_rel_id,
         offer_id,
         obj_type,
         obj_id,
         role_id,
         status_cd,
         apply_region_id,
         max_num,
         min_num,
         default_count,
         offer_object_name)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               t1.offer_prod_rel_id,
               t1.offer_id,
               '100000',
               t1.prod_id,
               t1.role_id,
               '1000',
               t1.apply_region_id,
               1,
               0,
               1,
               t3.prod_name
          from cpc.offer_prod_rel t1
          left join cpc.product t3
            on t1.prod_id = t3.prod_id
          left join cpc.offer_obj_rel t2
            on t1.offer_prod_rel_id = t2.offer_obj_rel_id
         where t2.offer_obj_rel_id is null

    - |
      insert into cpc.offer_prod_rel_rstr_cfg
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_cfg_id,
         offer_prod_rel_id,
         prod_id,
         default_count,
         rstr_type,
         min_num,
         max_num,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_prod_rel_rstr_cfg.nextval,
               t1.offer_prod_rel_id,
               t1.prod_id,
               1,
               t3.attr_value,
               1,
               1,
               t1.apply_region_id,
               1000
          from cpc.offer_prod_rel t1
          left join cpc.offer_prod_rel_rstr_cfg t2
            on t1.offer_prod_rel_id = t2.offer_prod_rel_id
          left join cpc.attr_value t3
            on t1.remark = trim(t3.attr_value_name)
           and t3.attr_id = 800052231
           and t3.status_cd = '1000'
         where t2.offer_prod_rel_id is null
           and t1.remark is not null

    - |
      insert into cpc.product_offer_detail_base
        (offer_base_id,
         offer_prod_rela_id,
         prod_offer_id,
         default_flag,
         oper_date)
        select cpc.seq_offer_base_id.nextval,
               t1.offer_prod_rel_id,
               t3.offer_id,
               'T',
               sysdate
          from cpc.offer_prod_rel t1
         inner join cpc.offer_obj_rel t2
            on t1.prod_id = t2.obj_id
         inner join cpc.offer t3
            on t2.offer_id = t3.offer_id
           and t3.offer_type = 10
          left join cpc.product_offer_detail_base t4
            on t4.offer_prod_rela_id = t1.offer_prod_rel_id
         where t1.par_offer_prod_rel_id = -1
           and t4.offer_base_id is null

    - |
      insert into cpc.offer_restrict
        (create_date,
         create_staff,
         update_date,
         offer_restrict_id,
         offer_id,
         rstr_obj_type,
         rstr_obj_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_restrict_id.nextval,
               T5.OFFER_ID,
               '3000',
               nvl(t3.common_region_id, %(default_apply_region_id)s),
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_PROD_BASIC_INFO t1
          left join dc_config_prod_area t2
            on t1.prod_name = t2.prod_name
          left join ftf.common_region t3
            on t2.AREA = t3.region_name
         inner join cpc.offer t5
            on t1.prod_name = t5.offer_name
           and t1.new_prod_id = t5.offer_id
           and t5.offer_type='12'
          left join cpc.offer_restrict t6
            on t5.offer_id = t6.offer_id
           and %(default_apply_region_id)s = t6.rstr_obj_id
           and t6.rstr_obj_type = 3000
         where t6.offer_restrict_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.offer_restrict
        (create_date,
         create_staff,
         update_date,
         offer_restrict_id,
         offer_id,
         rstr_obj_type,
         rstr_obj_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_restrict_id.nextval,
               T5.OFFER_ID,
               '2100',
               t2.org_id,
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_PROD_BASIC_INFO t1
         inner join cpc.offer t5
            on t1.prod_name = t5.offer_name
           and t5.offer_type = '12'
         inner join cpc.channel_type t2
            on t2.channel_name in (%(default_channel_type)s)
          left join cpc.offer_restrict t6
            on t5.offer_id = t6.offer_id
           and t2.org_id = t6.rstr_obj_id
           and t6.rstr_obj_type = 2100
         where t6.offer_restrict_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.offer_eff_exp_config
        (create_date,
         create_staff,
         update_date,
         offer_eff_exp_config_id,
         offer_id,
         service_offer_id,
         prod_exist_type,
         eff_base_type,
         eff_type,
         trial_type,
         trial_period_unit,
         apply_region_id,
         status_cd,
         is_default,
         attr_id,
         eff_date)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_eff_exp_config.nextval,
               t3.offer_id,
               t4.service_offer_id,
               '1100',
               '1000',
               %(default_offer_eff_type)s,
               0,
               1000,
               %(default_apply_region_id)s,
               1000,
               0,
               -1,
               null
          from DC_CONFIG_PROD_BASIC_INFO t1
         inner join cpc.offer t3
            on t1.prod_name = t3.offer_name
           and t1.new_prod_id = t3.offer_id
           and t3.offer_type='12'
          left join cpc.service_offer t4
            on t4.service_offer_name in
               ('Unsubscribe Offer', 'Modify Offer')
          left join cpc.offer_eff_exp_config t8
            on t3.offer_id = t8.offer_id
           and t8.service_offer_id = t4.service_offer_id
         where t8.offer_eff_exp_config_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'
    - |
      insert into cpc.offer_eff_exp_config
        (create_date,
         create_staff,
         update_date,
         offer_eff_exp_config_id,
         offer_id,
         service_offer_id,
         prod_exist_type,
         eff_base_type,
         eff_type,
         period_time_type,
         period_unit,
         period_time,
         trial_type,
         trial_period_unit,
         apply_region_id,
         status_cd,
         is_default,
         attr_id,
         eff_date,
         exp_date)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_eff_exp_config.nextval,
               t3.offer_id,
               t4.service_offer_id,
               %(default_existing_type)s,
               %(default_eff_base_type)s,
               %(default_offer_eff_type)s,
               %(default_period_time_type)s,
               case
                 when %(default_period_time_type)s = 1000 then
                  regexp_substr(%(default_eff_period)s, '\d*')
               end,
               case
                 when %(default_period_time_type)s = 1000 then
                  t6.attr_value
               end,
               0,
               1000,
               %(default_apply_region_id)s,
               1000,
               0,
               -1,
               case
                 when %(default_period_time_type)s = 1100 then
                  trunc(sysdate)
               end,
               case
                 when %(default_period_time_type)s = 1100 then
                  to_date(%(default_eff_period)s, 'yyyymmdd')
               end
          from DC_CONFIG_PROD_BASIC_INFO t1
         inner join cpc.offer t3
            on t1.prod_name = t3.offer_name
           and t1.new_prod_id = t3.offer_id
           and t3.offer_type='12'
          left join cpc.service_offer t4
            on t4.service_offer_name in ('Order Offer')
          left join cpc.attr_value t6
            on instr(%(default_eff_period)s,trim(t6.attr_value_name))>1
           and t6.status_cd = '1000'
          left join cpc.offer_eff_exp_config t8
            on t3.offer_id = t8.offer_id
           and t8.service_offer_id = t4.service_offer_id
         where t8.offer_eff_exp_config_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.offer_exp_cfg
        (offer_exp_cfg_id,
         offer_id,
         deal_type,
         eff_date,
         exp_date,
         apply_region_id,
         status_cd,
         create_staff,
         create_date,
         update_date)
        select cpc.seq_offer_exp_cfg.nextval,
               t3.offer_id,
               30,
               %(default_eff_date)s,
               %(default_exp_date)s,
               %(default_apply_region_id)s,
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate
          from DC_CONFIG_PROD_BASIC_INFO T1
         inner join cpc.offer t3
            on t1.prod_name = t3.offer_name
           and t1.new_prod_id = t3.offer_id
           and t3.offer_type='12'
          left join cpc.offer_exp_cfg t4
            on t3.offer_id = t4.offer_id
         where t4.offer_exp_cfg_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.price_plan
        (price_plan_id,
         price_plan_code,
         price_plan_name,
         apply_level,
         price_plan_type,
         price_plan_genre,
         priority,
         lock_flag,
         state,
         price_plan_exit,
         active_date,
         active_staff_id,
         policy_plan_flag)
        select t1.new_prod_id,
               substr(regexp_replace(t1.prod_name, '[^A-Za-z0-9]+', '_'),0,58)||substr(t1.new_prod_id,-2),
               t1.prod_name,
               'S',
               3,
               'A',
               rownum+total_cnt,
               'N',
               'A',
               'N',
               %(default_create_date)s,
               %(default_create_user)s,
               'N'
          from dc_config_prod_basic_info t1
          left join cpc.price_plan t3
            on t1.prod_name = t3.price_plan_name
            or t1.new_prod_id = t3.price_plan_id
          left join (select offer_name
                       from DC_CONFIG_OFFER_PRICE_PLAN_REL
                      group by offer_name)t2
            on t1.prod_name = t2.offer_name
          left join DC_CONFIG_PRICE_PLAN_BASIC_INFO t5
            on t5.price_plan_name = t1.prod_name
           and t1.new_prod_id = t5.price_plan_id
          left join (select count(*) total_cnt
                       from cpc.price_plan
                      where price_plan_type = 3
                        and policy_plan_flag = 'N')t4
            on 1=1
         where t3.price_plan_name is null
           and t2.offer_name is null
           and t5.price_plan_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'
    - |
      insert into cpc.price_plan_ver
        (price_plan_ver_id,
         price_plan_id,
         seq,
         eff_date,
         using_state,
         state,
         created_date,
         created_staff_id,
         release_date,
         release_staff_id,
         submit_date,
         submit_staff_id,
         approved_date,
         approved_staff_id)
        select cpc.price_plan_ver_id_seq.nextval,
               t1.price_plan_id,
               1,
               %(default_eff_date)s,
               'A',
               'D',
               %(default_create_date)s,
               %(default_create_user)s,
               %(default_create_date)s,
               %(default_create_user)s,
               %(default_create_date)s,
               %(default_create_user)s,
               %(default_create_date)s,
               %(default_create_user)s
          from cpc.price_plan t1
          left join cpc.price_plan_ver t2
            on t1.price_plan_id = t2.price_plan_id
         where t2.price_plan_ver_id is null
    - |
      insert into cpc.price_set
        (price_set_id, apply_level, price_set_priority_id, priority)
        select cpc.price_set_id_seq.nextval, 'S', 10000, 1
          from cpc.price_plan_ver t1
          left join cpc.price_plan_member t2
            on t1.price_plan_ver_id = t2.price_plan_ver_id
          left join cpc.price_set t3
            on t3.price_set_id = t2.price_set_id
         where t3.price_set_id is null
    - |
      insert into cpc.price_plan_member
        (price_plan_ver_id, price_set_id, created_date)
        select t1.price_plan_ver_id, t2.price_set_id, %(default_create_date)s
          from (select t1.price_plan_ver_id, rownum row_count
                  from cpc.price_plan_ver t1
                  left join cpc.price_plan_member t2
                    on t1.price_plan_ver_id = t2.price_plan_ver_id
                 where t2.price_set_id is null
                   order by t1.price_plan_ver_id) t1
          left join (select t1.price_set_id, rownum row_count
                       from cpc.price_set t1
                       left join cpc.price_plan_member t2
                         on t1.price_set_id = t2.price_set_id
                      where t2.price_set_id is null
                        order by t1.price_set_id) t2
            on t1.row_count = t2.row_count

  update_dc_config_prod_charging_product:
    - |
      update cpc.offer tt1
         set (offer_name, offer_nbr, eff_date, exp_date) =
             (select prod_name,
                     coalesce(t1.prod_nbr, t2.offer_nbr),
                     nvl(to_date(t1.EFF_DATE, %(default_date_format)s),
                         t2.EFF_DATE),
                     nvl(to_date(t1.EXP_DATE, %(default_date_format)s),
                         t2.EXP_DATE)
                from dc_config_prod_basic_info t1
               inner join cpc.offer t2
                  on t1.new_prod_id = t2.offer_id
               where tt1.offer_id = t1.new_prod_id
                 and t1.IS_CHARGE_FUNC_PROD = 'Y')
       where tt1.offer_id in
             (select new_prod_id
                from dc_config_prod_basic_info
               where IS_CHARGE_FUNC_PROD = 'Y')

  insert_DC_CONFIG_OFFER_BASIC_INFO:
    - |
      insert into cpc.tariff_plan
        (tariff_plan_id,
         tariff_plan_name,
         tariff_plan_code,
         CREATED_DATE,
         state,
         tariff_plan_type,
         state_date,
         active_date)
        select cpc.tariff_plan_id_seq.nextval,
               t1.offer_name,
               substr(regexp_replace(t1.offer_name, '[^A-Za-z0-9]+', '_'),0,58)||substr(cpc.tariff_plan_id_seq.currval,-2),
               %(default_create_date)s,
               'B',
               'B',
               sysdate,
               %(default_create_date)s
          from dc_config_offer_basic_info t1
          left join cpc.tariff_plan t2
            on t1.offer_name = t2.tariff_plan_name
         where t2.tariff_plan_name is null
           and t1.offer_type <> 'Basic Offer'

    - |
      insert into cpc.offer
        (create_date,
         create_staff,
         update_date,
         offer_id,
         offer_type,
         offer_sys_type,
         offer_name,
         offer_sys_name,
         offer_nbr,
         offer_sys_nbr,
         offer_desc,
         eff_date,
         manage_grade,
         exp_date,
         offer_provider_id,
         brand_id,
         value_added_flag,
         initial_cred_value,
         pricing_plan_id,
         is_independent,
         manage_region_id,
         status_cd,
         main_flag,
         priority_value,
         offer_grade)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               t1.new_offer_id,
               t3.attr_value,
               case when t3.attr_value = '11' then '1000' else '1200' end,
               t1.offer_name,
               t1.offer_name,
               nvl(t1.offer_nbr, cpc.seq_offer_sys_nbr.nextval),
               nvl(t1.offer_nbr, cpc.seq_offer_sys_nbr.currval),
               t1.OFFER_DESC,
               nvl(to_date(t1.EFF_DATE,%(default_date_format)s), %(default_eff_date)s),
               '12',
               nvl(to_date(t1.EXP_DATE,%(default_date_format)s), %(default_exp_date)s),
               '10',
               t4.brand_id,
               '9',
               0,
               case when t3.attr_value not in ('10') then t5.tariff_plan_id else 920051445 end,
               case
                 when t3.attr_value in ('12', '10') then
                  0
                 else
                  1
               end,
               %(default_apply_region_id)s,
               nvl(t6.key_value,'1000'),
               case
                 when t3.attr_value in ('11') then
                  1
                 else
                  0
               end,
               nvl(t1.PRIORITY_VALUE,
                   case
                     when t3.attr_value = '10' then
                      9
                     when t3.attr_value = '11' then
                      7
                     when t3.attr_value = '12' then
                      5
                     else
                      3
                   end),
               nvl(to_number(t1.offer_grade),0)
          from DC_CONFIG_OFFER_BASIC_INFO t1
          left join cpc.offer t2
            on t1.offer_name = t2.offer_name
            or t1.new_offer_id = t2.offer_id
          left join cpc.attr_value t3
            on t3.attr_id = 800052220
           and trim(t3.attr_value_name) = t1.OFFER_TYPE
           and t3.status_cd = '1000'
          left join cpc.brand t4
            on t1.BRAND_NAME = t4.brand_name
          left join cpc.tariff_plan t5
            on t1.offer_name = t5.tariff_plan_name
          left join dc_dim_cpc_dict t6
            on t1.offer_state = t6.key_name
           and t6.dict_name = 'OFFER STATE'
         where t2.offer_id is null

    - |
      insert into cpc.offer_catalog_location
        (create_date,
         create_staff,
         update_date,
         offer_cat_loc_id,
         offer_id,
         catalog_item_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_cat_loc.nextval,
               t2.offer_id,
               t3.catalog_item_id,
               1000
          from DC_CONFIG_OFFER_BASIC_INFO t1
         inner join cpc.offer t2
            on t1.offer_name = t2.offer_name
         inner join cpc.catalog_item t3
            on nvl(t1.catalog_item_name,%(default_offer_catalog)s) = t3.catalog_item_name
           and t3.catalog_id = 871
          left join cpc.offer_catalog_location t4
            on t2.offer_id = t4.offer_id
         where t4.offer_cat_loc_id is null
    - |
      insert into cpc.offer_payment_mode
        (create_date,
         create_staff,
         update_date,
         offer_payment_mode_id,
         offer_id,
         payment_mode_cd,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_payment_mode.nextval,
               t2.offer_id,
               t4.attr_value,
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_OFFER_BASIC_INFO t1
         inner join cpc.offer t2
            on t1.offer_name = t2.offer_name
          left join cpc.attr_value t4
            on t1.payment_mode = trim(t4.attr_value_name)
           and t4.attr_id = 990000002
           and t4.status_cd = '1000'
          left join cpc.offer_payment_mode t3
            on t2.offer_id = t3.offer_id
         where t3.offer_id is null
           and t1.payment_mode is not null
    - |
      insert into cpc.offer_service_rel
        (create_date,
         create_staff,
         update_date,
         offer_serv_rel_id,
         offer_id,
         service_offer_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_service_rel.nextval,
               t3.offer_id,
               t4.service_offer_id,
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_OFFER_BASIC_INFO t1
          left join DC_CONFIG_OFFER_SERVICE t2
            on t1.offer_name = t2.offer_name
         inner join cpc.offer t3
            on t1.offer_name = t3.offer_name
         inner join cpc.service_offer t4
            on t4.service_offer_name in
               (%(default_service_offer)s)
          left join cpc.offer_service_rel t5
            on t3.offer_id = t5.offer_id
           and t4.service_offer_id = t5.service_offer_id
         where t5.offer_serv_rel_id is null
           and t2.offer_name is null

    - |
      insert into cpc.offer_prod_rel
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_id,
         offer_id,
         prod_id,
         rel_type,
         prod_exist_type,
         role_id,
         apply_region_id,
         status_cd,
         par_offer_prod_rel_id,
         remark)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_obj_rel.nextval,
               t3.offer_id,
               %(default_access_prod)s,
               '1000',
               '1200',
               %(default_offer_prod_rel_role)s,
               %(default_apply_region_id)s,
               1000,
                -1,
               'Default Selection'
          from DC_CONFIG_OFFER_BASIC_INFO t1
          left join DC_CONFIG_OFFER_PROD_REL t2
            on t1.offer_name = T2.offer_name
          inner join cpc.offer t3
            on t1.offer_name = t3.offer_name
          left join cpc.offer_prod_rel t4
            on t3.offer_id = t4.offer_id
         where t4.offer_prod_rel_id is null
           and t2.offer_name is null

    - |
      insert into cpc.offer_obj_rel
        (create_date,
         create_staff,
         update_date,
         offer_obj_rel_id,
         offer_id,
         obj_type,
         obj_id,
         role_id,
         status_cd,
         apply_region_id,
         max_num,
         min_num,
         default_count,
         offer_object_name)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               t1.offer_prod_rel_id,
               t1.offer_id,
               '100000',
               t1.prod_id,
               t1.role_id,
               '1000',
               t1.apply_region_id,
               1,
               0,
               1,
               t3.prod_name
          from cpc.offer_prod_rel t1
          left join cpc.product t3
            on t1.prod_id = t3.prod_id
          left join cpc.offer_obj_rel t2
            on t1.offer_prod_rel_id = t2.offer_obj_rel_id
         where t2.offer_obj_rel_id is null

    - |
      insert into cpc.offer_prod_rel_rstr_cfg
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_cfg_id,
         offer_prod_rel_id,
         prod_id,
         default_count,
         rstr_type,
         min_num,
         max_num,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_prod_rel_rstr_cfg.nextval,
               t1.offer_prod_rel_id,
               t1.prod_id,
               1,
               t3.attr_value,
               1,
               1,
               t1.apply_region_id,
               1000
          from cpc.offer_prod_rel t1
          left join cpc.offer_prod_rel_rstr_cfg t2
            on t1.offer_prod_rel_id = t2.offer_prod_rel_id
          left join cpc.attr_value t3
            on t1.remark = trim(t3.attr_value_name)
           and t3.attr_id = 800052231
           and t3.status_cd = '1000'
         where t2.offer_prod_rel_id is null
           and t1.remark is not null

    - |
      insert into cpc.product_offer_detail_base
        (offer_base_id,
         offer_prod_rela_id,
         prod_offer_id,
         default_flag,
         oper_date)
        select cpc.seq_offer_base_id.nextval,
               t1.offer_prod_rel_id,
               t3.offer_id,
               'T',
               sysdate
          from cpc.offer_prod_rel t1
         inner join cpc.offer_obj_rel t2
            on t1.prod_id = t2.obj_id
         inner join cpc.offer t3
            on t2.offer_id = t3.offer_id
           and t3.offer_type = 10
          left join cpc.product_offer_detail_base t4
            on t4.offer_prod_rela_id = t1.offer_prod_rel_id
         where t1.par_offer_prod_rel_id = -1
           and t4.offer_base_id is null

    - |
      insert into cpc.offer_restrict
        (create_date,
         create_staff,
         update_date,
         offer_restrict_id,
         offer_id,
         rstr_obj_type,
         rstr_obj_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_restrict_id.nextval,
               T5.OFFER_ID,
               '3000',
               nvl(t3.common_region_id, %(default_apply_region_id)s),
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_OFFER_BASIC_INFO t1
          left join DC_CONFIG_OFFER_SALES_AREA t2
            on t1.offer_name = t2.offer_name
           and t2.area_type = 'operator'
          left join ftf.common_region t3
            on t2.AREA_NAME = t3.region_name
         inner join cpc.offer t5
            on t1.offer_name = t5.offer_name
          left join cpc.offer_restrict t6
            on t5.offer_id = t6.offer_id
           and %(default_apply_region_id)s = t6.rstr_obj_id
           and t6.rstr_obj_type = 3000
         where t6.offer_restrict_id is null
           and t2.offer_name is null

    - |
      insert into cpc.offer_restrict
        (create_date,
         create_staff,
         update_date,
         offer_restrict_id,
         offer_id,
         rstr_obj_type,
         rstr_obj_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_restrict_id.nextval,
               T5.OFFER_ID,
               '2100',
               t2.org_id,
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_OFFER_BASIC_INFO t1
         inner join cpc.offer t5
            on t1.offer_name = t5.offer_name
         inner join cpc.channel_type t2
            on t2.channel_name in (%(default_channel_type)s)
          left join cpc.offer_restrict t6
            on t5.offer_id = t6.offer_id
           and t2.org_id = t6.rstr_obj_id
           and t6.rstr_obj_type = 2100
         where t6.offer_restrict_id is null

    - |
      insert into cpc.offer_eff_exp_config
        (create_date,
         create_staff,
         update_date,
         offer_eff_exp_config_id,
         offer_id,
         service_offer_id,
         prod_exist_type,
         eff_base_type,
         eff_type,
         trial_type,
         trial_period_unit,
         apply_region_id,
         status_cd,
         is_default,
         attr_id,
         eff_date)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_eff_exp_config.nextval,
               t3.offer_id,
               t4.service_offer_id,
               '1100',
               '1000',
               %(default_offer_eff_type)s,
               0,
               1000,
               %(default_apply_region_id)s,
               1000,
               0,
               -1,
               null
          from DC_CONFIG_OFFER_BASIC_INFO t1
          left join DC_CONFIG_OFFER_EFFECT_EXPIRY t2
            on t1.offer_name = t2.offer_name
         inner join cpc.offer t3
            on t1.offer_name = t3.offer_name
          left join cpc.service_offer t4
            on t4.service_offer_name in
               ('Unsubscribe Offer', 'Modify Offer')
          left join cpc.offer_eff_exp_config t8
            on t3.offer_id = t8.offer_id
           and t8.service_offer_id = t4.service_offer_id
         where t8.offer_eff_exp_config_id is null
           and t2.offer_name is null
    - |
      insert into cpc.offer_eff_exp_config
        (create_date,
         create_staff,
         update_date,
         offer_eff_exp_config_id,
         offer_id,
         service_offer_id,
         prod_exist_type,
         eff_base_type,
         eff_type,
         period_time_type,
         period_unit,
         period_time,
         trial_type,
         trial_period_unit,
         apply_region_id,
         status_cd,
         is_default,
         attr_id,
         eff_date,
         exp_date)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_eff_exp_config.nextval,
               t3.offer_id,
               t4.service_offer_id,
               %(default_existing_type)s,
               %(default_eff_base_type)s,
               %(default_offer_eff_type)s,
               %(default_period_time_type)s,
               case
                 when %(default_period_time_type)s = 1000 then
                  regexp_substr(%(default_eff_period)s, '\d*')
               end,
               case
                 when %(default_period_time_type)s = 1000 then
                  t6.attr_value
               end,
               0,
               1000,
               %(default_apply_region_id)s,
               1000,
               0,
               -1,
               case
                 when %(default_period_time_type)s = 1100 then
                  trunc(sysdate)
               end,
               case
                 when %(default_period_time_type)s = 1100 then
                  to_date(%(default_eff_period)s, 'yyyymmdd')
               end
          from DC_CONFIG_OFFER_BASIC_INFO t1
          left join DC_CONFIG_OFFER_EFFECT_EXPIRY t2
            on t1.offer_name = t2.offer_name
         inner join cpc.offer t3
            on t1.offer_name = t3.offer_name
          left join cpc.service_offer t4
            on t4.service_offer_name in ('Order Offer')
          left join cpc.attr_value t6
            on instr(%(default_eff_period)s,trim(t6.attr_value_name))>1
           and t6.status_cd = '1000'
          left join cpc.offer_eff_exp_config t8
            on t3.offer_id = t8.offer_id
           and t8.service_offer_id = t4.service_offer_id
         where t8.offer_eff_exp_config_id is null
           and t2.offer_name is null

    - |
      insert into cpc.offer_exp_cfg
        (offer_exp_cfg_id,
         offer_id,
         deal_type,
         eff_date,
         exp_date,
         apply_region_id,
         status_cd,
         create_staff,
         create_date,
         update_date)
        select cpc.seq_offer_exp_cfg.nextval,
               t3.offer_id,
               case t2.PROCESS_MODE
                 when 'Auto Renew' then
                  10
                 when 'Agreement Renew' then
                  20
                 when 'Auto De-register' then
                  40
                 else
                  30
               end,
               %(default_eff_date)s,
               %(default_exp_date)s,
               %(default_apply_region_id)s,
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate
          from DC_CONFIG_OFFER_BASIC_INFO T1
          left join DC_CONFIG_OFFER_EFFECT_EXPIRY t2
            on t1.offer_name = t2.offer_name
         inner join cpc.offer t3
            on t1.offer_name = t3.offer_name
          left join cpc.offer_exp_cfg t4
            on t3.offer_id = t4.offer_id
         where t4.offer_exp_cfg_id is null
           and t2.offer_name is null
           and t1.offer_type = 'Additional Offer'


    - |
      insert into cpc.price_plan
        (price_plan_id,
         price_plan_code,
         price_plan_name,
         apply_level,
         price_plan_type,
         price_plan_genre,
         priority,
         lock_flag,
         state,
         price_plan_exit,
         active_date,
         active_staff_id,
         policy_plan_flag)
        select t1.new_offer_id,
               substr(regexp_replace(t1.offer_name, '[^A-Za-z0-9]+', '_'),0,58)||substr(t1.new_offer_id,-2),
               t1.offer_name,
               'S',
               3,
               'A',
               rownum+total_cnt,
               'N',
               'A',
               'N',
               %(default_create_date)s,
               %(default_create_user)s,
               'N'
          from dc_config_offer_basic_info t1
          left join dc_config_price_plan_basic_info t2
            on t1.offer_name = t2.price_plan_name
          left join cpc.price_plan t3
            on t1.offer_name = t3.price_plan_name
            or t1.new_offer_id = t3.price_plan_id
          left join (select offer_name
                       from DC_CONFIG_OFFER_PRICE_PLAN_REL
                      group by offer_name)t5
            on t1.offer_name = t5.offer_name
          left join (select count(*) total_cnt
                       from cpc.price_plan
                      where price_plan_type = 3
                        and policy_plan_flag = 'N')t4
            on 1=1
         where t2.price_plan_name is null
           and t3.price_plan_name is null
           and t5.offer_name is null
           and t1.offer_type <> 'Basic Offer'
    - |
      insert into cpc.price_plan_ver
        (price_plan_ver_id,
         price_plan_id,
         seq,
         eff_date,
         using_state,
         state,
         created_date,
         created_staff_id,
         release_date,
         release_staff_id,
         submit_date,
         submit_staff_id,
         approved_date,
         approved_staff_id)
        select cpc.price_plan_ver_id_seq.nextval,
               t1.price_plan_id,
               1,
               %(default_eff_date)s,
               'A',
               'D',
               %(default_create_date)s,
               %(default_create_user)s,
               %(default_create_date)s,
               %(default_create_user)s,
               %(default_create_date)s,
               %(default_create_user)s,
               %(default_create_date)s,
               %(default_create_user)s
          from cpc.price_plan t1
          left join cpc.price_plan_ver t2
            on t1.price_plan_id = t2.price_plan_id
         where t2.price_plan_ver_id is null
    - |
      insert into cpc.price_set
        (price_set_id, apply_level, price_set_priority_id, priority)
        select cpc.price_set_id_seq.nextval, 'S', 10000, 1
          from cpc.price_plan_ver t1
          left join cpc.price_plan_member t2
            on t1.price_plan_ver_id = t2.price_plan_ver_id
          left join cpc.price_set t3
            on t3.price_set_id = t2.price_set_id
         where t3.price_set_id is null
    - |
      insert into cpc.price_plan_member
        (price_plan_ver_id, price_set_id, created_date)
        select t1.price_plan_ver_id, t2.price_set_id, %(default_create_date)s
          from (select t1.price_plan_ver_id, rownum row_count
                  from cpc.price_plan_ver t1
                  left join cpc.price_plan_member t2
                    on t1.price_plan_ver_id = t2.price_plan_ver_id
                 where t2.price_set_id is null
                   order by t1.price_plan_ver_id) t1
          left join (select t1.price_set_id, rownum row_count
                       from cpc.price_set t1
                       left join cpc.price_plan_member t2
                         on t1.price_set_id = t2.price_set_id
                      where t2.price_set_id is null
                        order by t1.price_set_id) t2
            on t1.row_count = t2.row_count

  update_DC_CONFIG_OFFER_BASIC_INFO:
    - |
      update cpc.offer_catalog_location tt1
         set update_date     = sysdate,
             catalog_item_id =
             (select nvl(t3.catalog_item_id, t4.catalog_item_id)
                from DC_CONFIG_OFFER_BASIC_INFO t1
               inner join cpc.offer t2
                  on t1.offer_name = t2.offer_name
               inner join cpc.offer_catalog_location t4
                  on t2.offer_id = t4.offer_id
                left join cpc.catalog_item t3
                  on t1.catalog_item_name = t3.catalog_item_name
                 and t3.catalog_id=871
               where tt1.offer_id=t2.offer_id)
       where offer_id in (select t2.offer_id
                            from DC_CONFIG_OFFER_BASIC_INFO t1
                           inner join cpc.offer t2
                              on t1.offer_name = t2.offer_name
                           where t1.catalog_item_name is not null)

    - |
      update cpc.offer t1
         set (update_date,
              offer_name,
              offer_type,
              offer_sys_type,
              offer_nbr,
              offer_sys_nbr,
              offer_desc,
              eff_date,
              exp_date,
              brand_id,
              is_independent,
              main_flag,
              priority_value,
              offer_grade,
              status_cd) =
             (select sysdate,
                     tt1.offer_name,
                     tt3.attr_value,
                     case when tt3.attr_value = '11' then '1000' else '1200' end,
                     nvl(tt1.offer_nbr, tt2.offer_nbr),
                     nvl(tt1.offer_nbr, tt2.offer_sys_nbr),
                     nvl(tt1.OFFER_DESC,tt2.offer_desc),
                     nvl(to_date(tt1.EFF_DATE,%(default_date_format)s), tt2.eff_date),
                     nvl(to_date(tt1.EXP_DATE,%(default_date_format)s), tt2.exp_date),
                     tt4.brand_id,
                     case
                       when tt3.attr_value in ('12', '10') then
                        0
                       else
                        1
                     end,
                     case
                       when tt3.attr_value in ('11') then
                        1
                       else
                        0
                     end,
                     nvl(tt1.PRIORITY_VALUE, tt2.PRIORITY_VALUE),
                     coalesce(to_number(tt1.offer_grade),tt2.offer_grade,0),
                     coalesce(tt5.key_value,tt2.status_cd,'1000')
                from DC_CONFIG_OFFER_BASIC_INFO tt1
               inner join cpc.offer tt2
                  on tt1.new_offer_id = tt2.offer_id
                left join cpc.attr_value tt3
                  on tt3.attr_id = 800052220
                 and trim(tt3.attr_value_name) = tt1.OFFER_TYPE
                 and tt3.status_cd='1000'
                left join cpc.brand tt4
                  on tt1.BRAND_NAME = tt4.brand_name
                left join dc_dim_cpc_dict tt5
                  on tt1.offer_state = tt5.key_name
                 and tt5.dict_name = 'OFFER STATE'
               where t1.offer_id = tt2.offer_id)
       where t1.offer_id in (select new_offer_id from DC_CONFIG_OFFER_BASIC_INFO)
    - |
      update cpc.offer_payment_mode t1
       set update_date     = sysdate,
           payment_mode_cd =
           (select tt4.attr_value
              from DC_CONFIG_OFFER_BASIC_INFO tt1
             inner join cpc.offer tt2
                on tt1.offer_name = tt2.offer_name
              left join cpc.attr_value tt4
                on tt1.payment_mode = trim(tt4.attr_value_name)
               and tt4.attr_id = 990000002
               and tt4.status_cd = '1000'
             where t1.offer_id = tt2.offer_id
               and tt1.payment_mode is not null)
      where t1.offer_id in (select t2.offer_id
                             from DC_CONFIG_OFFER_BASIC_INFO t1
                            inner join cpc.offer t2
                               on t1.offer_name = t2.offer_name
                            where t1.payment_mode is not null)
    - |
      delete from cpc.offer_payment_mode
       where offer_id in (select t2.offer_id
                            from DC_CONFIG_OFFER_BASIC_INFO t1
                           inner join cpc.offer t2
                              on t1.offer_name = t2.offer_name
                           where t1.payment_mode is null)

  insert_DC_CONFIG_OFFER_PROD_REL:
    - |
      insert into cpc.offer_obj_rel
        (create_date,
         create_staff,
         update_date,
         offer_obj_rel_id,
         offer_id,
         obj_type,
         obj_id,
         role_id,
         status_cd,
         apply_region_id,
         max_num,
         min_num,
         default_count,
         offer_object_name,
         remark)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_obj_rel.nextval,
               t2.offer_id,
               '100000',
               t3.prod_id,
               nvl(t5.role_id,%(default_prod_rel_role)s),
               '1000',
               %(default_apply_region_id)s,
               coalesce(t1.max_num,t1.default_count,t1.min_num,'1'),
               coalesce(t1.min_num,t1.default_count,t1.min_num,'0'),
               coalesce(t1.default_count,t1.max_num,t1.min_num,'1'),
               t3.prod_name,
               nvl(t1.rel_type, '1000') || ',' || nvl(t1.prod_exist_type, '1200')
          from (select t2.offer_name,
                       t2.access_prod_name,
                       t2.role_name,
                       case
                         when t2.rel_type = 'Use' then
                          '1100'
                         else
                          '1000'
                       end rel_type,
                       case
                         when t2.prod_exist_type = 'New' then
                          '1000'
                         when t2.prod_exist_type = 'Existing' then
                          '1100'
                         else
                          '1200'
                       end prod_exist_type,
                       max(t2.MAX_NUM) MAX_NUM,
                       min(t2.MIN_NUM) MIN_NUM,
                       max(DEFAULT_COUNT) DEFAULT_COUNT
                  from DC_CONFIG_OFFER_PROD_REL t2
                 group by t2.offer_name,
                          t2.access_prod_name,
                          t2.role_name,
                          t2.rel_type,
                          t2.prod_exist_type) t1
         inner join cpc.offer t2
            on t1.offer_name = t2.offer_name
         inner join cpc.product t3
            on t1.access_prod_name = t3.prod_name
           and t3.status_cd = '1000'
         inner join cpc.offer_obj_rel_role t5
            on t5.role_name = t1.role_name
          left join cpc.offer_prod_rel t6
            on t2.offer_id = t6.offer_id
           and t6.par_offer_prod_rel_id = -1
           and t3.prod_id = t6.prod_id
           and nvl(t5.role_id,%(default_prod_rel_role)s) = t6.role_id
         where t6.offer_prod_rel_id is null

    - |
      insert into cpc.offer_prod_rel
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_id,
         offer_id,
         prod_id,
         rel_type,
         prod_exist_type,
         role_id,
         apply_region_id,
         status_cd,
         par_offer_prod_rel_id,
         remark)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               t1.offer_obj_rel_id,
               t1.offer_id,
               t1.obj_id,
               substr(t1.remark,0,instr(t1.remark,',')-1),
               substr(t1.remark,instr(t1.remark,',')+1),
               t1.role_id,
               %(default_apply_region_id)s,
               '1000',
               -1,
               'Default Selection'
          from cpc.offer_obj_rel t1
         inner join DC_DIM_CPC_DICT t2
           on substr(t1.remark,0,instr(t1.remark,',')-1) = t2.key_value
          and t2.dict_name = 'OFFER PROD REL TYPE'
        inner join DC_DIM_CPC_DICT t3
           on substr(t1.remark,instr(t1.remark,',')+1) = t3.key_value
          and t3.dict_name = 'OFFER PROD EXIST TYPE'
          left join cpc.offer_prod_rel t5
            on t1.offer_obj_rel_id = t5.offer_prod_rel_id
         where t1.remark is not null
           and t5.offer_prod_rel_id is null

    - |
      insert into cpc.offer_prod_rel_rstr_cfg
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_cfg_id,
         offer_prod_rel_id,
         prod_id,
         default_count,
         rstr_type,
         min_num,
         max_num,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_prod_rel_rstr_cfg.nextval,
               t1.offer_prod_rel_id,
               t1.prod_id,
               t5.default_count,
               t4.attr_value,
               t5.min_num,
               t5.max_num,
               t1.apply_region_id,
               '1000'
          from cpc.offer_prod_rel t1
          left join cpc.offer_obj_rel t5
            on t5.offer_obj_rel_id = t1.offer_prod_rel_id
          left join cpc.offer_prod_rel_rstr_cfg t2
            on t1.offer_prod_rel_id = t2.offer_prod_rel_id
          left join cpc.attr_value t4
            on t1.remark = trim(t4.attr_value_name)
           and t4.attr_id = 800052231
           and t4.status_cd = '1000'
         where t2.offer_prod_rel_id is null
           and t1.par_offer_prod_rel_id = -1
           and t1.remark is not null

    - |
      insert into cpc.offer_prod_rel
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_id,
         offer_id,
         prod_id,
         rel_type,
         prod_exist_type,
         role_id,
         apply_region_id,
         status_cd,
         par_offer_prod_rel_id,
         remark)
        select sysdate,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_obj_rel.nextval,
               t2.offer_id,
               t3.prod_id,
               t5.rel_type,
               t5.prod_exist_type,
               nvl(t7.role_id,%(default_prod_rel_role)s),
               %(default_apply_region_id)s,
               '1000',
               t5.offer_prod_rel_id,
               t1.FUNC_CONSTRAINT_TYPE
          from DC_CONFIG_OFFER_PROD_REL t1
         inner join cpc.offer t2
            on t1.offer_name = t2.offer_name
         inner join cpc.product t3
            on t1.func_prod_name = t3.prod_name
           and t3.status_cd = '1000'
         inner join cpc.product t4
            on t1.access_prod_name = t4.prod_name
           and t4.status_cd = '1000'
          left join cpc.offer_obj_rel_role t7
            on t7.role_name = t1.role_name
         inner join cpc.offer_prod_rel t5
            on t2.offer_id = t5.offer_id
           and t5.par_offer_prod_rel_id = -1
           and t4.prod_id = t5.prod_id
           and nvl(t7.role_id,%(default_prod_rel_role)s) = t5.role_id
          left join cpc.offer_prod_rel t6
            on t2.offer_id = t5.offer_id
           and t3.prod_id = t6.prod_id
           and nvl(t7.role_id,%(default_prod_rel_role)s) = t6.role_id
           and t5.offer_prod_rel_id = t6.par_offer_prod_rel_id
         where t1.access_prod_name is not null
           and t6.offer_prod_rel_id is null

    - |
      insert into cpc.offer_obj_rel
        (create_date,
         create_staff,
         update_date,
         offer_obj_rel_id,
         offer_id,
         obj_type,
         obj_id,
         role_id,
         status_cd,
         apply_region_id,
         max_num,
         min_num,
         default_count,
         offer_object_name)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               t1.offer_prod_rel_id,
               t1.offer_id,
               '100000',
               t1.prod_id,
               t1.role_id,
               '1000',
               t1.apply_region_id,
               1,
               0,
               1,
               t3.prod_name
          from cpc.offer_prod_rel t1
          left join cpc.product t3
            on t1.prod_id = t3.prod_id
          left join cpc.offer_obj_rel t2
            on t1.offer_prod_rel_id = t2.offer_obj_rel_id
         where t2.offer_obj_rel_id is null
    - |
      insert into cpc.offer_prod_rel_rstr_cfg
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_cfg_id,
         offer_prod_rel_id,
         prod_id,
         default_count,
         rstr_type,
         min_num,
         max_num,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_prod_rel_rstr_cfg.nextval,
               t1.offer_prod_rel_id,
               t1.prod_id,
               1,
               t3.attr_value,
               0,
               1,
               t1.apply_region_id,
               '1000'
          from cpc.offer_prod_rel t1
          left join cpc.offer_prod_rel_rstr_cfg t2
            on t1.offer_prod_rel_id = t2.offer_prod_rel_id
          left join cpc.attr_value t3
            on t1.remark = trim(t3.attr_value_name)
           and t3.attr_id = 800052231
           and t3.status_cd = '1000'
         where t2.offer_prod_rel_id is null
           and t1.par_offer_prod_rel_id <> -1
           and t1.remark is not null

    - |
      insert into cpc.product_offer_detail_base
        (offer_base_id,
         offer_prod_rela_id,
         prod_offer_id,
         default_flag,
         oper_date)
        select cpc.seq_offer_base_id.nextval,
               t1.offer_prod_rel_id,
               t3.offer_id,
               'T',
               sysdate
          from cpc.offer_prod_rel t1
         inner join cpc.offer_obj_rel t2
            on t1.prod_id = t2.obj_id
         inner join cpc.offer t3
            on t2.offer_id = t3.offer_id
           and t3.offer_type = 10
          left join cpc.product_offer_detail_base t4
            on t4.offer_prod_rela_id = t1.offer_prod_rel_id
         where t1.par_offer_prod_rel_id = -1
           and t4.offer_base_id is null

    - |
      insert into cpc.tariff_plan_rela_apply
        (tariff_plan_rela_apply_id,
         tariff_plan_rela_id,
         offer_obj_rel_id,
         offer_id,
         obj_type,
         obj_id,
         role_id,
         priority,
         created_date,
         state,
         state_date)
        select cpc.tariff_plan_rela_apply_id_seq.nextval,
               t6.tariff_plan_rela_id,
               t7.offer_obj_rel_id,
               t1.offer_id,
               t7.obj_type,
               t7.obj_id,
               t7.role_id,
               0,
               %(default_create_date)s,
               'B',
               sysdate
          from (select tt1.offer_id,
                       tt3.prod_id access_prod_id,
                       tt4.role_id,
                       tt2.offer_name
                  from DC_CONFIG_OFFER_PROD_REL tt2
                 inner join cpc.offer tt1
                    on tt2.offer_name = tt1.offer_name
                 inner join cpc.product tt3
                    on tt2.access_prod_name = tt3.prod_name
                 inner join cpc.offer_obj_rel_role tt4
                    on tt2.role_name = tt4.role_name
                 group by tt1.offer_id,
                          tt3.prod_id,
                          tt4.role_id,
                          tt2.offer_name) t1
          left join dc_config_offer_price_plan_rel t2
            on t1.offer_name = t2.offer_name
         inner join cpc.offer_prod_rel t4
            on t1.offer_id = t4.offer_id
           and t1.access_prod_id = t4.prod_id
           and t1.role_id = t4.role_id
           and t4.par_offer_prod_rel_id = -1
         inner join cpc.offer_obj_rel t7
            on t4.offer_prod_rel_id = t7.offer_obj_rel_id
         inner join cpc.tariff_plan t5
            on t5.tariff_plan_name = t1.offer_name
         inner join cpc.tariff_plan_rela t6
            on t5.tariff_plan_id = t6.tariff_plan_id
          left join cpc.tariff_plan_rela_apply t8
            on t6.tariff_plan_rela_id = t8.tariff_plan_rela_id
           and t7.offer_obj_rel_id = t8.offer_obj_rel_id
         where t8.tariff_plan_rela_apply_id is null
           and t2.offer_name is null


  update_DC_CONFIG_OFFER_PROD_REL:
    - |
      update cpc.offer_obj_rel tt1
         set update_date = sysdate,
             ( max_num, min_num, default_count, remark) =
             (select
                     nvl(t1.MAX_NUM, t6.MAX_NUM),
                     nvl(t1.min_num, t6.min_num),
                     nvl(t1.default_count, t6.default_count),
                     nvl(t1.rel_type,t7.rel_type )||','||
                     nvl(t1.prod_exist_type,t7.prod_exist_type)
                from (select t2.offer_name,
                             t2.access_prod_name,
                             t2.role_name,
                             case
                               when t2.rel_type = 'Use' then
                                '1100'
                               else
                                '1000'
                             end rel_type,
                             case
                               when t2.prod_exist_type = 'New' then
                                '1000'
                               when t2.prod_exist_type = 'Existing' then
                                '1100'
                               else
                                '1200'
                             end prod_exist_type,
                             max(t2.MAX_NUM) MAX_NUM,
                             min(t2.MIN_NUM) MIN_NUM,
                             max(DEFAULT_COUNT) DEFAULT_COUNT
                        from DC_CONFIG_OFFER_PROD_REL t2
                       group by t2.offer_name,
                                t2.access_prod_name,
                                t2.role_name,
                                t2.rel_type,
                                t2.prod_exist_type) t1
               inner join cpc.offer t3
                  on t3.offer_name = t1.offer_name
               inner join cpc.product t4
                  on t1.access_prod_name = t4.prod_name
                 and t4.status_cd = '1000'
                left join cpc.offer_obj_rel_role t5
                  on t1.role_name = t5.role_name
               inner join cpc.offer_obj_rel t6
                  on t3.offer_id = t6.offer_id
                 and t4.prod_id = t6.obj_id
                 and t5.role_id = t6.role_id
               inner join cpc.offer_prod_rel t7
                  on t6.offer_obj_rel_id = t7.offer_prod_rel_id
               where tt1.offer_obj_rel_id = t6.offer_obj_rel_id)
       where (tt1.offer_id, tt1.obj_id, tt1.role_id) in
             (select offer_id, prod_id, t5.role_id
                from DC_CONFIG_OFFER_PROD_REL t2
               inner join cpc.offer t3
                  on t3.offer_name = t2.offer_name
               inner join cpc.product t4
                  on t2.access_prod_name = t4.prod_name
               inner join cpc.offer_obj_rel_role t5
                  on t2.role_name = t5.role_name)
    - |
      update cpc.offer_prod_rel tt1
         set update_date = sysdate,
             (rel_type, prod_exist_type) =
             (select nvl(substr(t1.remark, 0, instr(t1.remark, ',') - 1), '1000'),
                     nvl(substr(t1.remark, instr(t1.remark, ',') + 1), '1200')
                from cpc.offer_obj_rel t1
               where obj_type = 100000
                 and t1.offer_obj_rel_id = tt1.offer_prod_rel_id)
       where (tt1.offer_id, tt1.prod_id, tt1.role_id) in
             (select offer_id, prod_id ,t5.role_id
                from DC_CONFIG_OFFER_PROD_REL t2
               inner join cpc.offer t3
                  on t3.offer_name = t2.offer_name
               inner join cpc.product t4
                  on t2.access_prod_name = t4.prod_name
               inner join cpc.offer_obj_rel_role t5
                  on t2.role_name = t5.role_name)
    - |
      update cpc.offer_prod_rel_rstr_cfg tt1
         set update_date = sysdate,
             (max_num, min_num, default_count) =
             (select max_num,min_num,default_count
                from cpc.offer_obj_rel t1
               where t1.offer_obj_rel_id = tt1.offer_prod_rel_id
                 and t1.remark is not null)
       where tt1.offer_prod_rel_id in
             (select offer_obj_rel_id
                from offer_obj_rel
               where remark is not null)

  insert_DC_CONFIG_OFFER_PROD_ATTR_REL:
    - |
      insert into cpc.PROD_ATTR_VALUE_RESTRICT
        (RESTRICT_ID,
         OFFER_PROD_REL_ID,
         APPLY_REGION_ID,
         STATUS_CD,
         CREATE_STAFF,
         UPDATE_STAFF,
         CREATE_DATE,
         UPDATE_DATE,
         STATUS_DATE,
         PROD_ID,
         ATTR_ID)
        SELECT CPC.SEQ_ATTR_RESTRICT_VALUE.NEXTVAL,
               TT1.OFFER_PROD_REL_ID,
               %(default_apply_region_id)s,
               1000,
               %(default_create_user)s,
               %(default_create_user)s,
               %(default_create_date)s,
               SYSDATE,
               SYSDATE,
               TT1.PROD_ID,
               TT1.ATTR_ID
          FROM (SELECT T6.OFFER_PROD_REL_ID, T3.PROD_ID, T5.ATTR_ID
                  FROM DC_CONFIG_OFFER_PROD_ATTR_REL T1
                 INNER JOIN CPC.OFFER T2
                    ON T1.OFFER_NAME = T2.OFFER_NAME
                 INNER JOIN CPC.PRODUCT T3
                    ON T1.PROD_NAME = T3.PROD_NAME
                   AND T3.STATUS_CD = '1000'
                 INNER JOIN CPC.ATTR_SPEC T4
                    ON T4.ATTR_NAME = T1.PROD_ATTR_NAME
                 INNER JOIN CPC.PROD_ATTR T5
                    ON T3.PROD_ID = T5.PROD_ID
                   AND T4.ATTR_ID = T5.ATTR_ID
                 INNER JOIN CPC.OFFER_PROD_REL T6
                    ON T6.OFFER_ID = T2.OFFER_ID
                   AND T6.PROD_ID = T3.PROD_ID
                 GROUP BY T6.OFFER_PROD_REL_ID, T3.PROD_ID, T5.ATTR_ID) TT1
          LEFT JOIN PROD_ATTR_VALUE_RESTRICT TT2
            ON TT1.OFFER_PROD_REL_ID = TT2.OFFER_PROD_REL_ID
           AND TT1.PROD_ID = TT2.PROD_ID
           AND TT1.ATTR_ID = TT2.ATTR_ID
         WHERE TT2.RESTRICT_ID IS NULL

    - |
      insert into cpc.ATTR_RESTRICT_VALUE
        (RESTRICT_VALUE_ID,
         RESTRICT_ID,
         ATTR_VALUE_ID,
         APPLY_REGION_ID,
         STATUS_CD,
         CREATE_STAFF,
         UPDATE_STAFF,
         CREATE_DATE,
         STATUS_DATE,
         UPDATE_DATE)
        select cpc.seq_attr_restrict_value.nextval,
               T7.RESTRICT_ID,
               T8.ATTR_VALUE_ID,
               731,
               1000,
               %(default_create_user)s,
               %(default_create_user)s,
               %(default_create_date)s,
               SYSDATE,
               SYSDATE
          FROM DC_CONFIG_OFFER_PROD_ATTR_REL T1
         INNER JOIN CPC.OFFER T2
            ON T1.OFFER_NAME = T2.OFFER_NAME
         INNER JOIN CPC.PRODUCT T3
            ON T1.PROD_NAME = T3.PROD_NAME
           AND T3.STATUS_CD = '1000'
         INNER JOIN CPC.ATTR_SPEC T4
            ON T4.ATTR_NAME = T1.PROD_ATTR_NAME
         INNER JOIN CPC.PROD_ATTR T5
            ON T3.PROD_ID = T5.PROD_ID
           AND T4.ATTR_ID = T5.ATTR_ID
         INNER JOIN CPC.OFFER_PROD_REL T6
            ON T6.OFFER_ID = T2.OFFER_ID
           AND T6.PROD_ID = T3.PROD_ID
         INNER JOIN cpc.PROD_ATTR_VALUE_RESTRICT T7
            ON T7.OFFER_PROD_REL_ID = T6.OFFER_PROD_REL_ID
           AND T7.PROD_ID = T6.PROD_ID
           AND T7.ATTR_ID = T4.ATTR_ID
         INNER JOIN CPC.ATTR_VALUE T8
            ON TRIM(T8.ATTR_VALUE_NAME) = T1.PROD_ATTR_VALUE_NAME
           AND T8.ATTR_ID = T4.ATTR_ID
           AND T8.STATUS_CD = '1000'
          left join CPC.ATTR_RESTRICT_VALUE T9
            ON T9.RESTRICT_ID = T7.RESTRICT_ID
           AND T9.ATTR_VALUE_ID = T8.ATTR_VALUE_ID
         WHERE T9.RESTRICT_VALUE_ID IS NULL

  insert_DC_CONFIG_OFFER_SALES_AREA:
    - |
      insert into cpc.offer_restrict
        (create_date,
         create_staff,
         update_date,
         offer_restrict_id,
         offer_id,
         rstr_obj_type,
         rstr_obj_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_restrict_id.nextval,
               T5.OFFER_ID,
               '3000',
               t3.common_region_id,
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_OFFER_SALES_AREA t2
         inner join ftf.common_region t3
            on t2.AREA_NAME = t3.region_name
         inner join cpc.offer t5
            on t2.offer_name = t5.offer_name
          left join cpc.offer_restrict t6
            on t5.offer_id = t6.offer_id
           and t3.common_region_id = t6.rstr_obj_id
           and t6.rstr_obj_type = 3000
         where t6.offer_restrict_id is null
           and t2.area_type = 'operator'


    - |
      insert into cpc.offer_restrict
        (create_date,
         create_staff,
         update_date,
         offer_restrict_id,
         offer_id,
         rstr_obj_type,
         rstr_obj_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_restrict_id.nextval,
               T5.OFFER_ID,
               '9002',
               t3.common_region_id,
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_OFFER_SALES_AREA t2
         inner join ftf.common_region t3
            on t2.AREA_NAME = t3.region_name
         inner join cpc.offer t5
            on t2.offer_name = t5.offer_name
          left join cpc.offer_restrict t6
            on t5.offer_id = t6.offer_id
           and t3.common_region_id = t6.rstr_obj_id
           and t6.rstr_obj_type = 9002
         where t6.offer_restrict_id is null
           and t2.area_type = 'customer'



  insert_DC_CONFIG_OFFER_APPLICABLE_CHANNEL:
    - |
      insert into cpc.offer_restrict
        (create_date,
         create_staff,
         update_date,
         offer_restrict_id,
         offer_id,
         rstr_obj_type,
         rstr_obj_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_restrict_id.nextval,
               T5.OFFER_ID,
               '9001',
               t3.attr_value,
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_OFFER_APPLICABLE_CHANNEL t2
         inner join cpc.attr_value t3
            on t2.CHANNEL_TYPE_NAME=trim(t3.attr_value_name)
           and t3.attr_id = 230000570
           and t3.status_cd = '1000'
         inner join cpc.offer t5
            on t2.offer_name = t5.offer_name
          left join cpc.offer_restrict t6
            on t5.offer_id = t6.offer_id
           and t3.attr_value = t6.rstr_obj_id
           and t6.rstr_obj_type = 9001
         where t6.offer_restrict_id is null

  insert_DC_CONFIG_OFFER_CUSTOMER_TAG:
    - |
      insert into cpc.offer_restrict
        (create_date,
         create_staff,
         update_date,
         offer_restrict_id,
         offer_id,
         rstr_obj_type,
         rstr_obj_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_restrict_id.nextval,
               T5.OFFER_ID,
               '6000',
               t3.label_id,
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_OFFER_CUSTOMER_TAG t2
         inner join cpc.label t3
            on t2.label_name = t3.label_name
         inner join cpc.offer t5
            on t2.offer_name = t5.offer_name
          left join cpc.offer_restrict t6
            on t5.offer_id = t6.offer_id
           and t3.label_id = t6.rstr_obj_id
           and t6.rstr_obj_type = 6000
         where t6.offer_restrict_id is null

  insert_DC_CONFIG_OFFER_ATTRIBUTE:
    - |
      insert into cpc.offer_attr
        (offer_attr_id,
         offer_id,
         default_value,
         obj_type,
         obj_id,
         apply_region_id,
         status_cd,
         create_staff,
         create_date,
         update_date,
         attr_name,
         attr_id)
        select cpc.seq_offer_attr.nextval,
               t2.offer_id,
               coalesce(t4.attr_value, t1.default_value,t3.default_value),
               110000,
               t2.offer_id,
               nvl(t7.common_region_id,%(default_apply_region_id)s),
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               t1.attr_name,
               t3.attr_id
          from DC_CONFIG_OFFER_ATTRIBUTE t1
         inner join cpc.offer t2
            on t1.offer_name = t2.offer_name
         inner join DC_CONFIG_ATTRIBUTE_DETAIL t3
            on t1.attr_name = t3.attr_name
          left join cpc.attr_value t4
            on t3.attr_id = t4.attr_id
           and trim(t4.attr_value_name) = t1.default_value
           and t4.status_cd = '1000'
          left join cpc.offer_attr t6
            on t2.offer_id = t6.offer_id
           and t3.attr_id = t6.attr_id
          left join ftf.common_region t7
            on t7.region_name = t1.APPLY_REGION_NAME
         where t1.ATTR_TYPE = 'Optional Attribute'
           and t6.offer_attr_id is null
    - |
      insert into cpc.offer_attr_ext
        (offer_attr_id,
         table_name,
         param_name,
         cname,
         value_type,
         is_check,
         is_make_to_table,
         is_edit,
         is_make,
         is_send_bill,
         is_print)
        select t1.offer_attr_id,
               t2.table_name,
               t2.field_name,
               t2.display_name,
               t2.value_type,
               t2.is_check,
               t2.is_make_to_table,
               t2.is_edit,
               t2.is_make,
               t2.is_send_bill,
               t2.is_print
          from cpc.offer_attr t1
         inner join cpc.DC_CONFIG_ATTRIBUTE_DETAIL t2
            on t1.attr_id = t2.attr_id
          left join cpc.offer_attr_ext t3
            on t1.offer_attr_id = t3.offer_attr_id
         where t3.offer_attr_id is null
    - |
      insert into cpc.offer_attr_value
        (offer_attr_value_id,
         offer_attr_id,
         region_id,
         status_cd,
         create_staff,
         create_date,
         update_date,
         attr_value_id)
        select cpc.seq_offer_attr_value.nextval,
               t1.offer_attr_id,
               t1.APPLY_REGION_ID,
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               t2.attr_value_id
          from cpc.offer_attr t1
         inner join DC_CONFIG_ATTRIBUTE_DETAIL t2
            on t1.attr_id = t2.attr_id
         inner join cpc.attr_value t2
            on t1.attr_id = t2.attr_id
           and t2.status_cd = '1000'
          left join cpc.offer_attr_value t3
            on t1.offer_attr_id = t3.offer_attr_id
         where t3.offer_attr_id is null
    - |
      insert into cpc.offer_ext_attr
        (offer_ext_attr_id,
         offer_id,
         attr_id,
         default_value,
         apply_region_id,
         status_cd,
         create_staff,
         create_date,
         update_date,
         attr_name)
        select cpc.seq_offer_ext_attr.nextval,
               t2.offer_id,
               t3.attr_id,
               coalesce(t4.attr_value, t1.default_value,t3.default_value),
               nvl(t7.common_region_id,%(default_apply_region_id)s),
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               t1.attr_name
          from DC_CONFIG_OFFER_ATTRIBUTE t1
         inner join cpc.offer t2
            on t1.offer_name = t2.offer_name
         inner join DC_CONFIG_ATTRIBUTE_DETAIL t3
            on t1.attr_name = t3.attr_name
          left join cpc.attr_value t4
            on t3.attr_id = t4.attr_id
           and trim(t4.attr_value_name) = t1.default_value
           and t4.status_cd = '1000'
          left join cpc.offer_ext_attr t6
            on t2.offer_id = t6.offer_id
           and t3.attr_id = t6.attr_id
          left join ftf.common_region t7
            on t7.region_name = t1.APPLY_REGION_NAME
         where t1.ATTR_TYPE = 'Extra Attribute'
           and t6.offer_ext_attr_id is null

  update_DC_CONFIG_OFFER_ATTRIBUTE:
    - |
      update cpc.offer_ext_attr tt1
         set update_date   = sysdate,
             default_value =
             (select coalesce(t4.attr_value, t1.default_value,t3.default_value)
                from DC_CONFIG_OFFER_ATTRIBUTE t1
               inner join cpc.offer t2
                  on t1.offer_name = t2.offer_name
               inner join DC_CONFIG_ATTRIBUTE_DETAIL t3
                  on t1.attr_name = t3.attr_name
                left join cpc.attr_value t4
                  on t3.attr_id = t4.attr_id
                 and trim(t4.attr_value_name) = t1.default_value
                 and t4.status_cd = '1000'
               where tt1.offer_id = t2.offer_id
                 and tt1.attr_id = t3.attr_id)
       where (offer_id, attr_id) in
             (select t2.offer_id, t3.attr_id
                from DC_CONFIG_OFFER_ATTRIBUTE t1
               inner join cpc.offer t2
                  on t1.offer_name = t2.offer_name
               inner join DC_CONFIG_ATTRIBUTE_DETAIL t3
                  on t1.attr_name = t3.attr_name)

    - |
      update cpc.offer_attr tt1
         set update_date   = sysdate,
             default_value =
             (select coalesce(t4.attr_value, t1.default_value,t3.default_value)
                from DC_CONFIG_OFFER_ATTRIBUTE t1
               inner join cpc.offer t2
                  on t1.offer_name = t2.offer_name
               inner join DC_CONFIG_ATTRIBUTE_DETAIL t3
                  on t1.attr_name = t3.attr_name
                left join cpc.attr_value t4
                  on t3.attr_id = t4.attr_id
                 and trim(t4.attr_value_name) = t1.default_value
                 and t4.status_cd='1000'
               where tt1.offer_id = t2.offer_id
                 and tt1.attr_id = t3.attr_id)
       where (offer_id, attr_id) in
             (select t2.offer_id, t3.attr_id
                from DC_CONFIG_OFFER_ATTRIBUTE t1
               inner join cpc.offer t2
                  on t1.offer_name = t2.offer_name
               inner join DC_CONFIG_ATTRIBUTE_DETAIL t3
                  on t1.attr_name = t3.attr_name
                where t1.default_value is not null)

  insert_DC_CONFIG_OFFER_REL:
    - |
      insert into cpc.offer_rel
        (offer_rel_id,
         a_offer_id,
         z_offer_id,
         role_id,
         rel_type,
         eff_date,
         exp_date,
         apply_region_id,
         status_cd,
         create_staff,
         create_date,
         update_date,
         scope,
         min_num,
         max_num,
         remark)
        select cpc.seq_offer_rel.nextval,
               t2.offer_id,
               t3.offer_id,
               nvl(t5.role_id,%(default_offer_rel_role)s),
               t4.attr_value,
               %(default_eff_date)s,
               %(default_exp_date)s,
               %(default_apply_region_id)s,
               case
                 when status = 'invalid' then
                  1100
                 else
                  1000
               end,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               case
                 when t1.scope = 'Customer Level' then
                  1300
                 when t1.scope = 'Account Level' then
                  1200
                 when t1.scope = 'Package Level' then
                  1100
                 else
                  1000
               end,
               t5.min_num,
               t5.max_num,
               coalesce(t1.rel_min_num,t1.rel_max_num,'0') || ',' || coalesce(t1.rel_max_num,t1.rel_min_num,'1')
          from DC_CONFIG_OFFER_REL t1
         inner join cpc.offer t2
            on t1.SOURCE_OFFER_NAME = t2.offer_name
         inner join cpc.offer t3
            on t1.DES_OFFER_NAME = t3.offer_name
         inner join cpc.attr_value t4
            on t4.attr_id = 800052221
           and trim(t4.attr_value_name) = t1.rel_type
           and t4.status_cd = '1000'
         inner join cpc.offer_rel_role t5
            on t1.OFFER_REL_ROLE_NAME = t5.role_name
          left join cpc.offer_rel t7
            on t7.a_offer_id = t2.offer_id
           and t7.z_offer_id = t3.offer_id
           and t4.attr_value = t7.rel_type
         where t7.offer_rel_id is null
           and (t1.oper_type is null or t1.oper_type = 'A')
    - |
      insert into cpc.OBJ_COUNT_LIMIT_RUL
        (limit_count_id,
         limit_type,
         obj_id,
         max_value,
         min_value,
         status_cd,
         create_staff,
         create_date,
         update_date,
         remark)
        select cpc.seq_obj_count_limit_rul.nextval,
               1200,
               a_offer_id,
               substr(t1.remark, instr(t1.remark, ',') + 1),
               substr(t1.remark, 0, instr(t1.remark, ',') - 1),
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               t1.offer_rel_id
          from cpc.offer_rel t1
          left join (select tt2.obj_id
                       from cpc.OBJ_COUNT_LIMIT_RUL tt1
                      inner join cpc.count_limit_comp_mbr tt2
                         on tt1.limit_count_id = tt2.limit_count_id) t2
            on t1.offer_rel_id = t2.obj_id
         where t2.obj_id is null
           and t1.remark is not null
    - |
      insert into cpc.count_limit_comp_mbr
        (vir_grp_com_obj_id,
         limit_count_id,
         obj_type,
         obj_id,
         status_cd,
         create_staff,
         create_date,
         update_date)
        select cpc.seq_count_limit_comp_mbr.nextval,
               t1.limit_count_id,
               110100,
               offer_rel_id,
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate
          from cpc.OBJ_COUNT_LIMIT_RUL t1
         inner join cpc.offer_rel t2
            on t1.remark = t2.offer_rel_id
          left join cpc.count_limit_comp_mbr t3
            on t1.limit_count_id = t3.limit_count_id
         where t3.limit_count_id is null
    - |
      insert into cpc.OFFER_REL_RSTR_CFG
        (Offer_Rel_Rstr_Cfg_Id,
         Offer_Rel_Id,
         Rstr_Type,
         Eff_Date,
         Exp_Date,
         Apply_Region_Id,
         Status_Cd,
         Create_Staff,
         Create_Date,
         Update_Date)
        select cpc.seq_offer_rel_rstr_cfg.nextval,
               t7.offer_rel_id,
               case
                 when t1.rel_rstr_type = 'Mandatory' then
                  1200
                 else
                  1300
               end,
               t7.eff_date,
               t7.exp_date,
               t7.apply_region_id,
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate
          from DC_CONFIG_OFFER_REL t1
         inner join cpc.offer t2
            on t1.SOURCE_OFFER_NAME = t2.offer_name
         inner join cpc.offer t3
            on t1.DES_OFFER_NAME = t3.offer_name
         inner join cpc.attr_value t4
            on t4.attr_id = 800052221
           and trim(t4.attr_value_name) = t1.rel_type
           and t4.status_cd = '1000'
         inner join cpc.offer_rel t7
            on t7.a_offer_id = t2.offer_id
           and t7.z_offer_id = t3.offer_id
           and t4.attr_value = t7.rel_type
          left join cpc.OFFER_REL_RSTR_CFG t8
            on t8.offer_rel_id = t7.offer_rel_id
         where t8.offer_rel_id is null
           and t1.rel_rstr_type in ('Mandatory', 'Default')
           and (t1.oper_type is null or t1.oper_type = 'A')

    - |
      insert into cpc.object_label_rel
        (object_label_rel_id,
         label_id,
         obj_type,
         obj_id,
         status_cd,
         create_staff,
         create_date,
         update_date,
         remark)
        select cpc.SEQ_OFFER_LABEL_RELT.Nextval,
               t3.label_id,
               1700,
               t2.offer_id,
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               t3.label_name
          from DC_CONFIG_OFFER_REL t1
         inner join cpc.offer t2
            on t1.source_offer_name = t2.offer_name
         inner join cpc.label t3
            on t3.label_name = 'Rent Exclusive Offer'
          left join cpc.object_label_rel t4
            on t2.offer_id = t4.obj_id
           and t4.label_id = t3.label_id
         where t4.object_label_rel_id is null
           and t1.rel_type = 'Rent Exclusive'

    - |
      delete from CPC.COUNT_LIMIT_COMP_MBR
       where obj_id in (SELECT tt7.offer_rel_id
                          FROM dc_config_offer_rel tt1
                         inner join cpc.offer tt2
                            on tt1.source_offer_name = tt2.offer_name
                         inner join cpc.offer tt3
                            on tt1.des_offer_name = tt3.offer_name
                         inner join cpc.attr_value tt4
                            on tt4.attr_id = 800052221
                           and trim(tt4.attr_value_name) = tt1.rel_type
                           and tt4.status_cd = '1000'
                         inner join cpc.offer_rel tt7
                            on tt7.a_offer_id = tt2.offer_id
                           and tt7.z_offer_id = tt3.offer_id
                           and tt4.attr_value = tt7.rel_type
                         WHERE tt1.oper_type = 'D')

    - |
      delete from CPC.OFFER_REL_RSTR_CFG
       where offer_rel_id in (SELECT tt7.offer_rel_id
                          FROM dc_config_offer_rel tt1
                         inner join cpc.offer tt2
                            on tt1.source_offer_name = tt2.offer_name
                         inner join cpc.offer tt3
                            on tt1.des_offer_name = tt3.offer_name
                         inner join cpc.attr_value tt4
                            on tt4.attr_id = 800052221
                           and trim(tt4.attr_value_name) = tt1.rel_type
                           and tt4.status_cd = '1000'
                         inner join cpc.offer_rel tt7
                            on tt7.a_offer_id = tt2.offer_id
                           and tt7.z_offer_id = tt3.offer_id
                           and tt4.attr_value = tt7.rel_type
                         WHERE tt1.oper_type = 'D')

    - |
      delete from CPC.OFFER_REL
       where offer_rel_id in (SELECT tt7.offer_rel_id
                          FROM dc_config_offer_rel tt1
                         inner join cpc.offer tt2
                            on tt1.source_offer_name = tt2.offer_name
                         inner join cpc.offer tt3
                            on tt1.des_offer_name = tt3.offer_name
                         inner join cpc.attr_value tt4
                            on tt4.attr_id = 800052221
                           and trim(tt4.attr_value_name) = tt1.rel_type
                           and tt4.status_cd = '1000'
                         inner join cpc.offer_rel tt7
                            on tt7.a_offer_id = tt2.offer_id
                           and tt7.z_offer_id = tt3.offer_id
                           and tt4.attr_value = tt7.rel_type
                         WHERE tt1.oper_type = 'D')

    - |
      delete from CPC.OBJ_COUNT_LIMIT_RUL
       where limit_count_id not in
             (select limit_count_id from CPC.COUNT_LIMIT_COMP_MBR)
             and limit_type = 1200

  update_DC_CONFIG_OFFER_REL:
    - |
      update cpc.offer_rel tt1
         set update_date = sysdate,
             (role_id, status_cd, scope, remark) =
             (select t5.role_id,
                     nvl(case
                           when t1.status = 'valid' then
                            1000
                           else
                            1100
                         end,
                         t7.status_cd),
                     nvl(case
                           when t1.scope = 'Customer Level' then
                            1300
                           when t1.scope = 'Account Level' then
                            1200
                           when t1.scope = 'Package Level' then
                            1100
                           else
                            1000
                         end,
                         t7.scope),
                     t1.rel_min_num || ',' || t1.rel_max_num
                from DC_CONFIG_OFFER_REL t1
               inner join cpc.offer t2
                  on t1.SOURCE_OFFER_NAME = t2.offer_name
               inner join cpc.offer t3
                  on t1.DES_OFFER_NAME = t3.offer_name
               inner join cpc.attr_value t4
                  on t4.attr_id = 800052221
                 and t4.status_cd = '1000'
                 and trim(t4.attr_value_name) = t1.rel_type
               inner join cpc.offer_rel_role t5
                  on t1.OFFER_REL_ROLE_NAME = t5.role_name
               inner join cpc.offer_rel t7
                  on t7.a_offer_id = t2.offer_id
                 and t7.z_offer_id = t3.offer_id
                 and t4.attr_value = t7.rel_type
               where tt1.offer_rel_id = t7.offer_rel_id)
       where (a_offer_id, z_offer_id, rel_type) in
             (select t2.offer_id, t3.offer_id, t4.attr_value
                from DC_CONFIG_OFFER_REL t1
               inner join cpc.offer t2
                  on t1.SOURCE_OFFER_NAME = t2.offer_name
               inner join cpc.offer t3
                  on t1.DES_OFFER_NAME = t3.offer_name
               inner join cpc.attr_value t4
                  on t4.attr_id = 800052221
                 and t4.status_cd = '1000'
                 and trim(t4.attr_value_name) = t1.rel_type
               where t1.oper_type is null or t1.oper_type = 'A')

    - |
      update cpc.OBJ_COUNT_LIMIT_RUL tt1
         set update_date = sysdate,
             (max_value, min_value) =
             (select substr(t1.remark, instr(t1.remark, ',') + 1),
                     substr(t1.remark, 0, instr(t1.remark, ',') - 1)
                from cpc.offer_rel t1
               inner join cpc.count_limit_comp_mbr t2
                  on t1.offer_rel_id = t2.obj_id
               where tt1.limit_count_id = t2.limit_count_id)
       where tt1.limit_count_id in
             (select limit_count_id
                from cpc.offer_rel t1
               inner join cpc.count_limit_comp_mbr t2
                  on t1.offer_rel_id = t2.obj_id
               where t1.remark is not null)

  insert_DC_CONFIG_OFFER_SERVICE:
    - |
      insert into cpc.offer_service_rel
        (create_date,
         create_staff,
         update_date,
         offer_serv_rel_id,
         offer_id,
         service_offer_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_service_rel.nextval,
               t2.offer_id,
               t3.service_offer_id,
               %(default_apply_region_id)s,
               '1000'
          from DC_CONFIG_OFFER_SERVICE t1
         inner join cpc.offer t2
            on t1.offer_name = t2.offer_name
         inner join cpc.service_offer t3
            on t1.service_name = t3.service_offer_name
          left join cpc.offer_service_rel t4
            on t2.offer_id = t4.offer_id
           and t3.service_offer_id = t4.service_offer_id
         where t4.offer_serv_rel_id is null

  insert_DC_CONFIG_OFFER_TAG:
    - |
      insert into cpc.object_label_rel
        (object_label_rel_id,
         label_id,
         obj_type,
         obj_id,
         status_cd,
         create_staff,
         create_date,
         update_date,
         remark)
        select cpc.SEQ_OFFER_LABEL_RELT.Nextval,
               t3.label_id,
               1700,
               t2.offer_id,
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               t3.label_name
          from DC_CONFIG_OFFER_TAG t1
         inner join cpc.offer t2
            on t1.offer_name = t2.offer_name
         inner join cpc.label t3
            on t3.label_name = t1.tag_name
          left join cpc.object_label_rel t4
            on t2.offer_id = t4.obj_id
           and t4.label_id = t3.label_id
         where t4.object_label_rel_id is null

  insert_DC_CONFIG_PROD_AREA:
    - |
      insert into cpc.prod_region_rel
        (create_date,
         create_staff,
         update_date,
         prod_region_rel_id,
         prod_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.SEQ_PROD_REGION_REL_ID.NEXTVAL,
               t2.prod_id,
               t6.common_region_id,
               '1000'
          from DC_CONFIG_PROD_AREA t1
         inner join cpc.product t2
            on t1.prod_name = t2.prod_name
         inner join ftf.common_region t6
            on t6.region_name = t1.area
          left join cpc.prod_region_rel t7
            on t2.prod_id = t7.prod_id
           and t6.common_region_id = t7.apply_region_id
         where t7.prod_region_rel_id is null

  insert_DC_CONFIG_OFFER_EFFECT_EXPIRY:
    - |
      insert into cpc.offer_exp_cfg
        (offer_exp_cfg_id,
         offer_id,
         deal_type,
         eff_date,
         exp_date,
         apply_region_id,
         status_cd,
         create_staff,
         create_date,
         update_date)
        select cpc.seq_offer_exp_cfg.nextval,
               t3.offer_id,
               case t2.PROCESS_MODE
                 when 'Auto Renew' then
                  10
                 when 'Agreement Renew' then
                  20
                 when 'Auto De-register' then
                  40
                 else
                  30
               end,
               t3.eff_date,
               t3.exp_date,
               %(default_apply_region_id)s,
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate
          from DC_CONFIG_OFFER_EFFECT_EXPIRY t2
         inner join cpc.offer t3
            on t2.offer_name = t3.offer_name
          left join cpc.offer_exp_cfg t4
            on t3.offer_id = t4.offer_id
         where t4.offer_exp_cfg_id is null
           and t2.PROCESS_MODE is not null
    - |
      insert into cpc.offer_eff_exp_config
        (create_date,
         create_staff,
         update_date,
         offer_eff_exp_config_id,
         offer_id,
         service_offer_id,
         prod_exist_type,
         eff_base_type,
         eff_type,
         trial_type,
         trial_period_unit,
         apply_region_id,
         status_cd,
         is_default,
         attr_id,
         eff_date)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_eff_exp_config.nextval,
               t3.offer_id,
               t4.service_offer_id,
               '1100',
               '1000',
               nvl(t5.attr_value, '1300'),
               0,
               1000,
               %(default_apply_region_id)s,
               1000,
               0,
               -1,
               case
                 when t5.attr_value in ('1600', '1200') then
                  nvl(case
                        when t4.service_offer_name = 'Modify Offer' then
                         to_date(t2.CHANGE_EFF_DATE,%(default_date_format)s)
                        else
                         to_date(t2.UNSUBSCRIBE_EFF_DATE,%(default_date_format)s)
                      end,
                      trunc(sysdate))
               end
          from DC_CONFIG_OFFER_EFFECT_EXPIRY t2
         inner join cpc.offer t3
            on t2.offer_name = t3.offer_name
          left join cpc.service_offer t4
            on t4.service_offer_name in
               ('Unsubscribe Offer', 'Modify Offer')
          left join cpc.attr_value t5
            on t5.attr_id = 800052229
           and t5.status_cd = '1000'
           and trim(t5.attr_value_name) = case
                 when t4.service_offer_name = 'Modify Offer' then
                  t2.CHANGE_EFF_TYPE
                 else
                  t2.UNSUBSCRIBE_EFF_TYPE
               end
          left join offer_eff_exp_config t8
            on t3.offer_id = t8.offer_id
           and t8.service_offer_id = t4.service_offer_id
         where t8.offer_eff_exp_config_id is null

    - |
      insert into cpc.offer_eff_exp_config
        (create_date,
         create_staff,
         update_date,
         offer_eff_exp_config_id,
         offer_id,
         service_offer_id,
         prod_exist_type,
         eff_base_type,
         eff_type,
         period_time_type,
         period_unit,
         period_time,
         trial_type,
         trial_period_unit,
         apply_region_id,
         status_cd,
         is_default,
         attr_id,
         eff_date,
         exp_date)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_eff_exp_config.nextval,
               t3.offer_id,
               t4.service_offer_id,
               case t2.EXIST_TYPE
                 when 'New' then
                  '1000'
                 when 'Existing' then
                  '1100'
                 else
                  '1200'
               end,
               case t2.EFF_BASE_TYPE
                 when 'Acceptance Time' then
                  '2000'
                 else
                  '1000'
               end,
               nvl(t5.attr_value, '1300'),
               case t2.PERIOD_TIME_TYPE
                 when 'Relative Time' then
                  1000
                 when 'Absolute Time' then
                  1100
                 else
                  1200
               end,
               case
                when t2.PERIOD_TIME_TYPE = 'Relative Time' then
                  t6.attr_value
                end,
               case
                 when t2.PERIOD_TIME_TYPE = 'Relative Time' then
                  regexp_substr(t2.EFF_PERIOD, '\d*')
               end,
               0,
               1000,
               %(default_apply_region_id)s,
               1000,
               0,
               -1,
               case
                 when t2.PERIOD_TIME_TYPE = 'Absolute Time' then
                  to_date(t2.EFF_DATE,%(default_date_format)s)
               end,
               case
                 when t2.PERIOD_TIME_TYPE = 'Absolute Time' then
                  to_date(t2.EXP_DATE, %(default_date_format)s)
               end
          from DC_CONFIG_OFFER_EFFECT_EXPIRY t2
         inner join cpc.offer t3
            on t2.offer_name = t3.offer_name
          left join cpc.service_offer t4
            on t4.service_offer_name in ('Order Offer')
          left join cpc.attr_value t5
            on t5.attr_id = 800052229
           and t5.status_cd = '1000'
           and trim(t5.attr_value) = t2.EFF_TYPE
          left join cpc.attr_value t6
            on t6.attr_id = 800052253
           and t6.status_cd = '1000'
           and instr(t2.EFF_PERIOD, trim(t6.attr_value_name))>1
          left join cpc.offer_eff_exp_config t8
            on t3.offer_id = t8.offer_id
           and t8.service_offer_id = t4.service_offer_id
         where t8.offer_eff_exp_config_id is null

  update_DC_CONFIG_OFFER_EFFECT_EXPIRY:
    - |
      update cpc.offer_eff_exp_config tt1
         set update_date = sysdate,
             (prod_exist_type,
              eff_base_type,
              eff_type,
              period_time_type,
              period_unit,
              period_time,
              eff_date,
              exp_date) =
             (select nvl(case t2.EXIST_TYPE
                           when 'New' then
                            '1000'
                           when 'Existing' then
                            '1100'
                           else
                            '1200'
                         end,
                         t8.prod_exist_type),
                     nvl(case t2.EFF_BASE_TYPE
                           when 'Acceptance Time' then
                            '2000'
                           else
                            '1000'
                         end,
                         t8.EFF_BASE_TYPE),
                     nvl(t5.attr_value, %(default_offer_eff_type)s),
                     case t2.PERIOD_TIME_TYPE
                       when 'Relative Time' then
                        1000
                       when 'Absolute Time' then
                        1100
                       else
                        1200
                     end,
                     case
                       when t2.PERIOD_TIME_TYPE = 'Relative Time' then
                        t6.attr_value
                     end,
                     case
                       when t2.PERIOD_TIME_TYPE = 'Relative Time' then
                        regexp_substr(t2.EFF_PERIOD, '\d*')
                     end,
                     case
                       when t2.PERIOD_TIME_TYPE = 'Absolute Time' then
                        to_date(t2.EFF_DATE, %(default_date_format)s)
                     end,
                     case
                       when t2.PERIOD_TIME_TYPE = 'Absolute Time' then
                        to_date(t2.EXP_DATE, %(default_date_format)s)
                     end
                from DC_CONFIG_OFFER_EFFECT_EXPIRY t2
               inner join cpc.offer t3
                  on t2.offer_name = t3.offer_name
                left join cpc.service_offer t4
                  on t4.service_offer_name in ('Order Offer')
                left join cpc.attr_value t5
                  on t5.attr_id = 800052229
                 and trim(t5.attr_value_name) = t2.EFF_TYPE
                 and t5.status_cd = '1000'
                left join cpc.attr_value t6
                  on t6.attr_id = 800052253
                 and instr(t2.EFF_PERIOD , trim(t6.attr_value_name))>0
                 and t6.status_cd = '1000'
                left join cpc.offer_eff_exp_config t8
                  on t3.offer_id = t8.offer_id
                 and t8.service_offer_id = t4.service_offer_id
               where tt1.offer_id = t3.offer_id
                 and tt1.service_offer_id = t4.service_offer_id)
       where service_offer_id in
             (select service_offer_id
                from cpc.service_offer
               where service_offer_name in ('Order Offer'))
         and offer_id in (select offer_id
                            from DC_CONFIG_OFFER_EFFECT_EXPIRY t2
                           inner join cpc.offer t3
                              on t2.offer_name = t3.offer_name)

    - |
      update cpc.offer_eff_exp_config tt1
         set update_date = sysdate,
             (eff_type, eff_date) =
             (select t5.attr_value,
                     case
                       when t5.attr_value in ('1600', '1200') then
                        nvl(to_date(CHANGE_EFF_DATE,%(default_date_format)s), trunc(sysdate))
                     end
                from DC_CONFIG_OFFER_EFFECT_EXPIRY t2
               inner join cpc.offer t3
                  on t2.offer_name = t3.offer_name
                left join cpc.service_offer t4
                  on t4.service_offer_name in ('Modify Offer')
                left join cpc.attr_value t5
                  on t5.attr_id = 800052229
                 and trim(t5.attr_value_name) = CHANGE_EFF_TYPE
                 and t5.status_cd = '1000'
               inner join offer_eff_exp_config t8
                  on t3.offer_id = t8.offer_id
                 and t8.service_offer_id = t4.service_offer_id
               where tt1.offer_eff_exp_config_id = t8.offer_eff_exp_config_id)
       where service_offer_id in
             (select service_offer_id
                from cpc.service_offer
               where service_offer_name in ('Modify Offer'))
         and offer_id in (select offer_id
                            from DC_CONFIG_OFFER_EFFECT_EXPIRY t2
                           inner join cpc.offer t3
                              on t2.offer_name = t3.offer_name
                            where t2.change_eff_type is not null)

    - |
      update cpc.offer_eff_exp_config tt1
         set update_date = sysdate,
             (eff_type, eff_date) =
             (select t5.attr_value,
                     case
                       when t5.attr_value in ('1600', '1200') then
                        nvl(to_date(UNSUBSCRIBE_EFF_DATE,%(default_date_format)s), trunc(sysdate))
                     end
                from DC_CONFIG_OFFER_EFFECT_EXPIRY t2
               inner join cpc.offer t3
                  on t2.offer_name = t3.offer_name
                left join cpc.service_offer t4
                  on t4.service_offer_name in ('Unsubscribe Offer')
                left join cpc.attr_value t5
                  on t5.attr_id = 800052229
                 and trim(t5.attr_value_name) = UNSUBSCRIBE_EFF_TYPE
                 and t5.status_cd = '1000'
               inner join cpc.offer_eff_exp_config t8
                  on t3.offer_id = t8.offer_id
                 and t8.service_offer_id = t4.service_offer_id
               where tt1.offer_eff_exp_config_id = t8.offer_eff_exp_config_id)
       where service_offer_id in
             (select service_offer_id
                from cpc.service_offer
               where service_offer_name in ('Unsubscribe Offer'))
         and offer_id in (select offer_id
                            from DC_CONFIG_OFFER_EFFECT_EXPIRY t2
                           inner join cpc.offer t3
                              on t2.offer_name = t3.offer_name
                           where t2.UNSUBSCRIBE_EFF_TYPE is not null)

  insert_DC_CONFIG_OFFER_PRICE_PLAN_REL:
    - |
      insert into cpc.tariff_plan_rela
        (tariff_plan_rela_id,
         tariff_plan_id,
         price_plan_id,
         priority,
         rent_rela_type,
         created_date,
         state,
         state_date,
         active_date,
         tariff_plan_rela_name)
        select cpc.tariff_plan_rela_id_seq.nextval,
               t3.tariff_plan_id,
               t4.price_plan_id,
               1,
               0,
               %(default_create_date)s,
               'B',
               sysdate,
               sysdate,
               t1.offer_name
          from dc_config_offer_basic_info t1
          left join dc_config_offer_price_plan_rel t2
            on t1.offer_name = t2.offer_name
         inner join cpc.tariff_plan t3
            on t1.offer_name = t3.tariff_plan_name
         inner join cpc.price_plan t4
            on t1.offer_name = t4.price_plan_name
          left join cpc.tariff_plan_rela t5
            on t3.tariff_plan_id = t5.tariff_plan_id
           and t5.price_plan_id = t4.price_plan_id
         where t2.offer_name is null
           and t5.tariff_plan_rela_id is null

    - |
      insert into cpc.tariff_plan_rela_apply
        (tariff_plan_rela_apply_id,
         tariff_plan_rela_id,
         offer_obj_rel_id,
         offer_id,
         obj_type,
         obj_id,
         role_id,
         priority,
         created_date,
         state,
         state_date)
        select cpc.tariff_plan_rela_apply_id_seq.nextval,
               t6.tariff_plan_rela_id,
               t7.offer_obj_rel_id,
               t3.offer_id,
               t7.obj_type,
               t7.obj_id,
               t7.role_id,
               0,
               %(default_create_date)s,
               'B',
               sysdate
          from dc_config_offer_basic_info t1
          left join dc_config_offer_price_plan_rel t2
            on t1.offer_name = t2.offer_name
         inner join cpc.offer t3
            on t1.offer_name = t3.offer_name
         inner join cpc.offer_prod_rel t4
            on t3.offer_id = t4.offer_id
           and t4.par_offer_prod_rel_id = -1
         inner join cpc.offer_obj_rel t7
            on t4.offer_prod_rel_id = t7.offer_obj_rel_id
         inner join cpc.tariff_plan t5
            on t5.tariff_plan_name = t1.offer_name
         inner join cpc.tariff_plan_rela t6
            on t5.tariff_plan_id = t6.tariff_plan_id
          left join cpc.tariff_plan_rela_apply t8
            on t6.tariff_plan_rela_id = t8.tariff_plan_rela_id
           and t7.offer_obj_rel_id = t8.offer_obj_rel_id
         where t8.tariff_plan_rela_apply_id is null
           and t2.offer_name is null

    - |
      insert into cpc.tariff_plan_rela
        (tariff_plan_rela_id,
         tariff_plan_id,
         price_plan_id,
         priority,
         rent_rela_type,
         created_date,
         state,
         state_date,
         active_date,
         tariff_plan_rela_name)
        select cpc.tariff_plan_rela_id_seq.nextval,
               t3.tariff_plan_id,
               t4.price_plan_id,
               1,
               0,
               %(default_create_date)s,
               'B',
               sysdate,
               sysdate,
               t1.prod_name
          from dc_config_prod_basic_info t1
         inner join cpc.tariff_plan t3
            on t1.prod_name = t3.tariff_plan_name
         inner join cpc.price_plan t4
            on t1.prod_name = t4.price_plan_name
          left join cpc.tariff_plan_rela t5
            on t3.tariff_plan_id = t5.tariff_plan_id
           and t5.price_plan_id = t4.price_plan_id
         where t5.tariff_plan_rela_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.tariff_plan_rela_apply
        (tariff_plan_rela_apply_id,
         tariff_plan_rela_id,
         offer_obj_rel_id,
         offer_id,
         obj_type,
         obj_id,
         role_id,
         priority,
         created_date,
         state,
         state_date)
        select cpc.tariff_plan_rela_apply_id_seq.nextval,
               t6.tariff_plan_rela_id,
               t7.offer_obj_rel_id,
               t3.offer_id,
               t7.obj_type,
               t7.obj_id,
               t7.role_id,
               0,
               %(default_create_date)s,
               'B',
               sysdate
          from dc_config_prod_basic_info t1
         inner join cpc.offer t3
            on t1.prod_name = t3.offer_name
           and t1.new_prod_id = t3.offer_id
         inner join cpc.offer_prod_rel t4
            on t3.offer_id = t4.offer_id
           and t4.par_offer_prod_rel_id = -1
         inner join cpc.offer_obj_rel t7
            on t4.offer_prod_rel_id = t7.offer_obj_rel_id
         inner join cpc.tariff_plan t5
            on t5.tariff_plan_name = t1.prod_name
         inner join cpc.tariff_plan_rela t6
            on t5.tariff_plan_id = t6.tariff_plan_id
          left join cpc.tariff_plan_rela_apply t8
            on t6.tariff_plan_rela_id = t8.tariff_plan_rela_id
           and t7.offer_obj_rel_id = t8.offer_obj_rel_id
         where t8.tariff_plan_rela_apply_id is null
           and t1.IS_CHARGE_FUNC_PROD='Y'

    - |
      insert into cpc.tariff_plan
        (tariff_plan_id,
         tariff_plan_name,
         tariff_plan_code,
         CREATED_DATE,
         state,
         tariff_plan_type,
         state_date,
         active_date)
        select cpc.tariff_plan_id_seq.nextval,
               t1.offer_name,
               substr(regexp_replace(t1.offer_name, '[^A-Za-z0-9]+', '_'),0,58)||substr(cpc.tariff_plan_id_seq.currval,-2),
               %(default_create_date)s,
               'B',
               'B',
               %(default_create_date)s,
               %(default_create_date)s
          from dc_config_offer_price_plan_rel t1
          left join cpc.tariff_plan t2
            on t1.offer_name = t2.tariff_plan_name
         where t2.tariff_plan_name is null

    - |
      insert into cpc.tariff_plan_rela
        (tariff_plan_rela_id,
         tariff_plan_id,
         price_plan_id,
         priority,
         rent_rela_type,
         created_date,
         state,
         state_date,
         active_date,
         tariff_plan_rela_name)
        select cpc.tariff_plan_rela_id_seq.nextval,
               t3.tariff_plan_id,
               t4.price_plan_id,
               1,
               0,
               %(default_create_date)s,
               'B',
               %(default_create_date)s,
               %(default_create_date)s,
               t2.offer_name
          from dc_config_offer_price_plan_rel t2
         inner join cpc.tariff_plan t3
            on t2.offer_name = t3.tariff_plan_name
         inner join cpc.price_plan t4
            on t2.price_plan_name = t4.price_plan_name
          left join cpc.tariff_plan_rela t5
            on t3.tariff_plan_id = t5.tariff_plan_id
           and t5.price_plan_id = t4.price_plan_id
         where t5.tariff_plan_rela_id is null
    - |
      insert into cpc.tariff_plan_rela_apply
        (tariff_plan_rela_apply_id,
         tariff_plan_rela_id,
         offer_obj_rel_id,
         offer_id,
         obj_type,
         obj_id,
         role_id,
         priority,
         created_date,
         state,
         state_date)
        select cpc.tariff_plan_rela_apply_id_seq.nextval,
               t6.tariff_plan_rela_id,
               t7.offer_obj_rel_id,
               t3.offer_id,
               t7.obj_type,
               t7.obj_id,
               t7.role_id,
               0,
               %(default_create_date)s,
               'B',
               %(default_create_date)s
          from dc_config_offer_price_plan_rel t2
         inner join cpc.offer t3
            on t2.offer_name = t3.offer_name
         inner join cpc.product t1
            on t1.prod_name = t2.access_prod_name
           and t1.status_cd = '1000'
         inner join cpc.offer_prod_rel t4
            on t3.offer_id = t4.offer_id
           and t1.prod_id=t4.prod_id
           and t4.par_offer_prod_rel_id = -1
         inner join cpc.offer_obj_rel t7
            on t4.offer_prod_rel_id = t7.offer_obj_rel_id
         inner join cpc.tariff_plan t5
            on t5.tariff_plan_name = t2.offer_name
         inner join cpc.price_plan t9
            on t2.price_plan_name = t9.price_plan_name
         inner join cpc.tariff_plan_rela t6
            on t5.tariff_plan_id = t6.tariff_plan_id
           and t9.price_plan_id = t6.price_plan_id
         left join cpc.tariff_plan_rela_apply t8
            on t6.tariff_plan_rela_id = t8.tariff_plan_rela_id
            and t7.offer_obj_rel_id = t8.offer_obj_rel_id
        where t8.tariff_plan_rela_apply_id is null

  insert_dc_config_offer_grp_basic_info:
    - |
      insert into cpc.offer_grp
        (offer_grp_id,
         offer_grp_name,
         offer_grp_desc,
         grp_rel_type,
         apply_region_id,
         status_cd,
         create_staff,
         update_staff,
         create_date,
         update_date,
         grp_type,
         catalog_item_id)
        select cpc.seq_offer_grp.nextval,
               t1.offer_grp_name,
               t1.offer_grp_desc,
               t2.attr_value,
               nvl(t3.common_region_id,%(default_apply_region_id)s),
               1000,
               %(default_create_user)s,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               t5.attr_value,
               nvl(t4.catalog_item_id,-1)
          from dc_config_offer_grp_basic_info t1
          left join cpc.attr_value t2
            on t1.grp_rel_type = trim(t2.attr_value_name)
           and t2.attr_id = 800052258
           and t2.status_cd = '1000'
          left join ftf.common_region t3
            on t1.apply_region_name = t3.region_name
          left join cpc.attr_value t5
            on t1.grp_type = trim(t5.attr_value_name)
           and t5.attr_id = 800052259
           and t5.status_cd = '1000'
          left join cpc.catalog_item t4
            on t4.catalog_id = 871
           and t1.catalog_item_name = t4.catalog_item_name
          left join cpc.offer_grp t6
            on t6.offer_grp_name = t1.offer_grp_name
         where t6.offer_grp_id is null

  insert_dc_config_offer_grp_member:
    - |
      insert into cpc.offer_grp_member
        (offer_grp_member_id,
         offer_grp_id,
         offer_id,
         apply_region_id,
         status_cd,
         create_staff,
         update_staff,
         create_date,
         update_date)
        select cpc.seq_offer_grp_member.nextval,
               t2.offer_grp_id,
               t3.offer_id,
               %(default_apply_region_id)s,
               1000,
               %(default_create_user)s,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate
          from dc_config_offer_grp_member t1
         inner join cpc.offer_grp t2
            on t1.offer_grp_name = t2.offer_grp_name
         inner join cpc.offer t3
            on t1.offer_name = t3.offer_name
          left join cpc.offer_grp_member t4
            on t2.offer_grp_id = t4.offer_grp_id
           and t3.offer_id = t4.offer_id
         where t4.offer_grp_member_id is null

  insert_dc_config_privisioning_offer:
    - |
      insert into cpc.product
        (create_date,
         create_staff,
         update_date,
         prod_id,
         prod_nbr,
         prod_sys_nbr,
         prod_name,
         prod_desc,
         manage_grade,
         eff_date,
         exp_date,
         prod_comp_type,
         prod_func_type,
         bill_prod_type,
         prod_use_type,
         manage_region_id,
         status_cd,
         no_rent_flag,
         product_family_id,
         alias_name,
         grp_prod_nbr)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               t1.new_offer_id,
               t1.offer_nbr,
               t1.new_offer_id,
               t1.offer_name,
               t1.offer_name || ' virtual product',
               %(default_manage_grade)s,
               nvl(to_date(t1.EFF_DATE, %(default_date_format)s),%(default_eff_date)s),
               nvl(to_date(t1.EXP_DATE, %(default_date_format)s),%(default_exp_date)s),
               '10',
               '102',
               %(default_bill_prod_type)s,
               %(default_prod_use_type)s,
               %(default_apply_region_id)s,
               '1000',
               1,
               12,
               substr(regexp_replace(t1.offer_name, '[^A-Za-z0-9]+', '_'),0,50),
               t1.offer_nbr
          from dc_config_offer_basic_info t1
          left join cpc.product t3
            on t1.offer_name = t3.prod_name
            or t1.new_offer_id = t3.prod_id
         where t3.prod_id is null
           and t1.IS_NEED_PRIVISIONING = 'Y'

    - |
      insert into coc.product_ext
        (prod_id, prod_cat_type, hb_product_id)
        select t1.new_offer_id, 20, t1.new_offer_id
          from dc_config_offer_basic_info t1
          inner join cpc.product t2
            on t1.offer_name = t2.prod_name
           and t1.new_offer_id = t2.prod_id
          left join coc.product_ext t3
            on t1.new_offer_id = t3.prod_id
         where t3.prod_id is null
           and t1.IS_NEED_PRIVISIONING = 'Y'

    - |
      insert into cpc.prod_catalog_location
        (create_date,
         create_staff,
         update_date,
         catalog_loc_id,
         prod_id,
         catalog_item_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.SEQ_PROD_CATALOG_LOCATION.Nextval,
               t1.new_offer_id,
               t3.catalog_item_id,
               1000
          from dc_config_offer_basic_info t1
         inner join cpc.product t2
            on t1.offer_name = t2.prod_name
           and t1.new_offer_id = t2.prod_id
         inner join cpc.catalog_item t3
            on %(default_prod_catalog)s = t3.catalog_item_name
           and t3.catalog_id in (91001115,91001135)
          left join cpc.prod_catalog_location t4
            on t1.new_offer_id = t4.prod_id
           and t3.catalog_item_id = t4.catalog_item_id
         where t4.catalog_loc_id is null
           and t1.IS_NEED_PRIVISIONING = 'Y'

    - |
      insert into cpc.PROD_REL
        (PROD_REL_ID,
         REL_TYPE,
         ROLE_ID,
         EFF_DATE,
         EXP_DATE,
         APPLY_REGION_ID,
         STATUS_CD,
         CREATE_STAFF,
         CREATE_DATE,
         A_PROD_ID,
         Z_PROD_ID)
        select cpc.SEQ_PROD_REL.NEXTVAL,
               t4.attr_value,
               nvl(t3.role_cd,%(default_prod_rel_role)s),
               nvl(to_date(t1.eff_date,%(default_date_format)s), %(default_eff_date)s),
               nvl(to_date(t1.exp_date,%(default_date_format)s), %(default_exp_date)s),
               %(default_apply_region_id)s,
               '1000',
               %(default_create_user)s,
               %(default_create_date)s,
               nvl(t3.obj_id,%(default_access_prod)s),
               t1.new_offer_id
          from dc_config_offer_basic_info t1
         inner join cpc.product t2
            on t1.offer_name = t2.prod_name
           and t1.new_offer_id = t2.prod_id
         inner join cpc.attr_value t4
            on t4.attr_id = 800052191
           and t4.status_cd = '1000'
           and trim(t4.attr_value_name) = %(default_func_product_rel)s
          left join (select tt6.offer_id, tt3.obj_id, max(tt5.role_id) role_cd
                       from dc_config_offer_prod_rel tt1
                      inner join cpc.product tt2
                         on tt1.access_prod_name = tt2.prod_name
                      inner join cpc.offer tt6
                         on tt6.offer_name = tt1.offer_name
                      inner join cpc.offer_obj_rel tt3
                         on tt2.prod_id = tt3.obj_id
                      inner join cpc.offer tt4
                         on tt4.offer_id = tt3.offer_id
                        and tt4.offer_type = 10
                        and tt4.status_cd = '1000'
                      inner join cpc.prod_rel_role tt5
                         on tt3.role_id = tt5.role_id
                      group by tt6.offer_id, tt3.obj_id)t3
            on t1.new_offer_id = t3.offer_id
          left join cpc.PROD_REL t7
            on t7.a_prod_id = nvl(t3.obj_id,%(default_access_prod)s)
           and t2.prod_id = t7.z_prod_id
           and t4.attr_value = t7.rel_type
         where t7.prod_rel_id is null
           and t1.IS_NEED_PRIVISIONING = 'Y'

    - |
      insert into cpc.prod_region_rel
        (create_date,
         create_staff,
         update_date,
         prod_region_rel_id,
         prod_id,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.SEQ_PROD_REGION_REL_ID.NEXTVAL,
               t1.new_offer_id,
               %(default_apply_region_id)s,
               '1000'
          from dc_config_offer_basic_info t1
         inner join cpc.product t3
            on t1.offer_name = t3.prod_name
           and t1.new_offer_id = t3.prod_id
          left join cpc.prod_region_rel t7
            on t3.prod_id = t7.prod_id
           and %(default_apply_region_id)s = t7.apply_region_id
         where t7.prod_region_rel_id is null
           and t1.IS_NEED_PRIVISIONING = 'Y'

    - |
      insert into cpc.offer_prod_rel
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_id,
         offer_id,
         prod_id,
         rel_type,
         prod_exist_type,
         role_id,
         apply_region_id,
         status_cd,
         par_offer_prod_rel_id,
         remark)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_obj_rel.nextval,
               t1.new_offer_id,
               t3.prod_id,
               '1000',
               '1200',
               t4.role_id,
               %(default_apply_region_id)s,
               1000,
               t4.offer_prod_rel_id,
               t5.attr_value_name
          from dc_config_offer_basic_info t1
         inner join cpc.product t3
            on t1.offer_name = t3.prod_name
           and t1.new_offer_id = t3.prod_id
         inner join cpc.offer_prod_rel t4
            on t1.new_offer_id = t4.offer_id
           and t4.par_offer_prod_rel_id = -1
         inner join cpc.attr_value t5
            on t5.status_cd = '1000'
           and t5.attr_id = 800052231
           and t5.attr_value in (1200, 1600)
          left join (select tt1.offer_id, tt1.prod_id, tt1.offer_prod_rel_id, tt2.rstr_type,tt1.par_offer_prod_rel_id
                       from cpc.offer_prod_rel tt1
                      inner join cpc.offer_prod_rel_rstr_cfg tt2
                         on tt1.offer_prod_rel_id = tt2.offer_prod_rel_id
                      where tt1.par_offer_prod_rel_id <> -1) t6
            on t1.new_offer_id = t6.offer_id
           and t3.prod_id = t6.prod_id
           and t4.offer_prod_rel_id = t6.par_offer_prod_rel_id
           and t5.attr_value = t6.rstr_type
         where t6.offer_prod_rel_id is null
           and t1.IS_NEED_PRIVISIONING = 'Y'

    - |
      insert into cpc.offer_obj_rel
        (create_date,
         create_staff,
         update_date,
         offer_obj_rel_id,
         offer_id,
         obj_type,
         obj_id,
         role_id,
         status_cd,
         apply_region_id,
         max_num,
         min_num,
         default_count,
         offer_object_name)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               t1.offer_prod_rel_id,
               t1.offer_id,
               '100000',
               t1.prod_id,
               t1.role_id,
               '1000',
               t1.apply_region_id,
               1,
               0,
               1,
               t3.prod_name
          from cpc.offer_prod_rel t1
          left join cpc.product t3
            on t1.prod_id = t3.prod_id
          left join cpc.offer_obj_rel t2
            on t1.offer_prod_rel_id = t2.offer_obj_rel_id
         where t2.offer_obj_rel_id is null

    - |
      insert into cpc.offer_prod_rel_rstr_cfg
        (create_date,
         create_staff,
         update_date,
         offer_prod_rel_cfg_id,
         offer_prod_rel_id,
         prod_id,
         default_count,
         rstr_type,
         min_num,
         max_num,
         apply_region_id,
         status_cd)
        select %(default_create_date)s,
               %(default_create_user)s,
               sysdate,
               cpc.seq_offer_prod_rel_rstr_cfg.nextval,
               t1.offer_prod_rel_id,
               t1.prod_id,
               1,
               t3.attr_value,
               1,
               1,
               t1.apply_region_id,
               1000
          from cpc.offer_prod_rel t1
          left join cpc.offer_prod_rel_rstr_cfg t2
            on t1.offer_prod_rel_id = t2.offer_prod_rel_id
          left join cpc.attr_value t3
            on t1.remark = trim(t3.attr_value_name)
           and t3.attr_id = 800052231
           and t3.status_cd = '1000'
         where t2.offer_prod_rel_id is null
           and t1.remark is not null

    - |
      insert into cpc.prod_attr
        (prod_attr_id,
         prod_id,
         par_prod_attr_id,
         default_value,
         apply_region_id,
         status_cd,
         create_staff,
         create_date,
         status_date,
         update_date,
         attr_id,
         attr_nbr,
         grp_attr_nbr,
         remark)
        select cpc.seq_prod_attr.nextval,
               t2.prod_id,
               -1,
               t3.default_value,
               %(default_apply_region_id)s,
               1000,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               sysdate,
               t3.attr_id,
               -1,
               -1,
               t3.attr_name
          from dc_config_offer_basic_info t1
         inner join cpc.product t2
            on t1.offer_name = t2.prod_name
         inner join DC_CONFIG_ATTRIBUTE_DETAIL t3
            on t3.attr_name = 'Whether to Provisioning'
          left join cpc.prod_attr t6
            on t2.prod_id = t6.prod_id
           and t3.attr_id = t6.attr_id
         where t1.is_need_privisioning = 'Y'
           and t6.prod_attr_id is null
           and t2.prod_func_type <> '101'
    - |
      insert into cpc.prod_attr_ext
        (prod_attr_id,
         table_name,
         field_name,
         cname,
         attr_value_type_id,
         is_check,
         is_make_to_table,
         is_edit,
         is_make,
         is_send_bill,
         is_print)
        select t1.prod_attr_id,
               t2.table_name,
               t2.field_name,
               t2.display_name,
               t2.value_type,
               t2.is_check,
               t2.is_make_to_table,
               t2.is_edit,
               t2.is_make,
               t2.is_send_bill,
               t2.is_print
          from cpc.prod_attr t1
         inner join DC_CONFIG_ATTRIBUTE_DETAIL t2
            on t1.attr_id = t2.attr_id
          left join cpc.prod_attr_ext t3
            on t1.prod_attr_id = t3.prod_attr_id
         where t3.prod_attr_id is null

    - |
      insert into cpc.prod_attr_value
        (prod_attr_value_id,
         prod_attr_id,
         apply_region_id,
         status_cd,
         create_staff,
         update_staff,
         create_date,
         status_date,
         update_date,
         attr_value_id)
        select cpc.seq_prod_attr_value.nextval,
               t1.prod_attr_id,
               t1.APPLY_REGION_ID,
               1000,
               %(default_create_user)s,
               %(default_create_user)s,
               %(default_create_date)s,
               sysdate,
               sysdate,
               t2.attr_value_id
          from cpc.prod_attr t1
         inner join DC_CONFIG_ATTRIBUTE_DETAIL t4
            on t1.attr_id = t4.attr_id
         inner join cpc.attr_value t2
            on t1.attr_id = t2.attr_id
           and t2.status_cd = '1000'
          left join cpc.prod_attr_value t3
            on t1.prod_attr_id = t3.prod_attr_id
         where t3.prod_attr_id is null


  update_dc_offer_config_privisioning_offer:
    - |
      update cpc.product tt1
         set (prod_name, prod_nbr, grp_prod_nbr, eff_date, exp_date) =
             (select offer_name,
                     t1.offer_nbr,
                     t1.offer_nbr,
                     nvl(to_date(t1.EFF_DATE, %(default_date_format)s),
                         t2.EFF_DATE),
                     nvl(to_date(t1.EXP_DATE, %(default_date_format)s),
                         t2.EXP_DATE)
                from dc_config_offer_basic_info t1
               inner join cpc.product t2
                  on t1.new_offer_id = t2.prod_id
               where tt1.prod_id = t1.new_offer_id
                 and t1.offer_nbr is not null)
       where prod_id in
             (select new_offer_id from dc_config_offer_basic_info where offer_nbr is not null)

BalanceAndOTC:
  dst_table:
    - cpc.con_res_detail
    - cpc.con_res
    - cpc.cbec_acct_item_type
    - cpc.CBEC_CURRENCY_TYPE
    - cpc.offer_ext_attr
    - cpc.cpc_otc_price
    - cpc.cpc_otc_price_rate
    - cpc.cpc_otc_price_benefit
    - cpc.REF_VALUE
    - cpc.PRICE
    - cpc.period
    - cpc.sub_bal_type
    - cpc.event_benefit
    - cpc.RE_PP_RECURRING
    - cpc.RE_PRICE_SET
    - cpc.MAPPING
    - cpc.PRICE_VER
    - cpc.RATE_PLAN
    - cpc.CPC_RENT_PRIORITY

  mid_table:
    - DC_CONFIG_OFFER_OTC_RENT
    - DC_CONFIG_BASIC_BALANCE_INFO
    - DC_CONFIG_CHARGE_ITEM
    - DC_CONFIG_CURRENCY_TYPE

  reserve_table:
    cbec_acct_res :
       "select * from cpc.cbec_acct_res where acct_res_id >= 10000"

    re :
       "select * from cpc.re  where re_id >= 10000 "

  insert_basic_balance:

    - |
      INSERT INTO CPC.CBEC_CURRENCY_TYPE (CURRENCY_TYPE_ID, CURRENCY_CODE, CURRENCY_SYMBOL, CURRENCY_NAME, SAVE_PRECISION,
                                          DISPLAY_SCALE, RATE_DISPLAY_SCALE, ROUND_METHOD, STATE, CREATED_DATE, PARTY_TYPE,
                                          PARTY_CODE)
       select CBEC_CURRENCY_TYPE_SEQ.nextval,
             C.CURRENCY_CODE,
             C.CURRENCY_SYMBOL,
             C.CURRENCY_NAME,
             C.SAVE_PRECISION,
             C.DISPLAY_SCALE,
             C.RATE_DISPLAY_SCALE,
             C.ROUND_METHOD,
             'A',
             SYSDATE,
             NULL,
             NULL
       from DC_CONFIG_CURRENCY_TYPE C
         where c.CURRENCY_CODE not in
           (SELECT CURRENCY_CODE FROM CPC.CBEC_CURRENCY_TYPE)

    - |
       insert into cpc.cbec_acct_res
        (acct_res_id,
         bal_type,
         acct_res_name,
         is_currency,
         comments,
         refillable,
         unit_id,
         unit_precision,
         currency_type_id,
         overdraft_flag,
         state,
         created_date,
         pack_inner,
         exclude_pack_inner)
         select case when t1.PRE_DEF_ACCT_RES_ID is not null then  t1.PRE_DEF_ACCT_RES_ID
                 else CBEC_ACCT_RES_SEQ.nextval end,
                 decode(t1.bal_type, 'Basic Balance', 1,'Non Currency Balance', 4,'Limited Balance', 2,'Given Balance', 3, 'Bonus Balance', 5, 'Credit Balance', 6),
                t1.acct_res_name,
                t1.is_currency,
                concat(%(default_project)s,t1.old_res_id),
                t1.refillable,
                decode(t1.unit_type,'Second' ,1,'Byte', 4,'Occurrence',8),
                t2.SAVE_PRECISION,
                t2.CURRENCY_TYPE_ID,
                'N',
                'A',
                sysdate,
                'Y',
                'Y'
          from DC_CONFIG_BASIC_BALANCE_INFO t1, cpc.CBEC_CURRENCY_TYPE t2
           where t1.bal_type = 'Basic Balance'
             and t1.CURRENCY_CODE = t2.CURRENCY_CODE
    - |
       insert into cpc.cbec_acct_res
        (acct_res_id,
         bal_type,
         acct_res_name,
         is_currency,
         comments,
         refillable,
         unit_id,
         unit_precision,
         currency_type_id,
         overdraft_flag,
         state,
         created_date,
         pack_inner,
         exclude_pack_inner)
          select case when t1.PRE_DEF_ACCT_RES_ID is not null then  t1.PRE_DEF_ACCT_RES_ID
                 else CBEC_ACCT_RES_SEQ.nextval end,
                 decode(t1.bal_type, 'Basic Balance', 1,'Non Currency Balance', 4,'Limited Balance', 2,'Given Balance', 3, 'Bonus Balance', 5, 'Credit Balance', 6),
                t1.acct_res_name,
                t1.is_currency,
                concat(%(default_project)s,t1.old_res_id),
                t1.refillable,
                decode(t1.unit_type,'Second' ,1,'Byte', 4,'Occurrence',8),
                1,
                NULL,
                'N',
                'A',
                sysdate,
                'Y',
                'Y'
           from DC_CONFIG_BASIC_BALANCE_INFO t1
            where t1.bal_type <> 'Basic Balance'

    - |
       insert into cpc.cbec_acct_item_type
         (
          ACCT_ITEM_TYPE_ID,
          ACCT_RES_ID,
          ACCT_ITEM_TYPE_NAME,
          state,
          created_date,
          COMMENTS
         )
        select SEQ_ACCT_ITEM_TYPE.nextval,
                t1.acct_res_id,
                t1.acct_res_name,
                'A',
                sysdate,
                concat(%(default_project)s,' no currency resources')
          from cpc.cbec_acct_res t1 where t1.bal_type <> 1  and substr(t1.comments,1,LENGTH(%(default_project)s))= %(default_project)s

  insert_cbec_acct_item_type:
    - |
      insert into cpc.cbec_acct_item_type
        (
         ACCT_ITEM_TYPE_ID,
         ACCT_RES_ID,
         ACCT_ITEM_TYPE_NAME,
         state,
         created_date,
         COMMENTS
         )
         select SEQ_ACCT_ITEM_TYPE.nextval,
                1,
                t1.acct_item_type_name,
                'A',
                sysdate,
                 concat(%(default_project)s,t1.old_charge_item_id)
          from DC_CONFIG_CHARGE_ITEM t1
  insert_cbec_acct_item_tax:
    - |
       insert into cpc.CBEC_ACCT_ITEM_TYPE_TAX_RATE
          select CBEC_ACCT_IT_TAX_R_SEQ.Nextval,
                 t.acct_item_type_id,
                 t.acct_item_type_id,
                 'G',
                 c.tax_rate,
                 sysdate,
                 sysdate + 36500,
                 'A',
                 sysdate,
                 NULL,
                 NULL,
                 CBEC_COND_GROUP_SEQ.nextval,
                 0
          from cpc.cbec_acct_item_type t,
               DC_CONFIG_CHARGE_ITEM c
          where t.ACCT_ITEM_TYPE_NAME = c.acct_item_type_name
            and t.ACCT_RES_ID = 1
            and c.tax_rate>0
            and substr(t.comments, 1, LENGTH(%(default_project)s)) = %(default_project)s

    - |
       insert into cpc.CBEC_CONDITION_GROUP
          (condition_group_id, condition_group_nbr, sub_grp_nbr, seq_no, l_re_attr, sort_operator, r_value_type, r_value, state,
           sp_id)
          select r.CONDITION_GROUP_NBR,
                 r.CONDITION_GROUP_NBR,
                 1,
                 1,
                 10363,
                 4,
                 'A',
                 'Y',
                 'A',
                 0
        from cpc.CBEC_ACCT_ITEM_TYPE_TAX_RATE r,
               cpc.cbec_acct_item_type c,
               DC_CONFIG_CHARGE_ITEM t
          where r.ACCT_ITEM_TYPE_ID = c.ACCT_ITEM_TYPE_ID
            and c.ACCT_ITEM_TYPE_NAME = t.acct_item_type_name
            and c.ACCT_RES_ID = 1
            and t.tax_rate>0
            and substr(c.comments, 1, LENGTH(%(default_project)s)) = %(default_project)s


  insert_con_res:
    - |
      insert into cpc.con_res
         (
          con_res_id,
          bal_source_type,
          con_res_name,
          CON_RES_CODE,
          comments,
          is_currency,
          currency_type_id,
          unit_precision
         )
         select CON_RES_ID_SEQ.nextval,
                1,
                t1.acct_item_type_name,
                t1.ACCT_ITEM_TYPE_ID,
                 concat(%(default_project)s,' local currency consumption'),
                'Y',
              t2.CURRENCY_TYPE_ID,
              %(default_local_currency_precision)s
         from cpc.cbec_acct_item_type t1 , cpc.cbec_acct_res t2 , cpc.DC_CONFIG_CHARGE_ITEM t3
          where t1.acct_res_id =  t2.acct_res_id
            and t2.bal_type = 1
            and t1.acct_item_type_name=t3.acct_item_type_name
            and substr(t1.comments,1,LENGTH(%(default_project)s))= %(default_project)s

    - |
      insert into cpc.con_res_detail
           (
            con_res_detail_id,
            con_res_id,
            acct_res_id,
            acct_item_type_id,
            pay_indicator,
            exchange_rate,
            exchange_value,
            priority,
            comments
           )
           select CON_RES_DETAIL_ID_SEQ.nextval,
                  t1.con_res_id,
                  1,
                  to_number(t1.CON_RES_CODE),
                  '000',
                  100,
                  100,
                  1,
                  sysdate
           from cpc.con_res t1 ,DC_CONFIG_CHARGE_ITEM t2
           WHERE substr(t1.comments,1,LENGTH(%(default_project)s))= %(default_project)s
           and t1.con_res_name=t2.acct_item_type_name;

  update_basic_info:
    - |
       UPDATE DC_CONFIG_OFFER_OTC_RENT T
       SET (T.NEW_OFFER_ID, T.PRICE_PLAN_ID)=(SELECT O.OFFER_ID, P.PRICE_PLAN_ID
                                              FROM cpc.OFFER O,
                                                   cpc.PRICE_PLAN P
                                              WHERE T.OFFER_NAME = O.OFFER_NAME
                                                AND O.OFFER_NAME = P.PRICE_PLAN_NAME)
       WHERE EXISTS
                 (SELECT 1
                  FROM cpc.OFFER O,
                       cpc.PRICE_PLAN P
                  WHERE T.OFFER_NAME = O.OFFER_NAME
                    AND O.OFFER_NAME = P.PRICE_PLAN_NAME)

    - |
       UPDATE DC_CONFIG_OFFER_OTC_RENT T
       SET T.NEW_ACCT_RES_ID=(SELECT C.ACCT_RES_ID
                                   FROM cpc.CBEC_ACCT_RES C
                                   WHERE C.ACCT_RES_NAME = T.OLD_ACCT_RES_NAME)
       WHERE EXISTS
                (SELECT 1
                         FROM cpc.CBEC_ACCT_RES C
                                   WHERE C.ACCT_RES_NAME = T.OLD_ACCT_RES_NAME)

    - |
        UPDATE DC_CONFIG_OFFER_OTC_RENT T
        SET T.NEW_ACCT_ITEM_TYPE_ID=(SELECT C.ACCT_ITEM_TYPE_ID
                                     FROM cpc.CBEC_ACCT_ITEM_TYPE C
                                     WHERE C.ACCT_ITEM_TYPE_NAME = T.ACCT_ITEM_TYPE_NAME)
        WHERE EXISTS
                  (SELECT 1
                   FROM cpc.CBEC_ACCT_ITEM_TYPE C
                   WHERE C.ACCT_ITEM_TYPE_NAME= T.ACCT_ITEM_TYPE_NAME)


  insert_offer_rent_priority:
    - |
        INSERT INTO cpc.CPC_RENT_PRIORITY
         SELECT SEQ_CPC_RENT_PRIORITY_ID.nextval,
               3,
               T1.NEW_OFFER_ID,
               T1.RENEW_PRIORITY,
               %(default_create_user)s,
               SYSDATE,
               NULL,
               NULL,
               'A'
              FROM DC_CONFIG_OFFER_OTC_RENT T1

  insert_offer_attr_ext:
    - |
        insert into cpc.offer_attr
              (offer_attr_id,
               offer_id,
               default_value,
               obj_type,
               obj_id,
               apply_region_id,
               status_cd,
               create_staff,
               create_date,
               update_date,
               attr_name,
               attr_id,REMARK)
              select cpc.seq_offer_attr.nextval,
                     t1.NEW_OFFER_ID,
                     'Y',
                     110000,
                       t1.NEW_OFFER_ID,
                    %(default_apply_region_id)s,
                     1000,
                    %(default_create_user)s,
                     sysdate,
                     sysdate,
                     'Auto Renewal',
                     60097,
                    concat(%(default_project)s,' AUTO RENEWAL')
                from DC_CONFIG_OFFER_OTC_RENT  t1  where t1.EVENT_TYPE = 'RENT' AND t1.SEQ=1

    - |
       insert into cpc.offer_attr_ext
        (offer_attr_id,
         table_name,
         param_name,
         cname,
         value_type,
         is_check,
         is_make_to_table,
         is_edit,
         is_make,
         is_send_bill,
         is_print)
        select t1.offer_attr_id,
               'OFFER_INST',
               'col3',
               'Auto Renewal',
               '98A',
                'T', 'T', 'T', 'T','T',
                'T'
          from cpc.offer_attr t1 WHERE substr(t1.REMARK,1,LENGTH(%(default_project)s))= %(default_project)s

    - |
       insert into cpc.offer_attr_value
          (offer_attr_value_id,
           offer_attr_id,
           region_id,
           status_cd,
           create_staff,
           create_date,
           update_date,
           attr_value_id)
          select cpc.seq_offer_attr_value.nextval,
                 t1.offer_attr_id,
                 t1.APPLY_REGION_ID,
                 1000,
                 %(default_create_user)s,
                 sysdate,
                 sysdate,
                 700443
            from cpc.offer_attr t1, cpc.offer_attr_ext  t2
            where t1.OFFER_ATTR_ID = t2.OFFER_ATTR_ID
            and  substr(t1.REMARK,1,LENGTH(%(default_project)s))= %(default_project)s

    - |
        insert into cpc.offer_attr_value
          (offer_attr_value_id,
           offer_attr_id,
           region_id,
           status_cd,
           create_staff,
           create_date,
           update_date,
           attr_value_id)
          select cpc.seq_offer_attr_value.nextval,
                 t1.offer_attr_id,
                 t1.APPLY_REGION_ID,
                 1000,
                 %(default_create_user)s,
                 sysdate,
                 sysdate,
                 700444
            from cpc.offer_attr t1, cpc.offer_attr_ext  t2
            where t1.OFFER_ATTR_ID = t2.OFFER_ATTR_ID
            and  substr(t1.REMARK,1,LENGTH(%(default_project)s))= %(default_project)s

  insert_offer_ext_attr:
    - |
       insert into cpc.OFFER_EXT_ATTR
          select SEQ_OFFER_EXT_ATTR.nextval,
         o.NEW_OFFER_ID,
         60085,
         case
             when o.EVENT_TYPE = 'RENT' then 'Y'
             when  o.EVENT_TYPE = 'OTC' then 'N' END,
          %(default_apply_region_id)s,
          1000,
          %(default_create_user)s,
         null,
         null,
         sysdate,
         sysdate,
         null,
         'isPeriodic'
        from DC_CONFIG_OFFER_OTC_RENT o WHERE O.SEQ=1

    - |
       insert into cpc.OFFER_EXT_ATTR
          select SEQ_OFFER_EXT_ATTR.nextval,
           o.NEW_OFFER_ID,
           60031,
             cast(o.RECURRING_PRICE as number(15,2)),
            %(default_apply_region_id)s,
            1000,
          %(default_create_user)s,
           null,
           null,
           sysdate,
           sysdate,
           null,
           'rent price'
         from DC_CONFIG_OFFER_OTC_RENT o where  O.SEQ=1 AND o.EVENT_TYPE = 'RENT'

    - |
       insert into cpc.OFFER_EXT_ATTR
        select SEQ_OFFER_EXT_ATTR.nextval,
         o.NEW_OFFER_ID,
         60071,
         case when o.recurring_re_type like 'Variable%%'  then 'Y' else 'N' end,
          %(default_apply_region_id)s,
          1000,
         %(default_create_user)s,
         null,
         null,
         sysdate,
         sysdate,
         null,
         'Precise Flag'
       from DC_CONFIG_OFFER_OTC_RENT o where  O.SEQ=1 AND o.EVENT_TYPE = 'RENT'

    - |
       insert into cpc.OFFER_EXT_ATTR
        select SEQ_OFFER_EXT_ATTR.nextval,
               o.NEW_OFFER_ID,
               60018,
               case
                   when o.OFFER_INST_VALID_UNIT = 'day' then 1
                   when o.OFFER_INST_VALID_UNIT = 'week' then 2
                   when o.OFFER_INST_VALID_UNIT = 'month' then 3
                   when o.OFFER_INST_VALID_UNIT = 'year' then 4
                   when o.OFFER_INST_VALID_UNIT = 'Billing Cycle' then 5 end,
               %(default_apply_region_id)s,
               1000,
               %(default_create_user)s,
               null,
               null,
               sysdate,
               sysdate,
               null,
               'EXP RENTAL TYPE'
        from DC_CONFIG_OFFER_OTC_RENT o
        where O.SEQ=1 AND o.EVENT_TYPE = 'RENT'

    - |
       insert into cpc.OFFER_EXT_ATTR
        select SEQ_OFFER_EXT_ATTR.nextval,
               o.NEW_OFFER_ID,
               60019,
               o.OFFER_INST_VALID_DURATION,
               %(default_apply_region_id)s,
               1000,
               %(default_create_user)s,
               null,
               null,
               sysdate,
               sysdate,
               null,
               'EXP RENTAL DAYS'
         from DC_CONFIG_OFFER_OTC_RENT o
        where o.EVENT_TYPE = 'RENT' AND O.SEQ = 1

    - |
       insert into cpc.OFFER_EXT_ATTR
          select SEQ_OFFER_EXT_ATTR.nextval,
           o.NEW_OFFER_ID,
           60102,
             o.ADVANCED_NOTIFICATION,
            %(default_apply_region_id)s,
            1000,
            %(default_create_user)s,
           null,
           null,
           sysdate,
           sysdate,
           null,
           'Rent Advance Notification Flag'
          from DC_CONFIG_OFFER_OTC_RENT o where  O.SEQ=1 AND O.advanced_notification = 'Y'
    - |
       insert into cpc.OFFER_EXT_ATTR
        select SEQ_OFFER_EXT_ATTR.nextval,
           o.NEW_OFFER_ID,
           60091,
             'Y',
            %(default_apply_region_id)s,
            1000,
          %(default_create_user)s,
           null,
           null,
           sysdate,
           sysdate,
           null,
           'is rent pcrf'
         from DC_CONFIG_OFFER_OTC_RENT o where  O.SEQ=1 AND o.EVENT_TYPE = 'RENT' AND o.IS_PCRF='Y'

  insert_cpc_otc:
    - |
      insert into cpc.CPC_OTC_PRICE
         (
          price_id,
          offer_id,
          service_offer_id,
          price_method,
          priority,
          is_list_price,
          create_staff
          )
         select SEQ_OTC_PRICE_ID.nextval,
              o.NEW_OFFER_ID,
               1,'2',1,'N', %(default_create_user)s
         from DC_CONFIG_OFFER_OTC_RENT o WHERE O.SEQ = 1

    - |
      insert into cpc.CPC_OTC_PRICE_RATE
         (
          RATE_ID           ,
          PRICE_ID         ,
          ACCT_ITEM_TYPE_ID ,
          VALUE          ,
          VALUE_EXP      ,
          VALUE_EXP_NAME
          )
         select SEQ_OTC_RATE_ID.nextval,
                R.PRICE_ID,
                O.NEW_ACCT_ITEM_TYPE_ID,
                -1*o.subscription_price*%(default_local_currency_precision)s,
                NULL,
                NULL
         from DC_CONFIG_OFFER_OTC_RENT o,  cpc.CPC_OTC_PRICE R
          WHERE  O.NEW_OFFER_ID = R.OFFER_ID and o.seq = 1

    - |
      INSERT INTO cpc.CPC_OTC_PRICE_BENEFIT
        (
            BENEFIT_ID       ,
            PRICE_ID         ,
            VALUE            ,
            ACCT_RES_ID      ,
            REL_EFF_OFFSET   ,
            REL_EFF_UNIT     ,
            REL_EXP_OFFSET   ,
            REL_EXP_UNIT     ,
            BENEFIT_LEVEL
        )
        SELECT  SEQ_OTC_BENEFIT_ID.nextval,
                R.PRICE_ID,
                O.BENEFIT_VALUE,
                O.NEW_ACCT_RES_ID,
                0,
                'S',
                O.BENEFIT_DURATION,
                O.BENEFIT_DURATION_UNIT,
                'S'
        FROM DC_CONFIG_OFFER_OTC_RENT o,cpc.CPC_OTC_PRICE R
        WHERE O.NEW_OFFER_ID = R.OFFER_ID

  insert_RENT_RE:
    - |
       INSERT INTO cpc.RE
         (
          RE_ID,
          RE_NAME,
          RE_TYPE,
          RE_CODE,
          COMMENTS,
          RE_DISPLAY_NAME
         )
         SELECT Re_Id_Seq.Nextval,
             concat(concat(t.RECURRING_RE_TYPE,'_'), t.OFFER_NAME)  ,
              '9',
              null,
              concat(%(default_project)s,r.RECURRING_RE_TYPE),
              null
         FROM DC_CONFIG_OFFER_OTC_RENT t,cpc.RECURRING_RE_TYPE r
         where t.EVENT_TYPE = 'RENT'
           and t.SEQ = 1
           and t.RECURRING_RE_TYPE = r.RECURRING_RE_TYPE_NAME


    - |
        INSERT INTO cpc.RE_PP_RECURRING
         (RE_ID,
          RECURRING_RE_TYPE,
          PRICE_PLAN_VER_ID,
          PRICE_PLAN_ID,
          STATE,
          SP_ID)
         select r.re_id,
                regexp_substr(r.comments, '\d'),
                v.PRICE_PLAN_VER_ID,
                p.price_plan_id,
                'A',
                NULL
         from cpc.price_plan_ver v,
              cpc.PRICE_PLAN p,
              cpc.RE r
         where p.PRICE_PLAN_ID = v.PRICE_PLAN_ID
           and SUBSTR(r.RE_NAME, INSTR(r.RE_NAME, '_') + 1) = p.PRICE_PLAN_NAME
           and  substr(r.comments,1,LENGTH(%(default_project)s)) = %(default_project)s

    - |
       INSERT INTO cpc.RE_PRICE_SET
       (RE_PRICE_SET_ID,
        RE_ID,
        PRICE_SET_ID,
        WORKFLOW_ID,
        POST_WORKFLOW_ID,
        RULE_COMMENTS)
       select RE_PRICE_SET_ID_SEQ.NEXTVAL,
              r.re_id,
              p.price_set_id,
              null,
              null,
              CONCAT('RENT_', SYSDATE)
       from cpc.RE_PP_RECURRING r,
            cpc.price_plan_member p,
            cpc.re
       where r.price_plan_ver_id = p.price_plan_ver_id
         and re.re_id = r.re_id
         and re.RE_TYPE = 9
         and  substr(re.comments,1,LENGTH(%(default_project)s)) = %(default_project)s

  insert_RATING_RATE_PLAN:

    -  |
        insert into CPC.RATE_PLAN
        (RATE_PLAN_ID, RATE_PLAN_NAME, RATE_PLAN_TYPE, RATE_CHARGE_TYPE, RE_PRICE_SET_ID, MAPPING_TYPE, PRIORITY, COMMENTS,
         CREATED_DATE, STATE, STATE_DATE, MAPPING_EXIT, SP_ID)
        select RATE_PLAN_ID_SEQ.NEXTVAL,
               concat(b.OFFER_NAME, ' Rent RP'),
               1,
               'M',
               a.re_price_set_id,
               'D',
               1,
               'Rent RP',
               sysdate,
               'A',
               sysdate,
               null,
               null
        from CPC.re_price_set a,
             DC_CONFIG_OFFER_OTC_RENT b,
             CPC.re_pp_recurring c
        where c.price_plan_id = b.price_plan_id
          and c.re_id = a.re_id
          and b.SEQ = 1

    -  |
        insert into CPC.MAPPING (MAPPING_ID, MAPPING_NAME, RATE_PLAN_ID, PRIORITY, MAPPING_DEFAULT, SP_ID)
         select MAPPING_ID_SEQ.NEXTVAL,
               t.rate_plan_name,
               t.rate_plan_id,
               0,
               null,
               null
         from CPC.rate_plan t
         where t.comments = 'Rent RP'

    -  |
        insert into CPC.PRICE_VER (PRICE_VER_ID, MAPPING_ID, EFF_DATE, EXP_DATE, SP_ID)
          select price_ver_id_seq.nextval,
                 t.mapping_id,
                 TO_DATE('2000-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
                 null,
                 null
          from CPC.mapping t,
               CPC.rate_plan r
          where t.rate_plan_id = r.rate_plan_id
            and r.comments = 'Rent RP'

    -  |
        insert into CPC.REF_VALUE
        (REF_VALUE_ID, REF_VALUE_TYPE, VALUE_STRING, CREATED_DATE, STATE, STATE_DATE, PRICE_ID, RATE_PLAN_ID, PRICE_SET_ID,
         SP_ID)
         select REF_VALUE_ID_SEQ.NEXTVAL,
               9,
               c.con_res_id,
               sysdate,
               'A',
               sysdate,
               price_id_seq.nextval,
               rp.rate_plan_id,
               s.price_set_id,
               0
         from CPC.rate_plan rp,
             DC_CONFIG_OFFER_OTC_RENT O,
             CPC.re_pp_recurring r,
             CPC.re_price_set s,
             CPC.con_res_detail c
         where O.price_plan_id = r.price_plan_id
            and r.re_id = s.re_id
            and s.re_price_set_id = rp.re_price_set_id
            and rp.rate_plan_type = 1
            and c.acct_item_type_id = O.NEW_ACCT_ITEM_TYPE_ID
            and  O.SEQ = 1

    -  |
        insert into CPC.REF_VALUE (REF_VALUE_ID, REF_VALUE_TYPE, VALUE_STRING, CREATED_DATE, STATE, STATE_DATE, PRICE_ID,
                       RATE_PLAN_ID, PRICE_SET_ID, SP_ID)
         select REF_VALUE_ID_SEQ.NEXTVAL,
               1,
               O.recurring_price,
               sysdate,
               'A',
               sysdate,
               rv.price_id,
               rv.rate_plan_id,
               rv.price_set_id,
               0
         from  CPC.rate_plan rp,
               DC_CONFIG_OFFER_OTC_RENT O,
               CPC.re_pp_recurring r,
               CPC.re_price_set s,
               CPC.ref_value rv,
               CPC.con_res_detail c
         where O.price_plan_id = r.price_plan_id
            and r.re_id = s.re_id
            and s.re_price_set_id = rp.re_price_set_id
            and rp.rate_plan_type = 1
            and to_number(rv.value_string) = c.con_res_id
            and c.acct_item_type_id = O.NEW_ACCT_ITEM_TYPE_ID
            and rv.ref_value_type = 9
            and O.SEQ = 1
            and rv.rate_plan_id = rp.rate_plan_id

    -  |
        insert into CPC.PRICE (PRICE_ID, PRICE_NAME, REF_VALUE_ID, RUM, RE_ATTR, PRICE_TYPE, CALC_TYPE, PRICE_VER_ID, CON_RES_ID,
                   CURRENCY_TYPE_ID, COMMENTS, PRIORITY, SRC_PRICE_ID, SP_ID, CONFIGURE_TYPE, MIN_RUM)
          select rv1.price_id,
                 concat(rp.rate_plan_name, ' Price'),
                 rv1.ref_value_id,
                 1,
                 10002,
                 null,
                 null,
                 pv.price_ver_id,
                 rv2.ref_value_id,
                 null,
                 'Rent Rating',
                 1,
                 null,
                 null,
                 1,
                 null
          from CPC.ref_value rv1,
               CPC.rate_plan rp,
               CPC.price_ver pv,
               CPC.mapping m,
               CPC.ref_value rv2
          where rv1.ref_value_type = 1
            and rv2.ref_value_type = 9
            and rv1.rate_plan_id = rp.rate_plan_id
            and rv2.rate_plan_id = rp.rate_plan_id
            and rp.rate_plan_id = m.rate_plan_id
            and m.mapping_id = pv.mapping_id
            and rp.rate_plan_type = 1
            and rp.comments like 'Rent RP'

  insert_BENEFIT_RATE_PLAN:

    -  |
        insert into cpc.RATE_PLAN
          (RATE_PLAN_ID,
           RATE_PLAN_NAME,
           RATE_PLAN_TYPE,
           RATE_CHARGE_TYPE,
           RE_PRICE_SET_ID,
           MAPPING_TYPE,
           PRIORITY,
           COMMENTS,
           CREATED_DATE,
           STATE,
           STATE_DATE,
           MAPPING_EXIT,
           SP_ID)
          select RATE_PLAN_ID_SEQ.NEXTVAL,
                 concat(O.OFFER_NAME, ' Benefit'),
                 3,
                 'M',
                 a.re_price_set_id,
                 'D',
                 1,
                 'Rent Benefit',
                 sysdate,
                 'A',
                 sysdate,
                 null,
                 null
            from cpc.re_price_set a, DC_CONFIG_OFFER_OTC_RENT O, cpc.re_pp_recurring c
           where c.price_plan_id = O.price_plan_id
             and c.re_id = a.re_id
             and O.SEQ = 1

    -  |
        insert into cpc.MAPPING (MAPPING_ID, MAPPING_NAME, RATE_PLAN_ID, PRIORITY, MAPPING_DEFAULT, SP_ID)
          select MAPPING_ID_SEQ.NEXTVAl,
                 t.rate_plan_name,
                 t.rate_plan_id,
                 0,
                 null,
                 null
          from cpc.rate_plan t
          where t.comments = 'Rent Benefit'

    -  |
        insert into cpc.PRICE_VER(PRICE_VER_ID, MAPPING_ID, EFF_DATE)
          select price_ver_id_seq.nextval,
            t.mapping_id,
            TO_DATE('2000-02-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
          from cpc.mapping t,
               cpc.rate_plan r
          where t.rate_plan_id = r.rate_plan_id
            and r.comments = 'Rent Benefit'

    -  |
        insert into REF_VALUE
          (REF_VALUE_ID, REF_VALUE_TYPE, VALUE_STRING, COMMENTS,CREATED_DATE, STATE, STATE_DATE, PRICE_ID, RATE_PLAN_ID, PRICE_SET_ID, SP_ID)
          select REF_VALUE_ID_SEQ.NEXTVAL,
                 1,
                 -1*O.BENEFIT_VALUE,
                 concat('benefit',O.NEW_ACCT_RES_ID),
                 sysdate,
                 'A',
                 sysdate,
                 price_id_seq.nextval,
                 rp.rate_plan_id,
                 s.price_set_id,
                 0
          from  CPC.rate_plan rp,
                DC_CONFIG_OFFER_OTC_RENT O,
                CPC.re_pp_recurring r,
                CPC.re_price_set s
          where
            O.price_plan_id = r.price_plan_id
            and r.re_id = s.re_id
            and s.re_price_set_id = rp.re_price_set_id
            and rp.rate_plan_type = 3
            and O.BENEFIT_VALUE is not null
    -  |
        DROP TABLE    DC_CONFIG_OFFER_OTC_RENT_NEW

    -  |
        create table DC_CONFIG_OFFER_OTC_RENT_NEW as
          (select period_id_seq.nextval PERIOD_ID,
                   sub_bal_type_id_seq.nextval sub_bal_type_id,
                 0 REL_EFF_OFFSET,
                  'S' rel_eff_unit,
                  O.BENEFIT_DURATION REL_EXP_OFFSET,
                 O.BENEFIT_DURATION_UNIT  REL_EXP_UNIT ,
                 0 SP_ID,
                 O.price_plan_id,
                 O.OFFER_NAME,
                 O.NEW_ACCT_RES_ID,
                 O.BENEFIT_VALUE,
                 rp.rate_plan_id
                 from  CPC.rate_plan rp,DC_CONFIG_OFFER_OTC_RENT O, CPC.re_pp_recurring r, CPC.re_price_set s
           where O.price_plan_id=r.price_plan_id
           and  r.re_id=s.re_id
           and s.re_price_set_id=rp.re_price_set_id
           and  rp.rate_plan_type =3
           and  O.BENEFIT_VALUE is not null)


    -  |
        insert into cpc.PERIOD
          (PERIOD_ID,
           REL_EFF_OFFSET,
           REL_EFF_UNIT,
           REL_EXP_OFFSET,
           REL_EXP_UNIT)
          select t.period_id,
                 t.rel_eff_offset,
                 t.rel_eff_unit,
                 t.rel_exp_offset,
                 t.rel_exp_unit
          from  DC_CONFIG_OFFER_OTC_RENT_NEW t

    -  |
        insert into cpc.sub_bal_type(SUB_BAL_TYPE_ID,ACCT_RES_ID,PERIOD_ID)
         select  t.sub_bal_type_id,
                t.NEW_ACCT_RES_ID,
                t.period_id
          from DC_CONFIG_OFFER_OTC_RENT_NEW t


    -  |
        insert into cpc.event_benefit
          (PRICE_ID,
           PRICE_NAME,
           REF_VALUE_ID,
           RE_ATTR,
           PRICE_VER_ID,
           SUB_BAL_TYPE_ID,
           RUM,
           COMMENTS)
          select rv1.price_id,
                 concat(rp.rate_plan_name, 'Benefit Detail'),
                 rv1.ref_value_id,
                 10002,
                 pv.price_ver_id,
                 O.sub_bal_type_id,
                 1,
                 'benefit'
          from  CPC.ref_value rv1,
                CPC.rate_plan rp,
                CPC.price_ver pv,
                CPC.mapping m,
                DC_CONFIG_OFFER_OTC_RENT_NEW O
          where rv1.ref_value_type = 1
            and rv1.rate_plan_id = rp.rate_plan_id
            and rp.rate_plan_id = m.rate_plan_id
            and m.mapping_id = pv.mapping_id
            and rp.rate_plan_type = 3
            and O.rate_plan_id = rp.rate_plan_id
            and O.new_acct_res_id  = regexp_substr(rv1.comments, '\d+')
