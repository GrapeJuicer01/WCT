UserList:
    cc


BadData:
    AcctItem_No_Define:
        des: AcctItem_No_Define
        area: comm
        sql: "select *
                  from cc.ref_value a
                 where a.ref_value_type = '8'
                   and not exists (select 1
                          from cc.acct_item_type b
                         where a.value_string = b.acct_item_type_id)"

    AcmAcctItem_RefValue_Error:
        des: AcmAcctItem_RefValue_Error
        area: comm
        sql:
            "select *
              from cc.acm a, cc.price_ver b, cc.rate_plan c, cc.ref_value d
             where a.price_ver_id = b.price_ver_id
               and b.rate_plan_id = c.rate_plan_id
               and a.ref_value_id = d.ref_value_id
               and (a.price_id <> d.price_id or c.rate_plan_id <> d.rate_plan_id or c.offer_ver_id <> d.offer_ver_id)"

    AcmTemplet_No_Catalog:
        des: AcmTemplet_No_Catalog
        area: comm
        sql:  "select *
            from cc.acm a, cc.price_ver c
            where a.template_flag = 'Y'
                and not exists (select * from cc.price_catalog_element b where a.price_id = b.price_id)
                and a.price_ver_id = c.price_ver_id and c.rate_plan_id is null"

    AcmValue_RefValue_Error:
        des: AcmValue_RefValue_Error
        area: comm
        sql:  "select *
          from cc.acm a, cc.price_ver b, cc.rate_plan c, cc.ref_value d
         where a.price_ver_id = b.price_ver_id
           and b.rate_plan_id = c.rate_plan_id
           and a.value = d.ref_value_id
           and (a.price_id <> d.price_id or c.rate_plan_id <> d.rate_plan_id or c.offer_ver_id <> d.offer_ver_id)"

    BenefitTemplet_No_Catalog:
        des: BenefitTemplet_No_Catalog
        area: comm
        sql:   "select *
            from cc.event_benefit a
            where a.template_flag = 'Y'
                and not exists (select * from cc.price_catalog_element b where a.price_id = b.price_id)
                and a.price_ver_id is null"

    EventBenefit_RefValue_Error:
        des: EventBenefit_RefValue_Error
        area: comm
        sql:  "select *
          from cc.event_benefit a, cc.price_ver b, cc.rate_plan c, cc.ref_value d
         where a.price_ver_id = b.price_ver_id
           and b.rate_plan_id = c.rate_plan_id
           and a.value = d.ref_value_id
           and (a.price_id <> d.price_id or c.rate_plan_id <> d.rate_plan_id or c.offer_ver_id <> d.offer_ver_id)"

    Offer_No_Offer_Ver:
        sql:  "select *
              from cc.offer a
             where offer_type in (4, 6)
               and not exists (select 1
                      from cc.offer_ver b
                     where a.offer_id = b.offer_id
                       and (b.exp_date is null or b.exp_date > sysdate))
                       and state <>'X'"

    Price_and_RatePlan_Re_NotMatch:
        des: 检查资费模板和真正的资费的对应的事件是否一致
        area: comm
        sql:  "select f.offer_name, g.re_name, d.rate_plan_name, a.price_id, b.price_name
              from cc.price_template_mapping_re a, cc.price b, cc.price_ver c, cc.rate_plan d, cc.offer_ver e, cc.offer f,cc.re g
             where ((a.price_id = b.price_id and b.template_flag = 'Y') or
                   (a.price_id = b.src_price_id and b.template_flag = 'N'))
               and b.price_ver_id = c.price_ver_id
               and c.rate_plan_id = d.rate_plan_id
               and a.re_id <> d.re_id
               and d.offer_ver_id=e.offer_ver_id
               and e.offer_id=f.offer_id
               and d.re_id=g.re_id"

    PricePlan_No_Offer:
        sql:   "select * from cc.price_plan a
            where not exists (select 1 from cc.offer b where a.price_plan_id = b.offer_id and b.offer_type = 4)"

    PricePlan_Offer_No_Price_Plan:
        sql: "select * from cc.offer a
        where not exists (select 1 from cc.price_plan b where b.price_plan_id = a.offer_id) and a.offer_type = 4"

    PricePlan_Re_No_Reserve:
        sql:   "select distinct b.*
           from cc.rate_plan_mapping a, cc.re b
          where a.re_id = b.re_id
            and b.re_type = '1'
            and not exists (select 1 from cc.reserve_policy c where a.re_id = c.re_id)
            and not exists (select 1 from cc.RESERVE_POLICY_PROD_SPEC d where a.re_id = d.re_id)
            and upper(b.re_name) not like '%%SMS%%'
            and upper(b.re_name) not like '%%MMS%%'"

    PriceTemplate_No_Catalog:
        sql: "select * from cc.price a
        where a.template_flag = 'Y' and not exists (select * from cc.price_catalog_element b where a.price_id = b.price_id) and a.price_ver_id is null"

    PriceTemplate_One_Mapping_Multi_Re:
        des: 一个模板被多个Rate_plan所引用，但是Re_id不一样
        area: comm
        sql:   "select distinct d.rate_plan_id, d.rate_plan_name, b.price_id, b.price_name
         from cc.price_template_mapping_re a, cc.price b, cc.price_ver c, cc.rate_plan d , cc.re e
         where a.price_id = b.src_price_id
         and b.price_ver_id = c.price_ver_id
         and c.rate_plan_id = d.rate_plan_id
         and d.re_id = e.re_id
         and e.re_type <>'9'
         and a.re_id <> d.re_id"

    PriceValue_RefValue_Error:
        sql:   "select *
          from cc.price a, cc.price_ver b, cc.rate_plan c, cc.ref_value d
         where a.price_ver_id = b.price_ver_id
           and b.rate_plan_id = c.rate_plan_id
           and a.value = d.ref_value_id
           and (a.price_id <> d.price_id or c.rate_plan_id <> d.rate_plan_id or c.offer_ver_id <> d.offer_ver_id)"

    PriceVer_No_Use:
        sql:    "select *
          from cc.price_ver a
         where not exists (select * from cc.price b where a.price_ver_id = b.price_ver_id)
           and not exists (select * from cc.event_benefit b where a.price_ver_id = b.price_ver_id)
           and not exists (select * from cc.acm b where a.price_ver_id = b.price_ver_id)
           and (a.exp_date is null or a.exp_date > sysdate)"

    RatePlan_No_PriceVer:
        sql:   "select r.re_name,d.offer_name,d.offer_id,a.*
              from cc.rate_plan a,cc.re r,cc.offer_ver c,cc.offer d
             where not exists
             (select * from cc.price_ver b where a.rate_plan_id = b.rate_plan_id)
               and a.rate_plan_id <> -1
             and a.re_id=r.re_id
             and a.offer_ver_id=c.offer_ver_id
             and d.state='A'
             and c.offer_id=d.offer_id
             order by a.offer_ver_id"
    #        "select * from rate_plan a where not exists (select * from price_ver b where a.rate_plan_id = b.rate_plan_id) and a.rate_plan_id <> -1"

    RatePlanTemplet_No_Catalog:
        sql:   "select * from cc.rate_plan a
        where a.template_flag = 'Y'and a.rate_plan_id <> -1 and not exists (select 1 from cc.rate_plan_catalog_element b where a.rate_plan_id = b.rate_plan_id)"

    RefValue_No_OfferVerId:
        sql:   "select * from cc.REF_VALUE a
        where not exists (select * from cc.offer_ver b where a.offer_ver_id = b.offer_ver_id) and a.offer_ver_id is not null and a.offer_ver_id <> -1 and a.state != 'X'"

    RefValue_No_PriceId:
        sql:  "select *
         from cc.REF_VALUE a
        where not exists (select * from cc.price b where a.price_id = b.price_id)
          and not exists
        (select * from cc.event_benefit b where a.price_id = b.price_id)
          and not exists (select * from cc.acm b where a.price_id = b.price_id)
          and a.price_id is not null
          and a.state='A'
          and a.price_id<>999999"

    RefValue_No_RatePlanId:
        sql:  "select *
         from cc.REF_VALUE a
        where not exists
        (select 1 from cc.rate_plan b where a.rate_plan_id = b.rate_plan_id)
          and a.rate_plan_id != -1
          and a.state != 'X'"

    RefValueToOfferVer_No_OfferVerId:
        sql:   "select *
        from cc.REF_VALUE_TO_OFFER_VER a
        where not exists (select 1 from cc.offer_ver b where a.offer_ver_id = b.offer_ver_id)"

    RefValueToOfferVer_NoUse_RefValue:
        sql:  "select *
          from cc.ref_value_to_offer_ver a
         where not exists (select *
                  from cc.REF_VALUE b, cc.rate_plan_mapping c
                 where a.ref_value_id = b.ref_value_id
                   and b.rate_plan_id = c.rate_plan_id
                   and a.offer_ver_id = c.offer_ver_id)
           and a.offer_ver_id <> -1"

    RefValueToOfferVer_MissSomeData:
        sql:   "select * from cc.ref_value c, cc.rate_plan_mapping d
        where exists (select 1 from cc.rate_plan d where c.rate_plan_id = d.rate_plan_id and d.template_flag = 'Y')
          and not exists (
        select * from cc.rate_plan_mapping a, cc.ref_value_to_offer_ver b
        where a.offer_ver_id = b.offer_ver_id
          and a.offer_ver_id <> -1
          and c.ref_value_id = b.ref_value_id
          and c.rate_plan_id = a.rate_plan_id)
          and c.rate_plan_id <> -1
          and c.rate_plan_id = d.rate_plan_id
          and d.offer_ver_id <> -1"

    RePricePlan_No_RatePlanMapping:
        sql:  "select * from cc.re_price_plan a
        where not exists (select 1 from cc.rate_plan_mapping b where a.offer_ver_id = b.offer_ver_id and a.re_id = b.re_id) and a.offer_ver_id != -1"

    ScriptTemplet_No_Catalog:
        sql:   "select * from cc.script_templet a
        where not exists (select * from cc.script_templet_catalog_element b where a.script_templet_id = b.script_templet_id)"

    SortRule_Not_Output_Re_Have_Tariff:
        des:  add by FYM 检查配置了资费，但是没有分拣的
        area: comm
        sql:  "select distinct rpp.re_id, r.re_name
              from cc.re_price_plan rpp, cc.re r, cc.offer_ver ov, cc.offer o
             where rpp.re_id = r.re_id
               and r.re_type = '1'
               and not exists (select ba.param1
                      from cc.def_re_attr dra, cc.bwf_action ba
                     where ba.param1 = rpp.re_id
                       and dra.def_re_attr = '21'
                       and dra.re_attr = ba.src_re_attr
                       and ba.function = 'assign')
               and rpp.offer_ver_id = ov.offer_ver_id
               and ov.offer_id = o.offer_id
               and o.offer_id > 0"

    SortRule_OutputRe_No_Reserve:
        des: 分拣分拣出了事件，但是在预留规则中没有配置预留
        area: comm
        sql:  "select f.workflow_name, a.PARAM1 as re_id, c.RE_NAME,d.sort_rule_name, e.NODE_NAME
                      from cc.bwf_action   a,
                           cc.def_re_attr  b,
                           cc.re           c,
                           cc.bwf_step     d,
                           cc.bwf_node     e,
                           cc.bwf_workflow f
                     where a.src_re_attr = a.obj_re_attr
                       and a.src_re_attr = b.re_attr
                       and b.def_re_attr = 21
                       and a.PARAM1 = TO_CHAR(c.re_id)
                       and a.PARAM1 not in (select re_id from cc.reserve_policy)
                       and a.step_id = d.STEP_ID
                       and d.NODE_ID = e.NODE_ID
                       and e.workflow_id = f.workflow_id
                       and f.workflow_type in ('A','B')
                       and a.param1 not in ('900','972','973')"

    TempletAcm_No_Use:
        sql:   "select * from cc.acm a, cc.price_ver b
        where not exists (select 1 from cc.acm c where a.price_id = c.src_price_id) and a.price_ver_id = b.price_ver_id and b.rate_plan_id is null"

    TempletAcmAcctItem_RefValue_Error:
        sql:  "select *
          from cc.acm a, cc.ref_value b, cc.price_ver c
         where a.price_ver_id = c.price_ver_id
           and c.rate_plan_id is null
           and a.ref_value_id = b.ref_value_id
           and (a.price_id <> b.price_id or b.rate_plan_id <> -1 or b.offer_ver_id <> -1)"

    TempletAcmValue_RefValue_Error:
        sql:  "select *
          from cc.acm a, cc.ref_value b, cc.price_ver c
         where a.price_ver_id = c.price_ver_id
           and c.rate_plan_id is null
           and a.value = b.ref_value_id
           and (a.price_id <> b.price_id or b.rate_plan_id <> -1 or b.offer_ver_id <> -1)"

    TempletEventBenefit_No_Use:
        sql:   "select * from cc.event_benefit a
        where not exists (select 1 from cc.event_benefit b where a.price_id = b.src_price_id) and a.price_ver_id is null"

    TempletEventBenefit_RefValue_Error:
        sql:  "select *
          from cc.event_benefit a, cc.ref_value b
         where a.price_ver_id is null
           and a.value = b.ref_value_id
           and (a.price_id <> b.price_id or b.rate_plan_id <> -1 or b.offer_ver_id <> -1)"

    TempletPrice_No_Use:
        sql: "select * from cc.price a
        where not exists (select * from cc.price b where a.price_id = b.src_price_id) and a.price_ver_id is null"

    TempletPriceValue_RefValue_Error:
        sql: "select *
          from cc.price a, cc.ref_value b
         where a.price_ver_id is null
           and a.value = b.ref_value_id
           and (a.price_id <> b.price_id or b.rate_plan_id <> -1 or b.offer_ver_id <> -1)"

    TemplateRatePlan_No_Use:
        sql: "select * from cc.rate_plan_mapping a
        where not exists (select * from cc.rate_plan_mapping b where a.rate_plan_id = b.rate_plan_id and b.offer_ver_id != -1) and a.offer_ver_id = -1"

    Zone_same_zone_id_multiple_value:
        des: 一个value 在同一个zone_item中出现，数据冗余，无功能错误
        area: comm
        sql:  "select a.zone_map_name , b.zone_name, c.value
         from cc.zone_map a, cc.zone b, cc.zone_value c
         where a.zone_map_id=b.zone_map_id
         and b.zone_id=c.zone_id
         and c.zone_id  in (select zone_id from (select zone_id,value,count(1) from cc.zone_value d group by zone_id,value having count(1)>1))
         and c.value in (select value from (select zone_id,value,count(1) from cc.zone_value d group by zone_id,value having count(1)>1))
         order by c.value"

ErrorData:
    AcctItem_No_Define_ErrorData:
        des: AcctItem_No_Define_ErrorData
        area: comm
        sql:  "select *
                 from cc.offer a, cc.offer_ver b,cc.rate_plan c,cc.price_ver d, cc.price e, cc.ref_value f
                 where a.offer_type=4
                 and a.offer_id=b.offer_id
                 and b.offer_ver_id=c.offer_ver_id
                 and c.rate_plan_id=d.rate_plan_id
                 and d.price_ver_id=e.price_ver_id
                 and e.PRICE_ID = f.ref_value_id
                 and f.ref_value_type ='8'
                 and not exists (select 1 from cc.acct_item_type g where f.value_string = g.acct_item_type_id)"

    AcmAcctItem_RefValueId_NotExists:
        sql:  "select * from cc.acm a
        where not exists (select * from cc.ref_value b where a.ref_value_id = b.ref_value_id)"

    AcmValue_RefValueId_NotExists:
        des: AcmValue_RefValueId_NotExists
        area: comm
        sql:  "select * from cc.acm a
        where not exists (select * from cc.ref_value b where a.value = b.ref_value_id)"

    BenefitValue_RefValueId_NotExists:
        sql:  "select * from cc.event_benefit a
        where not exists (select * from cc.ref_value b where a.value = b.ref_value_id)"

    IndepProdSpec_No_Migration:
        des: AcmAcctItem_RefValueId_NotExists
        area: comm
        sql: "select b.cond_group_id,b.operand,d.sort_rule_name, e.NODE_NAME, f.workflow_name
         from cc.bwf_action   a,
              cc.bwf_cond     b,
              cc.bwf_cond_group c,
              cc.bwf_step     d,
              cc.bwf_node     e,
              cc.bwf_workflow f
        where  a.step_id = d.STEP_ID
          and d.NODE_ID = e.NODE_ID
          and b.cond_group_id=c.cond_group_id
          and c.step_id=d.step_id
          and e.workflow_id = f.workflow_id
          and b.function = 'GetIndepProdSpecId'
          and b.operand is not null
          and not exists (select 1
                 from cc.indep_prod_spec bb
                where b.operand = bb.indep_prod_spec_id)
          and e.workflow_id in (1001, 1002, 110066, 110083)"

    IndepProdSpec_No_Migration_Zone:
        sql:  "select g.zone_id,g.value,d.sort_rule_name, e.NODE_NAME, f.workflow_name
             from cc.bwf_action   a,
                  cc.bwf_cond     b,
                  cc.bwf_cond_group c,
                  cc.bwf_step     d,
                  cc.bwf_node     e,
                  cc.bwf_workflow f,
                  cc.zone_value   g
            where  a.step_id = d.STEP_ID
              and d.NODE_ID = e.NODE_ID
              and b.cond_group_id=c.cond_group_id
              and c.step_id=d.step_id
              and e.workflow_id = f.workflow_id
              and b.function = 'GetIndepProdSpecId'
              and b.zone_id=g.zone_id
              and not exists (select 1
                     from cc.indep_prod_spec bb
                    where g.value = bb.indep_prod_spec_id)
              and e.workflow_id in (1001, 1002, 110066, 110083)"

    OneACMPriceTemplet_Mapping_Muti_Re:
        sql:  "select distinct d.rate_plan_id, d.rate_plan_name, b.price_id, b.acm_name
              from cc.price_template_mapping_re a, cc.acm b, cc.price_ver c, cc.rate_plan d
             where a.price_id = b.src_price_id
               and b.price_ver_id = c.price_ver_id
               and c.rate_plan_id = d.rate_plan_id
               and a.re_id <> d.re_id"

    OneBenefitPriceTemplet_Mapping_Muti_Re:
        sql: "select distinct d.rate_plan_id, d.rate_plan_name, b.price_id, b.price_name
              from cc.price_template_mapping_re a, cc.event_benefit b, cc.price_ver c, cc.rate_plan d
             where a.price_id = b.src_price_id
               and b.price_ver_id = c.price_ver_id
               and c.rate_plan_id = d.rate_plan_id
               and a.re_id <> d.re_id"

    OneRatePlan_Mapping_Muti_Re:
        sql:  "select a.rate_plan_id
        from (select distinct re_id, rate_plan_id from cc.rate_plan_mapping) a group by a.rate_plan_id having count(1)>1"

    OneScriptTemplet_Mapping_Muti_ReType:
        sql:  "select script_templet_id from (
            select distinct temp.script_templet_id, decode(d.re_type, 3, 3, 1)
                from (select 'UP_RULE' table_name, price_id, price_ver_id, script_templet_id
                        from cc.up_rule, cc.price
                       where up_id = price_id
                      union
                      select 'OP' table_name, price_id, price_ver_id, script_templet_id
                        from cc.op, cc.price
                       where op_id = price_id
                      union
                      select 'RP' table_name, price_id, price_ver_id, script_templet_id
                        from cc.rp, cc.price
                       where rp_id = price_id
                      union
                      select 'EVENT_BENEFIT' table_name, price_id, price_ver_id, script_templet_id
                        from cc.event_benefit
                      union
                      select 'ACM_RULE' table_name, b.price_id,b.price_ver_id, script_templet_id
                        from cc.acm_rule a, cc.acm b
                       where a.price_ver_id = b.price_ver_id) temp, cc.price_ver b, cc.rate_plan c, cc.re d
          where temp.price_ver_id = b.price_ver_id
            AND b.rate_plan_id = c.rate_plan_id
            AND c.re_id = d.re_id
            and temp.script_templet_id is not null) t
          group by t.script_templet_id
          having count(1) > 1"

    PriceValue_RefValueId_NotExists:
        sql:  "select * from cc.price a
        where not exists (select * from cc.ref_value b where a.value = b.ref_value_id)"

    ProdSpec_No_Migration:
        sql:  "SELECT a.*
              FROM cc.bwf_cond a
             where function in ('GetProdStateByNumAndProdSpecID', 'judgedependprod')
               and a.param1 is not null
               and not exists (select 1
                      from cc.offer b
                     where a.param1 = b.offer_id
                       and b.offer_type in (2, 3))"

    RatePlan_OfferVer_Re_Err:
        sql:  "select t.*, t1.*
                  from cc.rate_plan_mapping t,
                       (select *
                          from cc.rate_plan a
                         where not exists (select *
                                  from cc.rate_plan_mapping b
                                 where a.re_id = b.re_id
                                   and a.offer_ver_id = b.offer_ver_id
                                   and a.rate_plan_id = b.rate_plan_id)
                           and a.rate_plan_id <> -1) t1
                 where t.offer_ver_id = t1.offer_ver_id
                   and t.re_id = t1.re_id
                   and not exists (select *
                          from cc.rate_plan c
                         where t.offer_ver_id = c.offer_ver_id
                           and t.rate_plan_id = c.rate_plan_id
                           and t.re_id = c.re_id)
                 order by t.offer_ver_id, t.re_id, t.rate_plan_id"

    ReReserve_Policy_No_Limit:
        sql:  "select f.workflow_name, a.PARAM1 as re_id, c.RE_NAME,d.sort_rule_name, e.NODE_NAME
            from cc.bwf_action   a,
            cc.def_re_attr  b,
            cc.re           c,
            cc.bwf_step     d,
            cc.bwf_node     e,
            cc.bwf_workflow f
            where a.src_re_attr = a.obj_re_attr
            and a.src_re_attr = b.re_attr
            and b.def_re_attr = 21
            and a.PARAM1 = TO_CHAR(c.re_id)
            and a.PARAM1  in (select re_id from cc.reserve_policy)
            and a.step_id = d.STEP_ID
            and d.NODE_ID = e.NODE_ID
            and e.workflow_id = f.workflow_id
            and f.workflow_type in ('A','B')
            and a.param1 not in ('900','972','973')
            and not exists (select 1 from cc.reserve_limit b where b.re_id=a.param1 )"

    SortRule_OutputRe_No_Tariff:
        sql:  "select a.PARAM1, c.RE_NAME,d.sort_rule_name, e.NODE_NAME, f.workflow_name
             from cc.bwf_action   a,
                  cc.def_re_attr  b,
                  cc.re           c,
                  cc.bwf_step     d,
                  cc.bwf_node     e,
                  cc.bwf_workflow f
            where a.src_re_attr = a.obj_re_attr
              and a.src_re_attr = b.re_attr
              and b.def_re_attr = 21
              and a.PARAM1 = TO_CHAR(c.re_id)
              and a.PARAM1 not in (select re_id from cc.re_price_plan)
              and a.step_id = d.STEP_ID
              and d.NODE_ID = e.NODE_ID
              and e.workflow_id = f.workflow_id
              and a.param1 not in ('900','972','973')
              /*and e.workflow_id in (1001, 1002, 110066, 110083)*/"

    TemplateRatePlan_No_RatePlanMapping:
        sql:  "select * from cc.rate_plan a
        where a.template_flag = 'Y'
        and not exists (select 1 from cc.rate_plan_mapping b where a.rate_plan_id = b.rate_plan_id and a.re_id = b.re_id and b.offer_ver_id = -1)
        and a.rate_plan_id <> -1"

    TemplateRatePlan_OfferVerId_Error:
        sql:  "select * from cc.rate_plan a
        where a.template_flag = 'Y' and a.offer_ver_id <> -1"

    The re_attr of reservation rule is different with the re_attr configured in price plan:
        des: 使用批价单位是次，但是批价的值是多次，比如每60次计费多少，这个基本确定是配置问题
        area: comm
        sql:  "select a.offer_name,h.re_name,e.price_name
                    from cc.offer a,cc.offer_ver b,cc.rate_plan c,cc.price_ver d,cc.price e,cc.re_attr f,cc.def_re_attr g,cc.re h
                    where a.offer_id=b.offer_id
                      and b.offer_ver_id=c.offer_ver_id
                      and c.rate_plan_id=d.rate_plan_id
                      and d.price_ver_id=e.price_ver_id
                      and e.re_attr=f.re_attr
                      and f.re_attr=g.re_attr
                      and c.re_id=h.re_id
                      and g.def_re_attr=74
                      and e.rum>1
                      and (b.exp_date is null or b.exp_date > sysdate)
                      and (d.exp_date is null or d.exp_date > sysdate)"

    ZoneId_No_Migration:
        sql: "SELECT * FROM cc.bwf_cond a
        where function='GetIndepProdSpecId' and a.zone_id is not null
        and not exists (select 1 from cc.zone b where a.zone_id = b.zone_id)"

    Zone Same zone value exists in different zone:
        des: 检查一个zone map下一个zone value同时存在不同的zone里
        area: comm
        sql:  "select d.zone_map_id,d.zone_map_name,d.value from (
        select c.zone_map_id,c.zone_map_name,a.zone_id,a.zone_name,b.value from cc.zone a,cc.zone_value b,cc.zone_map c
        where a.zone_id=b.zone_id
        and a.zone_map_id=c.zone_map_id ) d
        group by d.zone_map_id,d.zone_map_name,d.value
        having count(1)>1"



WaitEnhance:

    OFFER_NO_Catg_A:
        level: ERROR
        description: offer havent configure management catg
        sqlStr:
            "SELECT *
              FROM offer a
             WHERE offer_id BETWEEN 2000 AND 399999
               AND NOT EXISTS
                   (SELECT 1
                     FROM OFFER_CATG_MEM b, offer_catg c
                    WHERE a.OFFER_ID = b.OFFER_ID
                      AND b.OFFER_CATG_ID = c.OFFER_CATG_ID
                      AND c.OFFER_CATG_CLASS = 'A')
               AND a.offer_type != 7
               AND NOT EXISTS
                   (SELECT 1
                     FROM subs_price_plan spp
                    WHERE spp.PRICE_PLAN_TYPE = '1'
                      AND a.OFFER_ID = spp.PRICE_PLAN_ID)"

    PP_NO_GROUP:
        level: ERROR
        description: PRICE PLAN no group
        sqlStr:
            "SELECT *
               FROM offer a
              WHERE offer_id BETWEEN 2000 AND 399999
               AND a.offer_type IN ('4')
               and a.offer_id not in (122483, 123010, 123008, 122485, 123011)
               AND NOT EXISTS
                  (SELECT 1
              FROM subs_plan_offer_select spos, offer_group b, offer_group_mem c
             WHERE spos.offer_group_id = b.offer_group_id
               and a.OFFER_ID = c.OFFER_ID
               AND b.OFFER_GROUP_ID = c.OFFER_GROUP_ID
               AND b.OFFER_GROUP_TYPE in ('6', '4'))
               AND not exists (select 1
              from acct_price_plan app
             where app.price_plan_id = a.offer_id)"

    MAIN_OFFER_NO_DPP_GROUP:
        level: ERROR
        description: main offer no default price plan
        sqlStr:
            "SELECT *
              FROM offer a, offer_ver ov
             WHERE a.offer_id BETWEEN 2000 AND 399999
               AND a.offer_type IN (7)
               AND a.OFFER_ID = ov.OFFER_ID
               AND NOT EXISTS
                   (SELECT 1
                     FROM subs_plan_offer_select spos, offer_group og
                    WHERE spos.OFFER_VER_ID = ov.OFFER_VER_ID
                      AND spos.OFFER_GROUP_ID = og.OFFER_GROUP_ID
                      AND og.OFFER_GROUP_TYPE = '6')"
    MAIN_OFFER_HAVE_MULTIPLE_DPP_GRP:
        level: ERROR
        description: main offer have multiple dpp group
        sqlStr:
            "SELECT a.OFFER_ID, COUNT(*)
               FROM offer a, offer_ver ov, subs_plan_offer_select spos, offer_group og
              WHERE a.offer_id BETWEEN 2000 AND 399999
                AND a.offer_type IN (7)
                AND a.OFFER_ID = ov.OFFER_ID
                AND spos.OFFER_VER_ID = ov.OFFER_VER_ID
                AND spos.OFFER_GROUP_ID = og.OFFER_GROUP_ID
                AND og.OFFER_GROUP_TYPE = '6'
                GROUP BY a.OFFER_ID HAVING COUNT(1)>1"

    OFFER_GROUP_NO_MAIN_OFFER:
        level: ERROR
        description: offer group no main offer
        sqlStr:
            "SELECT *
              FROM offer_group og
             WHERE og.OFFER_GROUP_ID BETWEEN 10000 AND 200000
               AND NOT EXISTS
                   (SELECT 1
                     FROM subs_plan_offer_select spos
                    WHERE spos.OFFER_GROUP_ID = og.OFFER_GROUP_ID)"

    OFFER_GROUP_NO_MEM:
        level: ERROR
        description: offer group no member
        sqlStr:
            "SELECT *
              FROM offer_group og
             WHERE og.OFFER_GROUP_ID BETWEEN 10000 AND 200000
               AND NOT EXISTS
                   (SELECT 1
                     FROM offer_group_mem ogm
                    WHERE ogm.OFFER_GROUP_ID = og.OFFER_GROUP_ID)"

    DPP_MANDATORY:
        level: ERROR
        description: the default price plan should be mandatory
        sqlStr:
            "SELECT *
               FROM subs_plan_offer_select
              WHERE offer_group_id IN
                    (SELECT offer_group_id
                       FROM offer_group
                      WHERE offer_group_type='6')
                        AND necessary != 1"

    SERV_TYPE_IS_NULL:
        level: ERROR
        description: the service type is null for main product
        sqlStr:
            "select * from INDEP_PROD_SPEC where SERV_TYPE is null"

    MAIN_PROD_IS_NULL:
        level: ERROR
        description: the main product is null
        sqlStr:
            "select * from SUBS_PLAN where INDEP_PROD_SPEC_ID is null"

    OFFER_DUPLICATE_IN_SUBS_PLAN:
        level: ERROR
        description: offer duplicate in subs plan
        sqlStr:
            "SELECT sp1.OFFER_VER_ID, sp2.OFFER_VER_ID, ogm2.OFFER_ID
               FROM subs_plan_offer_select sp1, subs_plan_offer_select sp2, offer_group_mem ogm1, offer_group_mem ogm2
              WHERE sp1.OFFER_VER_ID = sp2.OFFER_VER_ID
                AND sp1.OFFER_GROUP_ID = ogm1.OFFER_GROUP_ID
                AND sp2.OFFER_GROUP_ID = ogm2.OFFER_GROUP_ID
                AND sp1.OFFER_GROUP_ID != sp2.OFFER_GROUP_ID
                AND ogm1.OFFER_ID = ogm2.OFFER_ID"

    OFFER_DUPLICATE_IN_OFFER_GROUP:
        level: ERROR
        description: offer duplicate in offer group
        sqlStr:
            "SELECT * FROM offer_group_mem b WHERE (offer_group_id, offer_id) IN (
             SELECT offer_group_id, offer_id
               FROM offer_group_mem
              where offer_id between 5000 and 400000
                and offer_group_id between 10000 and 200000
              GROUP BY offer_group_id, offer_id HAVING COUNT(*)>1)"

    SUBS_PLAN_MAIN_PROD_MULTI_ATTR:
        level: ERROR
        description: the attr is multiplicate in subs plan
        sqlStr:
            "SELECT spoa.OFFER_VER_ID, spoa.ATTR_ID, COUNT(*)
               FROM subs_plan_offer_attr spoa, offer o
              WHERE spoa.OFFER_ID = o.OFFER_ID
                AND o.offer_type = 2
                GROUP BY spoa.OFFER_VER_ID, spoa.ATTR_ID
                HAVING COUNT(1)>1"

    OFFER_CODE_DUPLICATED:
        level: ERROR
        description: the OFFER CODE is duplicated
        sqlStr:
            "SELECT o.offer_code, COUNT(*)
               FROM offer o
              where o.offer_id between 5000 and 400000
               GROUP BY o.offer_code
                HAVING COUNT(1)>1"

    GOODS_OFFER_NO_SPEC:
        level: ERROR
        description: goods offer no goods_prod_spec
        sqlStr:
            "select *
               from offer a
              where a.offer_type = 5
                and a.offer_id not in (select goods_prod_spec_id from goods_prod_spec b)"

    DEFAULT_OFFER_GROUP_ERROR:
        level: ERROR
        description: default offer group have not set default offer
        sqlStr:
            "select *
               from offer_group og
              where og.offer_group_type = '6'
                and og.offer_group_id between 10000 and 1000000
                and not exists (
                    select 1
                      from offer_group_mem ogm
                     where ogm.offer_group_id = og.offer_group_id
                       and ogm.default_flag = 'Y')"

    DEFAULT_OFFER_GROUP_MEM_ERROR:
        level: ERROR
        description: default offer group have set more than one default offer
        sqlStr:
            "select *
               from offer_group og
              where og.offer_group_type = '6'
                and og.offer_group_id between 10000 and 1000000
                and exists (
                    select ogm.offer_group_id
                      from offer_group_mem ogm
                     where ogm.offer_group_id = og.offer_group_id
                       and ogm.default_flag = 'Y'
                       group by ogm.offer_group_id having count(1)>1)"

    BUNDLE_MEMBER_ONLY_SOLD_IN_BUNDLE:
        level: ERROR
        description: bundle member should be set bundle flag to Yes
        sqlStr:
            "select o.*
               from subs_plan a, offer o
              where a.is_bundle_flag = 'N'
                and a.subs_plan_id = o.offer_id
                and a.subs_plan_id not in ('175948', '175922', '175875', '175886', '175953', '175895', '175872', '175851',
             '175935', '170006', '175833', '175832', '175835', '175834', '175923', '175852',
             '175831', '175952', '170005', '170004', '176705')
                and a.subs_plan_id in (
                    select b.subs_plan_id
                      from bundle_unit_subs_plan b)"

    ACCOUNT_ITEM_TYPE_CODE_NULL:
        level: ERROR
        description: Account item type code should not be null
        sqlStr:
            "select a.*
               from acct_item_type a, dc_revenue_code_acct_item_map b
              where a.acct_item_type_code is null
                and a.acct_item_type_id = b.acct_item_type_id"

    BUNDLE_MEMBER_NO_NEED_OTC:
        level: ERROR
        description: Bundle member should not have one time charge
        sqlStr:
            "select /*+ parallel(12)*/ mm.*
                from bundle_unit_subs_plan busp, offer_ver ov, subs_plan_offer_select spos,
                     offer_group_mem ogm, offer_ver ovi, rate_plan rp, re r, offer mm, subs_price_plan spp
              where busp.subs_plan_id = ov.offer_id
                and ov.offer_ver_id = spos.offer_ver_id
                and spos.offer_group_id = ogm.offer_group_id
                and ogm.offer_id = ovi.offer_id
                and ovi.offer_ver_id = rp.offer_ver_id
                and rp.re_id = r.re_id
                and re_type in ('3', 'A')
                and r.re_id != '1006'
                and ogm.offer_id = mm.offer_id
                and mm.offer_id = spp.price_plan_id
                and spp.price_plan_type = '2'"

    BUNDLE_MEMBER_NO_NEED_DEPOSIT_PRICE:
        level: ERROR
        description: Bundle member no need configure BSNL_DEPOSIT_PRICE attribute
        sqlStr:
            "select /*+ parallel(12)*/ mm.*
                from bundle_unit_subs_plan busp, offer_ver ov, subs_plan_offer_select spos,
                     offer_group_mem ogm, offer_ver ovi, rate_plan rp, re r, offer mm, subs_price_plan spp,
                     offer_attr oa, attr ar
              where busp.subs_plan_id = ov.offer_id
                and ov.offer_ver_id = spos.offer_ver_id
                and spos.offer_group_id = ogm.offer_group_id
                and ogm.offer_id = ovi.offer_id
                and ovi.offer_ver_id = rp.offer_ver_id
                and rp.re_id = r.re_id
                and re_type in ('3', 'A')
                and r.re_id != '1006'
                and ogm.offer_id = mm.offer_id
                and mm.offer_id = spp.price_plan_id
                and spp.price_plan_type = '2'
                and oa.offer_id = mm.offer_id
                and oa.attr_id = ar.attr_id
                and ar.attr_code = 'BSNL_DEPOSIT_PRICE'"

    ACCT_ITEM_TYPE_APPLY_TAX:
        level: ERROR
        description: account item type not apply tax
        sqlStr:
            "select /*+ parallel(12)*/*
               from acct_item_type a
              where a.acct_item_type_id not in (select b.acct_item_type_id from acct_item_tax_apply b)
                and substr(a.acct_item_type_code, 3, 2) != '09'
                and (a.parent_id not in (30101, 214) or a.parent_id is null)
                and a.acct_item_type_id not between 59000 and 59999
                and a.acct_item_type_id not between 68001 and 68013
                and a.acct_item_type_id not in ('30001', '122', '123', '10137', '16141')"

    ACCT_ITEM_TYPE_USAGE_TYPE:
        level: ERROR
        description: account item type usage type should not be null
        sqlStr:
            "select /*+ parallel(12)*/*
               from acct_item_type
              where acct_item_type_id between 30001 and 40000
                and usage_type is null
                and comments in ('Additional Rental Charge', 'Leased Line Advance RC', 'VSAT Site Advance RC',
                    'VSAT Other Advance RC', 'Advance Rental', 'FMT Advance Rental')"

    BSNL_FMC_CHARGE:
        level: ERROR
        description: BSNL_FMC_CHARGE missing
        sqlStr:
            "select /*+ parallel(12)*/a.price_plan_id, o.offer_name, sp.*
               from subs_price_plan        a,
                    offer_group_mem        ogm,
                    subs_plan_offer_select spos,
                    subs_plan              sp,
                    offer o
              where a.price_plan_type = '2'
                and a.price_plan_id between 600 and 400000
                and a.price_plan_id = ogm.offer_id
                and ogm.offer_group_id = spos.offer_group_id
                and spos.offer_ver_id = sp.subs_plan_id
                and a.price_plan_id = o.offer_id
                and (sp.sale_flag = '0' or
                    (sp.sale_flag = '2' and
                    sp.indep_prod_spec_id not in
                    (200007, 200003, 200005, 200031, 200009, 200010, 200011)))
                and sp.indep_prod_spec_id not in (200028, 200014, 200015, 200092, 200056,200019,200037,200047,200063,200060,200061,200068,
                    200062,200067,200065,200059,200057,200058,200064,200066,200069,200070,200071,200072,200073,200074,200075,200076,200077,
                    200078,200079,200080,200081,200091,200093,200095)
                and a.price_plan_id not in (122402,123936,123938,123937,123939)
                and not exists (select 1
                       from offer_attr oa, attr ar
                      where oa.attr_id = ar.attr_id
                        and ar.attr_code in ('BSNL_FMC_CHARGE', 'BSNL_TOTAL_FMC_CHARGE')
                        and oa.offer_id = a.price_plan_id)"

    COMBO_VOICE_DPP:
        level: ERROR
        description: only need one dpp for combo voice subs plan
        sqlStr:
            "select /*+ parallel(12)*/offer_group_id, count(1) from (
             select distinct ogm.offer_group_id, ogm.offer_id
               from offer_group_mem ogm, subs_plan_offer_select spos, offer_group og, subs_plan sp
              where ogm.offer_group_id = og.offer_group_id
                and og.offer_group_type = 6
                and og.offer_group_id = spos.offer_group_id
                and spos.offer_ver_id = sp.subs_plan_id
                and sp.indep_prod_spec_id in ('200007', '200005', '200003', '200031', '200010', '200011', '200009')
                and sp.sale_flag = '2') tt
                group by tt.offer_group_id having count(1)>1"

    ANNUAL_SUBS_PLAN_MERGET_INTO_MONTHLY:
        level: ERROR
        description: ANNUAL plan should merget into montly plan
        sqlStr:
            "select /*+ parallel(12)*/b.*
               from dc_tariff_dpp_rela a, dc_tariff_id_mapping_west b
              where a.type_of_plan in ('ANNUAL', 'HALF YEARLY', 'QUARTERLY')
                and a.tariff_id_billing = b.org_id
                and b.map_type = 'SUBS_PLAN_OFFER_ID'
                and b.deal_flag = '1'
                and a.tariff_in_monthly != a.tariff_id_billing
                and a.dpp_type = 'TARIFF'
                and b.org_code in ('802', '6', '335', '734')"

    COMBO_ANNUAL_PRICE_PLAN_MERGET_INTO_MONTHLY:
        level: ERROR
        description: Combo annual price plan should merget into montly price plan
        sqlStr:
            "select /*+ parallel(12)*/b.*
               from dc_tariff_dpp_rela a, dc_tariff_id_mapping_west b
              where a.type_of_plan in ('ANNUAL', 'HALF YEARLY', 'QUARTERLY')
                and a.tariff_id_billing = b.org_id
                and b.map_type = 'PRICE_PLAN_OFFER_ID'
                and b.deal_flag = '1'
                and a.tariff_in_monthly != a.tariff_id_billing
                and a.dpp_type = 'TARIFF'
                and b.org_code in ('802', '6', '335', '734')
                and b.ext_str6 = 'COMBO'"

    COMBO_MEMBER:
        level: ERROR
        description: Combo must have three subs plan
        sqlStr:
            "select /*+ parallel(12)*/bundle_unit_id
               from bundle_unit_subs_plan a
              where not exists (
                    select 1
                      from bundle_unit bu, subs_plan sp
                     where bu.bundle_unit_id = a.bundle_unit_id
                       and bu.offer_ver_id = sp.subs_plan_id
                       and sp.indep_prod_spec_id = '200082')
              group by a.bundle_unit_id having count(1) != 3"

    COMBO_MEMBER_WIFI:
        level: ERROR
        description: Combo must have two subs plan for wifi
        sqlStr:
            "select /*+ parallel(12)*/bundle_unit_id
               from bundle_unit_subs_plan a
              where exists (
                    select 1
                      from bundle_unit bu, subs_plan sp
                     where bu.bundle_unit_id = a.bundle_unit_id
                       and bu.offer_ver_id = sp.subs_plan_id
                       and sp.indep_prod_spec_id = '200082')
              group by a.bundle_unit_id having count(1) != 2"

    COMBO_MEMBER_INDEPEND:
        level: ERROR
        description: Combo must have three independ product
        sqlStr:
            "select /*+ parallel(12)*/bundle_unit_id
                from bundle_unit_indep_prod_spec a
               where not exists (
                     select 1
                       from bundle_unit bu, subs_plan sp
                      where bu.bundle_unit_id = a.bundle_unit_id
                        and bu.offer_ver_id = sp.subs_plan_id
                        and sp.indep_prod_spec_id = '200082')
                 group by a.bundle_unit_id having count(1) != 3"

    COMBO_MEMBER_INDEPEND_WIFI:
        level: ERROR
        description: Combo must have three independ product for wifi
        sqlStr:
            "select /*+ parallel(12)*/bundle_unit_id
               from bundle_unit_indep_prod_spec a
              where exists (
                    select 1
                      from bundle_unit bu, subs_plan sp
                     where bu.bundle_unit_id = a.bundle_unit_id
                       and bu.offer_ver_id = sp.subs_plan_id
                       and sp.indep_prod_spec_id = '200082')
                group by a.bundle_unit_id having count(1) != 2"

    NO_TARIFFELEMENT_SUBSPLAN:
        level: ERROR
        description: should remove those subs plan as not in tariffelement table
        sqlStr:
            "select /*+ parallel(12)*/*
               from dc_tariff_id_mapping_west a
              where a.map_type in ('SUBS_PLAN_OFFER_ID')
                and a.deal_flag = '1'
                and a.org_code not like 'D%'
                and a.org_id is not null
                and a.org_id not in ('2870', '2871', '2872', '2873', '2874', '2875')
                and a.org_code not in ('PERMANENT', '296', '100111', '100112', '100113', '100114', '100115', '586')
                and a.ext_str1 not in ('CASUAL')
                and (a.comments is null or a.comments not in ('caigh:have some subscriber', 'caigh:for migration'))
                and not exists (
                    select 1
                      from west.tariffelement b
                     where b.catalogue_change_id = 860
                       and to_char(b.tariff_id) = a.org_id
                       and to_char(b.product_id) = a.org_code
                       and b.end_dat is null)"

    NO_TARIFFELEMENT_PRICEPLAN:
        level: ERROR
        description: should remove those price plan as not in tariffelement table
        sqlStr:
            "select /*+ parallel(12)*/*
               from dc_tariff_id_mapping_west a
              where a.map_type in ('PRICE_PLAN_OFFER_ID')
                and a.deal_flag = '1'
                and a.org_code not like 'D%'
                and a.org_id not in ('2870', '2871', '2872', '2873', '2874', '2875')
                and a.org_code not in ('RATING_TARIFF', '239', 'RATING_TARIFF_SPECIAL', '296', '586')
                and a.ext_str1 not in ('SCHEME', 'CUG_DPP', 'OTC-SCHEME', 'RELATED_IPP', 'Bearing DPP', 'ACCOUNT_IPP')
                and a.target_id not in (122402)
                and (a.comments is null or a.comments not in ('caigh:have some subscriber', 'caigh:for migration'))
                and not exists (
                    select 1
                      from west.tariffelement b
                     where b.catalogue_change_id = 860
                       and to_char(b.tariff_id) = a.org_id
                       and to_char(b.product_id) = a.org_code
                       and b.end_dat is null)"

    COMBO_LL_MEMBER_RENTAL_ZERO:
        level: ERROR
        description: the rental of LL member of combo should be zero
        sqlStr:
            "select /*+ parallel(12)*/*
               from dc_tariff_id_mapping a
              where a.map_type = 'PRICE_PLAN_OFFER_ID'
                and a.ext_str6 = 'SOUTH'
                and a.deal_flag = '1'
                and a.ext_str3 in ('COMBO-MEMBER-LL')
                and a.ext_str2 != '0'"

    OFFER_NEED_RENAME:
        level: ERROR
        description: offer need rename
        sqlStr:
            "select *
               from offer o
              where o.offer_type = 7
                and not exists (
                    select 1
                      from DC_OFFER_DETAIL b
                     where b.offer_id = o.offer_id)
                and o.offer_id between 70000 and 370000
             union all
             select *
               from offer o
              where o.offer_type = 4
                and not exists (
                    select 1
                      from DC_OFFER_DETAIL b
                     where b.offer_id = o.offer_id)
                and exists (
                    select 1
                      from subs_price_plan c
                     where c.price_plan_id = o.offer_id
                       and c.price_plan_type = '2')
                and o.offer_id between 20000 and 370000"

    OFFER_GROUP_MEM_OFFER_NOT_EXIST:
        level: ERROR
        description: Offer id not exist
        sqlStr:
            "SELECT *
              FROM offer_group_mem og
             WHERE og.OFFER_GROUP_ID BETWEEN 10000 AND 200000
               AND og.offer_id between 1000 and 400000
               AND NOT EXISTS
                   (SELECT 1
                     FROM offer o
                    WHERE o.offer_id = og.offer_id)"

    ISD_IPP_CHECK:
        level: ERROR
        description: "subs plan configured ISD, but haven't configure ISD usage price"
        sqlStr:
            "select o.*
               from subs_plan_offer_select spoa, offer_group_mem ogm,
                    depend_prod_spec dps, offer o
              where spoa.offer_group_id = ogm.offer_group_id
                and ogm.offer_id = dps.depend_prod_spec_id
                and dps.serv_type = 193
                and spoa.offer_ver_id = o.offer_id
                and o.offer_id not in (170002,171700,171701,171702,171703,171704,171705,171036,171181,171611,176980,176981,170568)
                and not exists (
                    select 1
                      from subs_plan_offer_select spos, offer_group_mem ogmi, offer_group og, offer oi
                     where spos.offer_ver_id = spoa.offer_ver_id
                       and spos.offer_group_id = ogmi.offer_group_id
                       and ogmi.offer_group_id = og.offer_group_id
                       and og.offer_group_type = '4'
                       and og.offer_group_name like '%RATING GRP'
                       and ogmi.offer_id = oi.offer_id
                       and oi.offer_name like '%ISD%')"

    DPP_GROUP_CHECK:
        level: ERROR
        description: "dpp offer group shouldn't have ipp"
        sqlStr:
            "select *
               from offer_group og, offer_group_mem ogm, subs_price_plan spp
              where og.offer_group_type = 6
                and og.offer_group_id = ogm.offer_group_id
                and ogm.offer_id = spp.price_plan_id
                and spp.price_plan_type != '2'"

    OFFER_APPLY_CATG_CHECK:
        level: ERROR
        description: "catg haven't defined"
        sqlStr:
            "select *
               from offer_apply_catg oac
              where not exists (
                    select 1
                      from catg c
                     where c.catg_id = oac.catg_id)"

    UOS_TACHE_DEF_IP:
        level: ERROR
        description: "can't have IP address"
        sqlStr: "select * from uosflow.UOS_TACHE_DEF t where t.serviceurl like '%ttp%'"

    UOS_PROCESSDEFINE_XML:
        level: ERROR
        description: "can't have IP address"
        sqlStr: "select * from uosflow.UOS_PROCESSDEFINE_XML a where dbms_lob.instr(a.detail,'ServiceType=\"HTTP\" ServiceUrl=\"http:')>0"

    OFFER_CATG_MEM_SALES:
        level: ERROR
        description: "child category can't in multiple category"
        sqlStr: "select count(*) from offer_catg_mem ocm where ocm.child_offer_catg_id is not null group by ocm.child_offer_catg_id having count(*)>1"

    CHECK_DUPLICATE_MONTHLY_DPP:
        level: ERROR
        description: "Can't have two montly dpp in one offer group"
        sqlStr: "select * from offer   WHERE offer_id IN
                 (select SUBS_PLANID from (
                 select SUBS_PLANID,count(1) cnt from (
                 select distinct so.offer_id Subs_planid,so.offer_code subs_plan_code, so.offer_name subs_plan_name,
                 po.offer_id DPP_id,po.offer_code DPP_code, po.offer_name DPP_name
                 from offer so,  offer po, subs_plan sp, offer_group og, offer_group_mem om,OFFER_CATG_MEM ocm,offer_catg oc
                 where so.offer_id = sp.subs_plan_id
                 and so.offer_id=ocm.offer_id
                 and ocm.offer_catg_id=oc.offer_catg_id
                 and og.offer_group_type = '6'
                 and og.offer_ver_id = sp.subs_plan_id
                 and og.offer_group_id = om.offer_group_id
                 and po.offer_id = om.offer_id
                 and oc.state='A'
                 and oc.comments not in ('SubsPlan Child Catg For SDC Plans')
                 ) WHERE DPP_NAME  LIKE '%MONTHLY%' and DPP_NAME not LIKE '%SIX-MONTHLY%'
                 GROUP BY SUBS_PLANID)  WHERE cnt >1)"

    CHECK_DUPLICATE_ANNUALLY_DPP:
        level: ERROR
        description: "Can't have two annually dpp in one offer group"
        sqlStr: "select * from offer   WHERE offer_id IN
                 (select SUBS_PLANID from (
                 select SUBS_PLANID,count(1) cnt from (
                 select distinct so.offer_id Subs_planid,so.offer_code subs_plan_code, so.offer_name subs_plan_name,
                 po.offer_id DPP_id,po.offer_code DPP_code, po.offer_name DPP_name
                 from offer so,  offer po, subs_plan sp, offer_group og, offer_group_mem om,OFFER_CATG_MEM ocm,offer_catg oc
                 where so.offer_id = sp.subs_plan_id
                 and so.offer_id=ocm.offer_id
                 and ocm.offer_catg_id=oc.offer_catg_id
                 and og.offer_group_type = '6'
                 and og.offer_ver_id = sp.subs_plan_id
                 and og.offer_group_id = om.offer_group_id
                 and po.offer_id = om.offer_id
                 and oc.state='A'
                 and oc.comments not in ('SubsPlan Child Catg For SDC Plans')
                 ) WHERE DPP_NAME  LIKE '%ANNUAL%' AND DPP_NAME NOT  LIKE '%BI-ANNUAL%' and  DPP_NAME NOT  LIKE '%BIANNUAL%'
                 GROUP BY SUBS_PLANID)  WHERE cnt >1)"

    CHECK_RENTAL_CYCLE_DPP:
        level: ERROR
        description: "Rental cycle is different with legacy"
        sqlStr: "select * from (
                   SELECT DISTINCT   tim.TARGET_ID ,t1.tariff_id,t1.tariff_name,t2.product_id,t2.charge_period,t2.charge_period_units,  o2.DEFAULT_VALUE AS value217,
                   CASE o1.DEFAULT_VALUE WHEN '1' THEN 'D'
                     WHEN '2' THEN  'W'
                     WHEN '3' THEN  'M'
                     WHEN '6' THEN  'M'
                     WHEN '4' THEN  'Y'
                     ELSE  o1.DEFAULT_VALUE END AS value216
                   from west.tariff t1,west.product t11,west.tariffelement t2,west.TARIFFELEMENTBAND t3
                   ,DC_TARIFF_ID_MAPPING_WEST tim,OFFER_ATTR o1 , OFFER_ATTR o2
                   where t1.tariff_id=t2.tariff_id and t2.tariff_id=t3.tariff_id
                   and t2.product_id=t3.product_id and t2.catalogue_change_id=t1.catalogue_change_id and t3.catalogue_change_id=t1.catalogue_change_id
                   and t2.end_dat is null and t2.catalogue_change_id =860 and t3.catalogue_change_id=860
                   and t2.product_id=t11.product_id and t2.start_dat=t3.start_dat  AND o1.OFFER_ID =tim.TARGET_ID  AND o2.OFFER_ID =tim.TARGET_ID
                   AND tim.ORG_ID = to_char(t1.TARIFF_ID) AND tim.ORG_CODE = to_char(t11.product_id) and tim.map_type='PRICE_PLAN_OFFER_ID'
                   and tim.target_val='2' and tim.deal_flag='1'
                   AND o1.ATTR_ID = '216' AND o2.ATTR_ID = '217' )  a WHERE charge_period <> value217 OR charge_period_units <> value216"

    HSN_CODE_CONFIGURE:
        level: ERROR
        description: "the relationship should be there between acct item type and HSN"
        sqlStr: "select *
                 from dc_hsn_ait_mapping_west
                 where hsn_code not in ('851762', '997316', '998412')
                    or acct_item_type_id is null
                    or (hsn_code = '851762' and substr(acct_item_type_code, 3, 2) != '14')
                    or (hsn_code = '997316' and substr(acct_item_type_code, 3, 2) not in ('07', '22'))
                    or substr(acct_item_type_code, 3, 2) in ('09')"

    AAA_ATTRIBUTE_CHECK:
        level: ERROR
        description: "3A feature should be configured"
        sqlStr: "select *
                   from subs_plan_offer_attr spo, subs_plan sp,dc_tariff_id_mapping_west tim
                  where spo.offer_ver_id = sp.subs_plan_id
                  and tim.target_id = sp.subs_plan_id
                  and tim.map_type='SUBS_PLAN_OFFER_ID'
                  and tim.deal_flag='1'
                  and spo.attr_id = (select attr_id from attr where attr_CODE = 'BSNL_AAA_DESC')
                  and sp.indep_prod_spec_id in (select ids.indep_prod_spec_id from indep_prod_spec ids where ids.serv_type in (79,903,931))
                  and spo.default_value is null
                  and exists(select 1 from offer_catg_mem ocm, offer_catg oc
                             where ocm.offer_catg_id = oc.offer_catg_id
                             and oc.offer_catg_class = 'B'
                             and ocm.offer_id = spo.offer_ver_id)"

    ACCOUNT_TYPE_CHECK_FROM_SALES_RULE:
        level: ERROR
        description: "Account type for scheme sales rule should be configured in attr_value table"
        sqlStr: "select * 
                   from  TABULAR_SALES_RULE_ATTR_VALUE tv,TABULAR_SALES_RULE se,SALES_RULE s
                  where tv.rule_attr_code in ('ACCOUNT_TYPE')
                    and not exists(select 1 from attr_value av where av.base_attr_id='77' and av.value = tv.value)
                    and tv.tabular_rule_id = se.tabular_rule_id
                    and se.sales_rule_id = s.sales_rule_id"

    ACCOUNT_SUB_TYPE_CHECK_FROM_SALES_RULE:
        level: ERROR
        description: "Account sub type for scheme sales rule should be configured in attr_value table"
        sqlStr: "select * from  TABULAR_SALES_RULE_ATTR_VALUE tv,TABULAR_SALES_RULE se,SALES_RULE s
                  where tv.rule_attr_code in ('ACCOUNT_SUBS_TYPE')
                    and not exists(select 1 from attr_value av where av.base_attr_id='768' and av.value = tv.value)
                    and tv.tabular_rule_id = se.tabular_rule_id
                    and se.sales_rule_id = s.sales_rule_id"

    ACCOUNT_TYPE_CHECK_FROM_SALES_CATG:
        level: ERROR
        description: "Account type for sales catgory should be configured in attr_value table"
        sqlStr: "select * from  ACCT_CATG_ATTR_VALUE gv
                  where gv.base_attr_id='77'
                    and not exists(select 1 from attr_value av where av.base_attr_id='77' and av.value = gv.value)"

    ACCOUNT_SUB_TYPE_CHECK_FROM_SALES_CATG:
        level: ERROR
        description: "Account sub type for sales catgory should be configured in attr_value table"
        sqlStr: "select * from  ACCT_CATG_ATTR_VALUE gv
                  where gv.base_attr_id='768'
                    and not exists(select 1 from attr_value av where av.base_attr_id='768' and av.value = gv.value)"

    STD_LOCAL_USAGE_IPP:
        level: ERROR
        description: "STD AND LOCAL usage IPP should not duplicately apply under a subs_plan"
        sqlStr: "select d.org_id, o7.offer_id, o7.offer_name, count(1)
                   from dc_tariff_id_mapping_west d,
                        offer                     o7,
                        subs_plan_offer_select    spos,
                        offer_group_mem           ogm,
                        offer_group               og,
                        offer                     o4
                  where d.deal_flag = '1'
                  and d.map_type = 'SUBS_PLAN_OFFER_ID'
                  and d.target_id = o7.offer_id
                  and o7.offer_id = spos.offer_ver_id
                  and spos.offer_group_id = ogm.offer_group_id
                  and ogm.offer_group_id = og.offer_group_id
                  and og.offer_group_name like '%RATING GRP'
                  and ogm.offer_id = o4.offer_id
                  and o4.offer_name like '%_LCL_%'
                  and o4.offer_name not like '%_SPECIAL'
                  and d.org_id not in ('1215')
                group by d.org_id, o7.offer_id, o7.offer_name
               having count(1) > 1"

    ISD_USAGE_IPP:
        level: ERROR
        description: "ISD usage IPP should not duplicately apply under a subs_plan"
        sqlStr: "select d.org_id, o7.offer_id, o7.offer_name, count(1)
                   from dc_tariff_id_mapping_west d,
                        offer                     o7,
                        subs_plan_offer_select    spos,
                        offer_group_mem           ogm,
                        offer_group               og,
                        offer                     o4
                  where d.deal_flag = '1'
                  and d.map_type = 'SUBS_PLAN_OFFER_ID'
                  and d.target_id = o7.offer_id
                  and o7.offer_id = spos.offer_ver_id
                  and spos.offer_group_id = ogm.offer_group_id
                  and ogm.offer_group_id = og.offer_group_id
                  and og.offer_group_name like '%RATING GRP'
                  and ogm.offer_id = o4.offer_id
                  and o4.offer_name like '%_ISD_%'
                  and o4.offer_name not like '%_SPECIAL'
                group by d.org_id, o7.offer_id, o7.offer_name
               having count(1) > 1"

    SPECIAL_USAGE_IPP:
        level: ERROR
        description: "LCL special usage IPP should be configured for subs pan that have LCL usage IPP"
        sqlStr: "select distinct og.* from offer_group og, offer_group_mem ogm
                  where og.offer_group_id=ogm.offer_group_id
                    and og.comments ='RATING TARIFF IPP WDC'
                    and exists(select 1 from offer o,offer_group_mem oga
                                where o.offer_id = oga.offer_id
                                  and ogm.offer_group_id = oga.offer_group_id
                                  and o.offer_name like '%_LCL_%')
                    and not exists(select 1 from offer p,offer_group_mem ogb
                                    where p.offer_id = ogb.offer_id
                                      and ogm.offer_group_id = ogb.offer_group_id
                                      and p.offer_name like '%SPECIAL')"

    ACCOUNT_ITEM_HSN_CODE_NEED_ADD_CZ:
        level: ERROR
        description: "Account item should have HSN_CODE"
        sqlStr: "select a.* from dc_revenue_code_acct_item_map a
                  where a.acct_item_type_id not in (select b.acct_item_type_id from bsnl_hsn_ait_mapping_west b)
                    and substr(a.acct_item_type_code, 3, 2) not in ('09', '10') 
                  order by a.acct_item_type_id"

    ACCOUNT_ITEM_HSN_CODE_NEED_DELETE_CZ:
        level: ERROR
        description: "Account item should DELETE HSN_CODE"
        sqlStr: "select *
                 from bsnl_hsn_ait_mapping_west a
                 where a.acct_item_type_id not in (select b.acct_item_type_id
                                      from dc_revenue_code_acct_item_map b
                                      where b.revenue_code_id is not null) 
                and not a.acct_item_type_id between 36001 and 36274 
                order by a.acct_item_type_id"

    BSNL_PACKAGE_ID_ATTR_VALUE:
        level: ERROR
        description: "Package id should in attr value"
        sqlStr: "select * from subs_plan_offer_attr spa
                  where spa.attr_id = (select attr_id from attr where attr_code ='BSNL_PACKAGE_ID')
                    and not exists(select 1 from attr_value av
                    where av.base_attr_id = spa.attr_id
                     and av.value = spa.default_value)"